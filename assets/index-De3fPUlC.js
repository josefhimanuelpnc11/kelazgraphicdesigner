var bw=i=>{throw TypeError(i)};var Tg=(i,t,e)=>t.has(i)||bw("Cannot "+e);var Te=(i,t,e)=>(Tg(i,t,"read from private field"),e?e.call(i):t.get(i)),yi=(i,t,e)=>t.has(i)?bw("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),Wn=(i,t,e,n)=>(Tg(i,t,"write to private field"),n?n.call(i,e):t.set(i,e),e),vi=(i,t,e)=>(Tg(i,t,"access private method"),e);var Aw=(i,t,e,n)=>({set _(s){Wn(i,t,s,e)},get _(){return Te(i,t,n)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();function VC(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var xg={exports:{}},uu={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ww;function UC(){if(ww)return uu;ww=1;var i=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(n,s,o){var l=null;if(o!==void 0&&(l=""+o),s.key!==void 0&&(l=""+s.key),"key"in s){o={};for(var u in s)u!=="key"&&(o[u]=s[u])}else o=s;return s=o.ref,{$$typeof:i,type:n,key:l,ref:s!==void 0?s:null,props:o}}return uu.Fragment=t,uu.jsx=e,uu.jsxs=e,uu}var Ew;function FC(){return Ew||(Ew=1,xg.exports=UC()),xg.exports}var g=FC(),Cg={exports:{}},Bt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sw;function BC(){if(Sw)return Bt;Sw=1;var i=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),v=Symbol.iterator;function b(q){return q===null||typeof q!="object"?null:(q=v&&q[v]||q["@@iterator"],typeof q=="function"?q:null)}var A={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,E={};function T(q,it,ht){this.props=q,this.context=it,this.refs=E,this.updater=ht||A}T.prototype.isReactComponent={},T.prototype.setState=function(q,it){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,it,"setState")},T.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function C(){}C.prototype=T.prototype;function L(q,it,ht){this.props=q,this.context=it,this.refs=E,this.updater=ht||A}var k=L.prototype=new C;k.constructor=L,S(k,T.prototype),k.isPureReactComponent=!0;var V=Array.isArray,P={H:null,A:null,T:null,S:null,V:null},G=Object.prototype.hasOwnProperty;function I(q,it,ht,W,ft,Nt){return ht=Nt.ref,{$$typeof:i,type:q,key:it,ref:ht!==void 0?ht:null,props:Nt}}function N(q,it){return I(q.type,it,void 0,void 0,void 0,q.props)}function M(q){return typeof q=="object"&&q!==null&&q.$$typeof===i}function j(q){var it={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(ht){return it[ht]})}var F=/\/+/g;function z(q,it){return typeof q=="object"&&q!==null&&q.key!=null?j(""+q.key):it.toString(36)}function U(){}function st(q){switch(q.status){case"fulfilled":return q.value;case"rejected":throw q.reason;default:switch(typeof q.status=="string"?q.then(U,U):(q.status="pending",q.then(function(it){q.status==="pending"&&(q.status="fulfilled",q.value=it)},function(it){q.status==="pending"&&(q.status="rejected",q.reason=it)})),q.status){case"fulfilled":return q.value;case"rejected":throw q.reason}}throw q}function dt(q,it,ht,W,ft){var Nt=typeof q;(Nt==="undefined"||Nt==="boolean")&&(q=null);var wt=!1;if(q===null)wt=!0;else switch(Nt){case"bigint":case"string":case"number":wt=!0;break;case"object":switch(q.$$typeof){case i:case t:wt=!0;break;case m:return wt=q._init,dt(wt(q._payload),it,ht,W,ft)}}if(wt)return ft=ft(q),wt=W===""?"."+z(q,0):W,V(ft)?(ht="",wt!=null&&(ht=wt.replace(F,"$&/")+"/"),dt(ft,it,ht,"",function(Gn){return Gn})):ft!=null&&(M(ft)&&(ft=N(ft,ht+(ft.key==null||q&&q.key===ft.key?"":(""+ft.key).replace(F,"$&/")+"/")+wt)),it.push(ft)),1;wt=0;var Ot=W===""?".":W+":";if(V(q))for(var Qt=0;Qt<q.length;Qt++)W=q[Qt],Nt=Ot+z(W,Qt),wt+=dt(W,it,ht,Nt,ft);else if(Qt=b(q),typeof Qt=="function")for(q=Qt.call(q),Qt=0;!(W=q.next()).done;)W=W.value,Nt=Ot+z(W,Qt++),wt+=dt(W,it,ht,Nt,ft);else if(Nt==="object"){if(typeof q.then=="function")return dt(st(q),it,ht,W,ft);throw it=String(q),Error("Objects are not valid as a React child (found: "+(it==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":it)+"). If you meant to render a collection of children, use an array instead.")}return wt}function $(q,it,ht){if(q==null)return q;var W=[],ft=0;return dt(q,W,"","",function(Nt){return it.call(ht,Nt,ft++)}),W}function Y(q){if(q._status===-1){var it=q._result;it=it(),it.then(function(ht){(q._status===0||q._status===-1)&&(q._status=1,q._result=ht)},function(ht){(q._status===0||q._status===-1)&&(q._status=2,q._result=ht)}),q._status===-1&&(q._status=0,q._result=it)}if(q._status===1)return q._result.default;throw q._result}var ut=typeof reportError=="function"?reportError:function(q){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var it=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof q=="object"&&q!==null&&typeof q.message=="string"?String(q.message):String(q),error:q});if(!window.dispatchEvent(it))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",q);return}console.error(q)};function xt(){}return Bt.Children={map:$,forEach:function(q,it,ht){$(q,function(){it.apply(this,arguments)},ht)},count:function(q){var it=0;return $(q,function(){it++}),it},toArray:function(q){return $(q,function(it){return it})||[]},only:function(q){if(!M(q))throw Error("React.Children.only expected to receive a single React element child.");return q}},Bt.Component=T,Bt.Fragment=e,Bt.Profiler=s,Bt.PureComponent=L,Bt.StrictMode=n,Bt.Suspense=h,Bt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=P,Bt.__COMPILER_RUNTIME={__proto__:null,c:function(q){return P.H.useMemoCache(q)}},Bt.cache=function(q){return function(){return q.apply(null,arguments)}},Bt.cloneElement=function(q,it,ht){if(q==null)throw Error("The argument must be a React element, but you passed "+q+".");var W=S({},q.props),ft=q.key,Nt=void 0;if(it!=null)for(wt in it.ref!==void 0&&(Nt=void 0),it.key!==void 0&&(ft=""+it.key),it)!G.call(it,wt)||wt==="key"||wt==="__self"||wt==="__source"||wt==="ref"&&it.ref===void 0||(W[wt]=it[wt]);var wt=arguments.length-2;if(wt===1)W.children=ht;else if(1<wt){for(var Ot=Array(wt),Qt=0;Qt<wt;Qt++)Ot[Qt]=arguments[Qt+2];W.children=Ot}return I(q.type,ft,void 0,void 0,Nt,W)},Bt.createContext=function(q){return q={$$typeof:l,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null},q.Provider=q,q.Consumer={$$typeof:o,_context:q},q},Bt.createElement=function(q,it,ht){var W,ft={},Nt=null;if(it!=null)for(W in it.key!==void 0&&(Nt=""+it.key),it)G.call(it,W)&&W!=="key"&&W!=="__self"&&W!=="__source"&&(ft[W]=it[W]);var wt=arguments.length-2;if(wt===1)ft.children=ht;else if(1<wt){for(var Ot=Array(wt),Qt=0;Qt<wt;Qt++)Ot[Qt]=arguments[Qt+2];ft.children=Ot}if(q&&q.defaultProps)for(W in wt=q.defaultProps,wt)ft[W]===void 0&&(ft[W]=wt[W]);return I(q,Nt,void 0,void 0,null,ft)},Bt.createRef=function(){return{current:null}},Bt.forwardRef=function(q){return{$$typeof:u,render:q}},Bt.isValidElement=M,Bt.lazy=function(q){return{$$typeof:m,_payload:{_status:-1,_result:q},_init:Y}},Bt.memo=function(q,it){return{$$typeof:f,type:q,compare:it===void 0?null:it}},Bt.startTransition=function(q){var it=P.T,ht={};P.T=ht;try{var W=q(),ft=P.S;ft!==null&&ft(ht,W),typeof W=="object"&&W!==null&&typeof W.then=="function"&&W.then(xt,ut)}catch(Nt){ut(Nt)}finally{P.T=it}},Bt.unstable_useCacheRefresh=function(){return P.H.useCacheRefresh()},Bt.use=function(q){return P.H.use(q)},Bt.useActionState=function(q,it,ht){return P.H.useActionState(q,it,ht)},Bt.useCallback=function(q,it){return P.H.useCallback(q,it)},Bt.useContext=function(q){return P.H.useContext(q)},Bt.useDebugValue=function(){},Bt.useDeferredValue=function(q,it){return P.H.useDeferredValue(q,it)},Bt.useEffect=function(q,it,ht){var W=P.H;if(typeof ht=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return W.useEffect(q,it)},Bt.useId=function(){return P.H.useId()},Bt.useImperativeHandle=function(q,it,ht){return P.H.useImperativeHandle(q,it,ht)},Bt.useInsertionEffect=function(q,it){return P.H.useInsertionEffect(q,it)},Bt.useLayoutEffect=function(q,it){return P.H.useLayoutEffect(q,it)},Bt.useMemo=function(q,it){return P.H.useMemo(q,it)},Bt.useOptimistic=function(q,it){return P.H.useOptimistic(q,it)},Bt.useReducer=function(q,it,ht){return P.H.useReducer(q,it,ht)},Bt.useRef=function(q){return P.H.useRef(q)},Bt.useState=function(q){return P.H.useState(q)},Bt.useSyncExternalStore=function(q,it,ht){return P.H.useSyncExternalStore(q,it,ht)},Bt.useTransition=function(){return P.H.useTransition()},Bt.version="19.1.1",Bt}var Tw;function Gy(){return Tw||(Tw=1,Cg.exports=BC()),Cg.exports}var B=Gy();const zC=VC(B);var Rg={exports:{}},hu={},Ig={exports:{}},Ng={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xw;function HC(){return xw||(xw=1,(function(i){function t($,Y){var ut=$.length;$.push(Y);t:for(;0<ut;){var xt=ut-1>>>1,q=$[xt];if(0<s(q,Y))$[xt]=Y,$[ut]=q,ut=xt;else break t}}function e($){return $.length===0?null:$[0]}function n($){if($.length===0)return null;var Y=$[0],ut=$.pop();if(ut!==Y){$[0]=ut;t:for(var xt=0,q=$.length,it=q>>>1;xt<it;){var ht=2*(xt+1)-1,W=$[ht],ft=ht+1,Nt=$[ft];if(0>s(W,ut))ft<q&&0>s(Nt,W)?($[xt]=Nt,$[ft]=ut,xt=ft):($[xt]=W,$[ht]=ut,xt=ht);else if(ft<q&&0>s(Nt,ut))$[xt]=Nt,$[ft]=ut,xt=ft;else break t}}return Y}function s($,Y){var ut=$.sortIndex-Y.sortIndex;return ut!==0?ut:$.id-Y.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;i.unstable_now=function(){return o.now()}}else{var l=Date,u=l.now();i.unstable_now=function(){return l.now()-u}}var h=[],f=[],m=1,v=null,b=3,A=!1,S=!1,E=!1,T=!1,C=typeof setTimeout=="function"?setTimeout:null,L=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;function V($){for(var Y=e(f);Y!==null;){if(Y.callback===null)n(f);else if(Y.startTime<=$)n(f),Y.sortIndex=Y.expirationTime,t(h,Y);else break;Y=e(f)}}function P($){if(E=!1,V($),!S)if(e(h)!==null)S=!0,G||(G=!0,z());else{var Y=e(f);Y!==null&&dt(P,Y.startTime-$)}}var G=!1,I=-1,N=5,M=-1;function j(){return T?!0:!(i.unstable_now()-M<N)}function F(){if(T=!1,G){var $=i.unstable_now();M=$;var Y=!0;try{t:{S=!1,E&&(E=!1,L(I),I=-1),A=!0;var ut=b;try{e:{for(V($),v=e(h);v!==null&&!(v.expirationTime>$&&j());){var xt=v.callback;if(typeof xt=="function"){v.callback=null,b=v.priorityLevel;var q=xt(v.expirationTime<=$);if($=i.unstable_now(),typeof q=="function"){v.callback=q,V($),Y=!0;break e}v===e(h)&&n(h),V($)}else n(h);v=e(h)}if(v!==null)Y=!0;else{var it=e(f);it!==null&&dt(P,it.startTime-$),Y=!1}}break t}finally{v=null,b=ut,A=!1}Y=void 0}}finally{Y?z():G=!1}}}var z;if(typeof k=="function")z=function(){k(F)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,st=U.port2;U.port1.onmessage=F,z=function(){st.postMessage(null)}}else z=function(){C(F,0)};function dt($,Y){I=C(function(){$(i.unstable_now())},Y)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function($){$.callback=null},i.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<$?Math.floor(1e3/$):5},i.unstable_getCurrentPriorityLevel=function(){return b},i.unstable_next=function($){switch(b){case 1:case 2:case 3:var Y=3;break;default:Y=b}var ut=b;b=Y;try{return $()}finally{b=ut}},i.unstable_requestPaint=function(){T=!0},i.unstable_runWithPriority=function($,Y){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var ut=b;b=$;try{return Y()}finally{b=ut}},i.unstable_scheduleCallback=function($,Y,ut){var xt=i.unstable_now();switch(typeof ut=="object"&&ut!==null?(ut=ut.delay,ut=typeof ut=="number"&&0<ut?xt+ut:xt):ut=xt,$){case 1:var q=-1;break;case 2:q=250;break;case 5:q=1073741823;break;case 4:q=1e4;break;default:q=5e3}return q=ut+q,$={id:m++,callback:Y,priorityLevel:$,startTime:ut,expirationTime:q,sortIndex:-1},ut>xt?($.sortIndex=ut,t(f,$),e(h)===null&&$===e(f)&&(E?(L(I),I=-1):E=!0,dt(P,ut-xt))):($.sortIndex=q,t(h,$),S||A||(S=!0,G||(G=!0,z()))),$},i.unstable_shouldYield=j,i.unstable_wrapCallback=function($){var Y=b;return function(){var ut=b;b=Y;try{return $.apply(this,arguments)}finally{b=ut}}}})(Ng)),Ng}var Cw;function GC(){return Cw||(Cw=1,Ig.exports=HC()),Ig.exports}var kg={exports:{}},Rn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rw;function qC(){if(Rw)return Rn;Rw=1;var i=Gy();function t(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)f+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var n={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},s=Symbol.for("react.portal");function o(h,f,m){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:v==null?null:""+v,children:h,containerInfo:f,implementation:m}}var l=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Rn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Rn.createPortal=function(h,f){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(t(299));return o(h,f,null,m)},Rn.flushSync=function(h){var f=l.T,m=n.p;try{if(l.T=null,n.p=2,h)return h()}finally{l.T=f,n.p=m,n.d.f()}},Rn.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,n.d.C(h,f))},Rn.prefetchDNS=function(h){typeof h=="string"&&n.d.D(h)},Rn.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var m=f.as,v=u(m,f.crossOrigin),b=typeof f.integrity=="string"?f.integrity:void 0,A=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;m==="style"?n.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:v,integrity:b,fetchPriority:A}):m==="script"&&n.d.X(h,{crossOrigin:v,integrity:b,fetchPriority:A,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Rn.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var m=u(f.as,f.crossOrigin);n.d.M(h,{crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&n.d.M(h)},Rn.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var m=f.as,v=u(m,f.crossOrigin);n.d.L(h,m,{crossOrigin:v,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Rn.preloadModule=function(h,f){if(typeof h=="string")if(f){var m=u(f.as,f.crossOrigin);n.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else n.d.m(h)},Rn.requestFormReset=function(h){n.d.r(h)},Rn.unstable_batchedUpdates=function(h,f){return h(f)},Rn.useFormState=function(h,f,m){return l.H.useFormState(h,f,m)},Rn.useFormStatus=function(){return l.H.useHostTransitionStatus()},Rn.version="19.1.1",Rn}var Iw;function $C(){if(Iw)return kg.exports;Iw=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(t){console.error(t)}}return i(),kg.exports=qC(),kg.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nw;function KC(){if(Nw)return hu;Nw=1;var i=GC(),t=Gy(),e=$C();function n(r){var a="https://react.dev/errors/"+r;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+r+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function o(r){var a=r,c=r;if(r.alternate)for(;a.return;)a=a.return;else{r=a;do a=r,(a.flags&4098)!==0&&(c=a.return),r=a.return;while(r)}return a.tag===3?c:null}function l(r){if(r.tag===13){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function u(r){if(o(r)!==r)throw Error(n(188))}function h(r){var a=r.alternate;if(!a){if(a=o(r),a===null)throw Error(n(188));return a!==r?null:r}for(var c=r,d=a;;){var y=c.return;if(y===null)break;var _=y.alternate;if(_===null){if(d=y.return,d!==null){c=d;continue}break}if(y.child===_.child){for(_=y.child;_;){if(_===c)return u(y),r;if(_===d)return u(y),a;_=_.sibling}throw Error(n(188))}if(c.return!==d.return)c=y,d=_;else{for(var R=!1,D=y.child;D;){if(D===c){R=!0,c=y,d=_;break}if(D===d){R=!0,d=y,c=_;break}D=D.sibling}if(!R){for(D=_.child;D;){if(D===c){R=!0,c=_,d=y;break}if(D===d){R=!0,d=_,c=y;break}D=D.sibling}if(!R)throw Error(n(189))}}if(c.alternate!==d)throw Error(n(190))}if(c.tag!==3)throw Error(n(188));return c.stateNode.current===c?r:a}function f(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r;for(r=r.child;r!==null;){if(a=f(r),a!==null)return a;r=r.sibling}return null}var m=Object.assign,v=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),A=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),L=Symbol.for("react.consumer"),k=Symbol.for("react.context"),V=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),M=Symbol.for("react.activity"),j=Symbol.for("react.memo_cache_sentinel"),F=Symbol.iterator;function z(r){return r===null||typeof r!="object"?null:(r=F&&r[F]||r["@@iterator"],typeof r=="function"?r:null)}var U=Symbol.for("react.client.reference");function st(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===U?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case S:return"Fragment";case T:return"Profiler";case E:return"StrictMode";case P:return"Suspense";case G:return"SuspenseList";case M:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case A:return"Portal";case k:return(r.displayName||"Context")+".Provider";case L:return(r._context.displayName||"Context")+".Consumer";case V:var a=r.render;return r=r.displayName,r||(r=a.displayName||a.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case I:return a=r.displayName||null,a!==null?a:st(r.type)||"Memo";case N:a=r._payload,r=r._init;try{return st(r(a))}catch{}}return null}var dt=Array.isArray,$=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ut={pending:!1,data:null,method:null,action:null},xt=[],q=-1;function it(r){return{current:r}}function ht(r){0>q||(r.current=xt[q],xt[q]=null,q--)}function W(r,a){q++,xt[q]=r.current,r.current=a}var ft=it(null),Nt=it(null),wt=it(null),Ot=it(null);function Qt(r,a){switch(W(wt,a),W(Nt,r),W(ft,null),a.nodeType){case 9:case 11:r=(r=a.documentElement)&&(r=r.namespaceURI)?WA(r):0;break;default:if(r=a.tagName,a=a.namespaceURI)a=WA(a),r=YA(a,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}ht(ft),W(ft,r)}function Gn(){ht(ft),ht(Nt),ht(wt)}function ys(r){r.memoizedState!==null&&W(Ot,r);var a=ft.current,c=YA(a,r.type);a!==c&&(W(Nt,r),W(ft,c))}function Pn(r){Nt.current===r&&(ht(ft),ht(Nt)),Ot.current===r&&(ht(Ot),ru._currentValue=ut)}var es=Object.prototype.hasOwnProperty,vs=i.unstable_scheduleCallback,Vs=i.unstable_cancelCallback,Ta=i.unstable_shouldYield,mt=i.unstable_requestPaint,Ct=i.unstable_now,ie=i.unstable_getCurrentPriorityLevel,ke=i.unstable_ImmediatePriority,_s=i.unstable_UserBlockingPriority,ns=i.unstable_NormalPriority,xp=i.unstable_LowPriority,No=i.unstable_IdlePriority,ic=i.log,_h=i.unstable_setDisableYieldValue,Me=null,le=null;function ss(r){if(typeof ic=="function"&&_h(r),le&&typeof le.setStrictMode=="function")try{le.setStrictMode(Me,r)}catch{}}var xn=Math.clz32?Math.clz32:xa,bh=Math.log,Cp=Math.LN2;function xa(r){return r>>>=0,r===0?32:31-(bh(r)/Cp|0)|0}var Ca=256,Ra=4194304;function Us(r){var a=r&42;if(a!==0)return a;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function ko(r,a,c){var d=r.pendingLanes;if(d===0)return 0;var y=0,_=r.suspendedLanes,R=r.pingedLanes;r=r.warmLanes;var D=d&134217727;return D!==0?(d=D&~_,d!==0?y=Us(d):(R&=D,R!==0?y=Us(R):c||(c=D&~r,c!==0&&(y=Us(c))))):(D=d&~_,D!==0?y=Us(D):R!==0?y=Us(R):c||(c=d&~r,c!==0&&(y=Us(c)))),y===0?0:a!==0&&a!==y&&(a&_)===0&&(_=y&-y,c=a&-a,_>=c||_===32&&(c&4194048)!==0)?a:y}function Ia(r,a){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&a)===0}function rc(r,a){switch(r){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ac(){var r=Ca;return Ca<<=1,(Ca&4194048)===0&&(Ca=256),r}function oc(){var r=Ra;return Ra<<=1,(Ra&62914560)===0&&(Ra=4194304),r}function Pi(r){for(var a=[],c=0;31>c;c++)a.push(r);return a}function Li(r,a){r.pendingLanes|=a,a!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function lc(r,a,c,d,y,_){var R=r.pendingLanes;r.pendingLanes=c,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=c,r.entangledLanes&=c,r.errorRecoveryDisabledLanes&=c,r.shellSuspendCounter=0;var D=r.entanglements,H=r.expirationTimes,Z=r.hiddenUpdates;for(c=R&~c;0<c;){var rt=31-xn(c),lt=1<<rt;D[rt]=0,H[rt]=-1;var tt=Z[rt];if(tt!==null)for(Z[rt]=null,rt=0;rt<tt.length;rt++){var et=tt[rt];et!==null&&(et.lane&=-536870913)}c&=~lt}d!==0&&ei(r,d,0),_!==0&&y===0&&r.tag!==0&&(r.suspendedLanes|=_&~(R&~a))}function ei(r,a,c){r.pendingLanes|=a,r.suspendedLanes&=~a;var d=31-xn(a);r.entangledLanes|=a,r.entanglements[d]=r.entanglements[d]|1073741824|c&4194090}function cc(r,a){var c=r.entangledLanes|=a;for(r=r.entanglements;c;){var d=31-xn(c),y=1<<d;y&a|r[d]&a&&(r[d]|=a),c&=~y}}function wr(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Mo(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function Er(){var r=Y.p;return r!==0?r:(r=window.event,r===void 0?32:pw(r.type))}function Ah(r,a){var c=Y.p;try{return Y.p=r,a()}finally{Y.p=c}}var Ee=Math.random().toString(36).slice(2),en="__reactFiber$"+Ee,Ge="__reactProps$"+Ee,bs="__reactContainer$"+Ee,uc="__reactEvents$"+Ee,Rp="__reactListeners$"+Ee,Sr="__reactHandles$"+Ee,wh="__reactResources$"+Ee,Na="__reactMarker$"+Ee;function Tr(r){delete r[en],delete r[Ge],delete r[uc],delete r[Rp],delete r[Sr]}function Oi(r){var a=r[en];if(a)return a;for(var c=r.parentNode;c;){if(a=c[bs]||c[en]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(r=ZA(r);r!==null;){if(c=r[en])return c;r=ZA(r)}return a}r=c,c=r.parentNode}return null}function ni(r){if(r=r[en]||r[bs]){var a=r.tag;if(a===5||a===6||a===13||a===26||a===27||a===3)return r}return null}function si(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r.stateNode;throw Error(n(33))}function Ln(r){var a=r[wh];return a||(a=r[wh]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function je(r){r[Na]=!0}var hc=new Set,Do={};function Fs(r,a){ji(r,a),ji(r+"Capture",a)}function ji(r,a){for(Do[r]=a,r=0;r<a.length;r++)hc.add(a[r])}var Eh=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Sh={},ka={};function Th(r){return es.call(ka,r)?!0:es.call(Sh,r)?!1:Eh.test(r)?ka[r]=!0:(Sh[r]=!0,!1)}function xr(r,a,c){if(Th(a))if(c===null)r.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":r.removeAttribute(a);return;case"boolean":var d=a.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){r.removeAttribute(a);return}}r.setAttribute(a,""+c)}}function ii(r,a,c){if(c===null)r.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(a);return}r.setAttribute(a,""+c)}}function yn(r,a,c,d){if(d===null)r.removeAttribute(c);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(c);return}r.setAttributeNS(a,c,""+d)}}var Ma,xh;function Vi(r){if(Ma===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);Ma=a&&a[1]||"",xh=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ma+r+xh}var Po=!1;function Lo(r,a){if(!r||Po)return"";Po=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(a){var lt=function(){throw Error()};if(Object.defineProperty(lt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(lt,[])}catch(et){var tt=et}Reflect.construct(r,[],lt)}else{try{lt.call()}catch(et){tt=et}r.call(lt.prototype)}}else{try{throw Error()}catch(et){tt=et}(lt=r())&&typeof lt.catch=="function"&&lt.catch(function(){})}}catch(et){if(et&&tt&&typeof et.stack=="string")return[et.stack,tt.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var _=d.DetermineComponentFrameRoot(),R=_[0],D=_[1];if(R&&D){var H=R.split(`
`),Z=D.split(`
`);for(y=d=0;d<H.length&&!H[d].includes("DetermineComponentFrameRoot");)d++;for(;y<Z.length&&!Z[y].includes("DetermineComponentFrameRoot");)y++;if(d===H.length||y===Z.length)for(d=H.length-1,y=Z.length-1;1<=d&&0<=y&&H[d]!==Z[y];)y--;for(;1<=d&&0<=y;d--,y--)if(H[d]!==Z[y]){if(d!==1||y!==1)do if(d--,y--,0>y||H[d]!==Z[y]){var rt=`
`+H[d].replace(" at new "," at ");return r.displayName&&rt.includes("<anonymous>")&&(rt=rt.replace("<anonymous>",r.displayName)),rt}while(1<=d&&0<=y);break}}}finally{Po=!1,Error.prepareStackTrace=c}return(c=r?r.displayName||r.name:"")?Vi(c):""}function dc(r){switch(r.tag){case 26:case 27:case 5:return Vi(r.type);case 16:return Vi("Lazy");case 13:return Vi("Suspense");case 19:return Vi("SuspenseList");case 0:case 15:return Lo(r.type,!1);case 11:return Lo(r.type.render,!1);case 1:return Lo(r.type,!0);case 31:return Vi("Activity");default:return""}}function Oo(r){try{var a="";do a+=dc(r),r=r.return;while(r);return a}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}function On(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function fc(r){var a=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Ip(r){var a=fc(r)?"checked":"value",c=Object.getOwnPropertyDescriptor(r.constructor.prototype,a),d=""+r[a];if(!r.hasOwnProperty(a)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var y=c.get,_=c.set;return Object.defineProperty(r,a,{configurable:!0,get:function(){return y.call(this)},set:function(R){d=""+R,_.call(this,R)}}),Object.defineProperty(r,a,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(R){d=""+R},stopTracking:function(){r._valueTracker=null,delete r[a]}}}}function jo(r){r._valueTracker||(r._valueTracker=Ip(r))}function pc(r){if(!r)return!1;var a=r._valueTracker;if(!a)return!0;var c=a.getValue(),d="";return r&&(d=fc(r)?r.checked?"true":"false":r.value),r=d,r!==c?(a.setValue(r),!0):!1}function Da(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Np=/[\n"\\]/g;function qe(r){return r.replace(Np,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function is(r,a,c,d,y,_,R,D){r.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?r.type=R:r.removeAttribute("type"),a!=null?R==="number"?(a===0&&r.value===""||r.value!=a)&&(r.value=""+On(a)):r.value!==""+On(a)&&(r.value=""+On(a)):R!=="submit"&&R!=="reset"||r.removeAttribute("value"),a!=null?Cr(r,R,On(a)):c!=null?Cr(r,R,On(c)):d!=null&&r.removeAttribute("value"),y==null&&_!=null&&(r.defaultChecked=!!_),y!=null&&(r.checked=y&&typeof y!="function"&&typeof y!="symbol"),D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?r.name=""+On(D):r.removeAttribute("name")}function Pa(r,a,c,d,y,_,R,D){if(_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(r.type=_),a!=null||c!=null){if(!(_!=="submit"&&_!=="reset"||a!=null))return;c=c!=null?""+On(c):"",a=a!=null?""+On(a):c,D||a===r.value||(r.value=a),r.defaultValue=a}d=d??y,d=typeof d!="function"&&typeof d!="symbol"&&!!d,r.checked=D?r.checked:!!d,r.defaultChecked=!!d,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(r.name=R)}function Cr(r,a,c){a==="number"&&Da(r.ownerDocument)===r||r.defaultValue===""+c||(r.defaultValue=""+c)}function Ui(r,a,c,d){if(r=r.options,a){a={};for(var y=0;y<c.length;y++)a["$"+c[y]]=!0;for(c=0;c<r.length;c++)y=a.hasOwnProperty("$"+r[c].value),r[c].selected!==y&&(r[c].selected=y),y&&d&&(r[c].defaultSelected=!0)}else{for(c=""+On(c),a=null,y=0;y<r.length;y++){if(r[y].value===c){r[y].selected=!0,d&&(r[y].defaultSelected=!0);return}a!==null||r[y].disabled||(a=r[y])}a!==null&&(a.selected=!0)}}function he(r,a,c){if(a!=null&&(a=""+On(a),a!==r.value&&(r.value=a),c==null)){r.defaultValue!==a&&(r.defaultValue=a);return}r.defaultValue=c!=null?""+On(c):""}function La(r,a,c,d){if(a==null){if(d!=null){if(c!=null)throw Error(n(92));if(dt(d)){if(1<d.length)throw Error(n(93));d=d[0]}c=d}c==null&&(c=""),a=c}c=On(a),r.defaultValue=c,d=r.textContent,d===c&&d!==""&&d!==null&&(r.value=d)}function As(r,a){if(a){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=a;return}}r.textContent=a}var Oa=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ch(r,a,c){var d=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?d?r.setProperty(a,""):a==="float"?r.cssFloat="":r[a]="":d?r.setProperty(a,c):typeof c!="number"||c===0||Oa.has(a)?a==="float"?r.cssFloat=c:r[a]=(""+c).trim():r[a]=c+"px"}function mc(r,a,c){if(a!=null&&typeof a!="object")throw Error(n(62));if(r=r.style,c!=null){for(var d in c)!c.hasOwnProperty(d)||a!=null&&a.hasOwnProperty(d)||(d.indexOf("--")===0?r.setProperty(d,""):d==="float"?r.cssFloat="":r[d]="");for(var y in a)d=a[y],a.hasOwnProperty(y)&&c[y]!==d&&Ch(r,y,d)}else for(var _ in a)a.hasOwnProperty(_)&&Ch(r,_,a[_])}function gc(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kp=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Mp=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Vo(r){return Mp.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}var Fi=null;function ws(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Bi=null,zi=null;function yc(r){var a=ni(r);if(a&&(r=a.stateNode)){var c=r[Ge]||null;t:switch(r=a.stateNode,a.type){case"input":if(is(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+qe(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var d=c[a];if(d!==r&&d.form===r.form){var y=d[Ge]||null;if(!y)throw Error(n(90));is(d,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(a=0;a<c.length;a++)d=c[a],d.form===r.form&&pc(d)}break t;case"textarea":he(r,c.value,c.defaultValue);break t;case"select":a=c.value,a!=null&&Ui(r,!!c.multiple,a,!1)}}}var ri=!1;function Rh(r,a,c){if(ri)return r(a,c);ri=!0;try{var d=r(a);return d}finally{if(ri=!1,(Bi!==null||zi!==null)&&(Ad(),Bi&&(a=Bi,r=zi,zi=Bi=null,yc(a),r)))for(a=0;a<r.length;a++)yc(r[a])}}function ja(r,a){var c=r.stateNode;if(c===null)return null;var d=c[Ge]||null;if(d===null)return null;c=d[a];t:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(r=r.type,d=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!d;break t;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(n(231,a,typeof c));return c}var Bs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Es=!1;if(Bs)try{var Va={};Object.defineProperty(Va,"passive",{get:function(){Es=!0}}),window.addEventListener("test",Va,Va),window.removeEventListener("test",Va,Va)}catch{Es=!1}var ai=null,Rr=null,Hi=null;function vc(){if(Hi)return Hi;var r,a=Rr,c=a.length,d,y="value"in ai?ai.value:ai.textContent,_=y.length;for(r=0;r<c&&a[r]===y[r];r++);var R=c-r;for(d=1;d<=R&&a[c-d]===y[_-d];d++);return Hi=y.slice(r,1<d?1-d:void 0)}function oi(r){var a=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&a===13&&(r=13)):r=a,r===10&&(r=13),32<=r||r===13?r:0}function li(){return!0}function _c(){return!1}function cn(r){function a(c,d,y,_,R){this._reactName=c,this._targetInst=y,this.type=d,this.nativeEvent=_,this.target=R,this.currentTarget=null;for(var D in r)r.hasOwnProperty(D)&&(c=r[D],this[D]=c?c(_):_[D]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?li:_c,this.isPropagationStopped=_c,this}return m(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=li)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=li)},persist:function(){},isPersistent:li}),a}var ae={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Uo=cn(ae),Ua=m({},ae,{view:0,detail:0}),Ih=cn(Ua),Fo,Bo,ci,Fa=m({},Ua,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ha,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==ci&&(ci&&r.type==="mousemove"?(Fo=r.screenX-ci.screenX,Bo=r.screenY-ci.screenY):Bo=Fo=0,ci=r),Fo)},movementY:function(r){return"movementY"in r?r.movementY:Bo}}),Ss=cn(Fa),Nh=m({},Fa,{dataTransfer:0}),Dp=cn(Nh),Ba=m({},Ua,{relatedTarget:0}),zo=cn(Ba),bc=m({},ae,{animationName:0,elapsedTime:0,pseudoElement:0}),Ho=cn(bc),kh=m({},ae,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Go=cn(kh),Pp=m({},ae,{data:0}),Ac=cn(Pp),za={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Mh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Dh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wc(r){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(r):(r=Dh[r])?!!a[r]:!1}function Ha(){return wc}var Ph=m({},Ua,{key:function(r){if(r.key){var a=za[r.key]||r.key;if(a!=="Unidentified")return a}return r.type==="keypress"?(r=oi(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Mh[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ha,charCode:function(r){return r.type==="keypress"?oi(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?oi(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),qo=cn(Ph),Lh=m({},Fa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ec=cn(Lh),Gi=m({},Ua,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ha}),Oh=cn(Gi),jh=m({},ae,{propertyName:0,elapsedTime:0,pseudoElement:0}),Vh=cn(jh),Uh=m({},Fa,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),$o=cn(Uh),jn=m({},ae,{newState:0,oldState:0}),Fh=cn(jn),Bh=[9,13,27,32],ui=Bs&&"CompositionEvent"in window,p=null;Bs&&"documentMode"in document&&(p=document.documentMode);var w=Bs&&"TextEvent"in window&&!p,x=Bs&&(!ui||p&&8<p&&11>=p),O=" ",Q=!1;function nt(r,a){switch(r){case"keyup":return Bh.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pt(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Jt=!1;function nn(r,a){switch(r){case"compositionend":return pt(a);case"keypress":return a.which!==32?null:(Q=!0,O);case"textInput":return r=a.data,r===O&&Q?null:r;default:return null}}function Zt(r,a){if(Jt)return r==="compositionend"||!ui&&nt(r,a)?(r=vc(),Hi=Rr=ai=null,Jt=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return x&&a.locale!=="ko"?null:a.data;default:return null}}var un={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function sn(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a==="input"?!!un[r.type]:a==="textarea"}function qi(r,a,c,d){Bi?zi?zi.push(d):zi=[d]:Bi=d,a=Cd(a,"onChange"),0<a.length&&(c=new Uo("onChange","change",null,c,d),r.push({event:c,listeners:a}))}var vn=null,hi=null;function Sc(r){HA(r,0)}function zh(r){var a=si(r);if(pc(a))return r}function u_(r,a){if(r==="change")return a}var h_=!1;if(Bs){var Lp;if(Bs){var Op="oninput"in document;if(!Op){var d_=document.createElement("div");d_.setAttribute("oninput","return;"),Op=typeof d_.oninput=="function"}Lp=Op}else Lp=!1;h_=Lp&&(!document.documentMode||9<document.documentMode)}function f_(){vn&&(vn.detachEvent("onpropertychange",p_),hi=vn=null)}function p_(r){if(r.propertyName==="value"&&zh(hi)){var a=[];qi(a,hi,r,ws(r)),Rh(Sc,a)}}function p1(r,a,c){r==="focusin"?(f_(),vn=a,hi=c,vn.attachEvent("onpropertychange",p_)):r==="focusout"&&f_()}function m1(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return zh(hi)}function g1(r,a){if(r==="click")return zh(a)}function y1(r,a){if(r==="input"||r==="change")return zh(a)}function v1(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var rs=typeof Object.is=="function"?Object.is:v1;function Tc(r,a){if(rs(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;var c=Object.keys(r),d=Object.keys(a);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var y=c[d];if(!es.call(a,y)||!rs(r[y],a[y]))return!1}return!0}function m_(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function g_(r,a){var c=m_(r);r=0;for(var d;c;){if(c.nodeType===3){if(d=r+c.textContent.length,r<=a&&d>=a)return{node:c,offset:a-r};r=d}t:{for(;c;){if(c.nextSibling){c=c.nextSibling;break t}c=c.parentNode}c=void 0}c=m_(c)}}function y_(r,a){return r&&a?r===a?!0:r&&r.nodeType===3?!1:a&&a.nodeType===3?y_(r,a.parentNode):"contains"in r?r.contains(a):r.compareDocumentPosition?!!(r.compareDocumentPosition(a)&16):!1:!1}function v_(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var a=Da(r.document);a instanceof r.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)r=a.contentWindow;else break;a=Da(r.document)}return a}function jp(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a&&(a==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||a==="textarea"||r.contentEditable==="true")}var _1=Bs&&"documentMode"in document&&11>=document.documentMode,Ko=null,Vp=null,xc=null,Up=!1;function __(r,a,c){var d=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Up||Ko==null||Ko!==Da(d)||(d=Ko,"selectionStart"in d&&jp(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),xc&&Tc(xc,d)||(xc=d,d=Cd(Vp,"onSelect"),0<d.length&&(a=new Uo("onSelect","select",null,a,c),r.push({event:a,listeners:d}),a.target=Ko)))}function Ga(r,a){var c={};return c[r.toLowerCase()]=a.toLowerCase(),c["Webkit"+r]="webkit"+a,c["Moz"+r]="moz"+a,c}var Wo={animationend:Ga("Animation","AnimationEnd"),animationiteration:Ga("Animation","AnimationIteration"),animationstart:Ga("Animation","AnimationStart"),transitionrun:Ga("Transition","TransitionRun"),transitionstart:Ga("Transition","TransitionStart"),transitioncancel:Ga("Transition","TransitionCancel"),transitionend:Ga("Transition","TransitionEnd")},Fp={},b_={};Bs&&(b_=document.createElement("div").style,"AnimationEvent"in window||(delete Wo.animationend.animation,delete Wo.animationiteration.animation,delete Wo.animationstart.animation),"TransitionEvent"in window||delete Wo.transitionend.transition);function qa(r){if(Fp[r])return Fp[r];if(!Wo[r])return r;var a=Wo[r],c;for(c in a)if(a.hasOwnProperty(c)&&c in b_)return Fp[r]=a[c];return r}var A_=qa("animationend"),w_=qa("animationiteration"),E_=qa("animationstart"),b1=qa("transitionrun"),A1=qa("transitionstart"),w1=qa("transitioncancel"),S_=qa("transitionend"),T_=new Map,Bp="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Bp.push("scrollEnd");function zs(r,a){T_.set(r,a),Fs(a,[r])}var x_=new WeakMap;function Ts(r,a){if(typeof r=="object"&&r!==null){var c=x_.get(r);return c!==void 0?c:(a={value:r,source:a,stack:Oo(a)},x_.set(r,a),a)}return{value:r,source:a,stack:Oo(a)}}var xs=[],Yo=0,zp=0;function Hh(){for(var r=Yo,a=zp=Yo=0;a<r;){var c=xs[a];xs[a++]=null;var d=xs[a];xs[a++]=null;var y=xs[a];xs[a++]=null;var _=xs[a];if(xs[a++]=null,d!==null&&y!==null){var R=d.pending;R===null?y.next=y:(y.next=R.next,R.next=y),d.pending=y}_!==0&&C_(c,y,_)}}function Gh(r,a,c,d){xs[Yo++]=r,xs[Yo++]=a,xs[Yo++]=c,xs[Yo++]=d,zp|=d,r.lanes|=d,r=r.alternate,r!==null&&(r.lanes|=d)}function Hp(r,a,c,d){return Gh(r,a,c,d),qh(r)}function Xo(r,a){return Gh(r,null,null,a),qh(r)}function C_(r,a,c){r.lanes|=c;var d=r.alternate;d!==null&&(d.lanes|=c);for(var y=!1,_=r.return;_!==null;)_.childLanes|=c,d=_.alternate,d!==null&&(d.childLanes|=c),_.tag===22&&(r=_.stateNode,r===null||r._visibility&1||(y=!0)),r=_,_=_.return;return r.tag===3?(_=r.stateNode,y&&a!==null&&(y=31-xn(c),r=_.hiddenUpdates,d=r[y],d===null?r[y]=[a]:d.push(a),a.lane=c|536870912),_):null}function qh(r){if(50<Qc)throw Qc=0,Ym=null,Error(n(185));for(var a=r.return;a!==null;)r=a,a=r.return;return r.tag===3?r.stateNode:null}var Qo={};function E1(r,a,c,d){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function as(r,a,c,d){return new E1(r,a,c,d)}function Gp(r){return r=r.prototype,!(!r||!r.isReactComponent)}function $i(r,a){var c=r.alternate;return c===null?(c=as(r.tag,a,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=a,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&65011712,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,a=r.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c.refCleanup=r.refCleanup,c}function R_(r,a){r.flags&=65011714;var c=r.alternate;return c===null?(r.childLanes=0,r.lanes=a,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=c.childLanes,r.lanes=c.lanes,r.child=c.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=c.memoizedProps,r.memoizedState=c.memoizedState,r.updateQueue=c.updateQueue,r.type=c.type,a=c.dependencies,r.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),r}function $h(r,a,c,d,y,_){var R=0;if(d=r,typeof r=="function")Gp(r)&&(R=1);else if(typeof r=="string")R=TC(r,c,ft.current)?26:r==="html"||r==="head"||r==="body"?27:5;else t:switch(r){case M:return r=as(31,c,a,y),r.elementType=M,r.lanes=_,r;case S:return $a(c.children,y,_,a);case E:R=8,y|=24;break;case T:return r=as(12,c,a,y|2),r.elementType=T,r.lanes=_,r;case P:return r=as(13,c,a,y),r.elementType=P,r.lanes=_,r;case G:return r=as(19,c,a,y),r.elementType=G,r.lanes=_,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case C:case k:R=10;break t;case L:R=9;break t;case V:R=11;break t;case I:R=14;break t;case N:R=16,d=null;break t}R=29,c=Error(n(130,r===null?"null":typeof r,"")),d=null}return a=as(R,c,a,y),a.elementType=r,a.type=d,a.lanes=_,a}function $a(r,a,c,d){return r=as(7,r,d,a),r.lanes=c,r}function qp(r,a,c){return r=as(6,r,null,a),r.lanes=c,r}function $p(r,a,c){return a=as(4,r.children!==null?r.children:[],r.key,a),a.lanes=c,a.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},a}var Jo=[],Zo=0,Kh=null,Wh=0,Cs=[],Rs=0,Ka=null,Ki=1,Wi="";function Wa(r,a){Jo[Zo++]=Wh,Jo[Zo++]=Kh,Kh=r,Wh=a}function I_(r,a,c){Cs[Rs++]=Ki,Cs[Rs++]=Wi,Cs[Rs++]=Ka,Ka=r;var d=Ki;r=Wi;var y=32-xn(d)-1;d&=~(1<<y),c+=1;var _=32-xn(a)+y;if(30<_){var R=y-y%5;_=(d&(1<<R)-1).toString(32),d>>=R,y-=R,Ki=1<<32-xn(a)+y|c<<y|d,Wi=_+r}else Ki=1<<_|c<<y|d,Wi=r}function Kp(r){r.return!==null&&(Wa(r,1),I_(r,1,0))}function Wp(r){for(;r===Kh;)Kh=Jo[--Zo],Jo[Zo]=null,Wh=Jo[--Zo],Jo[Zo]=null;for(;r===Ka;)Ka=Cs[--Rs],Cs[Rs]=null,Wi=Cs[--Rs],Cs[Rs]=null,Ki=Cs[--Rs],Cs[Rs]=null}var Vn=null,De=null,re=!1,Ya=null,di=!1,Yp=Error(n(519));function Xa(r){var a=Error(n(418,""));throw Ic(Ts(a,r)),Yp}function N_(r){var a=r.stateNode,c=r.type,d=r.memoizedProps;switch(a[en]=r,a[Ge]=d,c){case"dialog":$t("cancel",a),$t("close",a);break;case"iframe":case"object":case"embed":$t("load",a);break;case"video":case"audio":for(c=0;c<Zc.length;c++)$t(Zc[c],a);break;case"source":$t("error",a);break;case"img":case"image":case"link":$t("error",a),$t("load",a);break;case"details":$t("toggle",a);break;case"input":$t("invalid",a),Pa(a,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0),jo(a);break;case"select":$t("invalid",a);break;case"textarea":$t("invalid",a),La(a,d.value,d.defaultValue,d.children),jo(a)}c=d.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||d.suppressHydrationWarning===!0||KA(a.textContent,c)?(d.popover!=null&&($t("beforetoggle",a),$t("toggle",a)),d.onScroll!=null&&$t("scroll",a),d.onScrollEnd!=null&&$t("scrollend",a),d.onClick!=null&&(a.onclick=Rd),a=!0):a=!1,a||Xa(r)}function k_(r){for(Vn=r.return;Vn;)switch(Vn.tag){case 5:case 13:di=!1;return;case 27:case 3:di=!0;return;default:Vn=Vn.return}}function Cc(r){if(r!==Vn)return!1;if(!re)return k_(r),re=!0,!1;var a=r.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=r.type,c=!(c!=="form"&&c!=="button")||hg(r.type,r.memoizedProps)),c=!c),c&&De&&Xa(r),k_(r),a===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(317));t:{for(r=r.nextSibling,a=0;r;){if(r.nodeType===8)if(c=r.data,c==="/$"){if(a===0){De=Gs(r.nextSibling);break t}a--}else c!=="$"&&c!=="$!"&&c!=="$?"||a++;r=r.nextSibling}De=null}}else a===27?(a=De,Gr(r.type)?(r=mg,mg=null,De=r):De=a):De=Vn?Gs(r.stateNode.nextSibling):null;return!0}function Rc(){De=Vn=null,re=!1}function M_(){var r=Ya;return r!==null&&(Kn===null?Kn=r:Kn.push.apply(Kn,r),Ya=null),r}function Ic(r){Ya===null?Ya=[r]:Ya.push(r)}var Xp=it(null),Qa=null,Yi=null;function Ir(r,a,c){W(Xp,a._currentValue),a._currentValue=c}function Xi(r){r._currentValue=Xp.current,ht(Xp)}function Qp(r,a,c){for(;r!==null;){var d=r.alternate;if((r.childLanes&a)!==a?(r.childLanes|=a,d!==null&&(d.childLanes|=a)):d!==null&&(d.childLanes&a)!==a&&(d.childLanes|=a),r===c)break;r=r.return}}function Jp(r,a,c,d){var y=r.child;for(y!==null&&(y.return=r);y!==null;){var _=y.dependencies;if(_!==null){var R=y.child;_=_.firstContext;t:for(;_!==null;){var D=_;_=y;for(var H=0;H<a.length;H++)if(D.context===a[H]){_.lanes|=c,D=_.alternate,D!==null&&(D.lanes|=c),Qp(_.return,c,r),d||(R=null);break t}_=D.next}}else if(y.tag===18){if(R=y.return,R===null)throw Error(n(341));R.lanes|=c,_=R.alternate,_!==null&&(_.lanes|=c),Qp(R,c,r),R=null}else R=y.child;if(R!==null)R.return=y;else for(R=y;R!==null;){if(R===r){R=null;break}if(y=R.sibling,y!==null){y.return=R.return,R=y;break}R=R.return}y=R}}function Nc(r,a,c,d){r=null;for(var y=a,_=!1;y!==null;){if(!_){if((y.flags&524288)!==0)_=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var R=y.alternate;if(R===null)throw Error(n(387));if(R=R.memoizedProps,R!==null){var D=y.type;rs(y.pendingProps.value,R.value)||(r!==null?r.push(D):r=[D])}}else if(y===Ot.current){if(R=y.alternate,R===null)throw Error(n(387));R.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(r!==null?r.push(ru):r=[ru])}y=y.return}r!==null&&Jp(a,r,c,d),a.flags|=262144}function Yh(r){for(r=r.firstContext;r!==null;){if(!rs(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Ja(r){Qa=r,Yi=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Cn(r){return D_(Qa,r)}function Xh(r,a){return Qa===null&&Ja(r),D_(r,a)}function D_(r,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},Yi===null){if(r===null)throw Error(n(308));Yi=a,r.dependencies={lanes:0,firstContext:a},r.flags|=524288}else Yi=Yi.next=a;return c}var S1=typeof AbortController<"u"?AbortController:function(){var r=[],a=this.signal={aborted:!1,addEventListener:function(c,d){r.push(d)}};this.abort=function(){a.aborted=!0,r.forEach(function(c){return c()})}},T1=i.unstable_scheduleCallback,x1=i.unstable_NormalPriority,rn={$$typeof:k,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Zp(){return{controller:new S1,data:new Map,refCount:0}}function kc(r){r.refCount--,r.refCount===0&&T1(x1,function(){r.controller.abort()})}var Mc=null,tm=0,tl=0,el=null;function C1(r,a){if(Mc===null){var c=Mc=[];tm=0,tl=ng(),el={status:"pending",value:void 0,then:function(d){c.push(d)}}}return tm++,a.then(P_,P_),a}function P_(){if(--tm===0&&Mc!==null){el!==null&&(el.status="fulfilled");var r=Mc;Mc=null,tl=0,el=null;for(var a=0;a<r.length;a++)(0,r[a])()}}function R1(r,a){var c=[],d={status:"pending",value:null,reason:null,then:function(y){c.push(y)}};return r.then(function(){d.status="fulfilled",d.value=a;for(var y=0;y<c.length;y++)(0,c[y])(a)},function(y){for(d.status="rejected",d.reason=y,y=0;y<c.length;y++)(0,c[y])(void 0)}),d}var L_=$.S;$.S=function(r,a){typeof a=="object"&&a!==null&&typeof a.then=="function"&&C1(r,a),L_!==null&&L_(r,a)};var Za=it(null);function em(){var r=Za.current;return r!==null?r:_e.pooledCache}function Qh(r,a){a===null?W(Za,Za.current):W(Za,a.pool)}function O_(){var r=em();return r===null?null:{parent:rn._currentValue,pool:r}}var Dc=Error(n(460)),j_=Error(n(474)),Jh=Error(n(542)),nm={then:function(){}};function V_(r){return r=r.status,r==="fulfilled"||r==="rejected"}function Zh(){}function U_(r,a,c){switch(c=r[c],c===void 0?r.push(a):c!==a&&(a.then(Zh,Zh),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,B_(r),r;default:if(typeof a.status=="string")a.then(Zh,Zh);else{if(r=_e,r!==null&&100<r.shellSuspendCounter)throw Error(n(482));r=a,r.status="pending",r.then(function(d){if(a.status==="pending"){var y=a;y.status="fulfilled",y.value=d}},function(d){if(a.status==="pending"){var y=a;y.status="rejected",y.reason=d}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,B_(r),r}throw Pc=a,Dc}}var Pc=null;function F_(){if(Pc===null)throw Error(n(459));var r=Pc;return Pc=null,r}function B_(r){if(r===Dc||r===Jh)throw Error(n(483))}var Nr=!1;function sm(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function im(r,a){r=r.updateQueue,a.updateQueue===r&&(a.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function kr(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Mr(r,a,c){var d=r.updateQueue;if(d===null)return null;if(d=d.shared,(ce&2)!==0){var y=d.pending;return y===null?a.next=a:(a.next=y.next,y.next=a),d.pending=a,a=qh(r),C_(r,null,c),a}return Gh(r,d,a,c),qh(r)}function Lc(r,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var d=a.lanes;d&=r.pendingLanes,c|=d,a.lanes=c,cc(r,c)}}function rm(r,a){var c=r.updateQueue,d=r.alternate;if(d!==null&&(d=d.updateQueue,c===d)){var y=null,_=null;if(c=c.firstBaseUpdate,c!==null){do{var R={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};_===null?y=_=R:_=_.next=R,c=c.next}while(c!==null);_===null?y=_=a:_=_.next=a}else y=_=a;c={baseState:d.baseState,firstBaseUpdate:y,lastBaseUpdate:_,shared:d.shared,callbacks:d.callbacks},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=a:r.next=a,c.lastBaseUpdate=a}var am=!1;function Oc(){if(am){var r=el;if(r!==null)throw r}}function jc(r,a,c,d){am=!1;var y=r.updateQueue;Nr=!1;var _=y.firstBaseUpdate,R=y.lastBaseUpdate,D=y.shared.pending;if(D!==null){y.shared.pending=null;var H=D,Z=H.next;H.next=null,R===null?_=Z:R.next=Z,R=H;var rt=r.alternate;rt!==null&&(rt=rt.updateQueue,D=rt.lastBaseUpdate,D!==R&&(D===null?rt.firstBaseUpdate=Z:D.next=Z,rt.lastBaseUpdate=H))}if(_!==null){var lt=y.baseState;R=0,rt=Z=H=null,D=_;do{var tt=D.lane&-536870913,et=tt!==D.lane;if(et?(te&tt)===tt:(d&tt)===tt){tt!==0&&tt===tl&&(am=!0),rt!==null&&(rt=rt.next={lane:0,tag:D.tag,payload:D.payload,callback:null,next:null});t:{var Lt=r,It=D;tt=a;var pe=c;switch(It.tag){case 1:if(Lt=It.payload,typeof Lt=="function"){lt=Lt.call(pe,lt,tt);break t}lt=Lt;break t;case 3:Lt.flags=Lt.flags&-65537|128;case 0:if(Lt=It.payload,tt=typeof Lt=="function"?Lt.call(pe,lt,tt):Lt,tt==null)break t;lt=m({},lt,tt);break t;case 2:Nr=!0}}tt=D.callback,tt!==null&&(r.flags|=64,et&&(r.flags|=8192),et=y.callbacks,et===null?y.callbacks=[tt]:et.push(tt))}else et={lane:tt,tag:D.tag,payload:D.payload,callback:D.callback,next:null},rt===null?(Z=rt=et,H=lt):rt=rt.next=et,R|=tt;if(D=D.next,D===null){if(D=y.shared.pending,D===null)break;et=D,D=et.next,et.next=null,y.lastBaseUpdate=et,y.shared.pending=null}}while(!0);rt===null&&(H=lt),y.baseState=H,y.firstBaseUpdate=Z,y.lastBaseUpdate=rt,_===null&&(y.shared.lanes=0),Fr|=R,r.lanes=R,r.memoizedState=lt}}function z_(r,a){if(typeof r!="function")throw Error(n(191,r));r.call(a)}function H_(r,a){var c=r.callbacks;if(c!==null)for(r.callbacks=null,r=0;r<c.length;r++)z_(c[r],a)}var nl=it(null),td=it(0);function G_(r,a){r=sr,W(td,r),W(nl,a),sr=r|a.baseLanes}function om(){W(td,sr),W(nl,nl.current)}function lm(){sr=td.current,ht(nl),ht(td)}var Dr=0,zt=null,de=null,$e=null,ed=!1,sl=!1,to=!1,nd=0,Vc=0,il=null,I1=0;function Ve(){throw Error(n(321))}function cm(r,a){if(a===null)return!1;for(var c=0;c<a.length&&c<r.length;c++)if(!rs(r[c],a[c]))return!1;return!0}function um(r,a,c,d,y,_){return Dr=_,zt=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,$.H=r===null||r.memoizedState===null?Cb:Rb,to=!1,_=c(d,y),to=!1,sl&&(_=$_(a,c,d,y)),q_(r),_}function q_(r){$.H=ld;var a=de!==null&&de.next!==null;if(Dr=0,$e=de=zt=null,ed=!1,Vc=0,il=null,a)throw Error(n(300));r===null||hn||(r=r.dependencies,r!==null&&Yh(r)&&(hn=!0))}function $_(r,a,c,d){zt=r;var y=0;do{if(sl&&(il=null),Vc=0,sl=!1,25<=y)throw Error(n(301));if(y+=1,$e=de=null,r.updateQueue!=null){var _=r.updateQueue;_.lastEffect=null,_.events=null,_.stores=null,_.memoCache!=null&&(_.memoCache.index=0)}$.H=O1,_=a(c,d)}while(sl);return _}function N1(){var r=$.H,a=r.useState()[0];return a=typeof a.then=="function"?Uc(a):a,r=r.useState()[0],(de!==null?de.memoizedState:null)!==r&&(zt.flags|=1024),a}function hm(){var r=nd!==0;return nd=0,r}function dm(r,a,c){a.updateQueue=r.updateQueue,a.flags&=-2053,r.lanes&=~c}function fm(r){if(ed){for(r=r.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}ed=!1}Dr=0,$e=de=zt=null,sl=!1,Vc=nd=0,il=null}function qn(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $e===null?zt.memoizedState=$e=r:$e=$e.next=r,$e}function Ke(){if(de===null){var r=zt.alternate;r=r!==null?r.memoizedState:null}else r=de.next;var a=$e===null?zt.memoizedState:$e.next;if(a!==null)$e=a,de=r;else{if(r===null)throw zt.alternate===null?Error(n(467)):Error(n(310));de=r,r={memoizedState:de.memoizedState,baseState:de.baseState,baseQueue:de.baseQueue,queue:de.queue,next:null},$e===null?zt.memoizedState=$e=r:$e=$e.next=r}return $e}function pm(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Uc(r){var a=Vc;return Vc+=1,il===null&&(il=[]),r=U_(il,r,a),a=zt,($e===null?a.memoizedState:$e.next)===null&&(a=a.alternate,$.H=a===null||a.memoizedState===null?Cb:Rb),r}function sd(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Uc(r);if(r.$$typeof===k)return Cn(r)}throw Error(n(438,String(r)))}function mm(r){var a=null,c=zt.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var d=zt.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(a={data:d.data.map(function(y){return y.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=pm(),zt.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(r),d=0;d<r;d++)c[d]=j;return a.index++,c}function Qi(r,a){return typeof a=="function"?a(r):a}function id(r){var a=Ke();return gm(a,de,r)}function gm(r,a,c){var d=r.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=c;var y=r.baseQueue,_=d.pending;if(_!==null){if(y!==null){var R=y.next;y.next=_.next,_.next=R}a.baseQueue=y=_,d.pending=null}if(_=r.baseState,y===null)r.memoizedState=_;else{a=y.next;var D=R=null,H=null,Z=a,rt=!1;do{var lt=Z.lane&-536870913;if(lt!==Z.lane?(te&lt)===lt:(Dr&lt)===lt){var tt=Z.revertLane;if(tt===0)H!==null&&(H=H.next={lane:0,revertLane:0,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null}),lt===tl&&(rt=!0);else if((Dr&tt)===tt){Z=Z.next,tt===tl&&(rt=!0);continue}else lt={lane:0,revertLane:Z.revertLane,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null},H===null?(D=H=lt,R=_):H=H.next=lt,zt.lanes|=tt,Fr|=tt;lt=Z.action,to&&c(_,lt),_=Z.hasEagerState?Z.eagerState:c(_,lt)}else tt={lane:lt,revertLane:Z.revertLane,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null},H===null?(D=H=tt,R=_):H=H.next=tt,zt.lanes|=lt,Fr|=lt;Z=Z.next}while(Z!==null&&Z!==a);if(H===null?R=_:H.next=D,!rs(_,r.memoizedState)&&(hn=!0,rt&&(c=el,c!==null)))throw c;r.memoizedState=_,r.baseState=R,r.baseQueue=H,d.lastRenderedState=_}return y===null&&(d.lanes=0),[r.memoizedState,d.dispatch]}function ym(r){var a=Ke(),c=a.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=r;var d=c.dispatch,y=c.pending,_=a.memoizedState;if(y!==null){c.pending=null;var R=y=y.next;do _=r(_,R.action),R=R.next;while(R!==y);rs(_,a.memoizedState)||(hn=!0),a.memoizedState=_,a.baseQueue===null&&(a.baseState=_),c.lastRenderedState=_}return[_,d]}function K_(r,a,c){var d=zt,y=Ke(),_=re;if(_){if(c===void 0)throw Error(n(407));c=c()}else c=a();var R=!rs((de||y).memoizedState,c);R&&(y.memoizedState=c,hn=!0),y=y.queue;var D=X_.bind(null,d,y,r);if(Fc(2048,8,D,[r]),y.getSnapshot!==a||R||$e!==null&&$e.memoizedState.tag&1){if(d.flags|=2048,rl(9,rd(),Y_.bind(null,d,y,c,a),null),_e===null)throw Error(n(349));_||(Dr&124)!==0||W_(d,a,c)}return c}function W_(r,a,c){r.flags|=16384,r={getSnapshot:a,value:c},a=zt.updateQueue,a===null?(a=pm(),zt.updateQueue=a,a.stores=[r]):(c=a.stores,c===null?a.stores=[r]:c.push(r))}function Y_(r,a,c,d){a.value=c,a.getSnapshot=d,Q_(a)&&J_(r)}function X_(r,a,c){return c(function(){Q_(a)&&J_(r)})}function Q_(r){var a=r.getSnapshot;r=r.value;try{var c=a();return!rs(r,c)}catch{return!0}}function J_(r){var a=Xo(r,2);a!==null&&hs(a,r,2)}function vm(r){var a=qn();if(typeof r=="function"){var c=r;if(r=c(),to){ss(!0);try{c()}finally{ss(!1)}}}return a.memoizedState=a.baseState=r,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qi,lastRenderedState:r},a}function Z_(r,a,c,d){return r.baseState=c,gm(r,de,typeof d=="function"?d:Qi)}function k1(r,a,c,d,y){if(od(r))throw Error(n(485));if(r=a.action,r!==null){var _={payload:y,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){_.listeners.push(R)}};$.T!==null?c(!0):_.isTransition=!1,d(_),c=a.pending,c===null?(_.next=a.pending=_,tb(a,_)):(_.next=c.next,a.pending=c.next=_)}}function tb(r,a){var c=a.action,d=a.payload,y=r.state;if(a.isTransition){var _=$.T,R={};$.T=R;try{var D=c(y,d),H=$.S;H!==null&&H(R,D),eb(r,a,D)}catch(Z){_m(r,a,Z)}finally{$.T=_}}else try{_=c(y,d),eb(r,a,_)}catch(Z){_m(r,a,Z)}}function eb(r,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(d){nb(r,a,d)},function(d){return _m(r,a,d)}):nb(r,a,c)}function nb(r,a,c){a.status="fulfilled",a.value=c,sb(a),r.state=c,a=r.pending,a!==null&&(c=a.next,c===a?r.pending=null:(c=c.next,a.next=c,tb(r,c)))}function _m(r,a,c){var d=r.pending;if(r.pending=null,d!==null){d=d.next;do a.status="rejected",a.reason=c,sb(a),a=a.next;while(a!==d)}r.action=null}function sb(r){r=r.listeners;for(var a=0;a<r.length;a++)(0,r[a])()}function ib(r,a){return a}function rb(r,a){if(re){var c=_e.formState;if(c!==null){t:{var d=zt;if(re){if(De){e:{for(var y=De,_=di;y.nodeType!==8;){if(!_){y=null;break e}if(y=Gs(y.nextSibling),y===null){y=null;break e}}_=y.data,y=_==="F!"||_==="F"?y:null}if(y){De=Gs(y.nextSibling),d=y.data==="F!";break t}}Xa(d)}d=!1}d&&(a=c[0])}}return c=qn(),c.memoizedState=c.baseState=a,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ib,lastRenderedState:a},c.queue=d,c=Sb.bind(null,zt,d),d.dispatch=c,d=vm(!1),_=Sm.bind(null,zt,!1,d.queue),d=qn(),y={state:a,dispatch:null,action:r,pending:null},d.queue=y,c=k1.bind(null,zt,y,_,c),y.dispatch=c,d.memoizedState=r,[a,c,!1]}function ab(r){var a=Ke();return ob(a,de,r)}function ob(r,a,c){if(a=gm(r,a,ib)[0],r=id(Qi)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var d=Uc(a)}catch(R){throw R===Dc?Jh:R}else d=a;a=Ke();var y=a.queue,_=y.dispatch;return c!==a.memoizedState&&(zt.flags|=2048,rl(9,rd(),M1.bind(null,y,c),null)),[d,_,r]}function M1(r,a){r.action=a}function lb(r){var a=Ke(),c=de;if(c!==null)return ob(a,c,r);Ke(),a=a.memoizedState,c=Ke();var d=c.queue.dispatch;return c.memoizedState=r,[a,d,!1]}function rl(r,a,c,d){return r={tag:r,create:c,deps:d,inst:a,next:null},a=zt.updateQueue,a===null&&(a=pm(),zt.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=r.next=r:(d=c.next,c.next=r,r.next=d,a.lastEffect=r),r}function rd(){return{destroy:void 0,resource:void 0}}function cb(){return Ke().memoizedState}function ad(r,a,c,d){var y=qn();d=d===void 0?null:d,zt.flags|=r,y.memoizedState=rl(1|a,rd(),c,d)}function Fc(r,a,c,d){var y=Ke();d=d===void 0?null:d;var _=y.memoizedState.inst;de!==null&&d!==null&&cm(d,de.memoizedState.deps)?y.memoizedState=rl(a,_,c,d):(zt.flags|=r,y.memoizedState=rl(1|a,_,c,d))}function ub(r,a){ad(8390656,8,r,a)}function hb(r,a){Fc(2048,8,r,a)}function db(r,a){return Fc(4,2,r,a)}function fb(r,a){return Fc(4,4,r,a)}function pb(r,a){if(typeof a=="function"){r=r();var c=a(r);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return r=r(),a.current=r,function(){a.current=null}}function mb(r,a,c){c=c!=null?c.concat([r]):null,Fc(4,4,pb.bind(null,a,r),c)}function bm(){}function gb(r,a){var c=Ke();a=a===void 0?null:a;var d=c.memoizedState;return a!==null&&cm(a,d[1])?d[0]:(c.memoizedState=[r,a],r)}function yb(r,a){var c=Ke();a=a===void 0?null:a;var d=c.memoizedState;if(a!==null&&cm(a,d[1]))return d[0];if(d=r(),to){ss(!0);try{r()}finally{ss(!1)}}return c.memoizedState=[d,a],d}function Am(r,a,c){return c===void 0||(Dr&1073741824)!==0?r.memoizedState=a:(r.memoizedState=c,r=bA(),zt.lanes|=r,Fr|=r,c)}function vb(r,a,c,d){return rs(c,a)?c:nl.current!==null?(r=Am(r,c,d),rs(r,a)||(hn=!0),r):(Dr&42)===0?(hn=!0,r.memoizedState=c):(r=bA(),zt.lanes|=r,Fr|=r,a)}function _b(r,a,c,d,y){var _=Y.p;Y.p=_!==0&&8>_?_:8;var R=$.T,D={};$.T=D,Sm(r,!1,a,c);try{var H=y(),Z=$.S;if(Z!==null&&Z(D,H),H!==null&&typeof H=="object"&&typeof H.then=="function"){var rt=R1(H,d);Bc(r,a,rt,us(r))}else Bc(r,a,d,us(r))}catch(lt){Bc(r,a,{then:function(){},status:"rejected",reason:lt},us())}finally{Y.p=_,$.T=R}}function D1(){}function wm(r,a,c,d){if(r.tag!==5)throw Error(n(476));var y=bb(r).queue;_b(r,y,a,ut,c===null?D1:function(){return Ab(r),c(d)})}function bb(r){var a=r.memoizedState;if(a!==null)return a;a={memoizedState:ut,baseState:ut,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qi,lastRenderedState:ut},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qi,lastRenderedState:c},next:null},r.memoizedState=a,r=r.alternate,r!==null&&(r.memoizedState=a),a}function Ab(r){var a=bb(r).next.queue;Bc(r,a,{},us())}function Em(){return Cn(ru)}function wb(){return Ke().memoizedState}function Eb(){return Ke().memoizedState}function P1(r){for(var a=r.return;a!==null;){switch(a.tag){case 24:case 3:var c=us();r=kr(c);var d=Mr(a,r,c);d!==null&&(hs(d,a,c),Lc(d,a,c)),a={cache:Zp()},r.payload=a;return}a=a.return}}function L1(r,a,c){var d=us();c={lane:d,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null},od(r)?Tb(a,c):(c=Hp(r,a,c,d),c!==null&&(hs(c,r,d),xb(c,a,d)))}function Sb(r,a,c){var d=us();Bc(r,a,c,d)}function Bc(r,a,c,d){var y={lane:d,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null};if(od(r))Tb(a,y);else{var _=r.alternate;if(r.lanes===0&&(_===null||_.lanes===0)&&(_=a.lastRenderedReducer,_!==null))try{var R=a.lastRenderedState,D=_(R,c);if(y.hasEagerState=!0,y.eagerState=D,rs(D,R))return Gh(r,a,y,0),_e===null&&Hh(),!1}catch{}finally{}if(c=Hp(r,a,y,d),c!==null)return hs(c,r,d),xb(c,a,d),!0}return!1}function Sm(r,a,c,d){if(d={lane:2,revertLane:ng(),action:d,hasEagerState:!1,eagerState:null,next:null},od(r)){if(a)throw Error(n(479))}else a=Hp(r,c,d,2),a!==null&&hs(a,r,2)}function od(r){var a=r.alternate;return r===zt||a!==null&&a===zt}function Tb(r,a){sl=ed=!0;var c=r.pending;c===null?a.next=a:(a.next=c.next,c.next=a),r.pending=a}function xb(r,a,c){if((c&4194048)!==0){var d=a.lanes;d&=r.pendingLanes,c|=d,a.lanes=c,cc(r,c)}}var ld={readContext:Cn,use:sd,useCallback:Ve,useContext:Ve,useEffect:Ve,useImperativeHandle:Ve,useLayoutEffect:Ve,useInsertionEffect:Ve,useMemo:Ve,useReducer:Ve,useRef:Ve,useState:Ve,useDebugValue:Ve,useDeferredValue:Ve,useTransition:Ve,useSyncExternalStore:Ve,useId:Ve,useHostTransitionStatus:Ve,useFormState:Ve,useActionState:Ve,useOptimistic:Ve,useMemoCache:Ve,useCacheRefresh:Ve},Cb={readContext:Cn,use:sd,useCallback:function(r,a){return qn().memoizedState=[r,a===void 0?null:a],r},useContext:Cn,useEffect:ub,useImperativeHandle:function(r,a,c){c=c!=null?c.concat([r]):null,ad(4194308,4,pb.bind(null,a,r),c)},useLayoutEffect:function(r,a){return ad(4194308,4,r,a)},useInsertionEffect:function(r,a){ad(4,2,r,a)},useMemo:function(r,a){var c=qn();a=a===void 0?null:a;var d=r();if(to){ss(!0);try{r()}finally{ss(!1)}}return c.memoizedState=[d,a],d},useReducer:function(r,a,c){var d=qn();if(c!==void 0){var y=c(a);if(to){ss(!0);try{c(a)}finally{ss(!1)}}}else y=a;return d.memoizedState=d.baseState=y,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:y},d.queue=r,r=r.dispatch=L1.bind(null,zt,r),[d.memoizedState,r]},useRef:function(r){var a=qn();return r={current:r},a.memoizedState=r},useState:function(r){r=vm(r);var a=r.queue,c=Sb.bind(null,zt,a);return a.dispatch=c,[r.memoizedState,c]},useDebugValue:bm,useDeferredValue:function(r,a){var c=qn();return Am(c,r,a)},useTransition:function(){var r=vm(!1);return r=_b.bind(null,zt,r.queue,!0,!1),qn().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,a,c){var d=zt,y=qn();if(re){if(c===void 0)throw Error(n(407));c=c()}else{if(c=a(),_e===null)throw Error(n(349));(te&124)!==0||W_(d,a,c)}y.memoizedState=c;var _={value:c,getSnapshot:a};return y.queue=_,ub(X_.bind(null,d,_,r),[r]),d.flags|=2048,rl(9,rd(),Y_.bind(null,d,_,c,a),null),c},useId:function(){var r=qn(),a=_e.identifierPrefix;if(re){var c=Wi,d=Ki;c=(d&~(1<<32-xn(d)-1)).toString(32)+c,a=""+a+"R"+c,c=nd++,0<c&&(a+="H"+c.toString(32)),a+=""}else c=I1++,a=""+a+"r"+c.toString(32)+"";return r.memoizedState=a},useHostTransitionStatus:Em,useFormState:rb,useActionState:rb,useOptimistic:function(r){var a=qn();a.memoizedState=a.baseState=r;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=Sm.bind(null,zt,!0,c),c.dispatch=a,[r,a]},useMemoCache:mm,useCacheRefresh:function(){return qn().memoizedState=P1.bind(null,zt)}},Rb={readContext:Cn,use:sd,useCallback:gb,useContext:Cn,useEffect:hb,useImperativeHandle:mb,useInsertionEffect:db,useLayoutEffect:fb,useMemo:yb,useReducer:id,useRef:cb,useState:function(){return id(Qi)},useDebugValue:bm,useDeferredValue:function(r,a){var c=Ke();return vb(c,de.memoizedState,r,a)},useTransition:function(){var r=id(Qi)[0],a=Ke().memoizedState;return[typeof r=="boolean"?r:Uc(r),a]},useSyncExternalStore:K_,useId:wb,useHostTransitionStatus:Em,useFormState:ab,useActionState:ab,useOptimistic:function(r,a){var c=Ke();return Z_(c,de,r,a)},useMemoCache:mm,useCacheRefresh:Eb},O1={readContext:Cn,use:sd,useCallback:gb,useContext:Cn,useEffect:hb,useImperativeHandle:mb,useInsertionEffect:db,useLayoutEffect:fb,useMemo:yb,useReducer:ym,useRef:cb,useState:function(){return ym(Qi)},useDebugValue:bm,useDeferredValue:function(r,a){var c=Ke();return de===null?Am(c,r,a):vb(c,de.memoizedState,r,a)},useTransition:function(){var r=ym(Qi)[0],a=Ke().memoizedState;return[typeof r=="boolean"?r:Uc(r),a]},useSyncExternalStore:K_,useId:wb,useHostTransitionStatus:Em,useFormState:lb,useActionState:lb,useOptimistic:function(r,a){var c=Ke();return de!==null?Z_(c,de,r,a):(c.baseState=r,[r,c.queue.dispatch])},useMemoCache:mm,useCacheRefresh:Eb},al=null,zc=0;function cd(r){var a=zc;return zc+=1,al===null&&(al=[]),U_(al,r,a)}function Hc(r,a){a=a.props.ref,r.ref=a!==void 0?a:null}function ud(r,a){throw a.$$typeof===v?Error(n(525)):(r=Object.prototype.toString.call(a),Error(n(31,r==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":r)))}function Ib(r){var a=r._init;return a(r._payload)}function Nb(r){function a(X,K){if(r){var J=X.deletions;J===null?(X.deletions=[K],X.flags|=16):J.push(K)}}function c(X,K){if(!r)return null;for(;K!==null;)a(X,K),K=K.sibling;return null}function d(X){for(var K=new Map;X!==null;)X.key!==null?K.set(X.key,X):K.set(X.index,X),X=X.sibling;return K}function y(X,K){return X=$i(X,K),X.index=0,X.sibling=null,X}function _(X,K,J){return X.index=J,r?(J=X.alternate,J!==null?(J=J.index,J<K?(X.flags|=67108866,K):J):(X.flags|=67108866,K)):(X.flags|=1048576,K)}function R(X){return r&&X.alternate===null&&(X.flags|=67108866),X}function D(X,K,J,ot){return K===null||K.tag!==6?(K=qp(J,X.mode,ot),K.return=X,K):(K=y(K,J),K.return=X,K)}function H(X,K,J,ot){var bt=J.type;return bt===S?rt(X,K,J.props.children,ot,J.key):K!==null&&(K.elementType===bt||typeof bt=="object"&&bt!==null&&bt.$$typeof===N&&Ib(bt)===K.type)?(K=y(K,J.props),Hc(K,J),K.return=X,K):(K=$h(J.type,J.key,J.props,null,X.mode,ot),Hc(K,J),K.return=X,K)}function Z(X,K,J,ot){return K===null||K.tag!==4||K.stateNode.containerInfo!==J.containerInfo||K.stateNode.implementation!==J.implementation?(K=$p(J,X.mode,ot),K.return=X,K):(K=y(K,J.children||[]),K.return=X,K)}function rt(X,K,J,ot,bt){return K===null||K.tag!==7?(K=$a(J,X.mode,ot,bt),K.return=X,K):(K=y(K,J),K.return=X,K)}function lt(X,K,J){if(typeof K=="string"&&K!==""||typeof K=="number"||typeof K=="bigint")return K=qp(""+K,X.mode,J),K.return=X,K;if(typeof K=="object"&&K!==null){switch(K.$$typeof){case b:return J=$h(K.type,K.key,K.props,null,X.mode,J),Hc(J,K),J.return=X,J;case A:return K=$p(K,X.mode,J),K.return=X,K;case N:var ot=K._init;return K=ot(K._payload),lt(X,K,J)}if(dt(K)||z(K))return K=$a(K,X.mode,J,null),K.return=X,K;if(typeof K.then=="function")return lt(X,cd(K),J);if(K.$$typeof===k)return lt(X,Xh(X,K),J);ud(X,K)}return null}function tt(X,K,J,ot){var bt=K!==null?K.key:null;if(typeof J=="string"&&J!==""||typeof J=="number"||typeof J=="bigint")return bt!==null?null:D(X,K,""+J,ot);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case b:return J.key===bt?H(X,K,J,ot):null;case A:return J.key===bt?Z(X,K,J,ot):null;case N:return bt=J._init,J=bt(J._payload),tt(X,K,J,ot)}if(dt(J)||z(J))return bt!==null?null:rt(X,K,J,ot,null);if(typeof J.then=="function")return tt(X,K,cd(J),ot);if(J.$$typeof===k)return tt(X,K,Xh(X,J),ot);ud(X,J)}return null}function et(X,K,J,ot,bt){if(typeof ot=="string"&&ot!==""||typeof ot=="number"||typeof ot=="bigint")return X=X.get(J)||null,D(K,X,""+ot,bt);if(typeof ot=="object"&&ot!==null){switch(ot.$$typeof){case b:return X=X.get(ot.key===null?J:ot.key)||null,H(K,X,ot,bt);case A:return X=X.get(ot.key===null?J:ot.key)||null,Z(K,X,ot,bt);case N:var Ht=ot._init;return ot=Ht(ot._payload),et(X,K,J,ot,bt)}if(dt(ot)||z(ot))return X=X.get(J)||null,rt(K,X,ot,bt,null);if(typeof ot.then=="function")return et(X,K,J,cd(ot),bt);if(ot.$$typeof===k)return et(X,K,J,Xh(K,ot),bt);ud(K,ot)}return null}function Lt(X,K,J,ot){for(var bt=null,Ht=null,Et=K,kt=K=0,fn=null;Et!==null&&kt<J.length;kt++){Et.index>kt?(fn=Et,Et=null):fn=Et.sibling;var se=tt(X,Et,J[kt],ot);if(se===null){Et===null&&(Et=fn);break}r&&Et&&se.alternate===null&&a(X,Et),K=_(se,K,kt),Ht===null?bt=se:Ht.sibling=se,Ht=se,Et=fn}if(kt===J.length)return c(X,Et),re&&Wa(X,kt),bt;if(Et===null){for(;kt<J.length;kt++)Et=lt(X,J[kt],ot),Et!==null&&(K=_(Et,K,kt),Ht===null?bt=Et:Ht.sibling=Et,Ht=Et);return re&&Wa(X,kt),bt}for(Et=d(Et);kt<J.length;kt++)fn=et(Et,X,kt,J[kt],ot),fn!==null&&(r&&fn.alternate!==null&&Et.delete(fn.key===null?kt:fn.key),K=_(fn,K,kt),Ht===null?bt=fn:Ht.sibling=fn,Ht=fn);return r&&Et.forEach(function(Yr){return a(X,Yr)}),re&&Wa(X,kt),bt}function It(X,K,J,ot){if(J==null)throw Error(n(151));for(var bt=null,Ht=null,Et=K,kt=K=0,fn=null,se=J.next();Et!==null&&!se.done;kt++,se=J.next()){Et.index>kt?(fn=Et,Et=null):fn=Et.sibling;var Yr=tt(X,Et,se.value,ot);if(Yr===null){Et===null&&(Et=fn);break}r&&Et&&Yr.alternate===null&&a(X,Et),K=_(Yr,K,kt),Ht===null?bt=Yr:Ht.sibling=Yr,Ht=Yr,Et=fn}if(se.done)return c(X,Et),re&&Wa(X,kt),bt;if(Et===null){for(;!se.done;kt++,se=J.next())se=lt(X,se.value,ot),se!==null&&(K=_(se,K,kt),Ht===null?bt=se:Ht.sibling=se,Ht=se);return re&&Wa(X,kt),bt}for(Et=d(Et);!se.done;kt++,se=J.next())se=et(Et,X,kt,se.value,ot),se!==null&&(r&&se.alternate!==null&&Et.delete(se.key===null?kt:se.key),K=_(se,K,kt),Ht===null?bt=se:Ht.sibling=se,Ht=se);return r&&Et.forEach(function(jC){return a(X,jC)}),re&&Wa(X,kt),bt}function pe(X,K,J,ot){if(typeof J=="object"&&J!==null&&J.type===S&&J.key===null&&(J=J.props.children),typeof J=="object"&&J!==null){switch(J.$$typeof){case b:t:{for(var bt=J.key;K!==null;){if(K.key===bt){if(bt=J.type,bt===S){if(K.tag===7){c(X,K.sibling),ot=y(K,J.props.children),ot.return=X,X=ot;break t}}else if(K.elementType===bt||typeof bt=="object"&&bt!==null&&bt.$$typeof===N&&Ib(bt)===K.type){c(X,K.sibling),ot=y(K,J.props),Hc(ot,J),ot.return=X,X=ot;break t}c(X,K);break}else a(X,K);K=K.sibling}J.type===S?(ot=$a(J.props.children,X.mode,ot,J.key),ot.return=X,X=ot):(ot=$h(J.type,J.key,J.props,null,X.mode,ot),Hc(ot,J),ot.return=X,X=ot)}return R(X);case A:t:{for(bt=J.key;K!==null;){if(K.key===bt)if(K.tag===4&&K.stateNode.containerInfo===J.containerInfo&&K.stateNode.implementation===J.implementation){c(X,K.sibling),ot=y(K,J.children||[]),ot.return=X,X=ot;break t}else{c(X,K);break}else a(X,K);K=K.sibling}ot=$p(J,X.mode,ot),ot.return=X,X=ot}return R(X);case N:return bt=J._init,J=bt(J._payload),pe(X,K,J,ot)}if(dt(J))return Lt(X,K,J,ot);if(z(J)){if(bt=z(J),typeof bt!="function")throw Error(n(150));return J=bt.call(J),It(X,K,J,ot)}if(typeof J.then=="function")return pe(X,K,cd(J),ot);if(J.$$typeof===k)return pe(X,K,Xh(X,J),ot);ud(X,J)}return typeof J=="string"&&J!==""||typeof J=="number"||typeof J=="bigint"?(J=""+J,K!==null&&K.tag===6?(c(X,K.sibling),ot=y(K,J),ot.return=X,X=ot):(c(X,K),ot=qp(J,X.mode,ot),ot.return=X,X=ot),R(X)):c(X,K)}return function(X,K,J,ot){try{zc=0;var bt=pe(X,K,J,ot);return al=null,bt}catch(Et){if(Et===Dc||Et===Jh)throw Et;var Ht=as(29,Et,null,X.mode);return Ht.lanes=ot,Ht.return=X,Ht}finally{}}}var ol=Nb(!0),kb=Nb(!1),Is=it(null),fi=null;function Pr(r){var a=r.alternate;W(an,an.current&1),W(Is,r),fi===null&&(a===null||nl.current!==null||a.memoizedState!==null)&&(fi=r)}function Mb(r){if(r.tag===22){if(W(an,an.current),W(Is,r),fi===null){var a=r.alternate;a!==null&&a.memoizedState!==null&&(fi=r)}}else Lr()}function Lr(){W(an,an.current),W(Is,Is.current)}function Ji(r){ht(Is),fi===r&&(fi=null),ht(an)}var an=it(0);function hd(r){for(var a=r;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||pg(c)))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}function Tm(r,a,c,d){a=r.memoizedState,c=c(d,a),c=c==null?a:m({},a,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var xm={enqueueSetState:function(r,a,c){r=r._reactInternals;var d=us(),y=kr(d);y.payload=a,c!=null&&(y.callback=c),a=Mr(r,y,d),a!==null&&(hs(a,r,d),Lc(a,r,d))},enqueueReplaceState:function(r,a,c){r=r._reactInternals;var d=us(),y=kr(d);y.tag=1,y.payload=a,c!=null&&(y.callback=c),a=Mr(r,y,d),a!==null&&(hs(a,r,d),Lc(a,r,d))},enqueueForceUpdate:function(r,a){r=r._reactInternals;var c=us(),d=kr(c);d.tag=2,a!=null&&(d.callback=a),a=Mr(r,d,c),a!==null&&(hs(a,r,c),Lc(a,r,c))}};function Db(r,a,c,d,y,_,R){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(d,_,R):a.prototype&&a.prototype.isPureReactComponent?!Tc(c,d)||!Tc(y,_):!0}function Pb(r,a,c,d){r=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,d),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,d),a.state!==r&&xm.enqueueReplaceState(a,a.state,null)}function eo(r,a){var c=a;if("ref"in a){c={};for(var d in a)d!=="ref"&&(c[d]=a[d])}if(r=r.defaultProps){c===a&&(c=m({},c));for(var y in r)c[y]===void 0&&(c[y]=r[y])}return c}var dd=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)};function Lb(r){dd(r)}function Ob(r){console.error(r)}function jb(r){dd(r)}function fd(r,a){try{var c=r.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(d){setTimeout(function(){throw d})}}function Vb(r,a,c){try{var d=r.onCaughtError;d(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function Cm(r,a,c){return c=kr(c),c.tag=3,c.payload={element:null},c.callback=function(){fd(r,a)},c}function Ub(r){return r=kr(r),r.tag=3,r}function Fb(r,a,c,d){var y=c.type.getDerivedStateFromError;if(typeof y=="function"){var _=d.value;r.payload=function(){return y(_)},r.callback=function(){Vb(a,c,d)}}var R=c.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(r.callback=function(){Vb(a,c,d),typeof y!="function"&&(Br===null?Br=new Set([this]):Br.add(this));var D=d.stack;this.componentDidCatch(d.value,{componentStack:D!==null?D:""})})}function j1(r,a,c,d,y){if(c.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(a=c.alternate,a!==null&&Nc(a,c,y,!0),c=Is.current,c!==null){switch(c.tag){case 13:return fi===null?Qm():c.alternate===null&&Pe===0&&(Pe=3),c.flags&=-257,c.flags|=65536,c.lanes=y,d===nm?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([d]):a.add(d),Zm(r,d,y)),!1;case 22:return c.flags|=65536,d===nm?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([d])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([d]):c.add(d)),Zm(r,d,y)),!1}throw Error(n(435,c.tag))}return Zm(r,d,y),Qm(),!1}if(re)return a=Is.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=y,d!==Yp&&(r=Error(n(422),{cause:d}),Ic(Ts(r,c)))):(d!==Yp&&(a=Error(n(423),{cause:d}),Ic(Ts(a,c))),r=r.current.alternate,r.flags|=65536,y&=-y,r.lanes|=y,d=Ts(d,c),y=Cm(r.stateNode,d,y),rm(r,y),Pe!==4&&(Pe=2)),!1;var _=Error(n(520),{cause:d});if(_=Ts(_,c),Xc===null?Xc=[_]:Xc.push(_),Pe!==4&&(Pe=2),a===null)return!0;d=Ts(d,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,r=y&-y,c.lanes|=r,r=Cm(c.stateNode,d,r),rm(c,r),!1;case 1:if(a=c.type,_=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(Br===null||!Br.has(_))))return c.flags|=65536,y&=-y,c.lanes|=y,y=Ub(y),Fb(y,r,c,d),rm(c,y),!1}c=c.return}while(c!==null);return!1}var Bb=Error(n(461)),hn=!1;function _n(r,a,c,d){a.child=r===null?kb(a,null,c,d):ol(a,r.child,c,d)}function zb(r,a,c,d,y){c=c.render;var _=a.ref;if("ref"in d){var R={};for(var D in d)D!=="ref"&&(R[D]=d[D])}else R=d;return Ja(a),d=um(r,a,c,R,_,y),D=hm(),r!==null&&!hn?(dm(r,a,y),Zi(r,a,y)):(re&&D&&Kp(a),a.flags|=1,_n(r,a,d,y),a.child)}function Hb(r,a,c,d,y){if(r===null){var _=c.type;return typeof _=="function"&&!Gp(_)&&_.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=_,Gb(r,a,_,d,y)):(r=$h(c.type,null,d,a,a.mode,y),r.ref=a.ref,r.return=a,a.child=r)}if(_=r.child,!Lm(r,y)){var R=_.memoizedProps;if(c=c.compare,c=c!==null?c:Tc,c(R,d)&&r.ref===a.ref)return Zi(r,a,y)}return a.flags|=1,r=$i(_,d),r.ref=a.ref,r.return=a,a.child=r}function Gb(r,a,c,d,y){if(r!==null){var _=r.memoizedProps;if(Tc(_,d)&&r.ref===a.ref)if(hn=!1,a.pendingProps=d=_,Lm(r,y))(r.flags&131072)!==0&&(hn=!0);else return a.lanes=r.lanes,Zi(r,a,y)}return Rm(r,a,c,d,y)}function qb(r,a,c){var d=a.pendingProps,y=d.children,_=r!==null?r.memoizedState:null;if(d.mode==="hidden"){if((a.flags&128)!==0){if(d=_!==null?_.baseLanes|c:c,r!==null){for(y=a.child=r.child,_=0;y!==null;)_=_|y.lanes|y.childLanes,y=y.sibling;a.childLanes=_&~d}else a.childLanes=0,a.child=null;return $b(r,a,d,c)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},r!==null&&Qh(a,_!==null?_.cachePool:null),_!==null?G_(a,_):om(),Mb(a);else return a.lanes=a.childLanes=536870912,$b(r,a,_!==null?_.baseLanes|c:c,c)}else _!==null?(Qh(a,_.cachePool),G_(a,_),Lr(),a.memoizedState=null):(r!==null&&Qh(a,null),om(),Lr());return _n(r,a,y,c),a.child}function $b(r,a,c,d){var y=em();return y=y===null?null:{parent:rn._currentValue,pool:y},a.memoizedState={baseLanes:c,cachePool:y},r!==null&&Qh(a,null),om(),Mb(a),r!==null&&Nc(r,a,d,!0),null}function pd(r,a){var c=a.ref;if(c===null)r!==null&&r.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(n(284));(r===null||r.ref!==c)&&(a.flags|=4194816)}}function Rm(r,a,c,d,y){return Ja(a),c=um(r,a,c,d,void 0,y),d=hm(),r!==null&&!hn?(dm(r,a,y),Zi(r,a,y)):(re&&d&&Kp(a),a.flags|=1,_n(r,a,c,y),a.child)}function Kb(r,a,c,d,y,_){return Ja(a),a.updateQueue=null,c=$_(a,d,c,y),q_(r),d=hm(),r!==null&&!hn?(dm(r,a,_),Zi(r,a,_)):(re&&d&&Kp(a),a.flags|=1,_n(r,a,c,_),a.child)}function Wb(r,a,c,d,y){if(Ja(a),a.stateNode===null){var _=Qo,R=c.contextType;typeof R=="object"&&R!==null&&(_=Cn(R)),_=new c(d,_),a.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=xm,a.stateNode=_,_._reactInternals=a,_=a.stateNode,_.props=d,_.state=a.memoizedState,_.refs={},sm(a),R=c.contextType,_.context=typeof R=="object"&&R!==null?Cn(R):Qo,_.state=a.memoizedState,R=c.getDerivedStateFromProps,typeof R=="function"&&(Tm(a,c,R,d),_.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(R=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),R!==_.state&&xm.enqueueReplaceState(_,_.state,null),jc(a,d,_,y),Oc(),_.state=a.memoizedState),typeof _.componentDidMount=="function"&&(a.flags|=4194308),d=!0}else if(r===null){_=a.stateNode;var D=a.memoizedProps,H=eo(c,D);_.props=H;var Z=_.context,rt=c.contextType;R=Qo,typeof rt=="object"&&rt!==null&&(R=Cn(rt));var lt=c.getDerivedStateFromProps;rt=typeof lt=="function"||typeof _.getSnapshotBeforeUpdate=="function",D=a.pendingProps!==D,rt||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(D||Z!==R)&&Pb(a,_,d,R),Nr=!1;var tt=a.memoizedState;_.state=tt,jc(a,d,_,y),Oc(),Z=a.memoizedState,D||tt!==Z||Nr?(typeof lt=="function"&&(Tm(a,c,lt,d),Z=a.memoizedState),(H=Nr||Db(a,c,H,d,tt,Z,R))?(rt||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(a.flags|=4194308)):(typeof _.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=d,a.memoizedState=Z),_.props=d,_.state=Z,_.context=R,d=H):(typeof _.componentDidMount=="function"&&(a.flags|=4194308),d=!1)}else{_=a.stateNode,im(r,a),R=a.memoizedProps,rt=eo(c,R),_.props=rt,lt=a.pendingProps,tt=_.context,Z=c.contextType,H=Qo,typeof Z=="object"&&Z!==null&&(H=Cn(Z)),D=c.getDerivedStateFromProps,(Z=typeof D=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(R!==lt||tt!==H)&&Pb(a,_,d,H),Nr=!1,tt=a.memoizedState,_.state=tt,jc(a,d,_,y),Oc();var et=a.memoizedState;R!==lt||tt!==et||Nr||r!==null&&r.dependencies!==null&&Yh(r.dependencies)?(typeof D=="function"&&(Tm(a,c,D,d),et=a.memoizedState),(rt=Nr||Db(a,c,rt,d,tt,et,H)||r!==null&&r.dependencies!==null&&Yh(r.dependencies))?(Z||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(d,et,H),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(d,et,H)),typeof _.componentDidUpdate=="function"&&(a.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof _.componentDidUpdate!="function"||R===r.memoizedProps&&tt===r.memoizedState||(a.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||R===r.memoizedProps&&tt===r.memoizedState||(a.flags|=1024),a.memoizedProps=d,a.memoizedState=et),_.props=d,_.state=et,_.context=H,d=rt):(typeof _.componentDidUpdate!="function"||R===r.memoizedProps&&tt===r.memoizedState||(a.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||R===r.memoizedProps&&tt===r.memoizedState||(a.flags|=1024),d=!1)}return _=d,pd(r,a),d=(a.flags&128)!==0,_||d?(_=a.stateNode,c=d&&typeof c.getDerivedStateFromError!="function"?null:_.render(),a.flags|=1,r!==null&&d?(a.child=ol(a,r.child,null,y),a.child=ol(a,null,c,y)):_n(r,a,c,y),a.memoizedState=_.state,r=a.child):r=Zi(r,a,y),r}function Yb(r,a,c,d){return Rc(),a.flags|=256,_n(r,a,c,d),a.child}var Im={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Nm(r){return{baseLanes:r,cachePool:O_()}}function km(r,a,c){return r=r!==null?r.childLanes&~c:0,a&&(r|=Ns),r}function Xb(r,a,c){var d=a.pendingProps,y=!1,_=(a.flags&128)!==0,R;if((R=_)||(R=r!==null&&r.memoizedState===null?!1:(an.current&2)!==0),R&&(y=!0,a.flags&=-129),R=(a.flags&32)!==0,a.flags&=-33,r===null){if(re){if(y?Pr(a):Lr(),re){var D=De,H;if(H=D){t:{for(H=D,D=di;H.nodeType!==8;){if(!D){D=null;break t}if(H=Gs(H.nextSibling),H===null){D=null;break t}}D=H}D!==null?(a.memoizedState={dehydrated:D,treeContext:Ka!==null?{id:Ki,overflow:Wi}:null,retryLane:536870912,hydrationErrors:null},H=as(18,null,null,0),H.stateNode=D,H.return=a,a.child=H,Vn=a,De=null,H=!0):H=!1}H||Xa(a)}if(D=a.memoizedState,D!==null&&(D=D.dehydrated,D!==null))return pg(D)?a.lanes=32:a.lanes=536870912,null;Ji(a)}return D=d.children,d=d.fallback,y?(Lr(),y=a.mode,D=md({mode:"hidden",children:D},y),d=$a(d,y,c,null),D.return=a,d.return=a,D.sibling=d,a.child=D,y=a.child,y.memoizedState=Nm(c),y.childLanes=km(r,R,c),a.memoizedState=Im,d):(Pr(a),Mm(a,D))}if(H=r.memoizedState,H!==null&&(D=H.dehydrated,D!==null)){if(_)a.flags&256?(Pr(a),a.flags&=-257,a=Dm(r,a,c)):a.memoizedState!==null?(Lr(),a.child=r.child,a.flags|=128,a=null):(Lr(),y=d.fallback,D=a.mode,d=md({mode:"visible",children:d.children},D),y=$a(y,D,c,null),y.flags|=2,d.return=a,y.return=a,d.sibling=y,a.child=d,ol(a,r.child,null,c),d=a.child,d.memoizedState=Nm(c),d.childLanes=km(r,R,c),a.memoizedState=Im,a=y);else if(Pr(a),pg(D)){if(R=D.nextSibling&&D.nextSibling.dataset,R)var Z=R.dgst;R=Z,d=Error(n(419)),d.stack="",d.digest=R,Ic({value:d,source:null,stack:null}),a=Dm(r,a,c)}else if(hn||Nc(r,a,c,!1),R=(c&r.childLanes)!==0,hn||R){if(R=_e,R!==null&&(d=c&-c,d=(d&42)!==0?1:wr(d),d=(d&(R.suspendedLanes|c))!==0?0:d,d!==0&&d!==H.retryLane))throw H.retryLane=d,Xo(r,d),hs(R,r,d),Bb;D.data==="$?"||Qm(),a=Dm(r,a,c)}else D.data==="$?"?(a.flags|=192,a.child=r.child,a=null):(r=H.treeContext,De=Gs(D.nextSibling),Vn=a,re=!0,Ya=null,di=!1,r!==null&&(Cs[Rs++]=Ki,Cs[Rs++]=Wi,Cs[Rs++]=Ka,Ki=r.id,Wi=r.overflow,Ka=a),a=Mm(a,d.children),a.flags|=4096);return a}return y?(Lr(),y=d.fallback,D=a.mode,H=r.child,Z=H.sibling,d=$i(H,{mode:"hidden",children:d.children}),d.subtreeFlags=H.subtreeFlags&65011712,Z!==null?y=$i(Z,y):(y=$a(y,D,c,null),y.flags|=2),y.return=a,d.return=a,d.sibling=y,a.child=d,d=y,y=a.child,D=r.child.memoizedState,D===null?D=Nm(c):(H=D.cachePool,H!==null?(Z=rn._currentValue,H=H.parent!==Z?{parent:Z,pool:Z}:H):H=O_(),D={baseLanes:D.baseLanes|c,cachePool:H}),y.memoizedState=D,y.childLanes=km(r,R,c),a.memoizedState=Im,d):(Pr(a),c=r.child,r=c.sibling,c=$i(c,{mode:"visible",children:d.children}),c.return=a,c.sibling=null,r!==null&&(R=a.deletions,R===null?(a.deletions=[r],a.flags|=16):R.push(r)),a.child=c,a.memoizedState=null,c)}function Mm(r,a){return a=md({mode:"visible",children:a},r.mode),a.return=r,r.child=a}function md(r,a){return r=as(22,r,null,a),r.lanes=0,r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},r}function Dm(r,a,c){return ol(a,r.child,null,c),r=Mm(a,a.pendingProps.children),r.flags|=2,a.memoizedState=null,r}function Qb(r,a,c){r.lanes|=a;var d=r.alternate;d!==null&&(d.lanes|=a),Qp(r.return,a,c)}function Pm(r,a,c,d,y){var _=r.memoizedState;_===null?r.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:y}:(_.isBackwards=a,_.rendering=null,_.renderingStartTime=0,_.last=d,_.tail=c,_.tailMode=y)}function Jb(r,a,c){var d=a.pendingProps,y=d.revealOrder,_=d.tail;if(_n(r,a,d.children,c),d=an.current,(d&2)!==0)d=d&1|2,a.flags|=128;else{if(r!==null&&(r.flags&128)!==0)t:for(r=a.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Qb(r,c,a);else if(r.tag===19)Qb(r,c,a);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break t;for(;r.sibling===null;){if(r.return===null||r.return===a)break t;r=r.return}r.sibling.return=r.return,r=r.sibling}d&=1}switch(W(an,d),y){case"forwards":for(c=a.child,y=null;c!==null;)r=c.alternate,r!==null&&hd(r)===null&&(y=c),c=c.sibling;c=y,c===null?(y=a.child,a.child=null):(y=c.sibling,c.sibling=null),Pm(a,!1,y,c,_);break;case"backwards":for(c=null,y=a.child,a.child=null;y!==null;){if(r=y.alternate,r!==null&&hd(r)===null){a.child=y;break}r=y.sibling,y.sibling=c,c=y,y=r}Pm(a,!0,c,null,_);break;case"together":Pm(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function Zi(r,a,c){if(r!==null&&(a.dependencies=r.dependencies),Fr|=a.lanes,(c&a.childLanes)===0)if(r!==null){if(Nc(r,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(r!==null&&a.child!==r.child)throw Error(n(153));if(a.child!==null){for(r=a.child,c=$i(r,r.pendingProps),a.child=c,c.return=a;r.sibling!==null;)r=r.sibling,c=c.sibling=$i(r,r.pendingProps),c.return=a;c.sibling=null}return a.child}function Lm(r,a){return(r.lanes&a)!==0?!0:(r=r.dependencies,!!(r!==null&&Yh(r)))}function V1(r,a,c){switch(a.tag){case 3:Qt(a,a.stateNode.containerInfo),Ir(a,rn,r.memoizedState.cache),Rc();break;case 27:case 5:ys(a);break;case 4:Qt(a,a.stateNode.containerInfo);break;case 10:Ir(a,a.type,a.memoizedProps.value);break;case 13:var d=a.memoizedState;if(d!==null)return d.dehydrated!==null?(Pr(a),a.flags|=128,null):(c&a.child.childLanes)!==0?Xb(r,a,c):(Pr(a),r=Zi(r,a,c),r!==null?r.sibling:null);Pr(a);break;case 19:var y=(r.flags&128)!==0;if(d=(c&a.childLanes)!==0,d||(Nc(r,a,c,!1),d=(c&a.childLanes)!==0),y){if(d)return Jb(r,a,c);a.flags|=128}if(y=a.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),W(an,an.current),d)break;return null;case 22:case 23:return a.lanes=0,qb(r,a,c);case 24:Ir(a,rn,r.memoizedState.cache)}return Zi(r,a,c)}function Zb(r,a,c){if(r!==null)if(r.memoizedProps!==a.pendingProps)hn=!0;else{if(!Lm(r,c)&&(a.flags&128)===0)return hn=!1,V1(r,a,c);hn=(r.flags&131072)!==0}else hn=!1,re&&(a.flags&1048576)!==0&&I_(a,Wh,a.index);switch(a.lanes=0,a.tag){case 16:t:{r=a.pendingProps;var d=a.elementType,y=d._init;if(d=y(d._payload),a.type=d,typeof d=="function")Gp(d)?(r=eo(d,r),a.tag=1,a=Wb(null,a,d,r,c)):(a.tag=0,a=Rm(null,a,d,r,c));else{if(d!=null){if(y=d.$$typeof,y===V){a.tag=11,a=zb(null,a,d,r,c);break t}else if(y===I){a.tag=14,a=Hb(null,a,d,r,c);break t}}throw a=st(d)||d,Error(n(306,a,""))}}return a;case 0:return Rm(r,a,a.type,a.pendingProps,c);case 1:return d=a.type,y=eo(d,a.pendingProps),Wb(r,a,d,y,c);case 3:t:{if(Qt(a,a.stateNode.containerInfo),r===null)throw Error(n(387));d=a.pendingProps;var _=a.memoizedState;y=_.element,im(r,a),jc(a,d,null,c);var R=a.memoizedState;if(d=R.cache,Ir(a,rn,d),d!==_.cache&&Jp(a,[rn],c,!0),Oc(),d=R.element,_.isDehydrated)if(_={element:d,isDehydrated:!1,cache:R.cache},a.updateQueue.baseState=_,a.memoizedState=_,a.flags&256){a=Yb(r,a,d,c);break t}else if(d!==y){y=Ts(Error(n(424)),a),Ic(y),a=Yb(r,a,d,c);break t}else{switch(r=a.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(De=Gs(r.firstChild),Vn=a,re=!0,Ya=null,di=!0,c=kb(a,null,d,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(Rc(),d===y){a=Zi(r,a,c);break t}_n(r,a,d,c)}a=a.child}return a;case 26:return pd(r,a),r===null?(c=sw(a.type,null,a.pendingProps,null))?a.memoizedState=c:re||(c=a.type,r=a.pendingProps,d=Id(wt.current).createElement(c),d[en]=a,d[Ge]=r,An(d,c,r),je(d),a.stateNode=d):a.memoizedState=sw(a.type,r.memoizedProps,a.pendingProps,r.memoizedState),null;case 27:return ys(a),r===null&&re&&(d=a.stateNode=tw(a.type,a.pendingProps,wt.current),Vn=a,di=!0,y=De,Gr(a.type)?(mg=y,De=Gs(d.firstChild)):De=y),_n(r,a,a.pendingProps.children,c),pd(r,a),r===null&&(a.flags|=4194304),a.child;case 5:return r===null&&re&&((y=d=De)&&(d=dC(d,a.type,a.pendingProps,di),d!==null?(a.stateNode=d,Vn=a,De=Gs(d.firstChild),di=!1,y=!0):y=!1),y||Xa(a)),ys(a),y=a.type,_=a.pendingProps,R=r!==null?r.memoizedProps:null,d=_.children,hg(y,_)?d=null:R!==null&&hg(y,R)&&(a.flags|=32),a.memoizedState!==null&&(y=um(r,a,N1,null,null,c),ru._currentValue=y),pd(r,a),_n(r,a,d,c),a.child;case 6:return r===null&&re&&((r=c=De)&&(c=fC(c,a.pendingProps,di),c!==null?(a.stateNode=c,Vn=a,De=null,r=!0):r=!1),r||Xa(a)),null;case 13:return Xb(r,a,c);case 4:return Qt(a,a.stateNode.containerInfo),d=a.pendingProps,r===null?a.child=ol(a,null,d,c):_n(r,a,d,c),a.child;case 11:return zb(r,a,a.type,a.pendingProps,c);case 7:return _n(r,a,a.pendingProps,c),a.child;case 8:return _n(r,a,a.pendingProps.children,c),a.child;case 12:return _n(r,a,a.pendingProps.children,c),a.child;case 10:return d=a.pendingProps,Ir(a,a.type,d.value),_n(r,a,d.children,c),a.child;case 9:return y=a.type._context,d=a.pendingProps.children,Ja(a),y=Cn(y),d=d(y),a.flags|=1,_n(r,a,d,c),a.child;case 14:return Hb(r,a,a.type,a.pendingProps,c);case 15:return Gb(r,a,a.type,a.pendingProps,c);case 19:return Jb(r,a,c);case 31:return d=a.pendingProps,c=a.mode,d={mode:d.mode,children:d.children},r===null?(c=md(d,c),c.ref=a.ref,a.child=c,c.return=a,a=c):(c=$i(r.child,d),c.ref=a.ref,a.child=c,c.return=a,a=c),a;case 22:return qb(r,a,c);case 24:return Ja(a),d=Cn(rn),r===null?(y=em(),y===null&&(y=_e,_=Zp(),y.pooledCache=_,_.refCount++,_!==null&&(y.pooledCacheLanes|=c),y=_),a.memoizedState={parent:d,cache:y},sm(a),Ir(a,rn,y)):((r.lanes&c)!==0&&(im(r,a),jc(a,null,null,c),Oc()),y=r.memoizedState,_=a.memoizedState,y.parent!==d?(y={parent:d,cache:d},a.memoizedState=y,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=y),Ir(a,rn,d)):(d=_.cache,Ir(a,rn,d),d!==y.cache&&Jp(a,[rn],c,!0))),_n(r,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(n(156,a.tag))}function tr(r){r.flags|=4}function tA(r,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!lw(a)){if(a=Is.current,a!==null&&((te&4194048)===te?fi!==null:(te&62914560)!==te&&(te&536870912)===0||a!==fi))throw Pc=nm,j_;r.flags|=8192}}function gd(r,a){a!==null&&(r.flags|=4),r.flags&16384&&(a=r.tag!==22?oc():536870912,r.lanes|=a,hl|=a)}function Gc(r,a){if(!re)switch(r.tailMode){case"hidden":a=r.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?a||r.tail===null?r.tail=null:r.tail.sibling=null:d.sibling=null}}function Re(r){var a=r.alternate!==null&&r.alternate.child===r.child,c=0,d=0;if(a)for(var y=r.child;y!==null;)c|=y.lanes|y.childLanes,d|=y.subtreeFlags&65011712,d|=y.flags&65011712,y.return=r,y=y.sibling;else for(y=r.child;y!==null;)c|=y.lanes|y.childLanes,d|=y.subtreeFlags,d|=y.flags,y.return=r,y=y.sibling;return r.subtreeFlags|=d,r.childLanes=c,a}function U1(r,a,c){var d=a.pendingProps;switch(Wp(a),a.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Re(a),null;case 1:return Re(a),null;case 3:return c=a.stateNode,d=null,r!==null&&(d=r.memoizedState.cache),a.memoizedState.cache!==d&&(a.flags|=2048),Xi(rn),Gn(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(Cc(a)?tr(a):r===null||r.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,M_())),Re(a),null;case 26:return c=a.memoizedState,r===null?(tr(a),c!==null?(Re(a),tA(a,c)):(Re(a),a.flags&=-16777217)):c?c!==r.memoizedState?(tr(a),Re(a),tA(a,c)):(Re(a),a.flags&=-16777217):(r.memoizedProps!==d&&tr(a),Re(a),a.flags&=-16777217),null;case 27:Pn(a),c=wt.current;var y=a.type;if(r!==null&&a.stateNode!=null)r.memoizedProps!==d&&tr(a);else{if(!d){if(a.stateNode===null)throw Error(n(166));return Re(a),null}r=ft.current,Cc(a)?N_(a):(r=tw(y,d,c),a.stateNode=r,tr(a))}return Re(a),null;case 5:if(Pn(a),c=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==d&&tr(a);else{if(!d){if(a.stateNode===null)throw Error(n(166));return Re(a),null}if(r=ft.current,Cc(a))N_(a);else{switch(y=Id(wt.current),r){case 1:r=y.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:r=y.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":r=y.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":r=y.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":r=y.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild);break;case"select":r=typeof d.is=="string"?y.createElement("select",{is:d.is}):y.createElement("select"),d.multiple?r.multiple=!0:d.size&&(r.size=d.size);break;default:r=typeof d.is=="string"?y.createElement(c,{is:d.is}):y.createElement(c)}}r[en]=a,r[Ge]=d;t:for(y=a.child;y!==null;){if(y.tag===5||y.tag===6)r.appendChild(y.stateNode);else if(y.tag!==4&&y.tag!==27&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===a)break t;for(;y.sibling===null;){if(y.return===null||y.return===a)break t;y=y.return}y.sibling.return=y.return,y=y.sibling}a.stateNode=r;t:switch(An(r,c,d),c){case"button":case"input":case"select":case"textarea":r=!!d.autoFocus;break t;case"img":r=!0;break t;default:r=!1}r&&tr(a)}}return Re(a),a.flags&=-16777217,null;case 6:if(r&&a.stateNode!=null)r.memoizedProps!==d&&tr(a);else{if(typeof d!="string"&&a.stateNode===null)throw Error(n(166));if(r=wt.current,Cc(a)){if(r=a.stateNode,c=a.memoizedProps,d=null,y=Vn,y!==null)switch(y.tag){case 27:case 5:d=y.memoizedProps}r[en]=a,r=!!(r.nodeValue===c||d!==null&&d.suppressHydrationWarning===!0||KA(r.nodeValue,c)),r||Xa(a)}else r=Id(r).createTextNode(d),r[en]=a,a.stateNode=r}return Re(a),null;case 13:if(d=a.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(y=Cc(a),d!==null&&d.dehydrated!==null){if(r===null){if(!y)throw Error(n(318));if(y=a.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(n(317));y[en]=a}else Rc(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Re(a),y=!1}else y=M_(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=y),y=!0;if(!y)return a.flags&256?(Ji(a),a):(Ji(a),null)}if(Ji(a),(a.flags&128)!==0)return a.lanes=c,a;if(c=d!==null,r=r!==null&&r.memoizedState!==null,c){d=a.child,y=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(y=d.alternate.memoizedState.cachePool.pool);var _=null;d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(_=d.memoizedState.cachePool.pool),_!==y&&(d.flags|=2048)}return c!==r&&c&&(a.child.flags|=8192),gd(a,a.updateQueue),Re(a),null;case 4:return Gn(),r===null&&ag(a.stateNode.containerInfo),Re(a),null;case 10:return Xi(a.type),Re(a),null;case 19:if(ht(an),y=a.memoizedState,y===null)return Re(a),null;if(d=(a.flags&128)!==0,_=y.rendering,_===null)if(d)Gc(y,!1);else{if(Pe!==0||r!==null&&(r.flags&128)!==0)for(r=a.child;r!==null;){if(_=hd(r),_!==null){for(a.flags|=128,Gc(y,!1),r=_.updateQueue,a.updateQueue=r,gd(a,r),a.subtreeFlags=0,r=c,c=a.child;c!==null;)R_(c,r),c=c.sibling;return W(an,an.current&1|2),a.child}r=r.sibling}y.tail!==null&&Ct()>_d&&(a.flags|=128,d=!0,Gc(y,!1),a.lanes=4194304)}else{if(!d)if(r=hd(_),r!==null){if(a.flags|=128,d=!0,r=r.updateQueue,a.updateQueue=r,gd(a,r),Gc(y,!0),y.tail===null&&y.tailMode==="hidden"&&!_.alternate&&!re)return Re(a),null}else 2*Ct()-y.renderingStartTime>_d&&c!==536870912&&(a.flags|=128,d=!0,Gc(y,!1),a.lanes=4194304);y.isBackwards?(_.sibling=a.child,a.child=_):(r=y.last,r!==null?r.sibling=_:a.child=_,y.last=_)}return y.tail!==null?(a=y.tail,y.rendering=a,y.tail=a.sibling,y.renderingStartTime=Ct(),a.sibling=null,r=an.current,W(an,d?r&1|2:r&1),a):(Re(a),null);case 22:case 23:return Ji(a),lm(),d=a.memoizedState!==null,r!==null?r.memoizedState!==null!==d&&(a.flags|=8192):d&&(a.flags|=8192),d?(c&536870912)!==0&&(a.flags&128)===0&&(Re(a),a.subtreeFlags&6&&(a.flags|=8192)):Re(a),c=a.updateQueue,c!==null&&gd(a,c.retryQueue),c=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),d=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),d!==c&&(a.flags|=2048),r!==null&&ht(Za),null;case 24:return c=null,r!==null&&(c=r.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),Xi(rn),Re(a),null;case 25:return null;case 30:return null}throw Error(n(156,a.tag))}function F1(r,a){switch(Wp(a),a.tag){case 1:return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 3:return Xi(rn),Gn(),r=a.flags,(r&65536)!==0&&(r&128)===0?(a.flags=r&-65537|128,a):null;case 26:case 27:case 5:return Pn(a),null;case 13:if(Ji(a),r=a.memoizedState,r!==null&&r.dehydrated!==null){if(a.alternate===null)throw Error(n(340));Rc()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 19:return ht(an),null;case 4:return Gn(),null;case 10:return Xi(a.type),null;case 22:case 23:return Ji(a),lm(),r!==null&&ht(Za),r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 24:return Xi(rn),null;case 25:return null;default:return null}}function eA(r,a){switch(Wp(a),a.tag){case 3:Xi(rn),Gn();break;case 26:case 27:case 5:Pn(a);break;case 4:Gn();break;case 13:Ji(a);break;case 19:ht(an);break;case 10:Xi(a.type);break;case 22:case 23:Ji(a),lm(),r!==null&&ht(Za);break;case 24:Xi(rn)}}function qc(r,a){try{var c=a.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var y=d.next;c=y;do{if((c.tag&r)===r){d=void 0;var _=c.create,R=c.inst;d=_(),R.destroy=d}c=c.next}while(c!==y)}}catch(D){ve(a,a.return,D)}}function Or(r,a,c){try{var d=a.updateQueue,y=d!==null?d.lastEffect:null;if(y!==null){var _=y.next;d=_;do{if((d.tag&r)===r){var R=d.inst,D=R.destroy;if(D!==void 0){R.destroy=void 0,y=a;var H=c,Z=D;try{Z()}catch(rt){ve(y,H,rt)}}}d=d.next}while(d!==_)}}catch(rt){ve(a,a.return,rt)}}function nA(r){var a=r.updateQueue;if(a!==null){var c=r.stateNode;try{H_(a,c)}catch(d){ve(r,r.return,d)}}}function sA(r,a,c){c.props=eo(r.type,r.memoizedProps),c.state=r.memoizedState;try{c.componentWillUnmount()}catch(d){ve(r,a,d)}}function $c(r,a){try{var c=r.ref;if(c!==null){switch(r.tag){case 26:case 27:case 5:var d=r.stateNode;break;case 30:d=r.stateNode;break;default:d=r.stateNode}typeof c=="function"?r.refCleanup=c(d):c.current=d}}catch(y){ve(r,a,y)}}function pi(r,a){var c=r.ref,d=r.refCleanup;if(c!==null)if(typeof d=="function")try{d()}catch(y){ve(r,a,y)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(y){ve(r,a,y)}else c.current=null}function iA(r){var a=r.type,c=r.memoizedProps,d=r.stateNode;try{t:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&d.focus();break t;case"img":c.src?d.src=c.src:c.srcSet&&(d.srcset=c.srcSet)}}catch(y){ve(r,r.return,y)}}function Om(r,a,c){try{var d=r.stateNode;oC(d,r.type,c,a),d[Ge]=a}catch(y){ve(r,r.return,y)}}function rA(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&Gr(r.type)||r.tag===4}function jm(r){t:for(;;){for(;r.sibling===null;){if(r.return===null||rA(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&Gr(r.type)||r.flags&2||r.child===null||r.tag===4)continue t;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Vm(r,a,c){var d=r.tag;if(d===5||d===6)r=r.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(r,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(r),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=Rd));else if(d!==4&&(d===27&&Gr(r.type)&&(c=r.stateNode,a=null),r=r.child,r!==null))for(Vm(r,a,c),r=r.sibling;r!==null;)Vm(r,a,c),r=r.sibling}function yd(r,a,c){var d=r.tag;if(d===5||d===6)r=r.stateNode,a?c.insertBefore(r,a):c.appendChild(r);else if(d!==4&&(d===27&&Gr(r.type)&&(c=r.stateNode),r=r.child,r!==null))for(yd(r,a,c),r=r.sibling;r!==null;)yd(r,a,c),r=r.sibling}function aA(r){var a=r.stateNode,c=r.memoizedProps;try{for(var d=r.type,y=a.attributes;y.length;)a.removeAttributeNode(y[0]);An(a,d,c),a[en]=r,a[Ge]=c}catch(_){ve(r,r.return,_)}}var er=!1,Ue=!1,Um=!1,oA=typeof WeakSet=="function"?WeakSet:Set,dn=null;function B1(r,a){if(r=r.containerInfo,cg=Ld,r=v_(r),jp(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else t:{c=(c=r.ownerDocument)&&c.defaultView||window;var d=c.getSelection&&c.getSelection();if(d&&d.rangeCount!==0){c=d.anchorNode;var y=d.anchorOffset,_=d.focusNode;d=d.focusOffset;try{c.nodeType,_.nodeType}catch{c=null;break t}var R=0,D=-1,H=-1,Z=0,rt=0,lt=r,tt=null;e:for(;;){for(var et;lt!==c||y!==0&&lt.nodeType!==3||(D=R+y),lt!==_||d!==0&&lt.nodeType!==3||(H=R+d),lt.nodeType===3&&(R+=lt.nodeValue.length),(et=lt.firstChild)!==null;)tt=lt,lt=et;for(;;){if(lt===r)break e;if(tt===c&&++Z===y&&(D=R),tt===_&&++rt===d&&(H=R),(et=lt.nextSibling)!==null)break;lt=tt,tt=lt.parentNode}lt=et}c=D===-1||H===-1?null:{start:D,end:H}}else c=null}c=c||{start:0,end:0}}else c=null;for(ug={focusedElem:r,selectionRange:c},Ld=!1,dn=a;dn!==null;)if(a=dn,r=a.child,(a.subtreeFlags&1024)!==0&&r!==null)r.return=a,dn=r;else for(;dn!==null;){switch(a=dn,_=a.alternate,r=a.flags,a.tag){case 0:break;case 11:case 15:break;case 1:if((r&1024)!==0&&_!==null){r=void 0,c=a,y=_.memoizedProps,_=_.memoizedState,d=c.stateNode;try{var Lt=eo(c.type,y,c.elementType===c.type);r=d.getSnapshotBeforeUpdate(Lt,_),d.__reactInternalSnapshotBeforeUpdate=r}catch(It){ve(c,c.return,It)}}break;case 3:if((r&1024)!==0){if(r=a.stateNode.containerInfo,c=r.nodeType,c===9)fg(r);else if(c===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":fg(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(n(163))}if(r=a.sibling,r!==null){r.return=a.return,dn=r;break}dn=a.return}}function lA(r,a,c){var d=c.flags;switch(c.tag){case 0:case 11:case 15:jr(r,c),d&4&&qc(5,c);break;case 1:if(jr(r,c),d&4)if(r=c.stateNode,a===null)try{r.componentDidMount()}catch(R){ve(c,c.return,R)}else{var y=eo(c.type,a.memoizedProps);a=a.memoizedState;try{r.componentDidUpdate(y,a,r.__reactInternalSnapshotBeforeUpdate)}catch(R){ve(c,c.return,R)}}d&64&&nA(c),d&512&&$c(c,c.return);break;case 3:if(jr(r,c),d&64&&(r=c.updateQueue,r!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{H_(r,a)}catch(R){ve(c,c.return,R)}}break;case 27:a===null&&d&4&&aA(c);case 26:case 5:jr(r,c),a===null&&d&4&&iA(c),d&512&&$c(c,c.return);break;case 12:jr(r,c);break;case 13:jr(r,c),d&4&&hA(r,c),d&64&&(r=c.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(c=X1.bind(null,c),pC(r,c))));break;case 22:if(d=c.memoizedState!==null||er,!d){a=a!==null&&a.memoizedState!==null||Ue,y=er;var _=Ue;er=d,(Ue=a)&&!_?Vr(r,c,(c.subtreeFlags&8772)!==0):jr(r,c),er=y,Ue=_}break;case 30:break;default:jr(r,c)}}function cA(r){var a=r.alternate;a!==null&&(r.alternate=null,cA(a)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(a=r.stateNode,a!==null&&Tr(a)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var Se=null,$n=!1;function nr(r,a,c){for(c=c.child;c!==null;)uA(r,a,c),c=c.sibling}function uA(r,a,c){if(le&&typeof le.onCommitFiberUnmount=="function")try{le.onCommitFiberUnmount(Me,c)}catch{}switch(c.tag){case 26:Ue||pi(c,a),nr(r,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Ue||pi(c,a);var d=Se,y=$n;Gr(c.type)&&(Se=c.stateNode,$n=!1),nr(r,a,c),eu(c.stateNode),Se=d,$n=y;break;case 5:Ue||pi(c,a);case 6:if(d=Se,y=$n,Se=null,nr(r,a,c),Se=d,$n=y,Se!==null)if($n)try{(Se.nodeType===9?Se.body:Se.nodeName==="HTML"?Se.ownerDocument.body:Se).removeChild(c.stateNode)}catch(_){ve(c,a,_)}else try{Se.removeChild(c.stateNode)}catch(_){ve(c,a,_)}break;case 18:Se!==null&&($n?(r=Se,JA(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,c.stateNode),cu(r)):JA(Se,c.stateNode));break;case 4:d=Se,y=$n,Se=c.stateNode.containerInfo,$n=!0,nr(r,a,c),Se=d,$n=y;break;case 0:case 11:case 14:case 15:Ue||Or(2,c,a),Ue||Or(4,c,a),nr(r,a,c);break;case 1:Ue||(pi(c,a),d=c.stateNode,typeof d.componentWillUnmount=="function"&&sA(c,a,d)),nr(r,a,c);break;case 21:nr(r,a,c);break;case 22:Ue=(d=Ue)||c.memoizedState!==null,nr(r,a,c),Ue=d;break;default:nr(r,a,c)}}function hA(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{cu(r)}catch(c){ve(a,a.return,c)}}function z1(r){switch(r.tag){case 13:case 19:var a=r.stateNode;return a===null&&(a=r.stateNode=new oA),a;case 22:return r=r.stateNode,a=r._retryCache,a===null&&(a=r._retryCache=new oA),a;default:throw Error(n(435,r.tag))}}function Fm(r,a){var c=z1(r);a.forEach(function(d){var y=Q1.bind(null,r,d);c.has(d)||(c.add(d),d.then(y,y))})}function os(r,a){var c=a.deletions;if(c!==null)for(var d=0;d<c.length;d++){var y=c[d],_=r,R=a,D=R;t:for(;D!==null;){switch(D.tag){case 27:if(Gr(D.type)){Se=D.stateNode,$n=!1;break t}break;case 5:Se=D.stateNode,$n=!1;break t;case 3:case 4:Se=D.stateNode.containerInfo,$n=!0;break t}D=D.return}if(Se===null)throw Error(n(160));uA(_,R,y),Se=null,$n=!1,_=y.alternate,_!==null&&(_.return=null),y.return=null}if(a.subtreeFlags&13878)for(a=a.child;a!==null;)dA(a,r),a=a.sibling}var Hs=null;function dA(r,a){var c=r.alternate,d=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:os(a,r),ls(r),d&4&&(Or(3,r,r.return),qc(3,r),Or(5,r,r.return));break;case 1:os(a,r),ls(r),d&512&&(Ue||c===null||pi(c,c.return)),d&64&&er&&(r=r.updateQueue,r!==null&&(d=r.callbacks,d!==null&&(c=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=c===null?d:c.concat(d))));break;case 26:var y=Hs;if(os(a,r),ls(r),d&512&&(Ue||c===null||pi(c,c.return)),d&4){var _=c!==null?c.memoizedState:null;if(d=r.memoizedState,c===null)if(d===null)if(r.stateNode===null){t:{d=r.type,c=r.memoizedProps,y=y.ownerDocument||y;e:switch(d){case"title":_=y.getElementsByTagName("title")[0],(!_||_[Na]||_[en]||_.namespaceURI==="http://www.w3.org/2000/svg"||_.hasAttribute("itemprop"))&&(_=y.createElement(d),y.head.insertBefore(_,y.querySelector("head > title"))),An(_,d,c),_[en]=r,je(_),d=_;break t;case"link":var R=aw("link","href",y).get(d+(c.href||""));if(R){for(var D=0;D<R.length;D++)if(_=R[D],_.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&_.getAttribute("rel")===(c.rel==null?null:c.rel)&&_.getAttribute("title")===(c.title==null?null:c.title)&&_.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){R.splice(D,1);break e}}_=y.createElement(d),An(_,d,c),y.head.appendChild(_);break;case"meta":if(R=aw("meta","content",y).get(d+(c.content||""))){for(D=0;D<R.length;D++)if(_=R[D],_.getAttribute("content")===(c.content==null?null:""+c.content)&&_.getAttribute("name")===(c.name==null?null:c.name)&&_.getAttribute("property")===(c.property==null?null:c.property)&&_.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&_.getAttribute("charset")===(c.charSet==null?null:c.charSet)){R.splice(D,1);break e}}_=y.createElement(d),An(_,d,c),y.head.appendChild(_);break;default:throw Error(n(468,d))}_[en]=r,je(_),d=_}r.stateNode=d}else ow(y,r.type,r.stateNode);else r.stateNode=rw(y,d,r.memoizedProps);else _!==d?(_===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):_.count--,d===null?ow(y,r.type,r.stateNode):rw(y,d,r.memoizedProps)):d===null&&r.stateNode!==null&&Om(r,r.memoizedProps,c.memoizedProps)}break;case 27:os(a,r),ls(r),d&512&&(Ue||c===null||pi(c,c.return)),c!==null&&d&4&&Om(r,r.memoizedProps,c.memoizedProps);break;case 5:if(os(a,r),ls(r),d&512&&(Ue||c===null||pi(c,c.return)),r.flags&32){y=r.stateNode;try{As(y,"")}catch(et){ve(r,r.return,et)}}d&4&&r.stateNode!=null&&(y=r.memoizedProps,Om(r,y,c!==null?c.memoizedProps:y)),d&1024&&(Um=!0);break;case 6:if(os(a,r),ls(r),d&4){if(r.stateNode===null)throw Error(n(162));d=r.memoizedProps,c=r.stateNode;try{c.nodeValue=d}catch(et){ve(r,r.return,et)}}break;case 3:if(Md=null,y=Hs,Hs=Nd(a.containerInfo),os(a,r),Hs=y,ls(r),d&4&&c!==null&&c.memoizedState.isDehydrated)try{cu(a.containerInfo)}catch(et){ve(r,r.return,et)}Um&&(Um=!1,fA(r));break;case 4:d=Hs,Hs=Nd(r.stateNode.containerInfo),os(a,r),ls(r),Hs=d;break;case 12:os(a,r),ls(r);break;case 13:os(a,r),ls(r),r.child.flags&8192&&r.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&($m=Ct()),d&4&&(d=r.updateQueue,d!==null&&(r.updateQueue=null,Fm(r,d)));break;case 22:y=r.memoizedState!==null;var H=c!==null&&c.memoizedState!==null,Z=er,rt=Ue;if(er=Z||y,Ue=rt||H,os(a,r),Ue=rt,er=Z,ls(r),d&8192)t:for(a=r.stateNode,a._visibility=y?a._visibility&-2:a._visibility|1,y&&(c===null||H||er||Ue||no(r)),c=null,a=r;;){if(a.tag===5||a.tag===26){if(c===null){H=c=a;try{if(_=H.stateNode,y)R=_.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{D=H.stateNode;var lt=H.memoizedProps.style,tt=lt!=null&&lt.hasOwnProperty("display")?lt.display:null;D.style.display=tt==null||typeof tt=="boolean"?"":(""+tt).trim()}}catch(et){ve(H,H.return,et)}}}else if(a.tag===6){if(c===null){H=a;try{H.stateNode.nodeValue=y?"":H.memoizedProps}catch(et){ve(H,H.return,et)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===r)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break t;for(;a.sibling===null;){if(a.return===null||a.return===r)break t;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}d&4&&(d=r.updateQueue,d!==null&&(c=d.retryQueue,c!==null&&(d.retryQueue=null,Fm(r,c))));break;case 19:os(a,r),ls(r),d&4&&(d=r.updateQueue,d!==null&&(r.updateQueue=null,Fm(r,d)));break;case 30:break;case 21:break;default:os(a,r),ls(r)}}function ls(r){var a=r.flags;if(a&2){try{for(var c,d=r.return;d!==null;){if(rA(d)){c=d;break}d=d.return}if(c==null)throw Error(n(160));switch(c.tag){case 27:var y=c.stateNode,_=jm(r);yd(r,_,y);break;case 5:var R=c.stateNode;c.flags&32&&(As(R,""),c.flags&=-33);var D=jm(r);yd(r,D,R);break;case 3:case 4:var H=c.stateNode.containerInfo,Z=jm(r);Vm(r,Z,H);break;default:throw Error(n(161))}}catch(rt){ve(r,r.return,rt)}r.flags&=-3}a&4096&&(r.flags&=-4097)}function fA(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var a=r;fA(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),r=r.sibling}}function jr(r,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)lA(r,a.alternate,a),a=a.sibling}function no(r){for(r=r.child;r!==null;){var a=r;switch(a.tag){case 0:case 11:case 14:case 15:Or(4,a,a.return),no(a);break;case 1:pi(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&sA(a,a.return,c),no(a);break;case 27:eu(a.stateNode);case 26:case 5:pi(a,a.return),no(a);break;case 22:a.memoizedState===null&&no(a);break;case 30:no(a);break;default:no(a)}r=r.sibling}}function Vr(r,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var d=a.alternate,y=r,_=a,R=_.flags;switch(_.tag){case 0:case 11:case 15:Vr(y,_,c),qc(4,_);break;case 1:if(Vr(y,_,c),d=_,y=d.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(Z){ve(d,d.return,Z)}if(d=_,y=d.updateQueue,y!==null){var D=d.stateNode;try{var H=y.shared.hiddenCallbacks;if(H!==null)for(y.shared.hiddenCallbacks=null,y=0;y<H.length;y++)z_(H[y],D)}catch(Z){ve(d,d.return,Z)}}c&&R&64&&nA(_),$c(_,_.return);break;case 27:aA(_);case 26:case 5:Vr(y,_,c),c&&d===null&&R&4&&iA(_),$c(_,_.return);break;case 12:Vr(y,_,c);break;case 13:Vr(y,_,c),c&&R&4&&hA(y,_);break;case 22:_.memoizedState===null&&Vr(y,_,c),$c(_,_.return);break;case 30:break;default:Vr(y,_,c)}a=a.sibling}}function Bm(r,a){var c=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),r=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(r=a.memoizedState.cachePool.pool),r!==c&&(r!=null&&r.refCount++,c!=null&&kc(c))}function zm(r,a){r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&kc(r))}function mi(r,a,c,d){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)pA(r,a,c,d),a=a.sibling}function pA(r,a,c,d){var y=a.flags;switch(a.tag){case 0:case 11:case 15:mi(r,a,c,d),y&2048&&qc(9,a);break;case 1:mi(r,a,c,d);break;case 3:mi(r,a,c,d),y&2048&&(r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&kc(r)));break;case 12:if(y&2048){mi(r,a,c,d),r=a.stateNode;try{var _=a.memoizedProps,R=_.id,D=_.onPostCommit;typeof D=="function"&&D(R,a.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(H){ve(a,a.return,H)}}else mi(r,a,c,d);break;case 13:mi(r,a,c,d);break;case 23:break;case 22:_=a.stateNode,R=a.alternate,a.memoizedState!==null?_._visibility&2?mi(r,a,c,d):Kc(r,a):_._visibility&2?mi(r,a,c,d):(_._visibility|=2,ll(r,a,c,d,(a.subtreeFlags&10256)!==0)),y&2048&&Bm(R,a);break;case 24:mi(r,a,c,d),y&2048&&zm(a.alternate,a);break;default:mi(r,a,c,d)}}function ll(r,a,c,d,y){for(y=y&&(a.subtreeFlags&10256)!==0,a=a.child;a!==null;){var _=r,R=a,D=c,H=d,Z=R.flags;switch(R.tag){case 0:case 11:case 15:ll(_,R,D,H,y),qc(8,R);break;case 23:break;case 22:var rt=R.stateNode;R.memoizedState!==null?rt._visibility&2?ll(_,R,D,H,y):Kc(_,R):(rt._visibility|=2,ll(_,R,D,H,y)),y&&Z&2048&&Bm(R.alternate,R);break;case 24:ll(_,R,D,H,y),y&&Z&2048&&zm(R.alternate,R);break;default:ll(_,R,D,H,y)}a=a.sibling}}function Kc(r,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=r,d=a,y=d.flags;switch(d.tag){case 22:Kc(c,d),y&2048&&Bm(d.alternate,d);break;case 24:Kc(c,d),y&2048&&zm(d.alternate,d);break;default:Kc(c,d)}a=a.sibling}}var Wc=8192;function cl(r){if(r.subtreeFlags&Wc)for(r=r.child;r!==null;)mA(r),r=r.sibling}function mA(r){switch(r.tag){case 26:cl(r),r.flags&Wc&&r.memoizedState!==null&&CC(Hs,r.memoizedState,r.memoizedProps);break;case 5:cl(r);break;case 3:case 4:var a=Hs;Hs=Nd(r.stateNode.containerInfo),cl(r),Hs=a;break;case 22:r.memoizedState===null&&(a=r.alternate,a!==null&&a.memoizedState!==null?(a=Wc,Wc=16777216,cl(r),Wc=a):cl(r));break;default:cl(r)}}function gA(r){var a=r.alternate;if(a!==null&&(r=a.child,r!==null)){a.child=null;do a=r.sibling,r.sibling=null,r=a;while(r!==null)}}function Yc(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var d=a[c];dn=d,vA(d,r)}gA(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)yA(r),r=r.sibling}function yA(r){switch(r.tag){case 0:case 11:case 15:Yc(r),r.flags&2048&&Or(9,r,r.return);break;case 3:Yc(r);break;case 12:Yc(r);break;case 22:var a=r.stateNode;r.memoizedState!==null&&a._visibility&2&&(r.return===null||r.return.tag!==13)?(a._visibility&=-3,vd(r)):Yc(r);break;default:Yc(r)}}function vd(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var d=a[c];dn=d,vA(d,r)}gA(r)}for(r=r.child;r!==null;){switch(a=r,a.tag){case 0:case 11:case 15:Or(8,a,a.return),vd(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,vd(a));break;default:vd(a)}r=r.sibling}}function vA(r,a){for(;dn!==null;){var c=dn;switch(c.tag){case 0:case 11:case 15:Or(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var d=c.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:kc(c.memoizedState.cache)}if(d=c.child,d!==null)d.return=c,dn=d;else t:for(c=r;dn!==null;){d=dn;var y=d.sibling,_=d.return;if(cA(d),d===c){dn=null;break t}if(y!==null){y.return=_,dn=y;break t}dn=_}}}var H1={getCacheForType:function(r){var a=Cn(rn),c=a.data.get(r);return c===void 0&&(c=r(),a.data.set(r,c)),c}},G1=typeof WeakMap=="function"?WeakMap:Map,ce=0,_e=null,qt=null,te=0,ue=0,cs=null,Ur=!1,ul=!1,Hm=!1,sr=0,Pe=0,Fr=0,so=0,Gm=0,Ns=0,hl=0,Xc=null,Kn=null,qm=!1,$m=0,_d=1/0,bd=null,Br=null,bn=0,zr=null,dl=null,fl=0,Km=0,Wm=null,_A=null,Qc=0,Ym=null;function us(){if((ce&2)!==0&&te!==0)return te&-te;if($.T!==null){var r=tl;return r!==0?r:ng()}return Er()}function bA(){Ns===0&&(Ns=(te&536870912)===0||re?ac():536870912);var r=Is.current;return r!==null&&(r.flags|=32),Ns}function hs(r,a,c){(r===_e&&(ue===2||ue===9)||r.cancelPendingCommit!==null)&&(pl(r,0),Hr(r,te,Ns,!1)),Li(r,c),((ce&2)===0||r!==_e)&&(r===_e&&((ce&2)===0&&(so|=c),Pe===4&&Hr(r,te,Ns,!1)),gi(r))}function AA(r,a,c){if((ce&6)!==0)throw Error(n(327));var d=!c&&(a&124)===0&&(a&r.expiredLanes)===0||Ia(r,a),y=d?K1(r,a):Jm(r,a,!0),_=d;do{if(y===0){ul&&!d&&Hr(r,a,0,!1);break}else{if(c=r.current.alternate,_&&!q1(c)){y=Jm(r,a,!1),_=!1;continue}if(y===2){if(_=a,r.errorRecoveryDisabledLanes&_)var R=0;else R=r.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){a=R;t:{var D=r;y=Xc;var H=D.current.memoizedState.isDehydrated;if(H&&(pl(D,R).flags|=256),R=Jm(D,R,!1),R!==2){if(Hm&&!H){D.errorRecoveryDisabledLanes|=_,so|=_,y=4;break t}_=Kn,Kn=y,_!==null&&(Kn===null?Kn=_:Kn.push.apply(Kn,_))}y=R}if(_=!1,y!==2)continue}}if(y===1){pl(r,0),Hr(r,a,0,!0);break}t:{switch(d=r,_=y,_){case 0:case 1:throw Error(n(345));case 4:if((a&4194048)!==a)break;case 6:Hr(d,a,Ns,!Ur);break t;case 2:Kn=null;break;case 3:case 5:break;default:throw Error(n(329))}if((a&62914560)===a&&(y=$m+300-Ct(),10<y)){if(Hr(d,a,Ns,!Ur),ko(d,0,!0)!==0)break t;d.timeoutHandle=XA(wA.bind(null,d,c,Kn,bd,qm,a,Ns,so,hl,Ur,_,2,-0,0),y);break t}wA(d,c,Kn,bd,qm,a,Ns,so,hl,Ur,_,0,-0,0)}}break}while(!0);gi(r)}function wA(r,a,c,d,y,_,R,D,H,Z,rt,lt,tt,et){if(r.timeoutHandle=-1,lt=a.subtreeFlags,(lt&8192||(lt&16785408)===16785408)&&(iu={stylesheets:null,count:0,unsuspend:xC},mA(a),lt=RC(),lt!==null)){r.cancelPendingCommit=lt(IA.bind(null,r,a,_,c,d,y,R,D,H,rt,1,tt,et)),Hr(r,_,R,!Z);return}IA(r,a,_,c,d,y,R,D,H)}function q1(r){for(var a=r;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var d=0;d<c.length;d++){var y=c[d],_=y.getSnapshot;y=y.value;try{if(!rs(_(),y))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Hr(r,a,c,d){a&=~Gm,a&=~so,r.suspendedLanes|=a,r.pingedLanes&=~a,d&&(r.warmLanes|=a),d=r.expirationTimes;for(var y=a;0<y;){var _=31-xn(y),R=1<<_;d[_]=-1,y&=~R}c!==0&&ei(r,c,a)}function Ad(){return(ce&6)===0?(Jc(0),!1):!0}function Xm(){if(qt!==null){if(ue===0)var r=qt.return;else r=qt,Yi=Qa=null,fm(r),al=null,zc=0,r=qt;for(;r!==null;)eA(r.alternate,r),r=r.return;qt=null}}function pl(r,a){var c=r.timeoutHandle;c!==-1&&(r.timeoutHandle=-1,cC(c)),c=r.cancelPendingCommit,c!==null&&(r.cancelPendingCommit=null,c()),Xm(),_e=r,qt=c=$i(r.current,null),te=a,ue=0,cs=null,Ur=!1,ul=Ia(r,a),Hm=!1,hl=Ns=Gm=so=Fr=Pe=0,Kn=Xc=null,qm=!1,(a&8)!==0&&(a|=a&32);var d=r.entangledLanes;if(d!==0)for(r=r.entanglements,d&=a;0<d;){var y=31-xn(d),_=1<<y;a|=r[y],d&=~_}return sr=a,Hh(),c}function EA(r,a){zt=null,$.H=ld,a===Dc||a===Jh?(a=F_(),ue=3):a===j_?(a=F_(),ue=4):ue=a===Bb?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,cs=a,qt===null&&(Pe=1,fd(r,Ts(a,r.current)))}function SA(){var r=$.H;return $.H=ld,r===null?ld:r}function TA(){var r=$.A;return $.A=H1,r}function Qm(){Pe=4,Ur||(te&4194048)!==te&&Is.current!==null||(ul=!0),(Fr&134217727)===0&&(so&134217727)===0||_e===null||Hr(_e,te,Ns,!1)}function Jm(r,a,c){var d=ce;ce|=2;var y=SA(),_=TA();(_e!==r||te!==a)&&(bd=null,pl(r,a)),a=!1;var R=Pe;t:do try{if(ue!==0&&qt!==null){var D=qt,H=cs;switch(ue){case 8:Xm(),R=6;break t;case 3:case 2:case 9:case 6:Is.current===null&&(a=!0);var Z=ue;if(ue=0,cs=null,ml(r,D,H,Z),c&&ul){R=0;break t}break;default:Z=ue,ue=0,cs=null,ml(r,D,H,Z)}}$1(),R=Pe;break}catch(rt){EA(r,rt)}while(!0);return a&&r.shellSuspendCounter++,Yi=Qa=null,ce=d,$.H=y,$.A=_,qt===null&&(_e=null,te=0,Hh()),R}function $1(){for(;qt!==null;)xA(qt)}function K1(r,a){var c=ce;ce|=2;var d=SA(),y=TA();_e!==r||te!==a?(bd=null,_d=Ct()+500,pl(r,a)):ul=Ia(r,a);t:do try{if(ue!==0&&qt!==null){a=qt;var _=cs;e:switch(ue){case 1:ue=0,cs=null,ml(r,a,_,1);break;case 2:case 9:if(V_(_)){ue=0,cs=null,CA(a);break}a=function(){ue!==2&&ue!==9||_e!==r||(ue=7),gi(r)},_.then(a,a);break t;case 3:ue=7;break t;case 4:ue=5;break t;case 7:V_(_)?(ue=0,cs=null,CA(a)):(ue=0,cs=null,ml(r,a,_,7));break;case 5:var R=null;switch(qt.tag){case 26:R=qt.memoizedState;case 5:case 27:var D=qt;if(!R||lw(R)){ue=0,cs=null;var H=D.sibling;if(H!==null)qt=H;else{var Z=D.return;Z!==null?(qt=Z,wd(Z)):qt=null}break e}}ue=0,cs=null,ml(r,a,_,5);break;case 6:ue=0,cs=null,ml(r,a,_,6);break;case 8:Xm(),Pe=6;break t;default:throw Error(n(462))}}W1();break}catch(rt){EA(r,rt)}while(!0);return Yi=Qa=null,$.H=d,$.A=y,ce=c,qt!==null?0:(_e=null,te=0,Hh(),Pe)}function W1(){for(;qt!==null&&!Ta();)xA(qt)}function xA(r){var a=Zb(r.alternate,r,sr);r.memoizedProps=r.pendingProps,a===null?wd(r):qt=a}function CA(r){var a=r,c=a.alternate;switch(a.tag){case 15:case 0:a=Kb(c,a,a.pendingProps,a.type,void 0,te);break;case 11:a=Kb(c,a,a.pendingProps,a.type.render,a.ref,te);break;case 5:fm(a);default:eA(c,a),a=qt=R_(a,sr),a=Zb(c,a,sr)}r.memoizedProps=r.pendingProps,a===null?wd(r):qt=a}function ml(r,a,c,d){Yi=Qa=null,fm(a),al=null,zc=0;var y=a.return;try{if(j1(r,y,a,c,te)){Pe=1,fd(r,Ts(c,r.current)),qt=null;return}}catch(_){if(y!==null)throw qt=y,_;Pe=1,fd(r,Ts(c,r.current)),qt=null;return}a.flags&32768?(re||d===1?r=!0:ul||(te&536870912)!==0?r=!1:(Ur=r=!0,(d===2||d===9||d===3||d===6)&&(d=Is.current,d!==null&&d.tag===13&&(d.flags|=16384))),RA(a,r)):wd(a)}function wd(r){var a=r;do{if((a.flags&32768)!==0){RA(a,Ur);return}r=a.return;var c=U1(a.alternate,a,sr);if(c!==null){qt=c;return}if(a=a.sibling,a!==null){qt=a;return}qt=a=r}while(a!==null);Pe===0&&(Pe=5)}function RA(r,a){do{var c=F1(r.alternate,r);if(c!==null){c.flags&=32767,qt=c;return}if(c=r.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(r=r.sibling,r!==null)){qt=r;return}qt=r=c}while(r!==null);Pe=6,qt=null}function IA(r,a,c,d,y,_,R,D,H){r.cancelPendingCommit=null;do Ed();while(bn!==0);if((ce&6)!==0)throw Error(n(327));if(a!==null){if(a===r.current)throw Error(n(177));if(_=a.lanes|a.childLanes,_|=zp,lc(r,c,_,R,D,H),r===_e&&(qt=_e=null,te=0),dl=a,zr=r,fl=c,Km=_,Wm=y,_A=d,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,J1(ns,function(){return PA(),null})):(r.callbackNode=null,r.callbackPriority=0),d=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||d){d=$.T,$.T=null,y=Y.p,Y.p=2,R=ce,ce|=4;try{B1(r,a,c)}finally{ce=R,Y.p=y,$.T=d}}bn=1,NA(),kA(),MA()}}function NA(){if(bn===1){bn=0;var r=zr,a=dl,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=$.T,$.T=null;var d=Y.p;Y.p=2;var y=ce;ce|=4;try{dA(a,r);var _=ug,R=v_(r.containerInfo),D=_.focusedElem,H=_.selectionRange;if(R!==D&&D&&D.ownerDocument&&y_(D.ownerDocument.documentElement,D)){if(H!==null&&jp(D)){var Z=H.start,rt=H.end;if(rt===void 0&&(rt=Z),"selectionStart"in D)D.selectionStart=Z,D.selectionEnd=Math.min(rt,D.value.length);else{var lt=D.ownerDocument||document,tt=lt&&lt.defaultView||window;if(tt.getSelection){var et=tt.getSelection(),Lt=D.textContent.length,It=Math.min(H.start,Lt),pe=H.end===void 0?It:Math.min(H.end,Lt);!et.extend&&It>pe&&(R=pe,pe=It,It=R);var X=g_(D,It),K=g_(D,pe);if(X&&K&&(et.rangeCount!==1||et.anchorNode!==X.node||et.anchorOffset!==X.offset||et.focusNode!==K.node||et.focusOffset!==K.offset)){var J=lt.createRange();J.setStart(X.node,X.offset),et.removeAllRanges(),It>pe?(et.addRange(J),et.extend(K.node,K.offset)):(J.setEnd(K.node,K.offset),et.addRange(J))}}}}for(lt=[],et=D;et=et.parentNode;)et.nodeType===1&&lt.push({element:et,left:et.scrollLeft,top:et.scrollTop});for(typeof D.focus=="function"&&D.focus(),D=0;D<lt.length;D++){var ot=lt[D];ot.element.scrollLeft=ot.left,ot.element.scrollTop=ot.top}}Ld=!!cg,ug=cg=null}finally{ce=y,Y.p=d,$.T=c}}r.current=a,bn=2}}function kA(){if(bn===2){bn=0;var r=zr,a=dl,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=$.T,$.T=null;var d=Y.p;Y.p=2;var y=ce;ce|=4;try{lA(r,a.alternate,a)}finally{ce=y,Y.p=d,$.T=c}}bn=3}}function MA(){if(bn===4||bn===3){bn=0,mt();var r=zr,a=dl,c=fl,d=_A;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?bn=5:(bn=0,dl=zr=null,DA(r,r.pendingLanes));var y=r.pendingLanes;if(y===0&&(Br=null),Mo(c),a=a.stateNode,le&&typeof le.onCommitFiberRoot=="function")try{le.onCommitFiberRoot(Me,a,void 0,(a.current.flags&128)===128)}catch{}if(d!==null){a=$.T,y=Y.p,Y.p=2,$.T=null;try{for(var _=r.onRecoverableError,R=0;R<d.length;R++){var D=d[R];_(D.value,{componentStack:D.stack})}}finally{$.T=a,Y.p=y}}(fl&3)!==0&&Ed(),gi(r),y=r.pendingLanes,(c&4194090)!==0&&(y&42)!==0?r===Ym?Qc++:(Qc=0,Ym=r):Qc=0,Jc(0)}}function DA(r,a){(r.pooledCacheLanes&=a)===0&&(a=r.pooledCache,a!=null&&(r.pooledCache=null,kc(a)))}function Ed(r){return NA(),kA(),MA(),PA()}function PA(){if(bn!==5)return!1;var r=zr,a=Km;Km=0;var c=Mo(fl),d=$.T,y=Y.p;try{Y.p=32>c?32:c,$.T=null,c=Wm,Wm=null;var _=zr,R=fl;if(bn=0,dl=zr=null,fl=0,(ce&6)!==0)throw Error(n(331));var D=ce;if(ce|=4,yA(_.current),pA(_,_.current,R,c),ce=D,Jc(0,!1),le&&typeof le.onPostCommitFiberRoot=="function")try{le.onPostCommitFiberRoot(Me,_)}catch{}return!0}finally{Y.p=y,$.T=d,DA(r,a)}}function LA(r,a,c){a=Ts(c,a),a=Cm(r.stateNode,a,2),r=Mr(r,a,2),r!==null&&(Li(r,2),gi(r))}function ve(r,a,c){if(r.tag===3)LA(r,r,c);else for(;a!==null;){if(a.tag===3){LA(a,r,c);break}else if(a.tag===1){var d=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Br===null||!Br.has(d))){r=Ts(c,r),c=Ub(2),d=Mr(a,c,2),d!==null&&(Fb(c,d,a,r),Li(d,2),gi(d));break}}a=a.return}}function Zm(r,a,c){var d=r.pingCache;if(d===null){d=r.pingCache=new G1;var y=new Set;d.set(a,y)}else y=d.get(a),y===void 0&&(y=new Set,d.set(a,y));y.has(c)||(Hm=!0,y.add(c),r=Y1.bind(null,r,a,c),a.then(r,r))}function Y1(r,a,c){var d=r.pingCache;d!==null&&d.delete(a),r.pingedLanes|=r.suspendedLanes&c,r.warmLanes&=~c,_e===r&&(te&c)===c&&(Pe===4||Pe===3&&(te&62914560)===te&&300>Ct()-$m?(ce&2)===0&&pl(r,0):Gm|=c,hl===te&&(hl=0)),gi(r)}function OA(r,a){a===0&&(a=oc()),r=Xo(r,a),r!==null&&(Li(r,a),gi(r))}function X1(r){var a=r.memoizedState,c=0;a!==null&&(c=a.retryLane),OA(r,c)}function Q1(r,a){var c=0;switch(r.tag){case 13:var d=r.stateNode,y=r.memoizedState;y!==null&&(c=y.retryLane);break;case 19:d=r.stateNode;break;case 22:d=r.stateNode._retryCache;break;default:throw Error(n(314))}d!==null&&d.delete(a),OA(r,c)}function J1(r,a){return vs(r,a)}var Sd=null,gl=null,tg=!1,Td=!1,eg=!1,io=0;function gi(r){r!==gl&&r.next===null&&(gl===null?Sd=gl=r:gl=gl.next=r),Td=!0,tg||(tg=!0,tC())}function Jc(r,a){if(!eg&&Td){eg=!0;do for(var c=!1,d=Sd;d!==null;){if(r!==0){var y=d.pendingLanes;if(y===0)var _=0;else{var R=d.suspendedLanes,D=d.pingedLanes;_=(1<<31-xn(42|r)+1)-1,_&=y&~(R&~D),_=_&201326741?_&201326741|1:_?_|2:0}_!==0&&(c=!0,FA(d,_))}else _=te,_=ko(d,d===_e?_:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(_&3)===0||Ia(d,_)||(c=!0,FA(d,_));d=d.next}while(c);eg=!1}}function Z1(){jA()}function jA(){Td=tg=!1;var r=0;io!==0&&(lC()&&(r=io),io=0);for(var a=Ct(),c=null,d=Sd;d!==null;){var y=d.next,_=VA(d,a);_===0?(d.next=null,c===null?Sd=y:c.next=y,y===null&&(gl=c)):(c=d,(r!==0||(_&3)!==0)&&(Td=!0)),d=y}Jc(r)}function VA(r,a){for(var c=r.suspendedLanes,d=r.pingedLanes,y=r.expirationTimes,_=r.pendingLanes&-62914561;0<_;){var R=31-xn(_),D=1<<R,H=y[R];H===-1?((D&c)===0||(D&d)!==0)&&(y[R]=rc(D,a)):H<=a&&(r.expiredLanes|=D),_&=~D}if(a=_e,c=te,c=ko(r,r===a?c:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),d=r.callbackNode,c===0||r===a&&(ue===2||ue===9)||r.cancelPendingCommit!==null)return d!==null&&d!==null&&Vs(d),r.callbackNode=null,r.callbackPriority=0;if((c&3)===0||Ia(r,c)){if(a=c&-c,a===r.callbackPriority)return a;switch(d!==null&&Vs(d),Mo(c)){case 2:case 8:c=_s;break;case 32:c=ns;break;case 268435456:c=No;break;default:c=ns}return d=UA.bind(null,r),c=vs(c,d),r.callbackPriority=a,r.callbackNode=c,a}return d!==null&&d!==null&&Vs(d),r.callbackPriority=2,r.callbackNode=null,2}function UA(r,a){if(bn!==0&&bn!==5)return r.callbackNode=null,r.callbackPriority=0,null;var c=r.callbackNode;if(Ed()&&r.callbackNode!==c)return null;var d=te;return d=ko(r,r===_e?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),d===0?null:(AA(r,d,a),VA(r,Ct()),r.callbackNode!=null&&r.callbackNode===c?UA.bind(null,r):null)}function FA(r,a){if(Ed())return null;AA(r,a,!0)}function tC(){uC(function(){(ce&6)!==0?vs(ke,Z1):jA()})}function ng(){return io===0&&(io=ac()),io}function BA(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Vo(""+r)}function zA(r,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,r.id&&c.setAttribute("form",r.id),a.parentNode.insertBefore(c,a),r=new FormData(r),c.parentNode.removeChild(c),r}function eC(r,a,c,d,y){if(a==="submit"&&c&&c.stateNode===y){var _=BA((y[Ge]||null).action),R=d.submitter;R&&(a=(a=R[Ge]||null)?BA(a.formAction):R.getAttribute("formAction"),a!==null&&(_=a,R=null));var D=new Uo("action","action",null,d,y);r.push({event:D,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(io!==0){var H=R?zA(y,R):new FormData(y);wm(c,{pending:!0,data:H,method:y.method,action:_},null,H)}}else typeof _=="function"&&(D.preventDefault(),H=R?zA(y,R):new FormData(y),wm(c,{pending:!0,data:H,method:y.method,action:_},_,H))},currentTarget:y}]})}}for(var sg=0;sg<Bp.length;sg++){var ig=Bp[sg],nC=ig.toLowerCase(),sC=ig[0].toUpperCase()+ig.slice(1);zs(nC,"on"+sC)}zs(A_,"onAnimationEnd"),zs(w_,"onAnimationIteration"),zs(E_,"onAnimationStart"),zs("dblclick","onDoubleClick"),zs("focusin","onFocus"),zs("focusout","onBlur"),zs(b1,"onTransitionRun"),zs(A1,"onTransitionStart"),zs(w1,"onTransitionCancel"),zs(S_,"onTransitionEnd"),ji("onMouseEnter",["mouseout","mouseover"]),ji("onMouseLeave",["mouseout","mouseover"]),ji("onPointerEnter",["pointerout","pointerover"]),ji("onPointerLeave",["pointerout","pointerover"]),Fs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Fs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Fs("onBeforeInput",["compositionend","keypress","textInput","paste"]),Fs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Fs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Fs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),iC=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Zc));function HA(r,a){a=(a&4)!==0;for(var c=0;c<r.length;c++){var d=r[c],y=d.event;d=d.listeners;t:{var _=void 0;if(a)for(var R=d.length-1;0<=R;R--){var D=d[R],H=D.instance,Z=D.currentTarget;if(D=D.listener,H!==_&&y.isPropagationStopped())break t;_=D,y.currentTarget=Z;try{_(y)}catch(rt){dd(rt)}y.currentTarget=null,_=H}else for(R=0;R<d.length;R++){if(D=d[R],H=D.instance,Z=D.currentTarget,D=D.listener,H!==_&&y.isPropagationStopped())break t;_=D,y.currentTarget=Z;try{_(y)}catch(rt){dd(rt)}y.currentTarget=null,_=H}}}}function $t(r,a){var c=a[uc];c===void 0&&(c=a[uc]=new Set);var d=r+"__bubble";c.has(d)||(GA(a,r,2,!1),c.add(d))}function rg(r,a,c){var d=0;a&&(d|=4),GA(c,r,d,a)}var xd="_reactListening"+Math.random().toString(36).slice(2);function ag(r){if(!r[xd]){r[xd]=!0,hc.forEach(function(c){c!=="selectionchange"&&(iC.has(c)||rg(c,!1,r),rg(c,!0,r))});var a=r.nodeType===9?r:r.ownerDocument;a===null||a[xd]||(a[xd]=!0,rg("selectionchange",!1,a))}}function GA(r,a,c,d){switch(pw(a)){case 2:var y=kC;break;case 8:y=MC;break;default:y=bg}c=y.bind(null,a,c,r),y=void 0,!Es||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(y=!0),d?y!==void 0?r.addEventListener(a,c,{capture:!0,passive:y}):r.addEventListener(a,c,!0):y!==void 0?r.addEventListener(a,c,{passive:y}):r.addEventListener(a,c,!1)}function og(r,a,c,d,y){var _=d;if((a&1)===0&&(a&2)===0&&d!==null)t:for(;;){if(d===null)return;var R=d.tag;if(R===3||R===4){var D=d.stateNode.containerInfo;if(D===y)break;if(R===4)for(R=d.return;R!==null;){var H=R.tag;if((H===3||H===4)&&R.stateNode.containerInfo===y)return;R=R.return}for(;D!==null;){if(R=Oi(D),R===null)return;if(H=R.tag,H===5||H===6||H===26||H===27){d=_=R;continue t}D=D.parentNode}}d=d.return}Rh(function(){var Z=_,rt=ws(c),lt=[];t:{var tt=T_.get(r);if(tt!==void 0){var et=Uo,Lt=r;switch(r){case"keypress":if(oi(c)===0)break t;case"keydown":case"keyup":et=qo;break;case"focusin":Lt="focus",et=zo;break;case"focusout":Lt="blur",et=zo;break;case"beforeblur":case"afterblur":et=zo;break;case"click":if(c.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":et=Ss;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":et=Dp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":et=Oh;break;case A_:case w_:case E_:et=Ho;break;case S_:et=Vh;break;case"scroll":case"scrollend":et=Ih;break;case"wheel":et=$o;break;case"copy":case"cut":case"paste":et=Go;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":et=Ec;break;case"toggle":case"beforetoggle":et=Fh}var It=(a&4)!==0,pe=!It&&(r==="scroll"||r==="scrollend"),X=It?tt!==null?tt+"Capture":null:tt;It=[];for(var K=Z,J;K!==null;){var ot=K;if(J=ot.stateNode,ot=ot.tag,ot!==5&&ot!==26&&ot!==27||J===null||X===null||(ot=ja(K,X),ot!=null&&It.push(tu(K,ot,J))),pe)break;K=K.return}0<It.length&&(tt=new et(tt,Lt,null,c,rt),lt.push({event:tt,listeners:It}))}}if((a&7)===0){t:{if(tt=r==="mouseover"||r==="pointerover",et=r==="mouseout"||r==="pointerout",tt&&c!==Fi&&(Lt=c.relatedTarget||c.fromElement)&&(Oi(Lt)||Lt[bs]))break t;if((et||tt)&&(tt=rt.window===rt?rt:(tt=rt.ownerDocument)?tt.defaultView||tt.parentWindow:window,et?(Lt=c.relatedTarget||c.toElement,et=Z,Lt=Lt?Oi(Lt):null,Lt!==null&&(pe=o(Lt),It=Lt.tag,Lt!==pe||It!==5&&It!==27&&It!==6)&&(Lt=null)):(et=null,Lt=Z),et!==Lt)){if(It=Ss,ot="onMouseLeave",X="onMouseEnter",K="mouse",(r==="pointerout"||r==="pointerover")&&(It=Ec,ot="onPointerLeave",X="onPointerEnter",K="pointer"),pe=et==null?tt:si(et),J=Lt==null?tt:si(Lt),tt=new It(ot,K+"leave",et,c,rt),tt.target=pe,tt.relatedTarget=J,ot=null,Oi(rt)===Z&&(It=new It(X,K+"enter",Lt,c,rt),It.target=J,It.relatedTarget=pe,ot=It),pe=ot,et&&Lt)e:{for(It=et,X=Lt,K=0,J=It;J;J=yl(J))K++;for(J=0,ot=X;ot;ot=yl(ot))J++;for(;0<K-J;)It=yl(It),K--;for(;0<J-K;)X=yl(X),J--;for(;K--;){if(It===X||X!==null&&It===X.alternate)break e;It=yl(It),X=yl(X)}It=null}else It=null;et!==null&&qA(lt,tt,et,It,!1),Lt!==null&&pe!==null&&qA(lt,pe,Lt,It,!0)}}t:{if(tt=Z?si(Z):window,et=tt.nodeName&&tt.nodeName.toLowerCase(),et==="select"||et==="input"&&tt.type==="file")var bt=u_;else if(sn(tt))if(h_)bt=y1;else{bt=m1;var Ht=p1}else et=tt.nodeName,!et||et.toLowerCase()!=="input"||tt.type!=="checkbox"&&tt.type!=="radio"?Z&&gc(Z.elementType)&&(bt=u_):bt=g1;if(bt&&(bt=bt(r,Z))){qi(lt,bt,c,rt);break t}Ht&&Ht(r,tt,Z),r==="focusout"&&Z&&tt.type==="number"&&Z.memoizedProps.value!=null&&Cr(tt,"number",tt.value)}switch(Ht=Z?si(Z):window,r){case"focusin":(sn(Ht)||Ht.contentEditable==="true")&&(Ko=Ht,Vp=Z,xc=null);break;case"focusout":xc=Vp=Ko=null;break;case"mousedown":Up=!0;break;case"contextmenu":case"mouseup":case"dragend":Up=!1,__(lt,c,rt);break;case"selectionchange":if(_1)break;case"keydown":case"keyup":__(lt,c,rt)}var Et;if(ui)t:{switch(r){case"compositionstart":var kt="onCompositionStart";break t;case"compositionend":kt="onCompositionEnd";break t;case"compositionupdate":kt="onCompositionUpdate";break t}kt=void 0}else Jt?nt(r,c)&&(kt="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(kt="onCompositionStart");kt&&(x&&c.locale!=="ko"&&(Jt||kt!=="onCompositionStart"?kt==="onCompositionEnd"&&Jt&&(Et=vc()):(ai=rt,Rr="value"in ai?ai.value:ai.textContent,Jt=!0)),Ht=Cd(Z,kt),0<Ht.length&&(kt=new Ac(kt,r,null,c,rt),lt.push({event:kt,listeners:Ht}),Et?kt.data=Et:(Et=pt(c),Et!==null&&(kt.data=Et)))),(Et=w?nn(r,c):Zt(r,c))&&(kt=Cd(Z,"onBeforeInput"),0<kt.length&&(Ht=new Ac("onBeforeInput","beforeinput",null,c,rt),lt.push({event:Ht,listeners:kt}),Ht.data=Et)),eC(lt,r,Z,c,rt)}HA(lt,a)})}function tu(r,a,c){return{instance:r,listener:a,currentTarget:c}}function Cd(r,a){for(var c=a+"Capture",d=[];r!==null;){var y=r,_=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||_===null||(y=ja(r,c),y!=null&&d.unshift(tu(r,y,_)),y=ja(r,a),y!=null&&d.push(tu(r,y,_))),r.tag===3)return d;r=r.return}return[]}function yl(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function qA(r,a,c,d,y){for(var _=a._reactName,R=[];c!==null&&c!==d;){var D=c,H=D.alternate,Z=D.stateNode;if(D=D.tag,H!==null&&H===d)break;D!==5&&D!==26&&D!==27||Z===null||(H=Z,y?(Z=ja(c,_),Z!=null&&R.unshift(tu(c,Z,H))):y||(Z=ja(c,_),Z!=null&&R.push(tu(c,Z,H)))),c=c.return}R.length!==0&&r.push({event:a,listeners:R})}var rC=/\r\n?/g,aC=/\u0000|\uFFFD/g;function $A(r){return(typeof r=="string"?r:""+r).replace(rC,`
`).replace(aC,"")}function KA(r,a){return a=$A(a),$A(r)===a}function Rd(){}function fe(r,a,c,d,y,_){switch(c){case"children":typeof d=="string"?a==="body"||a==="textarea"&&d===""||As(r,d):(typeof d=="number"||typeof d=="bigint")&&a!=="body"&&As(r,""+d);break;case"className":ii(r,"class",d);break;case"tabIndex":ii(r,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":ii(r,c,d);break;case"style":mc(r,d,_);break;case"data":if(a!=="object"){ii(r,"data",d);break}case"src":case"href":if(d===""&&(a!=="a"||c!=="href")){r.removeAttribute(c);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){r.removeAttribute(c);break}d=Vo(""+d),r.setAttribute(c,d);break;case"action":case"formAction":if(typeof d=="function"){r.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof _=="function"&&(c==="formAction"?(a!=="input"&&fe(r,a,"name",y.name,y,null),fe(r,a,"formEncType",y.formEncType,y,null),fe(r,a,"formMethod",y.formMethod,y,null),fe(r,a,"formTarget",y.formTarget,y,null)):(fe(r,a,"encType",y.encType,y,null),fe(r,a,"method",y.method,y,null),fe(r,a,"target",y.target,y,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){r.removeAttribute(c);break}d=Vo(""+d),r.setAttribute(c,d);break;case"onClick":d!=null&&(r.onclick=Rd);break;case"onScroll":d!=null&&$t("scroll",r);break;case"onScrollEnd":d!=null&&$t("scrollend",r);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(n(61));if(c=d.__html,c!=null){if(y.children!=null)throw Error(n(60));r.innerHTML=c}}break;case"multiple":r.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":r.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){r.removeAttribute("xlink:href");break}c=Vo(""+d),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(c,""+d):r.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(c,""):r.removeAttribute(c);break;case"capture":case"download":d===!0?r.setAttribute(c,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(c,d):r.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?r.setAttribute(c,d):r.removeAttribute(c);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?r.removeAttribute(c):r.setAttribute(c,d);break;case"popover":$t("beforetoggle",r),$t("toggle",r),xr(r,"popover",d);break;case"xlinkActuate":yn(r,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":yn(r,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":yn(r,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":yn(r,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":yn(r,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":yn(r,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":yn(r,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":yn(r,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":yn(r,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":xr(r,"is",d);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=kp.get(c)||c,xr(r,c,d))}}function lg(r,a,c,d,y,_){switch(c){case"style":mc(r,d,_);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(n(61));if(c=d.__html,c!=null){if(y.children!=null)throw Error(n(60));r.innerHTML=c}}break;case"children":typeof d=="string"?As(r,d):(typeof d=="number"||typeof d=="bigint")&&As(r,""+d);break;case"onScroll":d!=null&&$t("scroll",r);break;case"onScrollEnd":d!=null&&$t("scrollend",r);break;case"onClick":d!=null&&(r.onclick=Rd);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Do.hasOwnProperty(c))t:{if(c[0]==="o"&&c[1]==="n"&&(y=c.endsWith("Capture"),a=c.slice(2,y?c.length-7:void 0),_=r[Ge]||null,_=_!=null?_[c]:null,typeof _=="function"&&r.removeEventListener(a,_,y),typeof d=="function")){typeof _!="function"&&_!==null&&(c in r?r[c]=null:r.hasAttribute(c)&&r.removeAttribute(c)),r.addEventListener(a,d,y);break t}c in r?r[c]=d:d===!0?r.setAttribute(c,""):xr(r,c,d)}}}function An(r,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":$t("error",r),$t("load",r);var d=!1,y=!1,_;for(_ in c)if(c.hasOwnProperty(_)){var R=c[_];if(R!=null)switch(_){case"src":d=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:fe(r,a,_,R,c,null)}}y&&fe(r,a,"srcSet",c.srcSet,c,null),d&&fe(r,a,"src",c.src,c,null);return;case"input":$t("invalid",r);var D=_=R=y=null,H=null,Z=null;for(d in c)if(c.hasOwnProperty(d)){var rt=c[d];if(rt!=null)switch(d){case"name":y=rt;break;case"type":R=rt;break;case"checked":H=rt;break;case"defaultChecked":Z=rt;break;case"value":_=rt;break;case"defaultValue":D=rt;break;case"children":case"dangerouslySetInnerHTML":if(rt!=null)throw Error(n(137,a));break;default:fe(r,a,d,rt,c,null)}}Pa(r,_,D,H,Z,R,y,!1),jo(r);return;case"select":$t("invalid",r),d=R=_=null;for(y in c)if(c.hasOwnProperty(y)&&(D=c[y],D!=null))switch(y){case"value":_=D;break;case"defaultValue":R=D;break;case"multiple":d=D;default:fe(r,a,y,D,c,null)}a=_,c=R,r.multiple=!!d,a!=null?Ui(r,!!d,a,!1):c!=null&&Ui(r,!!d,c,!0);return;case"textarea":$t("invalid",r),_=y=d=null;for(R in c)if(c.hasOwnProperty(R)&&(D=c[R],D!=null))switch(R){case"value":d=D;break;case"defaultValue":y=D;break;case"children":_=D;break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(n(91));break;default:fe(r,a,R,D,c,null)}La(r,d,y,_),jo(r);return;case"option":for(H in c)if(c.hasOwnProperty(H)&&(d=c[H],d!=null))switch(H){case"selected":r.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:fe(r,a,H,d,c,null)}return;case"dialog":$t("beforetoggle",r),$t("toggle",r),$t("cancel",r),$t("close",r);break;case"iframe":case"object":$t("load",r);break;case"video":case"audio":for(d=0;d<Zc.length;d++)$t(Zc[d],r);break;case"image":$t("error",r),$t("load",r);break;case"details":$t("toggle",r);break;case"embed":case"source":case"link":$t("error",r),$t("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Z in c)if(c.hasOwnProperty(Z)&&(d=c[Z],d!=null))switch(Z){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:fe(r,a,Z,d,c,null)}return;default:if(gc(a)){for(rt in c)c.hasOwnProperty(rt)&&(d=c[rt],d!==void 0&&lg(r,a,rt,d,c,void 0));return}}for(D in c)c.hasOwnProperty(D)&&(d=c[D],d!=null&&fe(r,a,D,d,c,null))}function oC(r,a,c,d){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,_=null,R=null,D=null,H=null,Z=null,rt=null;for(et in c){var lt=c[et];if(c.hasOwnProperty(et)&&lt!=null)switch(et){case"checked":break;case"value":break;case"defaultValue":H=lt;default:d.hasOwnProperty(et)||fe(r,a,et,null,d,lt)}}for(var tt in d){var et=d[tt];if(lt=c[tt],d.hasOwnProperty(tt)&&(et!=null||lt!=null))switch(tt){case"type":_=et;break;case"name":y=et;break;case"checked":Z=et;break;case"defaultChecked":rt=et;break;case"value":R=et;break;case"defaultValue":D=et;break;case"children":case"dangerouslySetInnerHTML":if(et!=null)throw Error(n(137,a));break;default:et!==lt&&fe(r,a,tt,et,d,lt)}}is(r,R,D,H,Z,rt,_,y);return;case"select":et=R=D=tt=null;for(_ in c)if(H=c[_],c.hasOwnProperty(_)&&H!=null)switch(_){case"value":break;case"multiple":et=H;default:d.hasOwnProperty(_)||fe(r,a,_,null,d,H)}for(y in d)if(_=d[y],H=c[y],d.hasOwnProperty(y)&&(_!=null||H!=null))switch(y){case"value":tt=_;break;case"defaultValue":D=_;break;case"multiple":R=_;default:_!==H&&fe(r,a,y,_,d,H)}a=D,c=R,d=et,tt!=null?Ui(r,!!c,tt,!1):!!d!=!!c&&(a!=null?Ui(r,!!c,a,!0):Ui(r,!!c,c?[]:"",!1));return;case"textarea":et=tt=null;for(D in c)if(y=c[D],c.hasOwnProperty(D)&&y!=null&&!d.hasOwnProperty(D))switch(D){case"value":break;case"children":break;default:fe(r,a,D,null,d,y)}for(R in d)if(y=d[R],_=c[R],d.hasOwnProperty(R)&&(y!=null||_!=null))switch(R){case"value":tt=y;break;case"defaultValue":et=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(n(91));break;default:y!==_&&fe(r,a,R,y,d,_)}he(r,tt,et);return;case"option":for(var Lt in c)if(tt=c[Lt],c.hasOwnProperty(Lt)&&tt!=null&&!d.hasOwnProperty(Lt))switch(Lt){case"selected":r.selected=!1;break;default:fe(r,a,Lt,null,d,tt)}for(H in d)if(tt=d[H],et=c[H],d.hasOwnProperty(H)&&tt!==et&&(tt!=null||et!=null))switch(H){case"selected":r.selected=tt&&typeof tt!="function"&&typeof tt!="symbol";break;default:fe(r,a,H,tt,d,et)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var It in c)tt=c[It],c.hasOwnProperty(It)&&tt!=null&&!d.hasOwnProperty(It)&&fe(r,a,It,null,d,tt);for(Z in d)if(tt=d[Z],et=c[Z],d.hasOwnProperty(Z)&&tt!==et&&(tt!=null||et!=null))switch(Z){case"children":case"dangerouslySetInnerHTML":if(tt!=null)throw Error(n(137,a));break;default:fe(r,a,Z,tt,d,et)}return;default:if(gc(a)){for(var pe in c)tt=c[pe],c.hasOwnProperty(pe)&&tt!==void 0&&!d.hasOwnProperty(pe)&&lg(r,a,pe,void 0,d,tt);for(rt in d)tt=d[rt],et=c[rt],!d.hasOwnProperty(rt)||tt===et||tt===void 0&&et===void 0||lg(r,a,rt,tt,d,et);return}}for(var X in c)tt=c[X],c.hasOwnProperty(X)&&tt!=null&&!d.hasOwnProperty(X)&&fe(r,a,X,null,d,tt);for(lt in d)tt=d[lt],et=c[lt],!d.hasOwnProperty(lt)||tt===et||tt==null&&et==null||fe(r,a,lt,tt,d,et)}var cg=null,ug=null;function Id(r){return r.nodeType===9?r:r.ownerDocument}function WA(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function YA(r,a){if(r===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&a==="foreignObject"?0:r}function hg(r,a){return r==="textarea"||r==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var dg=null;function lC(){var r=window.event;return r&&r.type==="popstate"?r===dg?!1:(dg=r,!0):(dg=null,!1)}var XA=typeof setTimeout=="function"?setTimeout:void 0,cC=typeof clearTimeout=="function"?clearTimeout:void 0,QA=typeof Promise=="function"?Promise:void 0,uC=typeof queueMicrotask=="function"?queueMicrotask:typeof QA<"u"?function(r){return QA.resolve(null).then(r).catch(hC)}:XA;function hC(r){setTimeout(function(){throw r})}function Gr(r){return r==="head"}function JA(r,a){var c=a,d=0,y=0;do{var _=c.nextSibling;if(r.removeChild(c),_&&_.nodeType===8)if(c=_.data,c==="/$"){if(0<d&&8>d){c=d;var R=r.ownerDocument;if(c&1&&eu(R.documentElement),c&2&&eu(R.body),c&4)for(c=R.head,eu(c),R=c.firstChild;R;){var D=R.nextSibling,H=R.nodeName;R[Na]||H==="SCRIPT"||H==="STYLE"||H==="LINK"&&R.rel.toLowerCase()==="stylesheet"||c.removeChild(R),R=D}}if(y===0){r.removeChild(_),cu(a);return}y--}else c==="$"||c==="$?"||c==="$!"?y++:d=c.charCodeAt(0)-48;else d=0;c=_}while(c);cu(a)}function fg(r){var a=r.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":fg(c),Tr(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}r.removeChild(c)}}function dC(r,a,c,d){for(;r.nodeType===1;){var y=c;if(r.nodeName.toLowerCase()!==a.toLowerCase()){if(!d&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(d){if(!r[Na])switch(a){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(_=r.getAttribute("rel"),_==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(_!==y.rel||r.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||r.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||r.getAttribute("title")!==(y.title==null?null:y.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(_=r.getAttribute("src"),(_!==(y.src==null?null:y.src)||r.getAttribute("type")!==(y.type==null?null:y.type)||r.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&_&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(a==="input"&&r.type==="hidden"){var _=y.name==null?null:""+y.name;if(y.type==="hidden"&&r.getAttribute("name")===_)return r}else return r;if(r=Gs(r.nextSibling),r===null)break}return null}function fC(r,a,c){if(a==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!c||(r=Gs(r.nextSibling),r===null))return null;return r}function pg(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState==="complete"}function pC(r,a){var c=r.ownerDocument;if(r.data!=="$?"||c.readyState==="complete")a();else{var d=function(){a(),c.removeEventListener("DOMContentLoaded",d)};c.addEventListener("DOMContentLoaded",d),r._reactRetry=d}}function Gs(r){for(;r!=null;r=r.nextSibling){var a=r.nodeType;if(a===1||a===3)break;if(a===8){if(a=r.data,a==="$"||a==="$!"||a==="$?"||a==="F!"||a==="F")break;if(a==="/$")return null}}return r}var mg=null;function ZA(r){r=r.previousSibling;for(var a=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"){if(a===0)return r;a--}else c==="/$"&&a++}r=r.previousSibling}return null}function tw(r,a,c){switch(a=Id(c),r){case"html":if(r=a.documentElement,!r)throw Error(n(452));return r;case"head":if(r=a.head,!r)throw Error(n(453));return r;case"body":if(r=a.body,!r)throw Error(n(454));return r;default:throw Error(n(451))}}function eu(r){for(var a=r.attributes;a.length;)r.removeAttributeNode(a[0]);Tr(r)}var ks=new Map,ew=new Set;function Nd(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var ir=Y.d;Y.d={f:mC,r:gC,D:yC,C:vC,L:_C,m:bC,X:wC,S:AC,M:EC};function mC(){var r=ir.f(),a=Ad();return r||a}function gC(r){var a=ni(r);a!==null&&a.tag===5&&a.type==="form"?Ab(a):ir.r(r)}var vl=typeof document>"u"?null:document;function nw(r,a,c){var d=vl;if(d&&typeof a=="string"&&a){var y=qe(a);y='link[rel="'+r+'"][href="'+y+'"]',typeof c=="string"&&(y+='[crossorigin="'+c+'"]'),ew.has(y)||(ew.add(y),r={rel:r,crossOrigin:c,href:a},d.querySelector(y)===null&&(a=d.createElement("link"),An(a,"link",r),je(a),d.head.appendChild(a)))}}function yC(r){ir.D(r),nw("dns-prefetch",r,null)}function vC(r,a){ir.C(r,a),nw("preconnect",r,a)}function _C(r,a,c){ir.L(r,a,c);var d=vl;if(d&&r&&a){var y='link[rel="preload"][as="'+qe(a)+'"]';a==="image"&&c&&c.imageSrcSet?(y+='[imagesrcset="'+qe(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(y+='[imagesizes="'+qe(c.imageSizes)+'"]')):y+='[href="'+qe(r)+'"]';var _=y;switch(a){case"style":_=_l(r);break;case"script":_=bl(r)}ks.has(_)||(r=m({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:r,as:a},c),ks.set(_,r),d.querySelector(y)!==null||a==="style"&&d.querySelector(nu(_))||a==="script"&&d.querySelector(su(_))||(a=d.createElement("link"),An(a,"link",r),je(a),d.head.appendChild(a)))}}function bC(r,a){ir.m(r,a);var c=vl;if(c&&r){var d=a&&typeof a.as=="string"?a.as:"script",y='link[rel="modulepreload"][as="'+qe(d)+'"][href="'+qe(r)+'"]',_=y;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":_=bl(r)}if(!ks.has(_)&&(r=m({rel:"modulepreload",href:r},a),ks.set(_,r),c.querySelector(y)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(su(_)))return}d=c.createElement("link"),An(d,"link",r),je(d),c.head.appendChild(d)}}}function AC(r,a,c){ir.S(r,a,c);var d=vl;if(d&&r){var y=Ln(d).hoistableStyles,_=_l(r);a=a||"default";var R=y.get(_);if(!R){var D={loading:0,preload:null};if(R=d.querySelector(nu(_)))D.loading=5;else{r=m({rel:"stylesheet",href:r,"data-precedence":a},c),(c=ks.get(_))&&gg(r,c);var H=R=d.createElement("link");je(H),An(H,"link",r),H._p=new Promise(function(Z,rt){H.onload=Z,H.onerror=rt}),H.addEventListener("load",function(){D.loading|=1}),H.addEventListener("error",function(){D.loading|=2}),D.loading|=4,kd(R,a,d)}R={type:"stylesheet",instance:R,count:1,state:D},y.set(_,R)}}}function wC(r,a){ir.X(r,a);var c=vl;if(c&&r){var d=Ln(c).hoistableScripts,y=bl(r),_=d.get(y);_||(_=c.querySelector(su(y)),_||(r=m({src:r,async:!0},a),(a=ks.get(y))&&yg(r,a),_=c.createElement("script"),je(_),An(_,"link",r),c.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},d.set(y,_))}}function EC(r,a){ir.M(r,a);var c=vl;if(c&&r){var d=Ln(c).hoistableScripts,y=bl(r),_=d.get(y);_||(_=c.querySelector(su(y)),_||(r=m({src:r,async:!0,type:"module"},a),(a=ks.get(y))&&yg(r,a),_=c.createElement("script"),je(_),An(_,"link",r),c.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},d.set(y,_))}}function sw(r,a,c,d){var y=(y=wt.current)?Nd(y):null;if(!y)throw Error(n(446));switch(r){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=_l(c.href),c=Ln(y).hoistableStyles,d=c.get(a),d||(d={type:"style",instance:null,count:0,state:null},c.set(a,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){r=_l(c.href);var _=Ln(y).hoistableStyles,R=_.get(r);if(R||(y=y.ownerDocument||y,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},_.set(r,R),(_=y.querySelector(nu(r)))&&!_._p&&(R.instance=_,R.state.loading=5),ks.has(r)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},ks.set(r,c),_||SC(y,r,c,R.state))),a&&d===null)throw Error(n(528,""));return R}if(a&&d!==null)throw Error(n(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=bl(c),c=Ln(y).hoistableScripts,d=c.get(a),d||(d={type:"script",instance:null,count:0,state:null},c.set(a,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,r))}}function _l(r){return'href="'+qe(r)+'"'}function nu(r){return'link[rel="stylesheet"]['+r+"]"}function iw(r){return m({},r,{"data-precedence":r.precedence,precedence:null})}function SC(r,a,c,d){r.querySelector('link[rel="preload"][as="style"]['+a+"]")?d.loading=1:(a=r.createElement("link"),d.preload=a,a.addEventListener("load",function(){return d.loading|=1}),a.addEventListener("error",function(){return d.loading|=2}),An(a,"link",c),je(a),r.head.appendChild(a))}function bl(r){return'[src="'+qe(r)+'"]'}function su(r){return"script[async]"+r}function rw(r,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var d=r.querySelector('style[data-href~="'+qe(c.href)+'"]');if(d)return a.instance=d,je(d),d;var y=m({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return d=(r.ownerDocument||r).createElement("style"),je(d),An(d,"style",y),kd(d,c.precedence,r),a.instance=d;case"stylesheet":y=_l(c.href);var _=r.querySelector(nu(y));if(_)return a.state.loading|=4,a.instance=_,je(_),_;d=iw(c),(y=ks.get(y))&&gg(d,y),_=(r.ownerDocument||r).createElement("link"),je(_);var R=_;return R._p=new Promise(function(D,H){R.onload=D,R.onerror=H}),An(_,"link",d),a.state.loading|=4,kd(_,c.precedence,r),a.instance=_;case"script":return _=bl(c.src),(y=r.querySelector(su(_)))?(a.instance=y,je(y),y):(d=c,(y=ks.get(_))&&(d=m({},c),yg(d,y)),r=r.ownerDocument||r,y=r.createElement("script"),je(y),An(y,"link",d),r.head.appendChild(y),a.instance=y);case"void":return null;default:throw Error(n(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(d=a.instance,a.state.loading|=4,kd(d,c.precedence,r));return a.instance}function kd(r,a,c){for(var d=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=d.length?d[d.length-1]:null,_=y,R=0;R<d.length;R++){var D=d[R];if(D.dataset.precedence===a)_=D;else if(_!==y)break}_?_.parentNode.insertBefore(r,_.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(r,a.firstChild))}function gg(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.title==null&&(r.title=a.title)}function yg(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.integrity==null&&(r.integrity=a.integrity)}var Md=null;function aw(r,a,c){if(Md===null){var d=new Map,y=Md=new Map;y.set(c,d)}else y=Md,d=y.get(c),d||(d=new Map,y.set(c,d));if(d.has(r))return d;for(d.set(r,null),c=c.getElementsByTagName(r),y=0;y<c.length;y++){var _=c[y];if(!(_[Na]||_[en]||r==="link"&&_.getAttribute("rel")==="stylesheet")&&_.namespaceURI!=="http://www.w3.org/2000/svg"){var R=_.getAttribute(a)||"";R=r+R;var D=d.get(R);D?D.push(_):d.set(R,[_])}}return d}function ow(r,a,c){r=r.ownerDocument||r,r.head.insertBefore(c,a==="title"?r.querySelector("head > title"):null)}function TC(r,a,c){if(c===1||a.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return r=a.disabled,typeof a.precedence=="string"&&r==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function lw(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}var iu=null;function xC(){}function CC(r,a,c){if(iu===null)throw Error(n(475));var d=iu;if(a.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var y=_l(c.href),_=r.querySelector(nu(y));if(_){r=_._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(d.count++,d=Dd.bind(d),r.then(d,d)),a.state.loading|=4,a.instance=_,je(_);return}_=r.ownerDocument||r,c=iw(c),(y=ks.get(y))&&gg(c,y),_=_.createElement("link"),je(_);var R=_;R._p=new Promise(function(D,H){R.onload=D,R.onerror=H}),An(_,"link",c),a.instance=_}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(a,r),(r=a.state.preload)&&(a.state.loading&3)===0&&(d.count++,a=Dd.bind(d),r.addEventListener("load",a),r.addEventListener("error",a))}}function RC(){if(iu===null)throw Error(n(475));var r=iu;return r.stylesheets&&r.count===0&&vg(r,r.stylesheets),0<r.count?function(a){var c=setTimeout(function(){if(r.stylesheets&&vg(r,r.stylesheets),r.unsuspend){var d=r.unsuspend;r.unsuspend=null,d()}},6e4);return r.unsuspend=a,function(){r.unsuspend=null,clearTimeout(c)}}:null}function Dd(){if(this.count--,this.count===0){if(this.stylesheets)vg(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Pd=null;function vg(r,a){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Pd=new Map,a.forEach(IC,r),Pd=null,Dd.call(r))}function IC(r,a){if(!(a.state.loading&4)){var c=Pd.get(r);if(c)var d=c.get(null);else{c=new Map,Pd.set(r,c);for(var y=r.querySelectorAll("link[data-precedence],style[data-precedence]"),_=0;_<y.length;_++){var R=y[_];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(c.set(R.dataset.precedence,R),d=R)}d&&c.set(null,d)}y=a.instance,R=y.getAttribute("data-precedence"),_=c.get(R)||d,_===d&&c.set(null,y),c.set(R,y),this.count++,d=Dd.bind(this),y.addEventListener("load",d),y.addEventListener("error",d),_?_.parentNode.insertBefore(y,_.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(y,r.firstChild)),a.state.loading|=4}}var ru={$$typeof:k,Provider:null,Consumer:null,_currentValue:ut,_currentValue2:ut,_threadCount:0};function NC(r,a,c,d,y,_,R,D){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Pi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pi(0),this.hiddenUpdates=Pi(null),this.identifierPrefix=d,this.onUncaughtError=y,this.onCaughtError=_,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=D,this.incompleteTransitions=new Map}function cw(r,a,c,d,y,_,R,D,H,Z,rt,lt){return r=new NC(r,a,c,R,D,H,Z,lt),a=1,_===!0&&(a|=24),_=as(3,null,null,a),r.current=_,_.stateNode=r,a=Zp(),a.refCount++,r.pooledCache=a,a.refCount++,_.memoizedState={element:d,isDehydrated:c,cache:a},sm(_),r}function uw(r){return r?(r=Qo,r):Qo}function hw(r,a,c,d,y,_){y=uw(y),d.context===null?d.context=y:d.pendingContext=y,d=kr(a),d.payload={element:c},_=_===void 0?null:_,_!==null&&(d.callback=_),c=Mr(r,d,a),c!==null&&(hs(c,r,a),Lc(c,r,a))}function dw(r,a){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<a?c:a}}function _g(r,a){dw(r,a),(r=r.alternate)&&dw(r,a)}function fw(r){if(r.tag===13){var a=Xo(r,67108864);a!==null&&hs(a,r,67108864),_g(r,67108864)}}var Ld=!0;function kC(r,a,c,d){var y=$.T;$.T=null;var _=Y.p;try{Y.p=2,bg(r,a,c,d)}finally{Y.p=_,$.T=y}}function MC(r,a,c,d){var y=$.T;$.T=null;var _=Y.p;try{Y.p=8,bg(r,a,c,d)}finally{Y.p=_,$.T=y}}function bg(r,a,c,d){if(Ld){var y=Ag(d);if(y===null)og(r,a,d,Od,c),mw(r,d);else if(PC(y,r,a,c,d))d.stopPropagation();else if(mw(r,d),a&4&&-1<DC.indexOf(r)){for(;y!==null;){var _=ni(y);if(_!==null)switch(_.tag){case 3:if(_=_.stateNode,_.current.memoizedState.isDehydrated){var R=Us(_.pendingLanes);if(R!==0){var D=_;for(D.pendingLanes|=2,D.entangledLanes|=2;R;){var H=1<<31-xn(R);D.entanglements[1]|=H,R&=~H}gi(_),(ce&6)===0&&(_d=Ct()+500,Jc(0))}}break;case 13:D=Xo(_,2),D!==null&&hs(D,_,2),Ad(),_g(_,2)}if(_=Ag(d),_===null&&og(r,a,d,Od,c),_===y)break;y=_}y!==null&&d.stopPropagation()}else og(r,a,d,null,c)}}function Ag(r){return r=ws(r),wg(r)}var Od=null;function wg(r){if(Od=null,r=Oi(r),r!==null){var a=o(r);if(a===null)r=null;else{var c=a.tag;if(c===13){if(r=l(a),r!==null)return r;r=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;r=null}else a!==r&&(r=null)}}return Od=r,null}function pw(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ie()){case ke:return 2;case _s:return 8;case ns:case xp:return 32;case No:return 268435456;default:return 32}default:return 32}}var Eg=!1,qr=null,$r=null,Kr=null,au=new Map,ou=new Map,Wr=[],DC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function mw(r,a){switch(r){case"focusin":case"focusout":qr=null;break;case"dragenter":case"dragleave":$r=null;break;case"mouseover":case"mouseout":Kr=null;break;case"pointerover":case"pointerout":au.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":ou.delete(a.pointerId)}}function lu(r,a,c,d,y,_){return r===null||r.nativeEvent!==_?(r={blockedOn:a,domEventName:c,eventSystemFlags:d,nativeEvent:_,targetContainers:[y]},a!==null&&(a=ni(a),a!==null&&fw(a)),r):(r.eventSystemFlags|=d,a=r.targetContainers,y!==null&&a.indexOf(y)===-1&&a.push(y),r)}function PC(r,a,c,d,y){switch(a){case"focusin":return qr=lu(qr,r,a,c,d,y),!0;case"dragenter":return $r=lu($r,r,a,c,d,y),!0;case"mouseover":return Kr=lu(Kr,r,a,c,d,y),!0;case"pointerover":var _=y.pointerId;return au.set(_,lu(au.get(_)||null,r,a,c,d,y)),!0;case"gotpointercapture":return _=y.pointerId,ou.set(_,lu(ou.get(_)||null,r,a,c,d,y)),!0}return!1}function gw(r){var a=Oi(r.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){r.blockedOn=a,Ah(r.priority,function(){if(c.tag===13){var d=us();d=wr(d);var y=Xo(c,d);y!==null&&hs(y,c,d),_g(c,d)}});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function jd(r){if(r.blockedOn!==null)return!1;for(var a=r.targetContainers;0<a.length;){var c=Ag(r.nativeEvent);if(c===null){c=r.nativeEvent;var d=new c.constructor(c.type,c);Fi=d,c.target.dispatchEvent(d),Fi=null}else return a=ni(c),a!==null&&fw(a),r.blockedOn=c,!1;a.shift()}return!0}function yw(r,a,c){jd(r)&&c.delete(a)}function LC(){Eg=!1,qr!==null&&jd(qr)&&(qr=null),$r!==null&&jd($r)&&($r=null),Kr!==null&&jd(Kr)&&(Kr=null),au.forEach(yw),ou.forEach(yw)}function Vd(r,a){r.blockedOn===a&&(r.blockedOn=null,Eg||(Eg=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,LC)))}var Ud=null;function vw(r){Ud!==r&&(Ud=r,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){Ud===r&&(Ud=null);for(var a=0;a<r.length;a+=3){var c=r[a],d=r[a+1],y=r[a+2];if(typeof d!="function"){if(wg(d||c)===null)continue;break}var _=ni(c);_!==null&&(r.splice(a,3),a-=3,wm(_,{pending:!0,data:y,method:c.method,action:d},d,y))}}))}function cu(r){function a(H){return Vd(H,r)}qr!==null&&Vd(qr,r),$r!==null&&Vd($r,r),Kr!==null&&Vd(Kr,r),au.forEach(a),ou.forEach(a);for(var c=0;c<Wr.length;c++){var d=Wr[c];d.blockedOn===r&&(d.blockedOn=null)}for(;0<Wr.length&&(c=Wr[0],c.blockedOn===null);)gw(c),c.blockedOn===null&&Wr.shift();if(c=(r.ownerDocument||r).$$reactFormReplay,c!=null)for(d=0;d<c.length;d+=3){var y=c[d],_=c[d+1],R=y[Ge]||null;if(typeof _=="function")R||vw(c);else if(R){var D=null;if(_&&_.hasAttribute("formAction")){if(y=_,R=_[Ge]||null)D=R.formAction;else if(wg(y)!==null)continue}else D=R.action;typeof D=="function"?c[d+1]=D:(c.splice(d,3),d-=3),vw(c)}}}function Sg(r){this._internalRoot=r}Fd.prototype.render=Sg.prototype.render=function(r){var a=this._internalRoot;if(a===null)throw Error(n(409));var c=a.current,d=us();hw(c,d,r,a,null,null)},Fd.prototype.unmount=Sg.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var a=r.containerInfo;hw(r.current,2,null,r,null,null),Ad(),a[bs]=null}};function Fd(r){this._internalRoot=r}Fd.prototype.unstable_scheduleHydration=function(r){if(r){var a=Er();r={blockedOn:null,target:r,priority:a};for(var c=0;c<Wr.length&&a!==0&&a<Wr[c].priority;c++);Wr.splice(c,0,r),c===0&&gw(r)}};var _w=t.version;if(_w!=="19.1.1")throw Error(n(527,_w,"19.1.1"));Y.findDOMNode=function(r){var a=r._reactInternals;if(a===void 0)throw typeof r.render=="function"?Error(n(188)):(r=Object.keys(r).join(","),Error(n(268,r)));return r=h(a),r=r!==null?f(r):null,r=r===null?null:r.stateNode,r};var OC={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:$,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Bd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Bd.isDisabled&&Bd.supportsFiber)try{Me=Bd.inject(OC),le=Bd}catch{}}return hu.createRoot=function(r,a){if(!s(r))throw Error(n(299));var c=!1,d="",y=Lb,_=Ob,R=jb,D=null;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(d=a.identifierPrefix),a.onUncaughtError!==void 0&&(y=a.onUncaughtError),a.onCaughtError!==void 0&&(_=a.onCaughtError),a.onRecoverableError!==void 0&&(R=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(D=a.unstable_transitionCallbacks)),a=cw(r,1,!1,null,null,c,d,y,_,R,D,null),r[bs]=a.current,ag(r),new Sg(a)},hu.hydrateRoot=function(r,a,c){if(!s(r))throw Error(n(299));var d=!1,y="",_=Lb,R=Ob,D=jb,H=null,Z=null;return c!=null&&(c.unstable_strictMode===!0&&(d=!0),c.identifierPrefix!==void 0&&(y=c.identifierPrefix),c.onUncaughtError!==void 0&&(_=c.onUncaughtError),c.onCaughtError!==void 0&&(R=c.onCaughtError),c.onRecoverableError!==void 0&&(D=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(H=c.unstable_transitionCallbacks),c.formState!==void 0&&(Z=c.formState)),a=cw(r,1,!0,a,c??null,d,y,_,R,D,H,Z),a.context=uw(null),c=a.current,d=us(),d=wr(d),y=kr(d),y.callback=null,Mr(c,y,d),c=d,a.current.lanes=c,Li(a,c),gi(a),r[bs]=a.current,ag(r),new Fd(a)},hu.version="19.1.1",hu}var kw;function WC(){if(kw)return Rg.exports;kw=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(t){console.error(t)}}return i(),Rg.exports=KC(),Rg.exports}var YC=WC();/**
 * react-router v7.8.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Mw="popstate";function XC(i={}){function t(s,o){let{pathname:l="/",search:u="",hash:h=""}=Eo(s.location.hash.substring(1));return!l.startsWith("/")&&!l.startsWith(".")&&(l="/"+l),iy("",{pathname:l,search:u,hash:h},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function e(s,o){let l=s.document.querySelector("base"),u="";if(l&&l.getAttribute("href")){let h=s.location.href,f=h.indexOf("#");u=f===-1?h:h.slice(0,f)}return u+"#"+(typeof o=="string"?o:Lu(o))}function n(s,o){Ls(s.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(o)})`)}return JC(t,e,n,i)}function Ce(i,t){if(i===!1||i===null||typeof i>"u")throw new Error(t)}function Ls(i,t){if(!i){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function QC(){return Math.random().toString(36).substring(2,10)}function Dw(i,t){return{usr:i.state,key:i.key,idx:t}}function iy(i,t,e=null,n){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof t=="string"?Eo(t):t,state:e,key:t&&t.key||n||QC()}}function Lu({pathname:i="/",search:t="",hash:e=""}){return t&&t!=="?"&&(i+=t.charAt(0)==="?"?t:"?"+t),e&&e!=="#"&&(i+=e.charAt(0)==="#"?e:"#"+e),i}function Eo(i){let t={};if(i){let e=i.indexOf("#");e>=0&&(t.hash=i.substring(e),i=i.substring(0,e));let n=i.indexOf("?");n>=0&&(t.search=i.substring(n),i=i.substring(0,n)),i&&(t.pathname=i)}return t}function JC(i,t,e,n={}){let{window:s=document.defaultView,v5Compat:o=!1}=n,l=s.history,u="POP",h=null,f=m();f==null&&(f=0,l.replaceState({...l.state,idx:f},""));function m(){return(l.state||{idx:null}).idx}function v(){u="POP";let T=m(),C=T==null?null:T-f;f=T,h&&h({action:u,location:E.location,delta:C})}function b(T,C){u="PUSH";let L=iy(E.location,T,C);e&&e(L,T),f=m()+1;let k=Dw(L,f),V=E.createHref(L);try{l.pushState(k,"",V)}catch(P){if(P instanceof DOMException&&P.name==="DataCloneError")throw P;s.location.assign(V)}o&&h&&h({action:u,location:E.location,delta:1})}function A(T,C){u="REPLACE";let L=iy(E.location,T,C);e&&e(L,T),f=m();let k=Dw(L,f),V=E.createHref(L);l.replaceState(k,"",V),o&&h&&h({action:u,location:E.location,delta:0})}function S(T){return ZC(T)}let E={get action(){return u},get location(){return i(s,l)},listen(T){if(h)throw new Error("A history only accepts one active listener");return s.addEventListener(Mw,v),h=T,()=>{s.removeEventListener(Mw,v),h=null}},createHref(T){return t(s,T)},createURL:S,encodeLocation(T){let C=S(T);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:b,replace:A,go(T){return l.go(T)}};return E}function ZC(i,t=!1){let e="http://localhost";typeof window<"u"&&(e=window.location.origin!=="null"?window.location.origin:window.location.href),Ce(e,"No window.location.(origin|href) available to create URL");let n=typeof i=="string"?i:Lu(i);return n=n.replace(/ $/,"%20"),!t&&n.startsWith("//")&&(n=e+n),new URL(n,e)}function F0(i,t,e="/"){return tR(i,t,e,!1)}function tR(i,t,e,n){let s=typeof t=="string"?Eo(t):t,o=mr(s.pathname||"/",e);if(o==null)return null;let l=B0(i);eR(l);let u=null;for(let h=0;u==null&&h<l.length;++h){let f=dR(o);u=uR(l[h],f,n)}return u}function B0(i,t=[],e=[],n="",s=!1){let o=(l,u,h=s,f)=>{let m={relativePath:f===void 0?l.path||"":f,caseSensitive:l.caseSensitive===!0,childrenIndex:u,route:l};if(m.relativePath.startsWith("/")){if(!m.relativePath.startsWith(n)&&h)return;Ce(m.relativePath.startsWith(n),`Absolute route path "${m.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),m.relativePath=m.relativePath.slice(n.length)}let v=hr([n,m.relativePath]),b=e.concat(m);l.children&&l.children.length>0&&(Ce(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${v}".`),B0(l.children,t,b,v,h)),!(l.path==null&&!l.index)&&t.push({path:v,score:lR(v,l.index),routesMeta:b})};return i.forEach((l,u)=>{if(l.path===""||!l.path?.includes("?"))o(l,u);else for(let h of z0(l.path))o(l,u,!0,h)}),t}function z0(i){let t=i.split("/");if(t.length===0)return[];let[e,...n]=t,s=e.endsWith("?"),o=e.replace(/\?$/,"");if(n.length===0)return s?[o,""]:[o];let l=z0(n.join("/")),u=[];return u.push(...l.map(h=>h===""?o:[o,h].join("/"))),s&&u.push(...l),u.map(h=>i.startsWith("/")&&h===""?"/":h)}function eR(i){i.sort((t,e)=>t.score!==e.score?e.score-t.score:cR(t.routesMeta.map(n=>n.childrenIndex),e.routesMeta.map(n=>n.childrenIndex)))}var nR=/^:[\w-]+$/,sR=3,iR=2,rR=1,aR=10,oR=-2,Pw=i=>i==="*";function lR(i,t){let e=i.split("/"),n=e.length;return e.some(Pw)&&(n+=oR),t&&(n+=iR),e.filter(s=>!Pw(s)).reduce((s,o)=>s+(nR.test(o)?sR:o===""?rR:aR),n)}function cR(i,t){return i.length===t.length&&i.slice(0,-1).every((n,s)=>n===t[s])?i[i.length-1]-t[t.length-1]:0}function uR(i,t,e=!1){let{routesMeta:n}=i,s={},o="/",l=[];for(let u=0;u<n.length;++u){let h=n[u],f=u===n.length-1,m=o==="/"?t:t.slice(o.length)||"/",v=bf({path:h.relativePath,caseSensitive:h.caseSensitive,end:f},m),b=h.route;if(!v&&f&&e&&!n[n.length-1].route.index&&(v=bf({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},m)),!v)return null;Object.assign(s,v.params),l.push({params:s,pathname:hr([o,v.pathname]),pathnameBase:gR(hr([o,v.pathnameBase])),route:b}),v.pathnameBase!=="/"&&(o=hr([o,v.pathnameBase]))}return l}function bf(i,t){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[e,n]=hR(i.path,i.caseSensitive,i.end),s=t.match(e);if(!s)return null;let o=s[0],l=o.replace(/(.)\/+$/,"$1"),u=s.slice(1);return{params:n.reduce((f,{paramName:m,isOptional:v},b)=>{if(m==="*"){let S=u[b]||"";l=o.slice(0,o.length-S.length).replace(/(.)\/+$/,"$1")}const A=u[b];return v&&!A?f[m]=void 0:f[m]=(A||"").replace(/%2F/g,"/"),f},{}),pathname:o,pathnameBase:l,pattern:i}}function hR(i,t=!1,e=!0){Ls(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let n=[],s="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,u,h)=>(n.push({paramName:u,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return i.endsWith("*")?(n.push({paramName:"*"}),s+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):e?s+="\\/*$":i!==""&&i!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),n]}function dR(i){try{return i.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Ls(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),i}}function mr(i,t){if(t==="/")return i;if(!i.toLowerCase().startsWith(t.toLowerCase()))return null;let e=t.endsWith("/")?t.length-1:t.length,n=i.charAt(e);return n&&n!=="/"?null:i.slice(e)||"/"}function fR(i,t="/"){let{pathname:e,search:n="",hash:s=""}=typeof i=="string"?Eo(i):i;return{pathname:e?e.startsWith("/")?e:pR(e,t):t,search:yR(n),hash:vR(s)}}function pR(i,t){let e=t.replace(/\/+$/,"").split("/");return i.split("/").forEach(s=>{s===".."?e.length>1&&e.pop():s!=="."&&e.push(s)}),e.length>1?e.join("/"):"/"}function Mg(i,t,e,n){return`Cannot include a '${i}' character in a manually specified \`to.${t}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${e}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function mR(i){return i.filter((t,e)=>e===0||t.route.path&&t.route.path.length>0)}function qy(i){let t=mR(i);return t.map((e,n)=>n===t.length-1?e.pathname:e.pathnameBase)}function $y(i,t,e,n=!1){let s;typeof i=="string"?s=Eo(i):(s={...i},Ce(!s.pathname||!s.pathname.includes("?"),Mg("?","pathname","search",s)),Ce(!s.pathname||!s.pathname.includes("#"),Mg("#","pathname","hash",s)),Ce(!s.search||!s.search.includes("#"),Mg("#","search","hash",s)));let o=i===""||s.pathname==="",l=o?"/":s.pathname,u;if(l==null)u=e;else{let v=t.length-1;if(!n&&l.startsWith("..")){let b=l.split("/");for(;b[0]==="..";)b.shift(),v-=1;s.pathname=b.join("/")}u=v>=0?t[v]:"/"}let h=fR(s,u),f=l&&l!=="/"&&l.endsWith("/"),m=(o||l===".")&&e.endsWith("/");return!h.pathname.endsWith("/")&&(f||m)&&(h.pathname+="/"),h}var hr=i=>i.join("/").replace(/\/\/+/g,"/"),gR=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),yR=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,vR=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function _R(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}var H0=["POST","PUT","PATCH","DELETE"];new Set(H0);var bR=["GET",...H0];new Set(bR);var Wl=B.createContext(null);Wl.displayName="DataRouter";var $f=B.createContext(null);$f.displayName="DataRouterState";B.createContext(!1);var G0=B.createContext({isTransitioning:!1});G0.displayName="ViewTransition";var AR=B.createContext(new Map);AR.displayName="Fetchers";var wR=B.createContext(null);wR.displayName="Await";var Zs=B.createContext(null);Zs.displayName="Navigation";var Yu=B.createContext(null);Yu.displayName="Location";var ti=B.createContext({outlet:null,matches:[],isDataRoute:!1});ti.displayName="Route";var Ky=B.createContext(null);Ky.displayName="RouteError";function ER(i,{relative:t}={}){Ce(Yl(),"useHref() may be used only in the context of a <Router> component.");let{basename:e,navigator:n}=B.useContext(Zs),{hash:s,pathname:o,search:l}=Xu(i,{relative:t}),u=o;return e!=="/"&&(u=o==="/"?e:hr([e,o])),n.createHref({pathname:u,search:l,hash:s})}function Yl(){return B.useContext(Yu)!=null}function va(){return Ce(Yl(),"useLocation() may be used only in the context of a <Router> component."),B.useContext(Yu).location}var q0="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function $0(i){B.useContext(Zs).static||B.useLayoutEffect(i)}function Wy(){let{isDataRoute:i}=B.useContext(ti);return i?OR():SR()}function SR(){Ce(Yl(),"useNavigate() may be used only in the context of a <Router> component.");let i=B.useContext(Wl),{basename:t,navigator:e}=B.useContext(Zs),{matches:n}=B.useContext(ti),{pathname:s}=va(),o=JSON.stringify(qy(n)),l=B.useRef(!1);return $0(()=>{l.current=!0}),B.useCallback((h,f={})=>{if(Ls(l.current,q0),!l.current)return;if(typeof h=="number"){e.go(h);return}let m=$y(h,JSON.parse(o),s,f.relative==="path");i==null&&t!=="/"&&(m.pathname=m.pathname==="/"?t:hr([t,m.pathname])),(f.replace?e.replace:e.push)(m,f.state,f)},[t,e,o,s,i])}B.createContext(null);function Yy(){let{matches:i}=B.useContext(ti),t=i[i.length-1];return t?t.params:{}}function Xu(i,{relative:t}={}){let{matches:e}=B.useContext(ti),{pathname:n}=va(),s=JSON.stringify(qy(e));return B.useMemo(()=>$y(i,JSON.parse(s),n,t==="path"),[i,s,n,t])}function TR(i,t){return K0(i,t)}function K0(i,t,e,n){Ce(Yl(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=B.useContext(Zs),{matches:o}=B.useContext(ti),l=o[o.length-1],u=l?l.params:{},h=l?l.pathname:"/",f=l?l.pathnameBase:"/",m=l&&l.route;{let C=m&&m.path||"";W0(h,!m||C.endsWith("*")||C.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${C}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${C}"> to <Route path="${C==="/"?"*":`${C}/*`}">.`)}let v=va(),b;if(t){let C=typeof t=="string"?Eo(t):t;Ce(f==="/"||C.pathname?.startsWith(f),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${C.pathname}" was given in the \`location\` prop.`),b=C}else b=v;let A=b.pathname||"/",S=A;if(f!=="/"){let C=f.replace(/^\//,"").split("/");S="/"+A.replace(/^\//,"").split("/").slice(C.length).join("/")}let E=F0(i,{pathname:S});Ls(m||E!=null,`No routes matched location "${b.pathname}${b.search}${b.hash}" `),Ls(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${b.pathname}${b.search}${b.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let T=NR(E&&E.map(C=>Object.assign({},C,{params:Object.assign({},u,C.params),pathname:hr([f,s.encodeLocation?s.encodeLocation(C.pathname).pathname:C.pathname]),pathnameBase:C.pathnameBase==="/"?f:hr([f,s.encodeLocation?s.encodeLocation(C.pathnameBase).pathname:C.pathnameBase])})),o,e,n);return t&&T?B.createElement(Yu.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...b},navigationType:"POP"}},T):T}function xR(){let i=LR(),t=_R(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),e=i instanceof Error?i.stack:null,n="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:n},o={padding:"2px 4px",backgroundColor:n},l=null;return console.error("Error handled by React Router default ErrorBoundary:",i),l=B.createElement(B.Fragment,null,B.createElement("p",null," Hey developer "),B.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",B.createElement("code",{style:o},"ErrorBoundary")," or"," ",B.createElement("code",{style:o},"errorElement")," prop on your route.")),B.createElement(B.Fragment,null,B.createElement("h2",null,"Unexpected Application Error!"),B.createElement("h3",{style:{fontStyle:"italic"}},t),e?B.createElement("pre",{style:s},e):null,l)}var CR=B.createElement(xR,null),RR=class extends B.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,t){return t.location!==i.location||t.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:t.error,location:t.location,revalidation:i.revalidation||t.revalidation}}componentDidCatch(i,t){console.error("React Router caught the following error during render",i,t)}render(){return this.state.error!==void 0?B.createElement(ti.Provider,{value:this.props.routeContext},B.createElement(Ky.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function IR({routeContext:i,match:t,children:e}){let n=B.useContext(Wl);return n&&n.static&&n.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=t.route.id),B.createElement(ti.Provider,{value:i},e)}function NR(i,t=[],e=null,n=null){if(i==null){if(!e)return null;if(e.errors)i=e.matches;else if(t.length===0&&!e.initialized&&e.matches.length>0)i=e.matches;else return null}let s=i,o=e?.errors;if(o!=null){let h=s.findIndex(f=>f.route.id&&o?.[f.route.id]!==void 0);Ce(h>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),s=s.slice(0,Math.min(s.length,h+1))}let l=!1,u=-1;if(e)for(let h=0;h<s.length;h++){let f=s[h];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(u=h),f.route.id){let{loaderData:m,errors:v}=e,b=f.route.loader&&!m.hasOwnProperty(f.route.id)&&(!v||v[f.route.id]===void 0);if(f.route.lazy||b){l=!0,u>=0?s=s.slice(0,u+1):s=[s[0]];break}}}return s.reduceRight((h,f,m)=>{let v,b=!1,A=null,S=null;e&&(v=o&&f.route.id?o[f.route.id]:void 0,A=f.route.errorElement||CR,l&&(u<0&&m===0?(W0("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),b=!0,S=null):u===m&&(b=!0,S=f.route.hydrateFallbackElement||null)));let E=t.concat(s.slice(0,m+1)),T=()=>{let C;return v?C=A:b?C=S:f.route.Component?C=B.createElement(f.route.Component,null):f.route.element?C=f.route.element:C=h,B.createElement(IR,{match:f,routeContext:{outlet:h,matches:E,isDataRoute:e!=null},children:C})};return e&&(f.route.ErrorBoundary||f.route.errorElement||m===0)?B.createElement(RR,{location:e.location,revalidation:e.revalidation,component:A,error:v,children:T(),routeContext:{outlet:null,matches:E,isDataRoute:!0}}):T()},null)}function Xy(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function kR(i){let t=B.useContext(Wl);return Ce(t,Xy(i)),t}function MR(i){let t=B.useContext($f);return Ce(t,Xy(i)),t}function DR(i){let t=B.useContext(ti);return Ce(t,Xy(i)),t}function Qy(i){let t=DR(i),e=t.matches[t.matches.length-1];return Ce(e.route.id,`${i} can only be used on routes that contain a unique "id"`),e.route.id}function PR(){return Qy("useRouteId")}function LR(){let i=B.useContext(Ky),t=MR("useRouteError"),e=Qy("useRouteError");return i!==void 0?i:t.errors?.[e]}function OR(){let{router:i}=kR("useNavigate"),t=Qy("useNavigate"),e=B.useRef(!1);return $0(()=>{e.current=!0}),B.useCallback(async(s,o={})=>{Ls(e.current,q0),e.current&&(typeof s=="number"?i.navigate(s):await i.navigate(s,{fromRouteId:t,...o}))},[i,t])}var Lw={};function W0(i,t,e){!t&&!Lw[i]&&(Lw[i]=!0,Ls(!1,e))}B.memo(jR);function jR({routes:i,future:t,state:e}){return K0(i,void 0,e,t)}function Nl({to:i,replace:t,state:e,relative:n}){Ce(Yl(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=B.useContext(Zs);Ls(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=B.useContext(ti),{pathname:l}=va(),u=Wy(),h=$y(i,qy(o),l,n==="path"),f=JSON.stringify(h);return B.useEffect(()=>{u(JSON.parse(f),{replace:t,state:e,relative:n})},[u,f,n,t,e]),null}function Ai(i){Ce(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function VR({basename:i="/",children:t=null,location:e,navigationType:n="POP",navigator:s,static:o=!1}){Ce(!Yl(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=i.replace(/^\/*/,"/"),u=B.useMemo(()=>({basename:l,navigator:s,static:o,future:{}}),[l,s,o]);typeof e=="string"&&(e=Eo(e));let{pathname:h="/",search:f="",hash:m="",state:v=null,key:b="default"}=e,A=B.useMemo(()=>{let S=mr(h,l);return S==null?null:{location:{pathname:S,search:f,hash:m,state:v,key:b},navigationType:n}},[l,h,f,m,v,b,n]);return Ls(A!=null,`<Router basename="${l}"> is not able to match the URL "${h}${f}${m}" because it does not start with the basename, so the <Router> won't render anything.`),A==null?null:B.createElement(Zs.Provider,{value:u},B.createElement(Yu.Provider,{children:t,value:A}))}function UR({children:i,location:t}){return TR(ry(i),t)}function ry(i,t=[]){let e=[];return B.Children.forEach(i,(n,s)=>{if(!B.isValidElement(n))return;let o=[...t,s];if(n.type===B.Fragment){e.push.apply(e,ry(n.props.children,o));return}Ce(n.type===Ai,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ce(!n.props.index||!n.props.children,"An index route cannot have child routes.");let l={id:n.props.id||o.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(l.children=ry(n.props.children,o)),e.push(l)}),e}var rf="get",af="application/x-www-form-urlencoded";function Kf(i){return i!=null&&typeof i.tagName=="string"}function FR(i){return Kf(i)&&i.tagName.toLowerCase()==="button"}function BR(i){return Kf(i)&&i.tagName.toLowerCase()==="form"}function zR(i){return Kf(i)&&i.tagName.toLowerCase()==="input"}function HR(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function GR(i,t){return i.button===0&&(!t||t==="_self")&&!HR(i)}var zd=null;function qR(){if(zd===null)try{new FormData(document.createElement("form"),0),zd=!1}catch{zd=!0}return zd}var $R=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Dg(i){return i!=null&&!$R.has(i)?(Ls(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${af}"`),null):i}function KR(i,t){let e,n,s,o,l;if(BR(i)){let u=i.getAttribute("action");n=u?mr(u,t):null,e=i.getAttribute("method")||rf,s=Dg(i.getAttribute("enctype"))||af,o=new FormData(i)}else if(FR(i)||zR(i)&&(i.type==="submit"||i.type==="image")){let u=i.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=i.getAttribute("formaction")||u.getAttribute("action");if(n=h?mr(h,t):null,e=i.getAttribute("formmethod")||u.getAttribute("method")||rf,s=Dg(i.getAttribute("formenctype"))||Dg(u.getAttribute("enctype"))||af,o=new FormData(u,i),!qR()){let{name:f,type:m,value:v}=i;if(m==="image"){let b=f?`${f}.`:"";o.append(`${b}x`,"0"),o.append(`${b}y`,"0")}else f&&o.append(f,v)}}else{if(Kf(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');e=rf,n=null,s=af,l=i}return o&&s==="text/plain"&&(l=o,o=void 0),{action:n,method:e.toLowerCase(),encType:s,formData:o,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Jy(i,t){if(i===!1||i===null||typeof i>"u")throw new Error(t)}function WR(i,t,e){let n=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return n.pathname==="/"?n.pathname=`_root.${e}`:t&&mr(n.pathname,t)==="/"?n.pathname=`${t.replace(/\/$/,"")}/_root.${e}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${e}`,n}async function YR(i,t){if(i.id in t)return t[i.id];try{let e=await import(i.module);return t[i.id]=e,e}catch(e){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(e),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function XR(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function QR(i,t,e){let n=await Promise.all(i.map(async s=>{let o=t.routes[s.route.id];if(o){let l=await YR(o,e);return l.links?l.links():[]}return[]}));return eI(n.flat(1).filter(XR).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function Ow(i,t,e,n,s,o){let l=(h,f)=>e[f]?h.route.id!==e[f].route.id:!0,u=(h,f)=>e[f].pathname!==h.pathname||e[f].route.path?.endsWith("*")&&e[f].params["*"]!==h.params["*"];return o==="assets"?t.filter((h,f)=>l(h,f)||u(h,f)):o==="data"?t.filter((h,f)=>{let m=n.routes[h.route.id];if(!m||!m.hasLoader)return!1;if(l(h,f)||u(h,f))return!0;if(h.route.shouldRevalidate){let v=h.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:e[0]?.params||{},nextUrl:new URL(i,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof v=="boolean")return v}return!0}):[]}function JR(i,t,{includeHydrateFallback:e}={}){return ZR(i.map(n=>{let s=t.routes[n.route.id];if(!s)return[];let o=[s.module];return s.clientActionModule&&(o=o.concat(s.clientActionModule)),s.clientLoaderModule&&(o=o.concat(s.clientLoaderModule)),e&&s.hydrateFallbackModule&&(o=o.concat(s.hydrateFallbackModule)),s.imports&&(o=o.concat(s.imports)),o}).flat(1))}function ZR(i){return[...new Set(i)]}function tI(i){let t={},e=Object.keys(i).sort();for(let n of e)t[n]=i[n];return t}function eI(i,t){let e=new Set;return new Set(t),i.reduce((n,s)=>{let o=JSON.stringify(tI(s));return e.has(o)||(e.add(o),n.push({key:o,link:s})),n},[])}function Y0(){let i=B.useContext(Wl);return Jy(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function nI(){let i=B.useContext($f);return Jy(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var Zy=B.createContext(void 0);Zy.displayName="FrameworkContext";function X0(){let i=B.useContext(Zy);return Jy(i,"You must render this element inside a <HydratedRouter> element"),i}function sI(i,t){let e=B.useContext(Zy),[n,s]=B.useState(!1),[o,l]=B.useState(!1),{onFocus:u,onBlur:h,onMouseEnter:f,onMouseLeave:m,onTouchStart:v}=t,b=B.useRef(null);B.useEffect(()=>{if(i==="render"&&l(!0),i==="viewport"){let E=C=>{C.forEach(L=>{l(L.isIntersecting)})},T=new IntersectionObserver(E,{threshold:.5});return b.current&&T.observe(b.current),()=>{T.disconnect()}}},[i]),B.useEffect(()=>{if(n){let E=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(E)}}},[n]);let A=()=>{s(!0)},S=()=>{s(!1),l(!1)};return e?i!=="intent"?[o,b,{}]:[o,b,{onFocus:du(u,A),onBlur:du(h,S),onMouseEnter:du(f,A),onMouseLeave:du(m,S),onTouchStart:du(v,A)}]:[!1,b,{}]}function du(i,t){return e=>{i&&i(e),e.defaultPrevented||t(e)}}function iI({page:i,...t}){let{router:e}=Y0(),n=B.useMemo(()=>F0(e.routes,i,e.basename),[e.routes,i,e.basename]);return n?B.createElement(aI,{page:i,matches:n,...t}):null}function rI(i){let{manifest:t,routeModules:e}=X0(),[n,s]=B.useState([]);return B.useEffect(()=>{let o=!1;return QR(i,t,e).then(l=>{o||s(l)}),()=>{o=!0}},[i,t,e]),n}function aI({page:i,matches:t,...e}){let n=va(),{manifest:s,routeModules:o}=X0(),{basename:l}=Y0(),{loaderData:u,matches:h}=nI(),f=B.useMemo(()=>Ow(i,t,h,s,n,"data"),[i,t,h,s,n]),m=B.useMemo(()=>Ow(i,t,h,s,n,"assets"),[i,t,h,s,n]),v=B.useMemo(()=>{if(i===n.pathname+n.search+n.hash)return[];let S=new Set,E=!1;if(t.forEach(C=>{let L=s.routes[C.route.id];!L||!L.hasLoader||(!f.some(k=>k.route.id===C.route.id)&&C.route.id in u&&o[C.route.id]?.shouldRevalidate||L.hasClientLoader?E=!0:S.add(C.route.id))}),S.size===0)return[];let T=WR(i,l,"data");return E&&S.size>0&&T.searchParams.set("_routes",t.filter(C=>S.has(C.route.id)).map(C=>C.route.id).join(",")),[T.pathname+T.search]},[l,u,n,s,f,t,i,o]),b=B.useMemo(()=>JR(m,s),[m,s]),A=rI(m);return B.createElement(B.Fragment,null,v.map(S=>B.createElement("link",{key:S,rel:"prefetch",as:"fetch",href:S,...e})),b.map(S=>B.createElement("link",{key:S,rel:"modulepreload",href:S,...e})),A.map(({key:S,link:E})=>B.createElement("link",{key:S,nonce:e.nonce,...E})))}function oI(...i){return t=>{i.forEach(e=>{typeof e=="function"?e(t):e!=null&&(e.current=t)})}}var Q0=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Q0&&(window.__reactRouterVersion="7.8.1")}catch{}function lI({basename:i,children:t,window:e}){let n=B.useRef();n.current==null&&(n.current=XC({window:e,v5Compat:!0}));let s=n.current,[o,l]=B.useState({action:s.action,location:s.location}),u=B.useCallback(h=>{B.startTransition(()=>l(h))},[l]);return B.useLayoutEffect(()=>s.listen(u),[s,u]),B.createElement(VR,{basename:i,children:t,location:o.location,navigationType:o.action,navigator:s})}var J0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ts=B.forwardRef(function({onClick:t,discover:e="render",prefetch:n="none",relative:s,reloadDocument:o,replace:l,state:u,target:h,to:f,preventScrollReset:m,viewTransition:v,...b},A){let{basename:S}=B.useContext(Zs),E=typeof f=="string"&&J0.test(f),T,C=!1;if(typeof f=="string"&&E&&(T=f,Q0))try{let M=new URL(window.location.href),j=f.startsWith("//")?new URL(M.protocol+f):new URL(f),F=mr(j.pathname,S);j.origin===M.origin&&F!=null?f=F+j.search+j.hash:C=!0}catch{Ls(!1,`<Link to="${f}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let L=ER(f,{relative:s}),[k,V,P]=sI(n,b),G=dI(f,{replace:l,state:u,target:h,preventScrollReset:m,relative:s,viewTransition:v});function I(M){t&&t(M),M.defaultPrevented||G(M)}let N=B.createElement("a",{...b,...P,href:T||L,onClick:C||o?t:I,ref:oI(A,V),target:h,"data-discover":!E&&e==="render"?"true":void 0});return k&&!E?B.createElement(B.Fragment,null,N,B.createElement(iI,{page:L})):N});ts.displayName="Link";var cI=B.forwardRef(function({"aria-current":t="page",caseSensitive:e=!1,className:n="",end:s=!1,style:o,to:l,viewTransition:u,children:h,...f},m){let v=Xu(l,{relative:f.relative}),b=va(),A=B.useContext($f),{navigator:S,basename:E}=B.useContext(Zs),T=A!=null&&yI(v)&&u===!0,C=S.encodeLocation?S.encodeLocation(v).pathname:v.pathname,L=b.pathname,k=A&&A.navigation&&A.navigation.location?A.navigation.location.pathname:null;e||(L=L.toLowerCase(),k=k?k.toLowerCase():null,C=C.toLowerCase()),k&&E&&(k=mr(k,E)||k);const V=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let P=L===C||!s&&L.startsWith(C)&&L.charAt(V)==="/",G=k!=null&&(k===C||!s&&k.startsWith(C)&&k.charAt(C.length)==="/"),I={isActive:P,isPending:G,isTransitioning:T},N=P?t:void 0,M;typeof n=="function"?M=n(I):M=[n,P?"active":null,G?"pending":null,T?"transitioning":null].filter(Boolean).join(" ");let j=typeof o=="function"?o(I):o;return B.createElement(ts,{...f,"aria-current":N,className:M,ref:m,style:j,to:l,viewTransition:u},typeof h=="function"?h(I):h)});cI.displayName="NavLink";var uI=B.forwardRef(({discover:i="render",fetcherKey:t,navigate:e,reloadDocument:n,replace:s,state:o,method:l=rf,action:u,onSubmit:h,relative:f,preventScrollReset:m,viewTransition:v,...b},A)=>{let S=mI(),E=gI(u,{relative:f}),T=l.toLowerCase()==="get"?"get":"post",C=typeof u=="string"&&J0.test(u),L=k=>{if(h&&h(k),k.defaultPrevented)return;k.preventDefault();let V=k.nativeEvent.submitter,P=V?.getAttribute("formmethod")||l;S(V||k.currentTarget,{fetcherKey:t,method:P,navigate:e,replace:s,state:o,relative:f,preventScrollReset:m,viewTransition:v})};return B.createElement("form",{ref:A,method:T,action:E,onSubmit:n?h:L,...b,"data-discover":!C&&i==="render"?"true":void 0})});uI.displayName="Form";function hI(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Z0(i){let t=B.useContext(Wl);return Ce(t,hI(i)),t}function dI(i,{target:t,replace:e,state:n,preventScrollReset:s,relative:o,viewTransition:l}={}){let u=Wy(),h=va(),f=Xu(i,{relative:o});return B.useCallback(m=>{if(GR(m,t)){m.preventDefault();let v=e!==void 0?e:Lu(h)===Lu(f);u(i,{replace:v,state:n,preventScrollReset:s,relative:o,viewTransition:l})}},[h,u,f,e,n,t,i,s,o,l])}var fI=0,pI=()=>`__${String(++fI)}__`;function mI(){let{router:i}=Z0("useSubmit"),{basename:t}=B.useContext(Zs),e=PR();return B.useCallback(async(n,s={})=>{let{action:o,method:l,encType:u,formData:h,body:f}=KR(n,t);if(s.navigate===!1){let m=s.fetcherKey||pI();await i.fetch(m,e,s.action||o,{preventScrollReset:s.preventScrollReset,formData:h,body:f,formMethod:s.method||l,formEncType:s.encType||u,flushSync:s.flushSync})}else await i.navigate(s.action||o,{preventScrollReset:s.preventScrollReset,formData:h,body:f,formMethod:s.method||l,formEncType:s.encType||u,replace:s.replace,state:s.state,fromRouteId:e,flushSync:s.flushSync,viewTransition:s.viewTransition})},[i,t,e])}function gI(i,{relative:t}={}){let{basename:e}=B.useContext(Zs),n=B.useContext(ti);Ce(n,"useFormAction must be used inside a RouteContext");let[s]=n.matches.slice(-1),o={...Xu(i||".",{relative:t})},l=va();if(i==null){o.search=l.search;let u=new URLSearchParams(o.search),h=u.getAll("index");if(h.some(m=>m==="")){u.delete("index"),h.filter(v=>v).forEach(v=>u.append("index",v));let m=u.toString();o.search=m?`?${m}`:""}}return(!i||i===".")&&s.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),e!=="/"&&(o.pathname=o.pathname==="/"?e:hr([e,o.pathname])),Lu(o)}function yI(i,{relative:t}={}){let e=B.useContext(G0);Ce(e!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=Z0("useViewTransitionState"),s=Xu(i,{relative:t});if(!e.isTransitioning)return!1;let o=mr(e.currentLocation.pathname,n)||e.currentLocation.pathname,l=mr(e.nextLocation.pathname,n)||e.nextLocation.pathname;return bf(s.pathname,l)!=null||bf(s.pathname,o)!=null}const vI=()=>{};var jw={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tS=function(i){const t=[];let e=0;for(let n=0;n<i.length;n++){let s=i.charCodeAt(n);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&n+1<i.length&&(i.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(i.charCodeAt(++n)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},_I=function(i){const t=[];let e=0,n=0;for(;e<i.length;){const s=i[e++];if(s<128)t[n++]=String.fromCharCode(s);else if(s>191&&s<224){const o=i[e++];t[n++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=i[e++],l=i[e++],u=i[e++],h=((s&7)<<18|(o&63)<<12|(l&63)<<6|u&63)-65536;t[n++]=String.fromCharCode(55296+(h>>10)),t[n++]=String.fromCharCode(56320+(h&1023))}else{const o=i[e++],l=i[e++];t[n++]=String.fromCharCode((s&15)<<12|(o&63)<<6|l&63)}}return t.join("")},eS={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(i,t){if(!Array.isArray(i))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<i.length;s+=3){const o=i[s],l=s+1<i.length,u=l?i[s+1]:0,h=s+2<i.length,f=h?i[s+2]:0,m=o>>2,v=(o&3)<<4|u>>4;let b=(u&15)<<2|f>>6,A=f&63;h||(A=64,l||(b=64)),n.push(e[m],e[v],e[b],e[A])}return n.join("")},encodeString(i,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(i):this.encodeByteArray(tS(i),t)},decodeString(i,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(i):_I(this.decodeStringToByteArray(i,t))},decodeStringToByteArray(i,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<i.length;){const o=e[i.charAt(s++)],u=s<i.length?e[i.charAt(s)]:0;++s;const f=s<i.length?e[i.charAt(s)]:64;++s;const v=s<i.length?e[i.charAt(s)]:64;if(++s,o==null||u==null||f==null||v==null)throw new bI;const b=o<<2|u>>4;if(n.push(b),f!==64){const A=u<<4&240|f>>2;if(n.push(A),v!==64){const S=f<<6&192|v;n.push(S)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class bI extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const AI=function(i){const t=tS(i);return eS.encodeByteArray(t,!0)},Af=function(i){return AI(i).replace(/\./g,"")},nS=function(i){try{return eS.decodeString(i,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wI(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EI=()=>wI().__FIREBASE_DEFAULTS__,SI=()=>{if(typeof process>"u"||typeof jw>"u")return;const i=jw.__FIREBASE_DEFAULTS__;if(i)return JSON.parse(i)},TI=()=>{if(typeof document>"u")return;let i;try{i=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=i&&nS(i[1]);return t&&JSON.parse(t)},Wf=()=>{try{return vI()||EI()||SI()||TI()}catch(i){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${i}`);return}},sS=i=>Wf()?.emulatorHosts?.[i],iS=i=>{const t=sS(i);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),n]:[t.substring(0,e),n]},rS=()=>Wf()?.config,aS=i=>Wf()?.[`_${i}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xI{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function So(i){try{return(i.startsWith("http://")||i.startsWith("https://")?new URL(i).hostname:i).endsWith(".cloudworkstations.dev")}catch{return!1}}async function tv(i){return(await fetch(i,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oS(i,t){if(i.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},n=t||"demo-project",s=i.iat||0,o=i.sub||i.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...i};return[Af(JSON.stringify(e)),Af(JSON.stringify(l)),""].join(".")}const Cu={};function CI(){const i={prod:[],emulator:[]};for(const t of Object.keys(Cu))Cu[t]?i.emulator.push(t):i.prod.push(t);return i}function RI(i){let t=document.getElementById(i),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",i),e=!0),{created:e,element:t}}let Vw=!1;function ev(i,t){if(typeof window>"u"||typeof document>"u"||!So(window.location.host)||Cu[i]===t||Cu[i]||Vw)return;Cu[i]=t;function e(b){return`__firebase__banner__${b}`}const n="__firebase__banner",o=CI().prod.length>0;function l(){const b=document.getElementById(n);b&&b.remove()}function u(b){b.style.display="flex",b.style.background="#7faaf0",b.style.position="fixed",b.style.bottom="5px",b.style.left="5px",b.style.padding=".5em",b.style.borderRadius="5px",b.style.alignItems="center"}function h(b,A){b.setAttribute("width","24"),b.setAttribute("id",A),b.setAttribute("height","24"),b.setAttribute("viewBox","0 0 24 24"),b.setAttribute("fill","none"),b.style.marginLeft="-6px"}function f(){const b=document.createElement("span");return b.style.cursor="pointer",b.style.marginLeft="16px",b.style.fontSize="24px",b.innerHTML=" &times;",b.onclick=()=>{Vw=!0,l()},b}function m(b,A){b.setAttribute("id",A),b.innerText="Learn more",b.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",b.setAttribute("target","__blank"),b.style.paddingLeft="5px",b.style.textDecoration="underline"}function v(){const b=RI(n),A=e("text"),S=document.getElementById(A)||document.createElement("span"),E=e("learnmore"),T=document.getElementById(E)||document.createElement("a"),C=e("preprendIcon"),L=document.getElementById(C)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(b.created){const k=b.element;u(k),m(T,E);const V=f();h(L,C),k.append(L,S,T,V),document.body.appendChild(k)}o?(S.innerText="Preview backend disconnected.",L.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(L.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",A)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",v):v()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function II(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Dn())}function NI(){const i=Wf()?.forceEnvironment;if(i==="node")return!0;if(i==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function kI(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function MI(){const i=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof i=="object"&&i.id!==void 0}function DI(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function PI(){const i=Dn();return i.indexOf("MSIE ")>=0||i.indexOf("Trident/")>=0}function LI(){return!NI()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function OI(){try{return typeof indexedDB=="object"}catch{return!1}}function jI(){return new Promise((i,t)=>{try{let e=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(n),i(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VI="FirebaseError";class Mi extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name=VI,Object.setPrototypeOf(this,Mi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Qu.prototype.create)}}class Qu{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},s=`${this.service}/${t}`,o=this.errors[t],l=o?UI(o,n):"Error",u=`${this.serviceName}: ${l} (${s}).`;return new Mi(s,u,n)}}function UI(i,t){return i.replace(FI,(e,n)=>{const s=t[n];return s!=null?String(s):`<${n}?>`})}const FI=/\{\$([^}]+)}/g;function BI(i){for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t))return!1;return!0}function po(i,t){if(i===t)return!0;const e=Object.keys(i),n=Object.keys(t);for(const s of e){if(!n.includes(s))return!1;const o=i[s],l=t[s];if(Uw(o)&&Uw(l)){if(!po(o,l))return!1}else if(o!==l)return!1}for(const s of n)if(!e.includes(s))return!1;return!0}function Uw(i){return i!==null&&typeof i=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ju(i){const t=[];for(const[e,n]of Object.entries(i))Array.isArray(n)?n.forEach(s=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(s))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function vu(i){const t={};return i.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[s,o]=n.split("=");t[decodeURIComponent(s)]=decodeURIComponent(o)}}),t}function _u(i){const t=i.indexOf("?");if(!t)return"";const e=i.indexOf("#",t);return i.substring(t,e>0?e:void 0)}function zI(i,t){const e=new HI(i,t);return e.subscribe.bind(e)}class HI{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(n=>{this.error(n)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,n){let s;if(t===void 0&&e===void 0&&n===void 0)throw new Error("Missing Observer.");GI(t,["next","error","complete"])?s=t:s={next:t,error:e,complete:n},s.next===void 0&&(s.next=Pg),s.error===void 0&&(s.error=Pg),s.complete===void 0&&(s.complete=Pg);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function GI(i,t){if(typeof i!="object"||i===null)return!1;for(const e of t)if(e in i&&typeof i[e]=="function")return!0;return!1}function Pg(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ze(i){return i&&i._delegate?i._delegate:i}class ca{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ro="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qI{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const n=new xI;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&n.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),n=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(KI(t))try{this.getOrInitializeService({instanceIdentifier:ro})}catch{}for(const[e,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const o=this.getOrInitializeService({instanceIdentifier:s});n.resolve(o)}catch{}}}}clearInstance(t=ro){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=ro){return this.instances.has(t)}getOptions(t=ro){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[o,l]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);n===u&&l.resolve(s)}return s}onInit(t,e){const n=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(n)??new Set;s.add(t),this.onInitCallbacks.set(n,s);const o=this.instances.get(n);return o&&t(o,n),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:$I(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=ro){return this.component?this.component.multipleInstances?t:ro:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function $I(i){return i===ro?void 0:i}function KI(i){return i.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WI{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new qI(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kt;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})(Kt||(Kt={}));const YI={debug:Kt.DEBUG,verbose:Kt.VERBOSE,info:Kt.INFO,warn:Kt.WARN,error:Kt.ERROR,silent:Kt.SILENT},XI=Kt.INFO,QI={[Kt.DEBUG]:"log",[Kt.VERBOSE]:"log",[Kt.INFO]:"info",[Kt.WARN]:"warn",[Kt.ERROR]:"error"},JI=(i,t,...e)=>{if(t<i.logLevel)return;const n=new Date().toISOString(),s=QI[t];if(s)console[s](`[${n}]  ${i.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class nv{constructor(t){this.name=t,this._logLevel=XI,this._logHandler=JI,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Kt))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?YI[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Kt.DEBUG,...t),this._logHandler(this,Kt.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Kt.VERBOSE,...t),this._logHandler(this,Kt.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Kt.INFO,...t),this._logHandler(this,Kt.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Kt.WARN,...t),this._logHandler(this,Kt.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Kt.ERROR,...t),this._logHandler(this,Kt.ERROR,...t)}}const ZI=(i,t)=>t.some(e=>i instanceof e);let Fw,Bw;function tN(){return Fw||(Fw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function eN(){return Bw||(Bw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const lS=new WeakMap,ay=new WeakMap,cS=new WeakMap,Lg=new WeakMap,sv=new WeakMap;function nN(i){const t=new Promise((e,n)=>{const s=()=>{i.removeEventListener("success",o),i.removeEventListener("error",l)},o=()=>{e(ra(i.result)),s()},l=()=>{n(i.error),s()};i.addEventListener("success",o),i.addEventListener("error",l)});return t.then(e=>{e instanceof IDBCursor&&lS.set(e,i)}).catch(()=>{}),sv.set(t,i),t}function sN(i){if(ay.has(i))return;const t=new Promise((e,n)=>{const s=()=>{i.removeEventListener("complete",o),i.removeEventListener("error",l),i.removeEventListener("abort",l)},o=()=>{e(),s()},l=()=>{n(i.error||new DOMException("AbortError","AbortError")),s()};i.addEventListener("complete",o),i.addEventListener("error",l),i.addEventListener("abort",l)});ay.set(i,t)}let oy={get(i,t,e){if(i instanceof IDBTransaction){if(t==="done")return ay.get(i);if(t==="objectStoreNames")return i.objectStoreNames||cS.get(i);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return ra(i[t])},set(i,t,e){return i[t]=e,!0},has(i,t){return i instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in i}};function iN(i){oy=i(oy)}function rN(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const n=i.call(Og(this),t,...e);return cS.set(n,t.sort?t.sort():[t]),ra(n)}:eN().includes(i)?function(...t){return i.apply(Og(this),t),ra(lS.get(this))}:function(...t){return ra(i.apply(Og(this),t))}}function aN(i){return typeof i=="function"?rN(i):(i instanceof IDBTransaction&&sN(i),ZI(i,tN())?new Proxy(i,oy):i)}function ra(i){if(i instanceof IDBRequest)return nN(i);if(Lg.has(i))return Lg.get(i);const t=aN(i);return t!==i&&(Lg.set(i,t),sv.set(t,i)),t}const Og=i=>sv.get(i);function oN(i,t,{blocked:e,upgrade:n,blocking:s,terminated:o}={}){const l=indexedDB.open(i,t),u=ra(l);return n&&l.addEventListener("upgradeneeded",h=>{n(ra(l.result),h.oldVersion,h.newVersion,ra(l.transaction),h)}),e&&l.addEventListener("blocked",h=>e(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",f=>s(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}const lN=["get","getKey","getAll","getAllKeys","count"],cN=["put","add","delete","clear"],jg=new Map;function zw(i,t){if(!(i instanceof IDBDatabase&&!(t in i)&&typeof t=="string"))return;if(jg.get(t))return jg.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,s=cN.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(s||lN.includes(e)))return;const o=async function(l,...u){const h=this.transaction(l,s?"readwrite":"readonly");let f=h.store;return n&&(f=f.index(u.shift())),(await Promise.all([f[e](...u),s&&h.done]))[0]};return jg.set(t,o),o}iN(i=>({...i,get:(t,e,n)=>zw(t,e)||i.get(t,e,n),has:(t,e)=>!!zw(t,e)||i.has(t,e)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uN{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(hN(e)){const n=e.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(e=>e).join(" ")}}function hN(i){return i.getComponent()?.type==="VERSION"}const ly="@firebase/app",Hw="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gr=new nv("@firebase/app"),dN="@firebase/app-compat",fN="@firebase/analytics-compat",pN="@firebase/analytics",mN="@firebase/app-check-compat",gN="@firebase/app-check",yN="@firebase/auth",vN="@firebase/auth-compat",_N="@firebase/database",bN="@firebase/data-connect",AN="@firebase/database-compat",wN="@firebase/functions",EN="@firebase/functions-compat",SN="@firebase/installations",TN="@firebase/installations-compat",xN="@firebase/messaging",CN="@firebase/messaging-compat",RN="@firebase/performance",IN="@firebase/performance-compat",NN="@firebase/remote-config",kN="@firebase/remote-config-compat",MN="@firebase/storage",DN="@firebase/storage-compat",PN="@firebase/firestore",LN="@firebase/ai",ON="@firebase/firestore-compat",jN="firebase",VN="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cy="[DEFAULT]",UN={[ly]:"fire-core",[dN]:"fire-core-compat",[pN]:"fire-analytics",[fN]:"fire-analytics-compat",[gN]:"fire-app-check",[mN]:"fire-app-check-compat",[yN]:"fire-auth",[vN]:"fire-auth-compat",[_N]:"fire-rtdb",[bN]:"fire-data-connect",[AN]:"fire-rtdb-compat",[wN]:"fire-fn",[EN]:"fire-fn-compat",[SN]:"fire-iid",[TN]:"fire-iid-compat",[xN]:"fire-fcm",[CN]:"fire-fcm-compat",[RN]:"fire-perf",[IN]:"fire-perf-compat",[NN]:"fire-rc",[kN]:"fire-rc-compat",[MN]:"fire-gcs",[DN]:"fire-gcs-compat",[PN]:"fire-fst",[ON]:"fire-fst-compat",[LN]:"fire-vertex","fire-js":"fire-js",[jN]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wf=new Map,FN=new Map,uy=new Map;function Gw(i,t){try{i.container.addComponent(t)}catch(e){gr.debug(`Component ${t.name} failed to register with FirebaseApp ${i.name}`,e)}}function mo(i){const t=i.name;if(uy.has(t))return gr.debug(`There were multiple attempts to register component ${t}.`),!1;uy.set(t,i);for(const e of wf.values())Gw(e,i);for(const e of FN.values())Gw(e,i);return!0}function Yf(i,t){const e=i.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),i.container.getProvider(t)}function Jn(i){return i==null?!1:i.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BN={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},aa=new Qu("app","Firebase",BN);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zN{constructor(t,e,n){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ca("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw aa.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const To=VN;function uS(i,t={}){let e=i;typeof t!="object"&&(t={name:t});const n={name:cy,automaticDataCollectionEnabled:!0,...t},s=n.name;if(typeof s!="string"||!s)throw aa.create("bad-app-name",{appName:String(s)});if(e||(e=rS()),!e)throw aa.create("no-options");const o=wf.get(s);if(o){if(po(e,o.options)&&po(n,o.config))return o;throw aa.create("duplicate-app",{appName:s})}const l=new WI(s);for(const h of uy.values())l.addComponent(h);const u=new zN(e,n,l);return wf.set(s,u),u}function iv(i=cy){const t=wf.get(i);if(!t&&i===cy&&rS())return uS();if(!t)throw aa.create("no-app",{appName:i});return t}function Ti(i,t,e){let n=UN[i]??i;e&&(n+=`-${e}`);const s=n.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const l=[`Unable to register library "${n}" with version "${t}":`];s&&l.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&o&&l.push("and"),o&&l.push(`version name "${t}" contains illegal characters (whitespace or "/")`),gr.warn(l.join(" "));return}mo(new ca(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HN="firebase-heartbeat-database",GN=1,Ou="firebase-heartbeat-store";let Vg=null;function hS(){return Vg||(Vg=oN(HN,GN,{upgrade:(i,t)=>{switch(t){case 0:try{i.createObjectStore(Ou)}catch(e){console.warn(e)}}}}).catch(i=>{throw aa.create("idb-open",{originalErrorMessage:i.message})})),Vg}async function qN(i){try{const e=(await hS()).transaction(Ou),n=await e.objectStore(Ou).get(dS(i));return await e.done,n}catch(t){if(t instanceof Mi)gr.warn(t.message);else{const e=aa.create("idb-get",{originalErrorMessage:t?.message});gr.warn(e.message)}}}async function qw(i,t){try{const n=(await hS()).transaction(Ou,"readwrite");await n.objectStore(Ou).put(t,dS(i)),await n.done}catch(e){if(e instanceof Mi)gr.warn(e.message);else{const n=aa.create("idb-set",{originalErrorMessage:e?.message});gr.warn(n.message)}}}function dS(i){return`${i.name}!${i.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $N=1024,KN=30;class WN{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new XN(e),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=$w();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(s=>s.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:e}),this._heartbeatsCache.heartbeats.length>KN){const s=QN(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){gr.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=$w(),{heartbeatsToSend:e,unsentEntries:n}=YN(this._heartbeatsCache.heartbeats),s=Af(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return gr.warn(t),""}}}function $w(){return new Date().toISOString().substring(0,10)}function YN(i,t=$N){const e=[];let n=i.slice();for(const s of i){const o=e.find(l=>l.agent===s.agent);if(o){if(o.dates.push(s.date),Kw(e)>t){o.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),Kw(e)>t){e.pop();break}n=n.slice(1)}return{heartbeatsToSend:e,unsentEntries:n}}class XN{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return OI()?jI().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await qN(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return qw(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return qw(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return}}function Kw(i){return Af(JSON.stringify({version:2,heartbeats:i})).length}function QN(i){if(i.length===0)return-1;let t=0,e=i[0].date;for(let n=1;n<i.length;n++)i[n].date<e&&(e=i[n].date,t=n);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JN(i){mo(new ca("platform-logger",t=>new uN(t),"PRIVATE")),mo(new ca("heartbeat",t=>new WN(t),"PRIVATE")),Ti(ly,Hw,i),Ti(ly,Hw,"esm2020"),Ti("fire-js","")}JN("");function fS(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const ZN=fS,pS=new Qu("auth","Firebase",fS());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ef=new nv("@firebase/auth");function tk(i,...t){Ef.logLevel<=Kt.WARN&&Ef.warn(`Auth (${To}): ${i}`,...t)}function of(i,...t){Ef.logLevel<=Kt.ERROR&&Ef.error(`Auth (${To}): ${i}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Os(i,...t){throw av(i,...t)}function Ys(i,...t){return av(i,...t)}function rv(i,t,e){const n={...ZN(),[t]:e};return new Qu("auth","Firebase",n).create(t,{appName:i.name})}function dr(i){return rv(i,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ek(i,t,e){const n=e;if(!(t instanceof n))throw n.name!==t.constructor.name&&Os(i,"argument-error"),rv(i,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function av(i,...t){if(typeof i!="string"){const e=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=i.name),i._errorFactory.create(e,...n)}return pS.create(i,...t)}function Dt(i,t,...e){if(!i)throw av(t,...e)}function cr(i){const t="INTERNAL ASSERTION FAILED: "+i;throw of(t),new Error(t)}function yr(i,t){i||cr(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hy(){return typeof self<"u"&&self.location?.href||""}function nk(){return Ww()==="http:"||Ww()==="https:"}function Ww(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sk(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(nk()||MI()||"connection"in navigator)?navigator.onLine:!0}function ik(){if(typeof navigator>"u")return null;const i=navigator;return i.languages&&i.languages[0]||i.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zu{constructor(t,e){this.shortDelay=t,this.longDelay=e,yr(e>t,"Short delay should be less than long delay!"),this.isMobile=II()||DI()}get(){return sk()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ov(i,t){yr(i.emulator,"Emulator should always be set here");const{url:e}=i.emulator;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mS{static initialize(t,e,n){this.fetchImpl=t,e&&(this.headersImpl=e),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;cr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;cr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;cr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ak=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],ok=new Zu(3e4,6e4);function _a(i,t){return i.tenantId&&!t.tenantId?{...t,tenantId:i.tenantId}:t}async function ba(i,t,e,n,s={}){return gS(i,s,async()=>{let o={},l={};n&&(t==="GET"?l=n:o={body:JSON.stringify(n)});const u=Ju({key:i.config.apiKey,...l}).slice(1),h=await i._getAdditionalHeaders();h["Content-Type"]="application/json",i.languageCode&&(h["X-Firebase-Locale"]=i.languageCode);const f={method:t,headers:h,...o};return kI()||(f.referrerPolicy="no-referrer"),i.emulatorConfig&&So(i.emulatorConfig.host)&&(f.credentials="include"),mS.fetch()(await yS(i,i.config.apiHost,e,u),f)})}async function gS(i,t,e){i._canInitEmulator=!1;const n={...rk,...t};try{const s=new ck(i),o=await Promise.race([e(),s.promise]);s.clearNetworkTimeout();const l=await o.json();if("needConfirmation"in l)throw Hd(i,"account-exists-with-different-credential",l);if(o.ok&&!("errorMessage"in l))return l;{const u=o.ok?l.errorMessage:l.error.message,[h,f]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Hd(i,"credential-already-in-use",l);if(h==="EMAIL_EXISTS")throw Hd(i,"email-already-in-use",l);if(h==="USER_DISABLED")throw Hd(i,"user-disabled",l);const m=n[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw rv(i,m,f);Os(i,m)}}catch(s){if(s instanceof Mi)throw s;Os(i,"network-request-failed",{message:String(s)})}}async function th(i,t,e,n,s={}){const o=await ba(i,t,e,n,s);return"mfaPendingCredential"in o&&Os(i,"multi-factor-auth-required",{_serverResponse:o}),o}async function yS(i,t,e,n){const s=`${t}${e}?${n}`,o=i,l=o.config.emulator?ov(i.config,s):`${i.config.apiScheme}://${s}`;return ak.includes(e)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(l).toString():l}function lk(i){switch(i){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class ck{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((e,n)=>{this.timer=setTimeout(()=>n(Ys(this.auth,"network-request-failed")),ok.get())})}}function Hd(i,t,e){const n={appName:i.name};e.email&&(n.email=e.email),e.phoneNumber&&(n.phoneNumber=e.phoneNumber);const s=Ys(i,t,n);return s.customData._tokenResponse=e,s}function Yw(i){return i!==void 0&&i.enterprise!==void 0}class uk{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const e of this.recaptchaEnforcementState)if(e.provider&&e.provider===t)return lk(e.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function hk(i,t){return ba(i,"GET","/v2/recaptchaConfig",_a(i,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dk(i,t){return ba(i,"POST","/v1/accounts:delete",t)}async function Sf(i,t){return ba(i,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ru(i){if(i)try{const t=new Date(Number(i));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function fk(i,t=!1){const e=ze(i),n=await e.getIdToken(t),s=lv(n);Dt(s&&s.exp&&s.auth_time&&s.iat,e.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,l=o?.sign_in_provider;return{claims:s,token:n,authTime:Ru(Ug(s.auth_time)),issuedAtTime:Ru(Ug(s.iat)),expirationTime:Ru(Ug(s.exp)),signInProvider:l||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Ug(i){return Number(i)*1e3}function lv(i){const[t,e,n]=i.split(".");if(t===void 0||e===void 0||n===void 0)return of("JWT malformed, contained fewer than 3 sections"),null;try{const s=nS(e);return s?JSON.parse(s):(of("Failed to decode base64 JWT payload"),null)}catch(s){return of("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Xw(i){const t=lv(i);return Dt(t,"internal-error"),Dt(typeof t.exp<"u","internal-error"),Dt(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ju(i,t,e=!1){if(e)return t;try{return await t}catch(n){throw n instanceof Mi&&pk(n)&&i.auth.currentUser===i&&await i.auth.signOut(),n}}function pk({code:i}){return i==="auth/user-disabled"||i==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){if(t){const e=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),e}else{this.errorBackoff=3e4;const n=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,n)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){t?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dy{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ru(this.lastLoginAt),this.creationTime=Ru(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tf(i){const t=i.auth,e=await i.getIdToken(),n=await ju(i,Sf(t,{idToken:e}));Dt(n?.users.length,t,"internal-error");const s=n.users[0];i._notifyReloadListener(s);const o=s.providerUserInfo?.length?vS(s.providerUserInfo):[],l=yk(i.providerData,o),u=i.isAnonymous,h=!(i.email&&s.passwordHash)&&!l?.length,f=u?h:!1,m={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:l,metadata:new dy(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(i,m)}async function gk(i){const t=ze(i);await Tf(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function yk(i,t){return[...i.filter(n=>!t.some(s=>s.providerId===n.providerId)),...t]}function vS(i){return i.map(({providerId:t,...e})=>({providerId:t,uid:e.rawId||"",displayName:e.displayName||null,email:e.email||null,phoneNumber:e.phoneNumber||null,photoURL:e.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vk(i,t){const e=await gS(i,{},async()=>{const n=Ju({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:s,apiKey:o}=i.config,l=await yS(i,s,"/v1/token",`key=${o}`),u=await i._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:u,body:n};return i.emulatorConfig&&So(i.emulatorConfig.host)&&(h.credentials="include"),mS.fetch()(l,h)});return{accessToken:e.access_token,expiresIn:e.expires_in,refreshToken:e.refresh_token}}async function _k(i,t){return ba(i,"POST","/v2/accounts:revokeToken",_a(i,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Dt(t.idToken,"internal-error"),Dt(typeof t.idToken<"u","internal-error"),Dt(typeof t.refreshToken<"u","internal-error");const e="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):Xw(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){Dt(t.length!==0,"internal-error");const e=Xw(t);this.updateTokensAndExpiration(t,null,e)}async getToken(t,e=!1){return!e&&this.accessToken&&!this.isExpired?this.accessToken:(Dt(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:n,refreshToken:s,expiresIn:o}=await vk(t,e);this.updateTokensAndExpiration(n,s,Number(o))}updateTokensAndExpiration(t,e,n){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(t,e){const{refreshToken:n,accessToken:s,expirationTime:o}=e,l=new Pl;return n&&(Dt(typeof n=="string","internal-error",{appName:t}),l.refreshToken=n),s&&(Dt(typeof s=="string","internal-error",{appName:t}),l.accessToken=s),o&&(Dt(typeof o=="number","internal-error",{appName:t}),l.expirationTime=o),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new Pl,this.toJSON())}_performRefresh(){return cr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xr(i,t){Dt(typeof i=="string"||typeof i>"u","internal-error",{appName:t})}class Ks{constructor({uid:t,auth:e,stsTokenManager:n,...s}){this.providerId="firebase",this.proactiveRefresh=new mk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=e,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new dy(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(t){const e=await ju(this,this.stsTokenManager.getToken(this.auth,t));return Dt(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return fk(this,t)}reload(){return gk(this)}_assign(t){this!==t&&(Dt(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(e=>({...e})),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const e=new Ks({...this,auth:t,stsTokenManager:this.stsTokenManager._clone()});return e.metadata._copy(this.metadata),e}_onReload(t){Dt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),e&&await Tf(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Jn(this.auth.app))return Promise.reject(dr(this.auth));const t=await this.getIdToken();return await ju(this,dk(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>({...t})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){const n=e.displayName??void 0,s=e.email??void 0,o=e.phoneNumber??void 0,l=e.photoURL??void 0,u=e.tenantId??void 0,h=e._redirectEventId??void 0,f=e.createdAt??void 0,m=e.lastLoginAt??void 0,{uid:v,emailVerified:b,isAnonymous:A,providerData:S,stsTokenManager:E}=e;Dt(v&&E,t,"internal-error");const T=Pl.fromJSON(this.name,E);Dt(typeof v=="string",t,"internal-error"),Xr(n,t.name),Xr(s,t.name),Dt(typeof b=="boolean",t,"internal-error"),Dt(typeof A=="boolean",t,"internal-error"),Xr(o,t.name),Xr(l,t.name),Xr(u,t.name),Xr(h,t.name),Xr(f,t.name),Xr(m,t.name);const C=new Ks({uid:v,auth:t,email:s,emailVerified:b,displayName:n,isAnonymous:A,photoURL:l,phoneNumber:o,tenantId:u,stsTokenManager:T,createdAt:f,lastLoginAt:m});return S&&Array.isArray(S)&&(C.providerData=S.map(L=>({...L}))),h&&(C._redirectEventId=h),C}static async _fromIdTokenResponse(t,e,n=!1){const s=new Pl;s.updateFromServerResponse(e);const o=new Ks({uid:e.localId,auth:t,stsTokenManager:s,isAnonymous:n});return await Tf(o),o}static async _fromGetAccountInfoResponse(t,e,n){const s=e.users[0];Dt(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?vS(s.providerUserInfo):[],l=!(s.email&&s.passwordHash)&&!o?.length,u=new Pl;u.updateFromIdToken(n);const h=new Ks({uid:s.localId,auth:t,stsTokenManager:u,isAnonymous:l}),f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new dy(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!o?.length};return Object.assign(h,f),h}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qw=new Map;function ur(i){yr(i instanceof Function,"Expected a class definition");let t=Qw.get(i);return t?(yr(t instanceof i,"Instance stored in cache mismatched with class"),t):(t=new i,Qw.set(i,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _S{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return e===void 0?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}_S.type="NONE";const Jw=_S;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lf(i,t,e){return`firebase:${i}:${t}:${e}`}class Ll{constructor(t,e,n){this.persistence=t,this.auth=e,this.userKey=n;const{config:s,name:o}=this.auth;this.fullUserKey=lf(this.userKey,s.apiKey,o),this.fullPersistenceKey=lf("persistence",s.apiKey,o),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);if(!t)return null;if(typeof t=="string"){const e=await Sf(this.auth,{idToken:t}).catch(()=>{});return e?Ks._fromGetAccountInfoResponse(this.auth,e,t):null}return Ks._fromJSON(this.auth,t)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,e)return this.setCurrentUser(e)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,n="authUser"){if(!e.length)return new Ll(ur(Jw),t,n);const s=(await Promise.all(e.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let o=s[0]||ur(Jw);const l=lf(n,t.config.apiKey,t.name);let u=null;for(const f of e)try{const m=await f._get(l);if(m){let v;if(typeof m=="string"){const b=await Sf(t,{idToken:m}).catch(()=>{});if(!b)break;v=await Ks._fromGetAccountInfoResponse(t,b,m)}else v=Ks._fromJSON(t,m);f!==o&&(u=v),o=f;break}}catch{}const h=s.filter(f=>f._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new Ll(o,t,n):(o=h[0],u&&await o._set(l,u.toJSON()),await Promise.all(e.map(async f=>{if(f!==o)try{await f._remove(l)}catch{}})),new Ll(o,t,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zw(i){const t=i.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ES(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(bS(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(TS(t))return"Blackberry";if(xS(t))return"Webos";if(AS(t))return"Safari";if((t.includes("chrome/")||wS(t))&&!t.includes("edge/"))return"Chrome";if(SS(t))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=i.match(e);if(n?.length===2)return n[1]}return"Other"}function bS(i=Dn()){return/firefox\//i.test(i)}function AS(i=Dn()){const t=i.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function wS(i=Dn()){return/crios\//i.test(i)}function ES(i=Dn()){return/iemobile/i.test(i)}function SS(i=Dn()){return/android/i.test(i)}function TS(i=Dn()){return/blackberry/i.test(i)}function xS(i=Dn()){return/webos/i.test(i)}function cv(i=Dn()){return/iphone|ipad|ipod/i.test(i)||/macintosh/i.test(i)&&/mobile/i.test(i)}function bk(i=Dn()){return cv(i)&&!!window.navigator?.standalone}function Ak(){return PI()&&document.documentMode===10}function CS(i=Dn()){return cv(i)||SS(i)||xS(i)||TS(i)||/windows phone/i.test(i)||ES(i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RS(i,t=[]){let e;switch(i){case"Browser":e=Zw(Dn());break;case"Worker":e=`${Zw(Dn())}-${i}`;break;default:e=i}const n=t.length?t.join(","):"FirebaseCore-web";return`${e}/JsCore/${To}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const n=o=>new Promise((l,u)=>{try{const h=t(o);l(h)}catch(h){u(h)}});n.onAbort=e,this.queue.push(n);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const e=[];try{for(const n of this.queue)await n(t),n.onAbort&&e.push(n.onAbort)}catch(n){e.reverse();for(const s of e)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ek(i,t={}){return ba(i,"GET","/v2/passwordPolicy",_a(i,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sk=6;class Tk{constructor(t){const e=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=e.minPasswordLength??Sk,e.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=e.maxPasswordLength),e.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=e.containsLowercaseCharacter),e.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=e.containsUppercaseCharacter),e.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=e.containsNumericCharacter),e.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=e.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=t.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=t.forceUpgradeOnSignin??!1,this.schemaVersion=t.schemaVersion}validatePassword(t){const e={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,e),this.validatePasswordCharacterOptions(t,e),e.isValid&&(e.isValid=e.meetsMinPasswordLength??!0),e.isValid&&(e.isValid=e.meetsMaxPasswordLength??!0),e.isValid&&(e.isValid=e.containsLowercaseLetter??!0),e.isValid&&(e.isValid=e.containsUppercaseLetter??!0),e.isValid&&(e.isValid=e.containsNumericCharacter??!0),e.isValid&&(e.isValid=e.containsNonAlphanumericCharacter??!0),e}validatePasswordLengthOptions(t,e){const n=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;n&&(e.meetsMinPasswordLength=t.length>=n),s&&(e.meetsMaxPasswordLength=t.length<=s)}validatePasswordCharacterOptions(t,e){this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);let n;for(let s=0;s<t.length;s++)n=t.charAt(s),this.updatePasswordCharacterOptionsStatuses(e,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(t,e,n,s,o){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xk{constructor(t,e,n,s){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=n,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new tE(this),this.idTokenSubscription=new tE(this),this.beforeStateQueue=new wk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=pS,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=ur(e)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Ll.create(this,t),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(e),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const e=await Sf(this,{idToken:t}),n=await Ks._fromGetAccountInfoResponse(this,e,t);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){if(Jn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const e=await this.assertedPersistence.getCurrentUser();let n=e,s=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,l=n?._redirectEventId,u=await this.tryRedirectSignIn(t);(!o||o===l)&&u?.user&&(n=u.user,s=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(n)}catch(o){n=e,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return Dt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await Tf(t)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=ik()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Jn(this.app))return Promise.reject(dr(this));const e=t?ze(t):null;return e&&Dt(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&Dt(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Jn(this.app)?Promise.reject(dr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Jn(this.app)?Promise.reject(dr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ur(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await Ek(this),e=new Tk(t);this.tenantId===null?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(t){this._errorFactory=new Qu("auth","Firebase",t())}onAuthStateChanged(t,e,n){return this.registerStateListener(this.authStateSubscription,t,e,n)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,n){return this.registerStateListener(this.idTokenSubscription,t,e,n)}authStateReady(){return new Promise((t,e)=>{if(this.currentUser)t();else{const n=this.onAuthStateChanged(()=>{n(),t()},e)}})}async revokeAccessToken(t){if(this.currentUser){const e=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:e};this.tenantId!=null&&(n.tenantId=this.tenantId),await _k(this,n)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(t,e){const n=await this.getOrInitRedirectPersistenceManager(e);return t===null?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&ur(t)||this._popupRedirectResolver;Dt(e,this,"argument-error"),this.redirectPersistenceManager=await Ll.create(this,[ur(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===t?this._currentUser:this.redirectUser?._redirectEventId===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const t=this.currentUser?.uid??null;this.lastNotifiedUid!==t&&(this.lastNotifiedUid=t,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,n,s){if(this._deleted)return()=>{};const o=typeof e=="function"?e:e.next.bind(e);let l=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(Dt(u,this,"internal-error"),u.then(()=>{l||o(this.currentUser)}),typeof e=="function"){const h=t.addObserver(e,n,s);return()=>{l=!0,h()}}else{const h=t.addObserver(e);return()=>{l=!0,h()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Dt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=RS(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const e=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();e&&(t["X-Firebase-Client"]=e);const n=await this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t}async _getAppCheckToken(){if(Jn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return t?.error&&tk(`Error while retrieving App Check token: ${t.error}`),t?.token}}function Aa(i){return ze(i)}class tE{constructor(t){this.auth=t,this.observer=null,this.addObserver=zI(e=>this.observer=e)}get next(){return Dt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Ck(i){Xf=i}function IS(i){return Xf.loadJS(i)}function Rk(){return Xf.recaptchaEnterpriseScript}function Ik(){return Xf.gapiScript}function Nk(i){return`__${i}${Math.floor(Math.random()*1e6)}`}class kk{constructor(){this.enterprise=new Mk}ready(t){t()}execute(t,e){return Promise.resolve("token")}render(t,e){return""}}class Mk{ready(t){t()}execute(t,e){return Promise.resolve("token")}render(t,e){return""}}const Dk="recaptcha-enterprise",NS="NO_RECAPTCHA";class Pk{constructor(t){this.type=Dk,this.auth=Aa(t)}async verify(t="verify",e=!1){async function n(o){if(!e){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(l,u)=>{hk(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{const f=new uk(h);return o.tenantId==null?o._agentRecaptchaConfig=f:o._tenantRecaptchaConfigs[o.tenantId]=f,l(f.siteKey)}}).catch(h=>{u(h)})})}function s(o,l,u){const h=window.grecaptcha;Yw(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:t}).then(f=>{l(f)}).catch(()=>{l(NS)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new kk().execute("siteKey",{action:"verify"}):new Promise((o,l)=>{n(this.auth).then(u=>{if(!e&&Yw(window.grecaptcha))s(u,o,l);else{if(typeof window>"u"){l(new Error("RecaptchaVerifier is only supported in browser"));return}let h=Rk();h.length!==0&&(h+=u),IS(h).then(()=>{s(u,o,l)}).catch(f=>{l(f)})}}).catch(u=>{l(u)})})}}async function eE(i,t,e,n=!1,s=!1){const o=new Pk(i);let l;if(s)l=NS;else try{l=await o.verify(e)}catch{l=await o.verify(e,!0)}const u={...t};if(e==="mfaSmsEnrollment"||e==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){const h=u.phoneEnrollmentInfo.phoneNumber,f=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:f,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){const h=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return n?Object.assign(u,{captchaResp:l}):Object.assign(u,{captchaResponse:l}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u}async function fy(i,t,e,n,s){if(i._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await eE(i,t,e,e==="getOobCode");return n(i,o)}else return n(i,t).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${e} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await eE(i,t,e,e==="getOobCode");return n(i,l)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lk(i,t){const e=Yf(i,"auth");if(e.isInitialized()){const s=e.getImmediate(),o=e.getOptions();if(po(o,t??{}))return s;Os(s,"already-initialized")}return e.initialize({options:t})}function Ok(i,t){const e=t?.persistence||[],n=(Array.isArray(e)?e:[e]).map(ur);t?.errorMap&&i._updateErrorMap(t.errorMap),i._initializeWithPersistence(n,t?.popupRedirectResolver)}function jk(i,t,e){const n=Aa(i);Dt(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const s=!1,o=kS(t),{host:l,port:u}=Vk(t),h=u===null?"":`:${u}`,f={url:`${o}//${l}${h}/`},m=Object.freeze({host:l,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!n._canInitEmulator){Dt(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),Dt(po(f,n.config.emulator)&&po(m,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=f,n.emulatorConfig=m,n.settings.appVerificationDisabledForTesting=!0,So(l)?(tv(`${o}//${l}${h}`),ev("Auth",!0)):Uk()}function kS(i){const t=i.indexOf(":");return t<0?"":i.substr(0,t+1)}function Vk(i){const t=kS(i),e=/(\/\/)?([^?#/]+)/.exec(i.substr(t.length));if(!e)return{host:"",port:null};const n=e[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(n);if(s){const o=s[1];return{host:o,port:nE(n.substr(o.length+1))}}else{const[o,l]=n.split(":");return{host:o,port:nE(l)}}}function nE(i){if(!i)return null;const t=Number(i);return isNaN(t)?null:t}function Uk(){function i(){const t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",i):i())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return cr("not implemented")}_getIdTokenResponse(t){return cr("not implemented")}_linkToIdToken(t,e){return cr("not implemented")}_getReauthenticationResolver(t){return cr("not implemented")}}async function Fk(i,t){return ba(i,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bk(i,t){return th(i,"POST","/v1/accounts:signInWithPassword",_a(i,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zk(i,t){return th(i,"POST","/v1/accounts:signInWithEmailLink",_a(i,t))}async function Hk(i,t){return th(i,"POST","/v1/accounts:signInWithEmailLink",_a(i,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vu extends uv{constructor(t,e,n,s=null){super("password",n),this._email=t,this._password=e,this._tenantId=s}static _fromEmailAndPassword(t,e){return new Vu(t,e,"password")}static _fromEmailAndCode(t,e,n=null){return new Vu(t,e,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e=typeof t=="string"?JSON.parse(t):t;if(e?.email&&e?.password){if(e.signInMethod==="password")return this._fromEmailAndPassword(e.email,e.password);if(e.signInMethod==="emailLink")return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const e={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return fy(t,e,"signInWithPassword",Bk);case"emailLink":return zk(t,{email:this._email,oobCode:this._password});default:Os(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":const n={idToken:e,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return fy(t,n,"signUpPassword",Fk);case"emailLink":return Hk(t,{idToken:e,email:this._email,oobCode:this._password});default:Os(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ol(i,t){return th(i,"POST","/v1/accounts:signInWithIdp",_a(i,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gk="http://localhost";class go extends uv{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new go(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):Os("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e=typeof t=="string"?JSON.parse(t):t,{providerId:n,signInMethod:s,...o}=e;if(!n||!s)return null;const l=new go(n,s);return l.idToken=o.idToken||void 0,l.accessToken=o.accessToken||void 0,l.secret=o.secret,l.nonce=o.nonce,l.pendingToken=o.pendingToken||null,l}_getIdTokenResponse(t){const e=this.buildRequest();return Ol(t,e)}_linkToIdToken(t,e){const n=this.buildRequest();return n.idToken=e,Ol(t,n)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,Ol(t,e)}buildRequest(){const t={requestUri:Gk,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=Ju(e)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qk(i){switch(i){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function $k(i){const t=vu(_u(i)).link,e=t?vu(_u(t)).deep_link_id:null,n=vu(_u(i)).deep_link_id;return(n?vu(_u(n)).link:null)||n||e||t||i}class hv{constructor(t){const e=vu(_u(t)),n=e.apiKey??null,s=e.oobCode??null,o=qk(e.mode??null);Dt(n&&s&&o,"argument-error"),this.apiKey=n,this.operation=o,this.code=s,this.continueUrl=e.continueUrl??null,this.languageCode=e.lang??null,this.tenantId=e.tenantId??null}static parseLink(t){const e=$k(t);try{return new hv(e)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xl{constructor(){this.providerId=Xl.PROVIDER_ID}static credential(t,e){return Vu._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const n=hv.parseLink(e);return Dt(n,"argument-error"),Vu._fromEmailAndCode(t,n.code,n.tenantId)}}Xl.PROVIDER_ID="password";Xl.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Xl.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dv{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh extends dv{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zr extends eh{constructor(){super("facebook.com")}static credential(t){return go._fromParams({providerId:Zr.PROVIDER_ID,signInMethod:Zr.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Zr.credentialFromTaggedObject(t)}static credentialFromError(t){return Zr.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Zr.credential(t.oauthAccessToken)}catch{return null}}}Zr.FACEBOOK_SIGN_IN_METHOD="facebook.com";Zr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lr extends eh{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return go._fromParams({providerId:lr.PROVIDER_ID,signInMethod:lr.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return lr.credentialFromTaggedObject(t)}static credentialFromError(t){return lr.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:n}=t;if(!e&&!n)return null;try{return lr.credential(e,n)}catch{return null}}}lr.GOOGLE_SIGN_IN_METHOD="google.com";lr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta extends eh{constructor(){super("github.com")}static credential(t){return go._fromParams({providerId:ta.PROVIDER_ID,signInMethod:ta.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return ta.credentialFromTaggedObject(t)}static credentialFromError(t){return ta.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return ta.credential(t.oauthAccessToken)}catch{return null}}}ta.GITHUB_SIGN_IN_METHOD="github.com";ta.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea extends eh{constructor(){super("twitter.com")}static credential(t,e){return go._fromParams({providerId:ea.PROVIDER_ID,signInMethod:ea.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return ea.credentialFromTaggedObject(t)}static credentialFromError(t){return ea.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:n}=t;if(!e||!n)return null;try{return ea.credential(e,n)}catch{return null}}}ea.TWITTER_SIGN_IN_METHOD="twitter.com";ea.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kk(i,t){return th(i,"POST","/v1/accounts:signUp",_a(i,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yo{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,n,s=!1){const o=await Ks._fromIdTokenResponse(t,n,s),l=sE(n);return new yo({user:o,providerId:l,_tokenResponse:n,operationType:e})}static async _forOperation(t,e,n){await t._updateTokensIfNecessary(n,!0);const s=sE(n);return new yo({user:t,providerId:s,_tokenResponse:n,operationType:e})}}function sE(i){return i.providerId?i.providerId:"phoneNumber"in i?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xf extends Mi{constructor(t,e,n,s){super(e.code,e.message),this.operationType=n,this.user=s,Object.setPrototypeOf(this,xf.prototype),this.customData={appName:t.name,tenantId:t.tenantId??void 0,_serverResponse:e.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(t,e,n,s){return new xf(t,e,n,s)}}function MS(i,t,e,n){return(t==="reauthenticate"?e._getReauthenticationResolver(i):e._getIdTokenResponse(i)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?xf._fromErrorAndOperation(i,o,t,n):o})}async function Wk(i,t,e=!1){const n=await ju(i,t._linkToIdToken(i.auth,await i.getIdToken()),e);return yo._forOperation(i,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yk(i,t,e=!1){const{auth:n}=i;if(Jn(n.app))return Promise.reject(dr(n));const s="reauthenticate";try{const o=await ju(i,MS(n,s,t,i),e);Dt(o.idToken,n,"internal-error");const l=lv(o.idToken);Dt(l,n,"internal-error");const{sub:u}=l;return Dt(i.uid===u,n,"user-mismatch"),yo._forOperation(i,s,o)}catch(o){throw o?.code==="auth/user-not-found"&&Os(n,"user-mismatch"),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DS(i,t,e=!1){if(Jn(i.app))return Promise.reject(dr(i));const n="signIn",s=await MS(i,n,t),o=await yo._fromIdTokenResponse(i,n,s);return e||await i._updateCurrentUser(o.user),o}async function Xk(i,t){return DS(Aa(i),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PS(i){const t=Aa(i);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function Qk(i,t,e){if(Jn(i.app))return Promise.reject(dr(i));const n=Aa(i),l=await fy(n,{returnSecureToken:!0,email:t,password:e,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Kk).catch(h=>{throw h.code==="auth/password-does-not-meet-requirements"&&PS(i),h}),u=await yo._fromIdTokenResponse(n,"signIn",l);return await n._updateCurrentUser(u.user),u}function Jk(i,t,e){return Jn(i.app)?Promise.reject(dr(i)):Xk(ze(i),Xl.credential(t,e)).catch(async n=>{throw n.code==="auth/password-does-not-meet-requirements"&&PS(i),n})}function Zk(i,t,e,n){return ze(i).onIdTokenChanged(t,e,n)}function tM(i,t,e){return ze(i).beforeAuthStateChanged(t,e)}function eM(i,t,e,n){return ze(i).onAuthStateChanged(t,e,n)}function nM(i){return ze(i).signOut()}const Cf="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LS{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(Cf,"1"),this.storage.removeItem(Cf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sM=1e3,iM=10;class OS extends LS{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=CS(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const n=this.storage.getItem(e),s=this.localCache[e];n!==s&&t(e,s,n)}}onStorageEvent(t,e=!1){if(!t.key){this.forAllChangedKeys((l,u,h)=>{this.notifyListeners(l,h)});return}const n=t.key;e?this.detachListener():this.stopPolling();const s=()=>{const l=this.storage.getItem(n);!e&&this.localCache[n]===l||this.notifyListeners(n,l)},o=this.storage.getItem(n);Ak()&&o!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,iM):s()}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const s of Array.from(n))s(e&&JSON.parse(e))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,e,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:n}),!0)})},sM)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}OS.type="LOCAL";const rM=OS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jS extends LS{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,e){}_removeListener(t,e){}}jS.type="SESSION";const VS=jS;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aM(i){return Promise.all(i.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(e){return{fulfilled:!1,reason:e}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find(s=>s.isListeningto(t));if(e)return e;const n=new Qf(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:n,eventType:s,data:o}=e.data,l=this.handlersMap[s];if(!l?.size)return;e.ports[0].postMessage({status:"ack",eventId:n,eventType:s});const u=Array.from(l).map(async f=>f(e.origin,o)),h=await aM(u);e.ports[0].postMessage({status:"done",eventId:n,eventType:s,response:h})}_subscribe(t,e){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),(!e||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Qf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fv(i="",t=10){let e="";for(let n=0;n<t;n++)e+=Math.floor(Math.random()*10);return i+e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oM{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,n=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,l;return new Promise((u,h)=>{const f=fv("",20);s.port1.start();const m=setTimeout(()=>{h(new Error("unsupported_event"))},n);l={messageChannel:s,onMessage(v){const b=v;if(b.data.eventId===f)switch(b.data.status){case"ack":clearTimeout(m),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(b.data.response);break;default:clearTimeout(m),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(l),s.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:t,eventId:f,data:e},[s.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xi(){return window}function lM(i){xi().location.href=i}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function US(){return typeof xi().WorkerGlobalScope<"u"&&typeof xi().importScripts=="function"}async function cM(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function uM(){return navigator?.serviceWorker?.controller||null}function hM(){return US()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FS="firebaseLocalStorageDb",dM=1,Rf="firebaseLocalStorage",BS="fbase_key";class nh{constructor(t){this.request=t}toPromise(){return new Promise((t,e)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{e(this.request.error)})})}}function Jf(i,t){return i.transaction([Rf],t?"readwrite":"readonly").objectStore(Rf)}function fM(){const i=indexedDB.deleteDatabase(FS);return new nh(i).toPromise()}function py(){const i=indexedDB.open(FS,dM);return new Promise((t,e)=>{i.addEventListener("error",()=>{e(i.error)}),i.addEventListener("upgradeneeded",()=>{const n=i.result;try{n.createObjectStore(Rf,{keyPath:BS})}catch(s){e(s)}}),i.addEventListener("success",async()=>{const n=i.result;n.objectStoreNames.contains(Rf)?t(n):(n.close(),await fM(),t(await py()))})})}async function iE(i,t,e){const n=Jf(i,!0).put({[BS]:t,value:e});return new nh(n).toPromise()}async function pM(i,t){const e=Jf(i,!1).get(t),n=await new nh(e).toPromise();return n===void 0?null:n.value}function rE(i,t){const e=Jf(i,!0).delete(t);return new nh(e).toPromise()}const mM=800,gM=3;class zS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await py(),this.db)}async _withRetries(t){let e=0;for(;;)try{const n=await this._openDb();return await t(n)}catch(n){if(e++>gM)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return US()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Qf._getInstance(hM()),this.receiver._subscribe("keyChanged",async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)})),this.receiver._subscribe("ping",async(t,e)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await cM(),!this.activeServiceWorker)return;this.sender=new oM(this.activeServiceWorker);const t=await this.sender._send("ping",{},800);t&&t[0]?.fulfilled&&t[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||uM()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await py();return await iE(t,Cf,"1"),await rE(t,Cf),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite(async()=>(await this._withRetries(n=>iE(n,t,e)),this.localCache[t]=e,this.notifyServiceWorker(t)))}async _get(t){const e=await this._withRetries(n=>pM(n,t));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>rE(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(s=>{const o=Jf(s,!1).getAll();return new nh(o).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const e=[],n=new Set;if(t.length!==0)for(const{fbase_key:s,value:o}of t)n.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),e.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!n.has(s)&&(this.notifyListeners(s,null),e.push(s));return e}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const s of Array.from(n))s(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),mM)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}zS.type="LOCAL";const yM=zS;new Zu(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HS(i,t){return t?ur(t):(Dt(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pv extends uv{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return Ol(t,this._buildIdpRequest())}_linkToIdToken(t,e){return Ol(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return Ol(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function vM(i){return DS(i.auth,new pv(i),i.bypassAuthState)}function _M(i){const{auth:t,user:e}=i;return Dt(e,t,"internal-error"),Yk(e,new pv(i),i.bypassAuthState)}async function bM(i){const{auth:t,user:e}=i;return Dt(e,t,"internal-error"),Wk(e,new pv(i),i.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GS{constructor(t,e,n,s,o=!1){this.auth=t,this.resolver=n,this.user=s,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise(async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(t){const{urlResponse:e,sessionId:n,postBody:s,tenantId:o,error:l,type:u}=t;if(l){this.reject(l);return}const h={auth:this.auth,requestUri:e,sessionId:n,tenantId:o||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(h))}catch(f){this.reject(f)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return vM;case"linkViaPopup":case"linkViaRedirect":return bM;case"reauthViaPopup":case"reauthViaRedirect":return _M;default:Os(this.auth,"internal-error")}}resolve(t){yr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){yr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AM=new Zu(2e3,1e4);async function wM(i,t,e){if(Jn(i.app))return Promise.reject(Ys(i,"operation-not-supported-in-this-environment"));const n=Aa(i);ek(i,t,dv);const s=HS(n,e);return new ao(n,"signInViaPopup",t,s).executeNotNull()}class ao extends GS{constructor(t,e,n,s,o){super(t,e,s,o),this.provider=n,this.authWindow=null,this.pollId=null,ao.currentPopupAction&&ao.currentPopupAction.cancel(),ao.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Dt(t,this.auth,"internal-error"),t}async onExecution(){yr(this.filter.length===1,"Popup operations only handle one event");const t=fv();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Ys(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Ys(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ao.currentPopupAction=null}pollUserCancellation(){const t=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ys(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,AM.get())};t()}}ao.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EM="pendingRedirect",cf=new Map;class SM extends GS{constructor(t,e,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,n),this.eventId=null}async execute(){let t=cf.get(this.auth._key());if(!t){try{const n=await TM(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(n)}catch(e){t=()=>Promise.reject(e)}cf.set(this.auth._key(),t)}return this.bypassAuthState||cf.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function TM(i,t){const e=RM(t),n=CM(i);if(!await n._isAvailable())return!1;const s=await n._get(e)==="true";return await n._remove(e),s}function xM(i,t){cf.set(i._key(),t)}function CM(i){return ur(i._redirectPersistence)}function RM(i){return lf(EM,i.config.apiKey,i.name)}async function IM(i,t,e=!1){if(Jn(i.app))return Promise.reject(dr(i));const n=Aa(i),s=HS(n,t),l=await new SM(n,s,e).execute();return l&&!e&&(delete l.user._redirectEventId,await n._persistUserIfCurrent(l.user),await n._setRedirectUser(null,t)),l}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NM=600*1e3;class kM{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(t,n)&&(e=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!MM(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){if(t.error&&!qS(t)){const n=t.error.code?.split("auth/")[1]||"internal-error";e.onError(Ys(this.auth,n))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const n=e.eventId===null||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=NM&&this.cachedEventUids.clear(),this.cachedEventUids.has(aE(t))}saveEventToCache(t){this.cachedEventUids.add(aE(t)),this.lastProcessedEventTime=Date.now()}}function aE(i){return[i.type,i.eventId,i.sessionId,i.tenantId].filter(t=>t).join("-")}function qS({type:i,error:t}){return i==="unknown"&&t?.code==="auth/no-auth-event"}function MM(i){switch(i.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return qS(i);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DM(i,t={}){return ba(i,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PM=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,LM=/^https?/;async function OM(i){if(i.config.emulator)return;const{authorizedDomains:t}=await DM(i);for(const e of t)try{if(jM(e))return}catch{}Os(i,"unauthorized-domain")}function jM(i){const t=hy(),{protocol:e,hostname:n}=new URL(t);if(i.startsWith("chrome-extension://")){const l=new URL(i);return l.hostname===""&&n===""?e==="chrome-extension:"&&i.replace("chrome-extension://","")===t.replace("chrome-extension://",""):e==="chrome-extension:"&&l.hostname===n}if(!LM.test(e))return!1;if(PM.test(i))return n===i;const s=i.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VM=new Zu(3e4,6e4);function oE(){const i=xi().___jsl;if(i?.H){for(const t of Object.keys(i.H))if(i.H[t].r=i.H[t].r||[],i.H[t].L=i.H[t].L||[],i.H[t].r=[...i.H[t].L],i.CP)for(let e=0;e<i.CP.length;e++)i.CP[e]=null}}function UM(i){return new Promise((t,e)=>{function n(){oE(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{oE(),e(Ys(i,"network-request-failed"))},timeout:VM.get()})}if(xi().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(xi().gapi?.load)n();else{const s=Nk("iframefcb");return xi()[s]=()=>{gapi.load?n():e(Ys(i,"network-request-failed"))},IS(`${Ik()}?onload=${s}`).catch(o=>e(o))}}).catch(t=>{throw uf=null,t})}let uf=null;function FM(i){return uf=uf||UM(i),uf}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BM=new Zu(5e3,15e3),zM="__/auth/iframe",HM="emulator/auth/iframe",GM={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},qM=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function $M(i){const t=i.config;Dt(t.authDomain,i,"auth-domain-config-required");const e=t.emulator?ov(t,HM):`https://${i.config.authDomain}/${zM}`,n={apiKey:t.apiKey,appName:i.name,v:To},s=qM.get(i.config.apiHost);s&&(n.eid=s);const o=i._getFrameworks();return o.length&&(n.fw=o.join(",")),`${e}?${Ju(n).slice(1)}`}async function KM(i){const t=await FM(i),e=xi().gapi;return Dt(e,i,"internal-error"),t.open({where:document.body,url:$M(i),messageHandlersFilter:e.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:GM,dontclear:!0},n=>new Promise(async(s,o)=>{await n.restyle({setHideOnLeave:!1});const l=Ys(i,"network-request-failed"),u=xi().setTimeout(()=>{o(l)},BM.get());function h(){xi().clearTimeout(u),s(n)}n.ping(h).then(h,()=>{o(l)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WM={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},YM=500,XM=600,QM="_blank",JM="http://localhost";class lE{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function ZM(i,t,e,n=YM,s=XM){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),l=Math.max((window.screen.availWidth-n)/2,0).toString();let u="";const h={...WM,width:n.toString(),height:s.toString(),top:o,left:l},f=Dn().toLowerCase();e&&(u=wS(f)?QM:e),bS(f)&&(t=t||JM,h.scrollbars="yes");const m=Object.entries(h).reduce((b,[A,S])=>`${b}${A}=${S},`,"");if(bk(f)&&u!=="_self")return tD(t||"",u),new lE(null);const v=window.open(t||"",u,m);Dt(v,i,"popup-blocked");try{v.focus()}catch{}return new lE(v)}function tD(i,t){const e=document.createElement("a");e.href=i,e.target=t;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eD="__/auth/handler",nD="emulator/auth/handler",sD=encodeURIComponent("fac");async function cE(i,t,e,n,s,o){Dt(i.config.authDomain,i,"auth-domain-config-required"),Dt(i.config.apiKey,i,"invalid-api-key");const l={apiKey:i.config.apiKey,appName:i.name,authType:e,redirectUrl:n,v:To,eventId:s};if(t instanceof dv){t.setDefaultLanguage(i.languageCode),l.providerId=t.providerId||"",BI(t.getCustomParameters())||(l.customParameters=JSON.stringify(t.getCustomParameters()));for(const[m,v]of Object.entries({}))l[m]=v}if(t instanceof eh){const m=t.getScopes().filter(v=>v!=="");m.length>0&&(l.scopes=m.join(","))}i.tenantId&&(l.tid=i.tenantId);const u=l;for(const m of Object.keys(u))u[m]===void 0&&delete u[m];const h=await i._getAppCheckToken(),f=h?`#${sD}=${encodeURIComponent(h)}`:"";return`${iD(i)}?${Ju(u).slice(1)}${f}`}function iD({config:i}){return i.emulator?ov(i,nD):`https://${i.authDomain}/${eD}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fg="webStorageSupport";class rD{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=VS,this._completeRedirectFn=IM,this._overrideRedirectResult=xM}async _openPopup(t,e,n,s){yr(this.eventManagers[t._key()]?.manager,"_initialize() not called before _openPopup()");const o=await cE(t,e,n,hy(),s);return ZM(t,o,fv())}async _openRedirect(t,e,n,s){await this._originValidation(t);const o=await cE(t,e,n,hy(),s);return lM(o),new Promise(()=>{})}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:s,promise:o}=this.eventManagers[e];return s?Promise.resolve(s):(yr(o,"If manager is not set, promise should be"),o)}const n=this.initAndGetManager(t);return this.eventManagers[e]={promise:n},n.catch(()=>{delete this.eventManagers[e]}),n}async initAndGetManager(t){const e=await KM(t),n=new kM(t);return e.register("authEvent",s=>(Dt(s?.authEvent,t,"invalid-auth-event"),{status:n.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(Fg,{type:Fg},s=>{const o=s?.[0]?.[Fg];o!==void 0&&e(!!o),Os(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=OM(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return CS()||AS()||cv()}}const aD=rD;var uE="@firebase/auth",hE="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oD{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged(n=>{t(n?.stsTokenManager.accessToken||null)});this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){Dt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lD(i){switch(i){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function cD(i){mo(new ca("auth",(t,{options:e})=>{const n=t.getProvider("app").getImmediate(),s=t.getProvider("heartbeat"),o=t.getProvider("app-check-internal"),{apiKey:l,authDomain:u}=n.options;Dt(l&&!l.includes(":"),"invalid-api-key",{appName:n.name});const h={apiKey:l,authDomain:u,clientPlatform:i,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:RS(i)},f=new xk(n,s,o,h);return Ok(f,e),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,n)=>{t.getProvider("auth-internal").initialize()})),mo(new ca("auth-internal",t=>{const e=Aa(t.getProvider("auth").getImmediate());return(n=>new oD(n))(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ti(uE,hE,lD(i)),Ti(uE,hE,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uD=300,hD=aS("authIdTokenMaxAge")||uD;let dE=null;const dD=i=>async t=>{const e=t&&await t.getIdTokenResult(),n=e&&(new Date().getTime()-Date.parse(e.issuedAtTime))/1e3;if(n&&n>hD)return;const s=e?.token;dE!==s&&(dE=s,await fetch(i,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function fD(i=iv()){const t=Yf(i,"auth");if(t.isInitialized())return t.getImmediate();const e=Lk(i,{popupRedirectResolver:aD,persistence:[yM,rM,VS]}),n=aS("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(n,location.origin);if(location.origin===o.origin){const l=dD(o.toString());tM(e,l,()=>l(e.currentUser)),Zk(e,u=>l(u))}}const s=sS("auth");return s&&jk(e,`http://${s}`),e}function pD(){return document.getElementsByTagName("head")?.[0]??document}Ck({loadJS(i){return new Promise((t,e)=>{const n=document.createElement("script");n.setAttribute("src",i),n.onload=t,n.onerror=s=>{const o=Ys("internal-error");o.customData=s,e(o)},n.type="text/javascript",n.charset="UTF-8",pD().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});cD("Browser");var mD="firebase",gD="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ti(mD,gD,"app");var fE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var oa,$S;(function(){var i;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(I,N){function M(){}M.prototype=N.prototype,I.D=N.prototype,I.prototype=new M,I.prototype.constructor=I,I.C=function(j,F,z){for(var U=Array(arguments.length-2),st=2;st<arguments.length;st++)U[st-2]=arguments[st];return N.prototype[F].apply(j,U)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,N,M){M||(M=0);var j=Array(16);if(typeof N=="string")for(var F=0;16>F;++F)j[F]=N.charCodeAt(M++)|N.charCodeAt(M++)<<8|N.charCodeAt(M++)<<16|N.charCodeAt(M++)<<24;else for(F=0;16>F;++F)j[F]=N[M++]|N[M++]<<8|N[M++]<<16|N[M++]<<24;N=I.g[0],M=I.g[1],F=I.g[2];var z=I.g[3],U=N+(z^M&(F^z))+j[0]+3614090360&4294967295;N=M+(U<<7&4294967295|U>>>25),U=z+(F^N&(M^F))+j[1]+3905402710&4294967295,z=N+(U<<12&4294967295|U>>>20),U=F+(M^z&(N^M))+j[2]+606105819&4294967295,F=z+(U<<17&4294967295|U>>>15),U=M+(N^F&(z^N))+j[3]+3250441966&4294967295,M=F+(U<<22&4294967295|U>>>10),U=N+(z^M&(F^z))+j[4]+4118548399&4294967295,N=M+(U<<7&4294967295|U>>>25),U=z+(F^N&(M^F))+j[5]+1200080426&4294967295,z=N+(U<<12&4294967295|U>>>20),U=F+(M^z&(N^M))+j[6]+2821735955&4294967295,F=z+(U<<17&4294967295|U>>>15),U=M+(N^F&(z^N))+j[7]+4249261313&4294967295,M=F+(U<<22&4294967295|U>>>10),U=N+(z^M&(F^z))+j[8]+1770035416&4294967295,N=M+(U<<7&4294967295|U>>>25),U=z+(F^N&(M^F))+j[9]+2336552879&4294967295,z=N+(U<<12&4294967295|U>>>20),U=F+(M^z&(N^M))+j[10]+4294925233&4294967295,F=z+(U<<17&4294967295|U>>>15),U=M+(N^F&(z^N))+j[11]+2304563134&4294967295,M=F+(U<<22&4294967295|U>>>10),U=N+(z^M&(F^z))+j[12]+1804603682&4294967295,N=M+(U<<7&4294967295|U>>>25),U=z+(F^N&(M^F))+j[13]+4254626195&4294967295,z=N+(U<<12&4294967295|U>>>20),U=F+(M^z&(N^M))+j[14]+2792965006&4294967295,F=z+(U<<17&4294967295|U>>>15),U=M+(N^F&(z^N))+j[15]+1236535329&4294967295,M=F+(U<<22&4294967295|U>>>10),U=N+(F^z&(M^F))+j[1]+4129170786&4294967295,N=M+(U<<5&4294967295|U>>>27),U=z+(M^F&(N^M))+j[6]+3225465664&4294967295,z=N+(U<<9&4294967295|U>>>23),U=F+(N^M&(z^N))+j[11]+643717713&4294967295,F=z+(U<<14&4294967295|U>>>18),U=M+(z^N&(F^z))+j[0]+3921069994&4294967295,M=F+(U<<20&4294967295|U>>>12),U=N+(F^z&(M^F))+j[5]+3593408605&4294967295,N=M+(U<<5&4294967295|U>>>27),U=z+(M^F&(N^M))+j[10]+38016083&4294967295,z=N+(U<<9&4294967295|U>>>23),U=F+(N^M&(z^N))+j[15]+3634488961&4294967295,F=z+(U<<14&4294967295|U>>>18),U=M+(z^N&(F^z))+j[4]+3889429448&4294967295,M=F+(U<<20&4294967295|U>>>12),U=N+(F^z&(M^F))+j[9]+568446438&4294967295,N=M+(U<<5&4294967295|U>>>27),U=z+(M^F&(N^M))+j[14]+3275163606&4294967295,z=N+(U<<9&4294967295|U>>>23),U=F+(N^M&(z^N))+j[3]+4107603335&4294967295,F=z+(U<<14&4294967295|U>>>18),U=M+(z^N&(F^z))+j[8]+1163531501&4294967295,M=F+(U<<20&4294967295|U>>>12),U=N+(F^z&(M^F))+j[13]+2850285829&4294967295,N=M+(U<<5&4294967295|U>>>27),U=z+(M^F&(N^M))+j[2]+4243563512&4294967295,z=N+(U<<9&4294967295|U>>>23),U=F+(N^M&(z^N))+j[7]+1735328473&4294967295,F=z+(U<<14&4294967295|U>>>18),U=M+(z^N&(F^z))+j[12]+2368359562&4294967295,M=F+(U<<20&4294967295|U>>>12),U=N+(M^F^z)+j[5]+4294588738&4294967295,N=M+(U<<4&4294967295|U>>>28),U=z+(N^M^F)+j[8]+2272392833&4294967295,z=N+(U<<11&4294967295|U>>>21),U=F+(z^N^M)+j[11]+1839030562&4294967295,F=z+(U<<16&4294967295|U>>>16),U=M+(F^z^N)+j[14]+4259657740&4294967295,M=F+(U<<23&4294967295|U>>>9),U=N+(M^F^z)+j[1]+2763975236&4294967295,N=M+(U<<4&4294967295|U>>>28),U=z+(N^M^F)+j[4]+1272893353&4294967295,z=N+(U<<11&4294967295|U>>>21),U=F+(z^N^M)+j[7]+4139469664&4294967295,F=z+(U<<16&4294967295|U>>>16),U=M+(F^z^N)+j[10]+3200236656&4294967295,M=F+(U<<23&4294967295|U>>>9),U=N+(M^F^z)+j[13]+681279174&4294967295,N=M+(U<<4&4294967295|U>>>28),U=z+(N^M^F)+j[0]+3936430074&4294967295,z=N+(U<<11&4294967295|U>>>21),U=F+(z^N^M)+j[3]+3572445317&4294967295,F=z+(U<<16&4294967295|U>>>16),U=M+(F^z^N)+j[6]+76029189&4294967295,M=F+(U<<23&4294967295|U>>>9),U=N+(M^F^z)+j[9]+3654602809&4294967295,N=M+(U<<4&4294967295|U>>>28),U=z+(N^M^F)+j[12]+3873151461&4294967295,z=N+(U<<11&4294967295|U>>>21),U=F+(z^N^M)+j[15]+530742520&4294967295,F=z+(U<<16&4294967295|U>>>16),U=M+(F^z^N)+j[2]+3299628645&4294967295,M=F+(U<<23&4294967295|U>>>9),U=N+(F^(M|~z))+j[0]+4096336452&4294967295,N=M+(U<<6&4294967295|U>>>26),U=z+(M^(N|~F))+j[7]+1126891415&4294967295,z=N+(U<<10&4294967295|U>>>22),U=F+(N^(z|~M))+j[14]+2878612391&4294967295,F=z+(U<<15&4294967295|U>>>17),U=M+(z^(F|~N))+j[5]+4237533241&4294967295,M=F+(U<<21&4294967295|U>>>11),U=N+(F^(M|~z))+j[12]+1700485571&4294967295,N=M+(U<<6&4294967295|U>>>26),U=z+(M^(N|~F))+j[3]+2399980690&4294967295,z=N+(U<<10&4294967295|U>>>22),U=F+(N^(z|~M))+j[10]+4293915773&4294967295,F=z+(U<<15&4294967295|U>>>17),U=M+(z^(F|~N))+j[1]+2240044497&4294967295,M=F+(U<<21&4294967295|U>>>11),U=N+(F^(M|~z))+j[8]+1873313359&4294967295,N=M+(U<<6&4294967295|U>>>26),U=z+(M^(N|~F))+j[15]+4264355552&4294967295,z=N+(U<<10&4294967295|U>>>22),U=F+(N^(z|~M))+j[6]+2734768916&4294967295,F=z+(U<<15&4294967295|U>>>17),U=M+(z^(F|~N))+j[13]+1309151649&4294967295,M=F+(U<<21&4294967295|U>>>11),U=N+(F^(M|~z))+j[4]+4149444226&4294967295,N=M+(U<<6&4294967295|U>>>26),U=z+(M^(N|~F))+j[11]+3174756917&4294967295,z=N+(U<<10&4294967295|U>>>22),U=F+(N^(z|~M))+j[2]+718787259&4294967295,F=z+(U<<15&4294967295|U>>>17),U=M+(z^(F|~N))+j[9]+3951481745&4294967295,I.g[0]=I.g[0]+N&4294967295,I.g[1]=I.g[1]+(F+(U<<21&4294967295|U>>>11))&4294967295,I.g[2]=I.g[2]+F&4294967295,I.g[3]=I.g[3]+z&4294967295}n.prototype.u=function(I,N){N===void 0&&(N=I.length);for(var M=N-this.blockSize,j=this.B,F=this.h,z=0;z<N;){if(F==0)for(;z<=M;)s(this,I,z),z+=this.blockSize;if(typeof I=="string"){for(;z<N;)if(j[F++]=I.charCodeAt(z++),F==this.blockSize){s(this,j),F=0;break}}else for(;z<N;)if(j[F++]=I[z++],F==this.blockSize){s(this,j),F=0;break}}this.h=F,this.o+=N},n.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var N=1;N<I.length-8;++N)I[N]=0;var M=8*this.o;for(N=I.length-8;N<I.length;++N)I[N]=M&255,M/=256;for(this.u(I),I=Array(16),N=M=0;4>N;++N)for(var j=0;32>j;j+=8)I[M++]=this.g[N]>>>j&255;return I};function o(I,N){var M=u;return Object.prototype.hasOwnProperty.call(M,I)?M[I]:M[I]=N(I)}function l(I,N){this.h=N;for(var M=[],j=!0,F=I.length-1;0<=F;F--){var z=I[F]|0;j&&z==N||(M[F]=z,j=!1)}this.g=M}var u={};function h(I){return-128<=I&&128>I?o(I,function(N){return new l([N|0],0>N?-1:0)}):new l([I|0],0>I?-1:0)}function f(I){if(isNaN(I)||!isFinite(I))return v;if(0>I)return T(f(-I));for(var N=[],M=1,j=0;I>=M;j++)N[j]=I/M|0,M*=4294967296;return new l(N,0)}function m(I,N){if(I.length==0)throw Error("number format error: empty string");if(N=N||10,2>N||36<N)throw Error("radix out of range: "+N);if(I.charAt(0)=="-")return T(m(I.substring(1),N));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var M=f(Math.pow(N,8)),j=v,F=0;F<I.length;F+=8){var z=Math.min(8,I.length-F),U=parseInt(I.substring(F,F+z),N);8>z?(z=f(Math.pow(N,z)),j=j.j(z).add(f(U))):(j=j.j(M),j=j.add(f(U)))}return j}var v=h(0),b=h(1),A=h(16777216);i=l.prototype,i.m=function(){if(E(this))return-T(this).m();for(var I=0,N=1,M=0;M<this.g.length;M++){var j=this.i(M);I+=(0<=j?j:4294967296+j)*N,N*=4294967296}return I},i.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(S(this))return"0";if(E(this))return"-"+T(this).toString(I);for(var N=f(Math.pow(I,6)),M=this,j="";;){var F=V(M,N).g;M=C(M,F.j(N));var z=((0<M.g.length?M.g[0]:M.h)>>>0).toString(I);if(M=F,S(M))return z+j;for(;6>z.length;)z="0"+z;j=z+j}},i.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function S(I){if(I.h!=0)return!1;for(var N=0;N<I.g.length;N++)if(I.g[N]!=0)return!1;return!0}function E(I){return I.h==-1}i.l=function(I){return I=C(this,I),E(I)?-1:S(I)?0:1};function T(I){for(var N=I.g.length,M=[],j=0;j<N;j++)M[j]=~I.g[j];return new l(M,~I.h).add(b)}i.abs=function(){return E(this)?T(this):this},i.add=function(I){for(var N=Math.max(this.g.length,I.g.length),M=[],j=0,F=0;F<=N;F++){var z=j+(this.i(F)&65535)+(I.i(F)&65535),U=(z>>>16)+(this.i(F)>>>16)+(I.i(F)>>>16);j=U>>>16,z&=65535,U&=65535,M[F]=U<<16|z}return new l(M,M[M.length-1]&-2147483648?-1:0)};function C(I,N){return I.add(T(N))}i.j=function(I){if(S(this)||S(I))return v;if(E(this))return E(I)?T(this).j(T(I)):T(T(this).j(I));if(E(I))return T(this.j(T(I)));if(0>this.l(A)&&0>I.l(A))return f(this.m()*I.m());for(var N=this.g.length+I.g.length,M=[],j=0;j<2*N;j++)M[j]=0;for(j=0;j<this.g.length;j++)for(var F=0;F<I.g.length;F++){var z=this.i(j)>>>16,U=this.i(j)&65535,st=I.i(F)>>>16,dt=I.i(F)&65535;M[2*j+2*F]+=U*dt,L(M,2*j+2*F),M[2*j+2*F+1]+=z*dt,L(M,2*j+2*F+1),M[2*j+2*F+1]+=U*st,L(M,2*j+2*F+1),M[2*j+2*F+2]+=z*st,L(M,2*j+2*F+2)}for(j=0;j<N;j++)M[j]=M[2*j+1]<<16|M[2*j];for(j=N;j<2*N;j++)M[j]=0;return new l(M,0)};function L(I,N){for(;(I[N]&65535)!=I[N];)I[N+1]+=I[N]>>>16,I[N]&=65535,N++}function k(I,N){this.g=I,this.h=N}function V(I,N){if(S(N))throw Error("division by zero");if(S(I))return new k(v,v);if(E(I))return N=V(T(I),N),new k(T(N.g),T(N.h));if(E(N))return N=V(I,T(N)),new k(T(N.g),N.h);if(30<I.g.length){if(E(I)||E(N))throw Error("slowDivide_ only works with positive integers.");for(var M=b,j=N;0>=j.l(I);)M=P(M),j=P(j);var F=G(M,1),z=G(j,1);for(j=G(j,2),M=G(M,2);!S(j);){var U=z.add(j);0>=U.l(I)&&(F=F.add(M),z=U),j=G(j,1),M=G(M,1)}return N=C(I,F.j(N)),new k(F,N)}for(F=v;0<=I.l(N);){for(M=Math.max(1,Math.floor(I.m()/N.m())),j=Math.ceil(Math.log(M)/Math.LN2),j=48>=j?1:Math.pow(2,j-48),z=f(M),U=z.j(N);E(U)||0<U.l(I);)M-=j,z=f(M),U=z.j(N);S(z)&&(z=b),F=F.add(z),I=C(I,U)}return new k(F,I)}i.A=function(I){return V(this,I).h},i.and=function(I){for(var N=Math.max(this.g.length,I.g.length),M=[],j=0;j<N;j++)M[j]=this.i(j)&I.i(j);return new l(M,this.h&I.h)},i.or=function(I){for(var N=Math.max(this.g.length,I.g.length),M=[],j=0;j<N;j++)M[j]=this.i(j)|I.i(j);return new l(M,this.h|I.h)},i.xor=function(I){for(var N=Math.max(this.g.length,I.g.length),M=[],j=0;j<N;j++)M[j]=this.i(j)^I.i(j);return new l(M,this.h^I.h)};function P(I){for(var N=I.g.length+1,M=[],j=0;j<N;j++)M[j]=I.i(j)<<1|I.i(j-1)>>>31;return new l(M,I.h)}function G(I,N){var M=N>>5;N%=32;for(var j=I.g.length-M,F=[],z=0;z<j;z++)F[z]=0<N?I.i(z+M)>>>N|I.i(z+M+1)<<32-N:I.i(z+M);return new l(F,I.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,$S=n,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.A,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=f,l.fromString=m,oa=l}).apply(typeof fE<"u"?fE:typeof self<"u"?self:typeof window<"u"?window:{});var Gd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var KS,bu,WS,hf,my,YS,XS,QS;(function(){var i,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(p,w,x){return p==Array.prototype||p==Object.prototype||(p[w]=x.value),p};function e(p){p=[typeof globalThis=="object"&&globalThis,p,typeof window=="object"&&window,typeof self=="object"&&self,typeof Gd=="object"&&Gd];for(var w=0;w<p.length;++w){var x=p[w];if(x&&x.Math==Math)return x}throw Error("Cannot find global object")}var n=e(this);function s(p,w){if(w)t:{var x=n;p=p.split(".");for(var O=0;O<p.length-1;O++){var Q=p[O];if(!(Q in x))break t;x=x[Q]}p=p[p.length-1],O=x[p],w=w(O),w!=O&&w!=null&&t(x,p,{configurable:!0,writable:!0,value:w})}}function o(p,w){p instanceof String&&(p+="");var x=0,O=!1,Q={next:function(){if(!O&&x<p.length){var nt=x++;return{value:w(nt,p[nt]),done:!1}}return O=!0,{done:!0,value:void 0}}};return Q[Symbol.iterator]=function(){return Q},Q}s("Array.prototype.values",function(p){return p||function(){return o(this,function(w,x){return x})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var l=l||{},u=this||self;function h(p){var w=typeof p;return w=w!="object"?w:p?Array.isArray(p)?"array":w:"null",w=="array"||w=="object"&&typeof p.length=="number"}function f(p){var w=typeof p;return w=="object"&&p!=null||w=="function"}function m(p,w,x){return p.call.apply(p.bind,arguments)}function v(p,w,x){if(!p)throw Error();if(2<arguments.length){var O=Array.prototype.slice.call(arguments,2);return function(){var Q=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Q,O),p.apply(w,Q)}}return function(){return p.apply(w,arguments)}}function b(p,w,x){return b=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?m:v,b.apply(null,arguments)}function A(p,w){var x=Array.prototype.slice.call(arguments,1);return function(){var O=x.slice();return O.push.apply(O,arguments),p.apply(this,O)}}function S(p,w){function x(){}x.prototype=w.prototype,p.aa=w.prototype,p.prototype=new x,p.prototype.constructor=p,p.Qb=function(O,Q,nt){for(var pt=Array(arguments.length-2),Jt=2;Jt<arguments.length;Jt++)pt[Jt-2]=arguments[Jt];return w.prototype[Q].apply(O,pt)}}function E(p){const w=p.length;if(0<w){const x=Array(w);for(let O=0;O<w;O++)x[O]=p[O];return x}return[]}function T(p,w){for(let x=1;x<arguments.length;x++){const O=arguments[x];if(h(O)){const Q=p.length||0,nt=O.length||0;p.length=Q+nt;for(let pt=0;pt<nt;pt++)p[Q+pt]=O[pt]}else p.push(O)}}class C{constructor(w,x){this.i=w,this.j=x,this.h=0,this.g=null}get(){let w;return 0<this.h?(this.h--,w=this.g,this.g=w.next,w.next=null):w=this.i(),w}}function L(p){return/^[\s\xa0]*$/.test(p)}function k(){var p=u.navigator;return p&&(p=p.userAgent)?p:""}function V(p){return V[" "](p),p}V[" "]=function(){};var P=k().indexOf("Gecko")!=-1&&!(k().toLowerCase().indexOf("webkit")!=-1&&k().indexOf("Edge")==-1)&&!(k().indexOf("Trident")!=-1||k().indexOf("MSIE")!=-1)&&k().indexOf("Edge")==-1;function G(p,w,x){for(const O in p)w.call(x,p[O],O,p)}function I(p,w){for(const x in p)w.call(void 0,p[x],x,p)}function N(p){const w={};for(const x in p)w[x]=p[x];return w}const M="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function j(p,w){let x,O;for(let Q=1;Q<arguments.length;Q++){O=arguments[Q];for(x in O)p[x]=O[x];for(let nt=0;nt<M.length;nt++)x=M[nt],Object.prototype.hasOwnProperty.call(O,x)&&(p[x]=O[x])}}function F(p){var w=1;p=p.split(":");const x=[];for(;0<w&&p.length;)x.push(p.shift()),w--;return p.length&&x.push(p.join(":")),x}function z(p){u.setTimeout(()=>{throw p},0)}function U(){var p=xt;let w=null;return p.g&&(w=p.g,p.g=p.g.next,p.g||(p.h=null),w.next=null),w}class st{constructor(){this.h=this.g=null}add(w,x){const O=dt.get();O.set(w,x),this.h?this.h.next=O:this.g=O,this.h=O}}var dt=new C(()=>new $,p=>p.reset());class ${constructor(){this.next=this.g=this.h=null}set(w,x){this.h=w,this.g=x,this.next=null}reset(){this.next=this.g=this.h=null}}let Y,ut=!1,xt=new st,q=()=>{const p=u.Promise.resolve(void 0);Y=()=>{p.then(it)}};var it=()=>{for(var p;p=U();){try{p.h.call(p.g)}catch(x){z(x)}var w=dt;w.j(p),100>w.h&&(w.h++,p.next=w.g,w.g=p)}ut=!1};function ht(){this.s=this.s,this.C=this.C}ht.prototype.s=!1,ht.prototype.ma=function(){this.s||(this.s=!0,this.N())},ht.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function W(p,w){this.type=p,this.g=this.target=w,this.defaultPrevented=!1}W.prototype.h=function(){this.defaultPrevented=!0};var ft=(function(){if(!u.addEventListener||!Object.defineProperty)return!1;var p=!1,w=Object.defineProperty({},"passive",{get:function(){p=!0}});try{const x=()=>{};u.addEventListener("test",x,w),u.removeEventListener("test",x,w)}catch{}return p})();function Nt(p,w){if(W.call(this,p?p.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,p){var x=this.type=p.type,O=p.changedTouches&&p.changedTouches.length?p.changedTouches[0]:null;if(this.target=p.target||p.srcElement,this.g=w,w=p.relatedTarget){if(P){t:{try{V(w.nodeName);var Q=!0;break t}catch{}Q=!1}Q||(w=null)}}else x=="mouseover"?w=p.fromElement:x=="mouseout"&&(w=p.toElement);this.relatedTarget=w,O?(this.clientX=O.clientX!==void 0?O.clientX:O.pageX,this.clientY=O.clientY!==void 0?O.clientY:O.pageY,this.screenX=O.screenX||0,this.screenY=O.screenY||0):(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0),this.button=p.button,this.key=p.key||"",this.ctrlKey=p.ctrlKey,this.altKey=p.altKey,this.shiftKey=p.shiftKey,this.metaKey=p.metaKey,this.pointerId=p.pointerId||0,this.pointerType=typeof p.pointerType=="string"?p.pointerType:wt[p.pointerType]||"",this.state=p.state,this.i=p,p.defaultPrevented&&Nt.aa.h.call(this)}}S(Nt,W);var wt={2:"touch",3:"pen",4:"mouse"};Nt.prototype.h=function(){Nt.aa.h.call(this);var p=this.i;p.preventDefault?p.preventDefault():p.returnValue=!1};var Ot="closure_listenable_"+(1e6*Math.random()|0),Qt=0;function Gn(p,w,x,O,Q){this.listener=p,this.proxy=null,this.src=w,this.type=x,this.capture=!!O,this.ha=Q,this.key=++Qt,this.da=this.fa=!1}function ys(p){p.da=!0,p.listener=null,p.proxy=null,p.src=null,p.ha=null}function Pn(p){this.src=p,this.g={},this.h=0}Pn.prototype.add=function(p,w,x,O,Q){var nt=p.toString();p=this.g[nt],p||(p=this.g[nt]=[],this.h++);var pt=vs(p,w,O,Q);return-1<pt?(w=p[pt],x||(w.fa=!1)):(w=new Gn(w,this.src,nt,!!O,Q),w.fa=x,p.push(w)),w};function es(p,w){var x=w.type;if(x in p.g){var O=p.g[x],Q=Array.prototype.indexOf.call(O,w,void 0),nt;(nt=0<=Q)&&Array.prototype.splice.call(O,Q,1),nt&&(ys(w),p.g[x].length==0&&(delete p.g[x],p.h--))}}function vs(p,w,x,O){for(var Q=0;Q<p.length;++Q){var nt=p[Q];if(!nt.da&&nt.listener==w&&nt.capture==!!x&&nt.ha==O)return Q}return-1}var Vs="closure_lm_"+(1e6*Math.random()|0),Ta={};function mt(p,w,x,O,Q){if(Array.isArray(w)){for(var nt=0;nt<w.length;nt++)mt(p,w[nt],x,O,Q);return null}return x=_h(x),p&&p[Ot]?p.K(w,x,f(O)?!!O.capture:!1,Q):Ct(p,w,x,!1,O,Q)}function Ct(p,w,x,O,Q,nt){if(!w)throw Error("Invalid event type");var pt=f(Q)?!!Q.capture:!!Q,Jt=No(p);if(Jt||(p[Vs]=Jt=new Pn(p)),x=Jt.add(w,x,O,pt,nt),x.proxy)return x;if(O=ie(),x.proxy=O,O.src=p,O.listener=x,p.addEventListener)ft||(Q=pt),Q===void 0&&(Q=!1),p.addEventListener(w.toString(),O,Q);else if(p.attachEvent)p.attachEvent(ns(w.toString()),O);else if(p.addListener&&p.removeListener)p.addListener(O);else throw Error("addEventListener and attachEvent are unavailable.");return x}function ie(){function p(x){return w.call(p.src,p.listener,x)}const w=xp;return p}function ke(p,w,x,O,Q){if(Array.isArray(w))for(var nt=0;nt<w.length;nt++)ke(p,w[nt],x,O,Q);else O=f(O)?!!O.capture:!!O,x=_h(x),p&&p[Ot]?(p=p.i,w=String(w).toString(),w in p.g&&(nt=p.g[w],x=vs(nt,x,O,Q),-1<x&&(ys(nt[x]),Array.prototype.splice.call(nt,x,1),nt.length==0&&(delete p.g[w],p.h--)))):p&&(p=No(p))&&(w=p.g[w.toString()],p=-1,w&&(p=vs(w,x,O,Q)),(x=-1<p?w[p]:null)&&_s(x))}function _s(p){if(typeof p!="number"&&p&&!p.da){var w=p.src;if(w&&w[Ot])es(w.i,p);else{var x=p.type,O=p.proxy;w.removeEventListener?w.removeEventListener(x,O,p.capture):w.detachEvent?w.detachEvent(ns(x),O):w.addListener&&w.removeListener&&w.removeListener(O),(x=No(w))?(es(x,p),x.h==0&&(x.src=null,w[Vs]=null)):ys(p)}}}function ns(p){return p in Ta?Ta[p]:Ta[p]="on"+p}function xp(p,w){if(p.da)p=!0;else{w=new Nt(w,this);var x=p.listener,O=p.ha||p.src;p.fa&&_s(p),p=x.call(O,w)}return p}function No(p){return p=p[Vs],p instanceof Pn?p:null}var ic="__closure_events_fn_"+(1e9*Math.random()>>>0);function _h(p){return typeof p=="function"?p:(p[ic]||(p[ic]=function(w){return p.handleEvent(w)}),p[ic])}function Me(){ht.call(this),this.i=new Pn(this),this.M=this,this.F=null}S(Me,ht),Me.prototype[Ot]=!0,Me.prototype.removeEventListener=function(p,w,x,O){ke(this,p,w,x,O)};function le(p,w){var x,O=p.F;if(O)for(x=[];O;O=O.F)x.push(O);if(p=p.M,O=w.type||w,typeof w=="string")w=new W(w,p);else if(w instanceof W)w.target=w.target||p;else{var Q=w;w=new W(O,p),j(w,Q)}if(Q=!0,x)for(var nt=x.length-1;0<=nt;nt--){var pt=w.g=x[nt];Q=ss(pt,O,!0,w)&&Q}if(pt=w.g=p,Q=ss(pt,O,!0,w)&&Q,Q=ss(pt,O,!1,w)&&Q,x)for(nt=0;nt<x.length;nt++)pt=w.g=x[nt],Q=ss(pt,O,!1,w)&&Q}Me.prototype.N=function(){if(Me.aa.N.call(this),this.i){var p=this.i,w;for(w in p.g){for(var x=p.g[w],O=0;O<x.length;O++)ys(x[O]);delete p.g[w],p.h--}}this.F=null},Me.prototype.K=function(p,w,x,O){return this.i.add(String(p),w,!1,x,O)},Me.prototype.L=function(p,w,x,O){return this.i.add(String(p),w,!0,x,O)};function ss(p,w,x,O){if(w=p.i.g[String(w)],!w)return!0;w=w.concat();for(var Q=!0,nt=0;nt<w.length;++nt){var pt=w[nt];if(pt&&!pt.da&&pt.capture==x){var Jt=pt.listener,nn=pt.ha||pt.src;pt.fa&&es(p.i,pt),Q=Jt.call(nn,O)!==!1&&Q}}return Q&&!O.defaultPrevented}function xn(p,w,x){if(typeof p=="function")x&&(p=b(p,x));else if(p&&typeof p.handleEvent=="function")p=b(p.handleEvent,p);else throw Error("Invalid listener argument");return 2147483647<Number(w)?-1:u.setTimeout(p,w||0)}function bh(p){p.g=xn(()=>{p.g=null,p.i&&(p.i=!1,bh(p))},p.l);const w=p.h;p.h=null,p.m.apply(null,w)}class Cp extends ht{constructor(w,x){super(),this.m=w,this.l=x,this.h=null,this.i=!1,this.g=null}j(w){this.h=arguments,this.g?this.i=!0:bh(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function xa(p){ht.call(this),this.h=p,this.g={}}S(xa,ht);var Ca=[];function Ra(p){G(p.g,function(w,x){this.g.hasOwnProperty(x)&&_s(w)},p),p.g={}}xa.prototype.N=function(){xa.aa.N.call(this),Ra(this)},xa.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Us=u.JSON.stringify,ko=u.JSON.parse,Ia=class{stringify(p){return u.JSON.stringify(p,void 0)}parse(p){return u.JSON.parse(p,void 0)}};function rc(){}rc.prototype.h=null;function ac(p){return p.h||(p.h=p.i())}function oc(){}var Pi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Li(){W.call(this,"d")}S(Li,W);function lc(){W.call(this,"c")}S(lc,W);var ei={},cc=null;function wr(){return cc=cc||new Me}ei.La="serverreachability";function Mo(p){W.call(this,ei.La,p)}S(Mo,W);function Er(p){const w=wr();le(w,new Mo(w))}ei.STAT_EVENT="statevent";function Ah(p,w){W.call(this,ei.STAT_EVENT,p),this.stat=w}S(Ah,W);function Ee(p){const w=wr();le(w,new Ah(w,p))}ei.Ma="timingevent";function en(p,w){W.call(this,ei.Ma,p),this.size=w}S(en,W);function Ge(p,w){if(typeof p!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){p()},w)}function bs(){this.g=!0}bs.prototype.xa=function(){this.g=!1};function uc(p,w,x,O,Q,nt){p.info(function(){if(p.g)if(nt)for(var pt="",Jt=nt.split("&"),nn=0;nn<Jt.length;nn++){var Zt=Jt[nn].split("=");if(1<Zt.length){var un=Zt[0];Zt=Zt[1];var sn=un.split("_");pt=2<=sn.length&&sn[1]=="type"?pt+(un+"="+Zt+"&"):pt+(un+"=redacted&")}}else pt=null;else pt=nt;return"XMLHTTP REQ ("+O+") [attempt "+Q+"]: "+w+`
`+x+`
`+pt})}function Rp(p,w,x,O,Q,nt,pt){p.info(function(){return"XMLHTTP RESP ("+O+") [ attempt "+Q+"]: "+w+`
`+x+`
`+nt+" "+pt})}function Sr(p,w,x,O){p.info(function(){return"XMLHTTP TEXT ("+w+"): "+Na(p,x)+(O?" "+O:"")})}function wh(p,w){p.info(function(){return"TIMEOUT: "+w})}bs.prototype.info=function(){};function Na(p,w){if(!p.g)return w;if(!w)return null;try{var x=JSON.parse(w);if(x){for(p=0;p<x.length;p++)if(Array.isArray(x[p])){var O=x[p];if(!(2>O.length)){var Q=O[1];if(Array.isArray(Q)&&!(1>Q.length)){var nt=Q[0];if(nt!="noop"&&nt!="stop"&&nt!="close")for(var pt=1;pt<Q.length;pt++)Q[pt]=""}}}}return Us(x)}catch{return w}}var Tr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Oi={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ni;function si(){}S(si,rc),si.prototype.g=function(){return new XMLHttpRequest},si.prototype.i=function(){return{}},ni=new si;function Ln(p,w,x,O){this.j=p,this.i=w,this.l=x,this.R=O||1,this.U=new xa(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new je}function je(){this.i=null,this.g="",this.h=!1}var hc={},Do={};function Fs(p,w,x){p.L=1,p.v=La(is(w)),p.m=x,p.P=!0,ji(p,null)}function ji(p,w){p.F=Date.now(),ka(p),p.A=is(p.v);var x=p.A,O=p.R;Array.isArray(O)||(O=[String(O)]),yc(x.i,"t",O),p.C=0,x=p.j.J,p.h=new je,p.g=Vh(p.j,x?w:null,!p.m),0<p.O&&(p.M=new Cp(b(p.Y,p,p.g),p.O)),w=p.U,x=p.g,O=p.ca;var Q="readystatechange";Array.isArray(Q)||(Q&&(Ca[0]=Q.toString()),Q=Ca);for(var nt=0;nt<Q.length;nt++){var pt=mt(x,Q[nt],O||w.handleEvent,!1,w.h||w);if(!pt)break;w.g[pt.key]=pt}w=p.H?N(p.H):{},p.m?(p.u||(p.u="POST"),w["Content-Type"]="application/x-www-form-urlencoded",p.g.ea(p.A,p.u,p.m,w)):(p.u="GET",p.g.ea(p.A,p.u,null,w)),Er(),uc(p.i,p.u,p.A,p.l,p.R,p.m)}Ln.prototype.ca=function(p){p=p.target;const w=this.M;w&&Ss(p)==3?w.j():this.Y(p)},Ln.prototype.Y=function(p){try{if(p==this.g)t:{const sn=Ss(this.g);var w=this.g.Ba();const qi=this.g.Z();if(!(3>sn)&&(sn!=3||this.g&&(this.h.h||this.g.oa()||Nh(this.g)))){this.J||sn!=4||w==7||(w==8||0>=qi?Er(3):Er(2)),xr(this);var x=this.g.Z();this.X=x;e:if(Eh(this)){var O=Nh(this.g);p="";var Q=O.length,nt=Ss(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){yn(this),ii(this);var pt="";break e}this.h.i=new u.TextDecoder}for(w=0;w<Q;w++)this.h.h=!0,p+=this.h.i.decode(O[w],{stream:!(nt&&w==Q-1)});O.length=0,this.h.g+=p,this.C=0,pt=this.h.g}else pt=this.g.oa();if(this.o=x==200,Rp(this.i,this.u,this.A,this.l,this.R,sn,x),this.o){if(this.T&&!this.K){e:{if(this.g){var Jt,nn=this.g;if((Jt=nn.g?nn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!L(Jt)){var Zt=Jt;break e}}Zt=null}if(x=Zt)Sr(this.i,this.l,x,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ma(this,x);else{this.o=!1,this.s=3,Ee(12),yn(this),ii(this);break t}}if(this.P){x=!0;let vn;for(;!this.J&&this.C<pt.length;)if(vn=Sh(this,pt),vn==Do){sn==4&&(this.s=4,Ee(14),x=!1),Sr(this.i,this.l,null,"[Incomplete Response]");break}else if(vn==hc){this.s=4,Ee(15),Sr(this.i,this.l,pt,"[Invalid Chunk]"),x=!1;break}else Sr(this.i,this.l,vn,null),Ma(this,vn);if(Eh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),sn!=4||pt.length!=0||this.h.h||(this.s=1,Ee(16),x=!1),this.o=this.o&&x,!x)Sr(this.i,this.l,pt,"[Invalid Chunked Response]"),yn(this),ii(this);else if(0<pt.length&&!this.W){this.W=!0;var un=this.j;un.g==this&&un.ba&&!un.M&&(un.j.info("Great, no buffering proxy detected. Bytes received: "+pt.length),Ha(un),un.M=!0,Ee(11))}}else Sr(this.i,this.l,pt,null),Ma(this,pt);sn==4&&yn(this),this.o&&!this.J&&(sn==4?Lh(this.j,this):(this.o=!1,ka(this)))}else Dp(this.g),x==400&&0<pt.indexOf("Unknown SID")?(this.s=3,Ee(12)):(this.s=0,Ee(13)),yn(this),ii(this)}}}catch{}finally{}};function Eh(p){return p.g?p.u=="GET"&&p.L!=2&&p.j.Ca:!1}function Sh(p,w){var x=p.C,O=w.indexOf(`
`,x);return O==-1?Do:(x=Number(w.substring(x,O)),isNaN(x)?hc:(O+=1,O+x>w.length?Do:(w=w.slice(O,O+x),p.C=O+x,w)))}Ln.prototype.cancel=function(){this.J=!0,yn(this)};function ka(p){p.S=Date.now()+p.I,Th(p,p.I)}function Th(p,w){if(p.B!=null)throw Error("WatchDog timer not null");p.B=Ge(b(p.ba,p),w)}function xr(p){p.B&&(u.clearTimeout(p.B),p.B=null)}Ln.prototype.ba=function(){this.B=null;const p=Date.now();0<=p-this.S?(wh(this.i,this.A),this.L!=2&&(Er(),Ee(17)),yn(this),this.s=2,ii(this)):Th(this,this.S-p)};function ii(p){p.j.G==0||p.J||Lh(p.j,p)}function yn(p){xr(p);var w=p.M;w&&typeof w.ma=="function"&&w.ma(),p.M=null,Ra(p.U),p.g&&(w=p.g,p.g=null,w.abort(),w.ma())}function Ma(p,w){try{var x=p.j;if(x.G!=0&&(x.g==p||dc(x.h,p))){if(!p.K&&dc(x.h,p)&&x.G==3){try{var O=x.Da.g.parse(w)}catch{O=null}if(Array.isArray(O)&&O.length==3){var Q=O;if(Q[0]==0){t:if(!x.u){if(x.g)if(x.g.F+3e3<p.F)qo(x),Ho(x);else break t;wc(x),Ee(18)}}else x.za=Q[1],0<x.za-x.T&&37500>Q[2]&&x.F&&x.v==0&&!x.C&&(x.C=Ge(b(x.Za,x),6e3));if(1>=Lo(x.h)&&x.ca){try{x.ca()}catch{}x.ca=void 0}}else Gi(x,11)}else if((p.K||x.g==p)&&qo(x),!L(w))for(Q=x.Da.g.parse(w),w=0;w<Q.length;w++){let Zt=Q[w];if(x.T=Zt[0],Zt=Zt[1],x.G==2)if(Zt[0]=="c"){x.K=Zt[1],x.ia=Zt[2];const un=Zt[3];un!=null&&(x.la=un,x.j.info("VER="+x.la));const sn=Zt[4];sn!=null&&(x.Aa=sn,x.j.info("SVER="+x.Aa));const qi=Zt[5];qi!=null&&typeof qi=="number"&&0<qi&&(O=1.5*qi,x.L=O,x.j.info("backChannelRequestTimeoutMs_="+O)),O=x;const vn=p.g;if(vn){const hi=vn.g?vn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(hi){var nt=O.h;nt.g||hi.indexOf("spdy")==-1&&hi.indexOf("quic")==-1&&hi.indexOf("h2")==-1||(nt.j=nt.l,nt.g=new Set,nt.h&&(Oo(nt,nt.h),nt.h=null))}if(O.D){const Sc=vn.g?vn.g.getResponseHeader("X-HTTP-Session-Id"):null;Sc&&(O.ya=Sc,he(O.I,O.D,Sc))}}x.G=3,x.l&&x.l.ua(),x.ba&&(x.R=Date.now()-p.F,x.j.info("Handshake RTT: "+x.R+"ms")),O=x;var pt=p;if(O.qa=jh(O,O.J?O.ia:null,O.W),pt.K){On(O.h,pt);var Jt=pt,nn=O.L;nn&&(Jt.I=nn),Jt.B&&(xr(Jt),ka(Jt)),O.g=pt}else Dh(O);0<x.i.length&&Go(x)}else Zt[0]!="stop"&&Zt[0]!="close"||Gi(x,7);else x.G==3&&(Zt[0]=="stop"||Zt[0]=="close"?Zt[0]=="stop"?Gi(x,7):bc(x):Zt[0]!="noop"&&x.l&&x.l.ta(Zt),x.v=0)}}Er(4)}catch{}}var xh=class{constructor(p,w){this.g=p,this.map=w}};function Vi(p){this.l=p||10,u.PerformanceNavigationTiming?(p=u.performance.getEntriesByType("navigation"),p=0<p.length&&(p[0].nextHopProtocol=="hq"||p[0].nextHopProtocol=="h2")):p=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=p?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Po(p){return p.h?!0:p.g?p.g.size>=p.j:!1}function Lo(p){return p.h?1:p.g?p.g.size:0}function dc(p,w){return p.h?p.h==w:p.g?p.g.has(w):!1}function Oo(p,w){p.g?p.g.add(w):p.h=w}function On(p,w){p.h&&p.h==w?p.h=null:p.g&&p.g.has(w)&&p.g.delete(w)}Vi.prototype.cancel=function(){if(this.i=fc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const p of this.g.values())p.cancel();this.g.clear()}};function fc(p){if(p.h!=null)return p.i.concat(p.h.D);if(p.g!=null&&p.g.size!==0){let w=p.i;for(const x of p.g.values())w=w.concat(x.D);return w}return E(p.i)}function Ip(p){if(p.V&&typeof p.V=="function")return p.V();if(typeof Map<"u"&&p instanceof Map||typeof Set<"u"&&p instanceof Set)return Array.from(p.values());if(typeof p=="string")return p.split("");if(h(p)){for(var w=[],x=p.length,O=0;O<x;O++)w.push(p[O]);return w}w=[],x=0;for(O in p)w[x++]=p[O];return w}function jo(p){if(p.na&&typeof p.na=="function")return p.na();if(!p.V||typeof p.V!="function"){if(typeof Map<"u"&&p instanceof Map)return Array.from(p.keys());if(!(typeof Set<"u"&&p instanceof Set)){if(h(p)||typeof p=="string"){var w=[];p=p.length;for(var x=0;x<p;x++)w.push(x);return w}w=[],x=0;for(const O in p)w[x++]=O;return w}}}function pc(p,w){if(p.forEach&&typeof p.forEach=="function")p.forEach(w,void 0);else if(h(p)||typeof p=="string")Array.prototype.forEach.call(p,w,void 0);else for(var x=jo(p),O=Ip(p),Q=O.length,nt=0;nt<Q;nt++)w.call(void 0,O[nt],x&&x[nt],p)}var Da=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Np(p,w){if(p){p=p.split("&");for(var x=0;x<p.length;x++){var O=p[x].indexOf("="),Q=null;if(0<=O){var nt=p[x].substring(0,O);Q=p[x].substring(O+1)}else nt=p[x];w(nt,Q?decodeURIComponent(Q.replace(/\+/g," ")):"")}}}function qe(p){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,p instanceof qe){this.h=p.h,Pa(this,p.j),this.o=p.o,this.g=p.g,Cr(this,p.s),this.l=p.l;var w=p.i,x=new Fi;x.i=w.i,w.g&&(x.g=new Map(w.g),x.h=w.h),Ui(this,x),this.m=p.m}else p&&(w=String(p).match(Da))?(this.h=!1,Pa(this,w[1]||"",!0),this.o=As(w[2]||""),this.g=As(w[3]||"",!0),Cr(this,w[4]),this.l=As(w[5]||"",!0),Ui(this,w[6]||"",!0),this.m=As(w[7]||"")):(this.h=!1,this.i=new Fi(null,this.h))}qe.prototype.toString=function(){var p=[],w=this.j;w&&p.push(Oa(w,mc,!0),":");var x=this.g;return(x||w=="file")&&(p.push("//"),(w=this.o)&&p.push(Oa(w,mc,!0),"@"),p.push(encodeURIComponent(String(x)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),x=this.s,x!=null&&p.push(":",String(x))),(x=this.l)&&(this.g&&x.charAt(0)!="/"&&p.push("/"),p.push(Oa(x,x.charAt(0)=="/"?kp:gc,!0))),(x=this.i.toString())&&p.push("?",x),(x=this.m)&&p.push("#",Oa(x,Vo)),p.join("")};function is(p){return new qe(p)}function Pa(p,w,x){p.j=x?As(w,!0):w,p.j&&(p.j=p.j.replace(/:$/,""))}function Cr(p,w){if(w){if(w=Number(w),isNaN(w)||0>w)throw Error("Bad port number "+w);p.s=w}else p.s=null}function Ui(p,w,x){w instanceof Fi?(p.i=w,Rh(p.i,p.h)):(x||(w=Oa(w,Mp)),p.i=new Fi(w,p.h))}function he(p,w,x){p.i.set(w,x)}function La(p){return he(p,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),p}function As(p,w){return p?w?decodeURI(p.replace(/%25/g,"%2525")):decodeURIComponent(p):""}function Oa(p,w,x){return typeof p=="string"?(p=encodeURI(p).replace(w,Ch),x&&(p=p.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p):null}function Ch(p){return p=p.charCodeAt(0),"%"+(p>>4&15).toString(16)+(p&15).toString(16)}var mc=/[#\/\?@]/g,gc=/[#\?:]/g,kp=/[#\?]/g,Mp=/[#\?@]/g,Vo=/#/g;function Fi(p,w){this.h=this.g=null,this.i=p||null,this.j=!!w}function ws(p){p.g||(p.g=new Map,p.h=0,p.i&&Np(p.i,function(w,x){p.add(decodeURIComponent(w.replace(/\+/g," ")),x)}))}i=Fi.prototype,i.add=function(p,w){ws(this),this.i=null,p=ri(this,p);var x=this.g.get(p);return x||this.g.set(p,x=[]),x.push(w),this.h+=1,this};function Bi(p,w){ws(p),w=ri(p,w),p.g.has(w)&&(p.i=null,p.h-=p.g.get(w).length,p.g.delete(w))}function zi(p,w){return ws(p),w=ri(p,w),p.g.has(w)}i.forEach=function(p,w){ws(this),this.g.forEach(function(x,O){x.forEach(function(Q){p.call(w,Q,O,this)},this)},this)},i.na=function(){ws(this);const p=Array.from(this.g.values()),w=Array.from(this.g.keys()),x=[];for(let O=0;O<w.length;O++){const Q=p[O];for(let nt=0;nt<Q.length;nt++)x.push(w[O])}return x},i.V=function(p){ws(this);let w=[];if(typeof p=="string")zi(this,p)&&(w=w.concat(this.g.get(ri(this,p))));else{p=Array.from(this.g.values());for(let x=0;x<p.length;x++)w=w.concat(p[x])}return w},i.set=function(p,w){return ws(this),this.i=null,p=ri(this,p),zi(this,p)&&(this.h-=this.g.get(p).length),this.g.set(p,[w]),this.h+=1,this},i.get=function(p,w){return p?(p=this.V(p),0<p.length?String(p[0]):w):w};function yc(p,w,x){Bi(p,w),0<x.length&&(p.i=null,p.g.set(ri(p,w),E(x)),p.h+=x.length)}i.toString=function(){if(this.i)return this.i;if(!this.g)return"";const p=[],w=Array.from(this.g.keys());for(var x=0;x<w.length;x++){var O=w[x];const nt=encodeURIComponent(String(O)),pt=this.V(O);for(O=0;O<pt.length;O++){var Q=nt;pt[O]!==""&&(Q+="="+encodeURIComponent(String(pt[O]))),p.push(Q)}}return this.i=p.join("&")};function ri(p,w){return w=String(w),p.j&&(w=w.toLowerCase()),w}function Rh(p,w){w&&!p.j&&(ws(p),p.i=null,p.g.forEach(function(x,O){var Q=O.toLowerCase();O!=Q&&(Bi(this,O),yc(this,Q,x))},p)),p.j=w}function ja(p,w){const x=new bs;if(u.Image){const O=new Image;O.onload=A(Es,x,"TestLoadImage: loaded",!0,w,O),O.onerror=A(Es,x,"TestLoadImage: error",!1,w,O),O.onabort=A(Es,x,"TestLoadImage: abort",!1,w,O),O.ontimeout=A(Es,x,"TestLoadImage: timeout",!1,w,O),u.setTimeout(function(){O.ontimeout&&O.ontimeout()},1e4),O.src=p}else w(!1)}function Bs(p,w){const x=new bs,O=new AbortController,Q=setTimeout(()=>{O.abort(),Es(x,"TestPingServer: timeout",!1,w)},1e4);fetch(p,{signal:O.signal}).then(nt=>{clearTimeout(Q),nt.ok?Es(x,"TestPingServer: ok",!0,w):Es(x,"TestPingServer: server error",!1,w)}).catch(()=>{clearTimeout(Q),Es(x,"TestPingServer: error",!1,w)})}function Es(p,w,x,O,Q){try{Q&&(Q.onload=null,Q.onerror=null,Q.onabort=null,Q.ontimeout=null),O(x)}catch{}}function Va(){this.g=new Ia}function ai(p,w,x){const O=x||"";try{pc(p,function(Q,nt){let pt=Q;f(Q)&&(pt=Us(Q)),w.push(O+nt+"="+encodeURIComponent(pt))})}catch(Q){throw w.push(O+"type="+encodeURIComponent("_badmap")),Q}}function Rr(p){this.l=p.Ub||null,this.j=p.eb||!1}S(Rr,rc),Rr.prototype.g=function(){return new Hi(this.l,this.j)},Rr.prototype.i=(function(p){return function(){return p}})({});function Hi(p,w){Me.call(this),this.D=p,this.o=w,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}S(Hi,Me),i=Hi.prototype,i.open=function(p,w){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=p,this.A=w,this.readyState=1,li(this)},i.send=function(p){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const w={headers:this.u,method:this.B,credentials:this.m,cache:void 0};p&&(w.body=p),(this.D||u).fetch(new Request(this.A,w)).then(this.Sa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,oi(this)),this.readyState=0},i.Sa=function(p){if(this.g&&(this.l=p,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=p.headers,this.readyState=2,li(this)),this.g&&(this.readyState=3,li(this),this.g)))if(this.responseType==="arraybuffer")p.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in p){if(this.j=p.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;vc(this)}else p.text().then(this.Ra.bind(this),this.ga.bind(this))};function vc(p){p.j.read().then(p.Pa.bind(p)).catch(p.ga.bind(p))}i.Pa=function(p){if(this.g){if(this.o&&p.value)this.response.push(p.value);else if(!this.o){var w=p.value?p.value:new Uint8Array(0);(w=this.v.decode(w,{stream:!p.done}))&&(this.response=this.responseText+=w)}p.done?oi(this):li(this),this.readyState==3&&vc(this)}},i.Ra=function(p){this.g&&(this.response=this.responseText=p,oi(this))},i.Qa=function(p){this.g&&(this.response=p,oi(this))},i.ga=function(){this.g&&oi(this)};function oi(p){p.readyState=4,p.l=null,p.j=null,p.v=null,li(p)}i.setRequestHeader=function(p,w){this.u.append(p,w)},i.getResponseHeader=function(p){return this.h&&this.h.get(p.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";const p=[],w=this.h.entries();for(var x=w.next();!x.done;)x=x.value,p.push(x[0]+": "+x[1]),x=w.next();return p.join(`\r
`)};function li(p){p.onreadystatechange&&p.onreadystatechange.call(p)}Object.defineProperty(Hi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(p){this.m=p?"include":"same-origin"}});function _c(p){let w="";return G(p,function(x,O){w+=O,w+=":",w+=x,w+=`\r
`}),w}function cn(p,w,x){t:{for(O in x){var O=!1;break t}O=!0}O||(x=_c(x),typeof p=="string"?x!=null&&encodeURIComponent(String(x)):he(p,w,x))}function ae(p){Me.call(this),this.headers=new Map,this.o=p||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}S(ae,Me);var Uo=/^https?$/i,Ua=["POST","PUT"];i=ae.prototype,i.Ha=function(p){this.J=p},i.ea=function(p,w,x,O){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+p);w=w?w.toUpperCase():"GET",this.D=p,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ni.g(),this.v=this.o?ac(this.o):ac(ni),this.g.onreadystatechange=b(this.Ea,this);try{this.B=!0,this.g.open(w,String(p),!0),this.B=!1}catch(nt){Ih(this,nt);return}if(p=x||"",x=new Map(this.headers),O)if(Object.getPrototypeOf(O)===Object.prototype)for(var Q in O)x.set(Q,O[Q]);else if(typeof O.keys=="function"&&typeof O.get=="function")for(const nt of O.keys())x.set(nt,O.get(nt));else throw Error("Unknown input type for opt_headers: "+String(O));O=Array.from(x.keys()).find(nt=>nt.toLowerCase()=="content-type"),Q=u.FormData&&p instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Ua,w,void 0))||O||Q||x.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[nt,pt]of x)this.g.setRequestHeader(nt,pt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Fa(this),this.u=!0,this.g.send(p),this.u=!1}catch(nt){Ih(this,nt)}};function Ih(p,w){p.h=!1,p.g&&(p.j=!0,p.g.abort(),p.j=!1),p.l=w,p.m=5,Fo(p),ci(p)}function Fo(p){p.A||(p.A=!0,le(p,"complete"),le(p,"error"))}i.abort=function(p){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=p||7,le(this,"complete"),le(this,"abort"),ci(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ci(this,!0)),ae.aa.N.call(this)},i.Ea=function(){this.s||(this.B||this.u||this.j?Bo(this):this.bb())},i.bb=function(){Bo(this)};function Bo(p){if(p.h&&typeof l<"u"&&(!p.v[1]||Ss(p)!=4||p.Z()!=2)){if(p.u&&Ss(p)==4)xn(p.Ea,0,p);else if(le(p,"readystatechange"),Ss(p)==4){p.h=!1;try{const pt=p.Z();t:switch(pt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var w=!0;break t;default:w=!1}var x;if(!(x=w)){var O;if(O=pt===0){var Q=String(p.D).match(Da)[1]||null;!Q&&u.self&&u.self.location&&(Q=u.self.location.protocol.slice(0,-1)),O=!Uo.test(Q?Q.toLowerCase():"")}x=O}if(x)le(p,"complete"),le(p,"success");else{p.m=6;try{var nt=2<Ss(p)?p.g.statusText:""}catch{nt=""}p.l=nt+" ["+p.Z()+"]",Fo(p)}}finally{ci(p)}}}}function ci(p,w){if(p.g){Fa(p);const x=p.g,O=p.v[0]?()=>{}:null;p.g=null,p.v=null,w||le(p,"ready");try{x.onreadystatechange=O}catch{}}}function Fa(p){p.I&&(u.clearTimeout(p.I),p.I=null)}i.isActive=function(){return!!this.g};function Ss(p){return p.g?p.g.readyState:0}i.Z=function(){try{return 2<Ss(this)?this.g.status:-1}catch{return-1}},i.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},i.Oa=function(p){if(this.g){var w=this.g.responseText;return p&&w.indexOf(p)==0&&(w=w.substring(p.length)),ko(w)}};function Nh(p){try{if(!p.g)return null;if("response"in p.g)return p.g.response;switch(p.H){case"":case"text":return p.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in p.g)return p.g.mozResponseArrayBuffer}return null}catch{return null}}function Dp(p){const w={};p=(p.g&&2<=Ss(p)&&p.g.getAllResponseHeaders()||"").split(`\r
`);for(let O=0;O<p.length;O++){if(L(p[O]))continue;var x=F(p[O]);const Q=x[0];if(x=x[1],typeof x!="string")continue;x=x.trim();const nt=w[Q]||[];w[Q]=nt,nt.push(x)}I(w,function(O){return O.join(", ")})}i.Ba=function(){return this.m},i.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ba(p,w,x){return x&&x.internalChannelParams&&x.internalChannelParams[p]||w}function zo(p){this.Aa=0,this.i=[],this.j=new bs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ba("failFast",!1,p),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ba("baseRetryDelayMs",5e3,p),this.cb=Ba("retryDelaySeedMs",1e4,p),this.Wa=Ba("forwardChannelMaxRetries",2,p),this.wa=Ba("forwardChannelRequestTimeoutMs",2e4,p),this.pa=p&&p.xmlHttpFactory||void 0,this.Xa=p&&p.Tb||void 0,this.Ca=p&&p.useFetchStreams||!1,this.L=void 0,this.J=p&&p.supportsCrossDomainXhr||!1,this.K="",this.h=new Vi(p&&p.concurrentRequestLimit),this.Da=new Va,this.P=p&&p.fastHandshake||!1,this.O=p&&p.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=p&&p.Rb||!1,p&&p.xa&&this.j.xa(),p&&p.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&p&&p.detectBufferingProxy||!1,this.ja=void 0,p&&p.longPollingTimeout&&0<p.longPollingTimeout&&(this.ja=p.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}i=zo.prototype,i.la=8,i.G=1,i.connect=function(p,w,x,O){Ee(0),this.W=p,this.H=w||{},x&&O!==void 0&&(this.H.OSID=x,this.H.OAID=O),this.F=this.X,this.I=jh(this,null,this.W),Go(this)};function bc(p){if(kh(p),p.G==3){var w=p.U++,x=is(p.I);if(he(x,"SID",p.K),he(x,"RID",w),he(x,"TYPE","terminate"),za(p,x),w=new Ln(p,p.j,w),w.L=2,w.v=La(is(x)),x=!1,u.navigator&&u.navigator.sendBeacon)try{x=u.navigator.sendBeacon(w.v.toString(),"")}catch{}!x&&u.Image&&(new Image().src=w.v,x=!0),x||(w.g=Vh(w.j,null),w.g.ea(w.v)),w.F=Date.now(),ka(w)}Oh(p)}function Ho(p){p.g&&(Ha(p),p.g.cancel(),p.g=null)}function kh(p){Ho(p),p.u&&(u.clearTimeout(p.u),p.u=null),qo(p),p.h.cancel(),p.s&&(typeof p.s=="number"&&u.clearTimeout(p.s),p.s=null)}function Go(p){if(!Po(p.h)&&!p.s){p.s=!0;var w=p.Ga;Y||q(),ut||(Y(),ut=!0),xt.add(w,p),p.B=0}}function Pp(p,w){return Lo(p.h)>=p.h.j-(p.s?1:0)?!1:p.s?(p.i=w.D.concat(p.i),!0):p.G==1||p.G==2||p.B>=(p.Va?0:p.Wa)?!1:(p.s=Ge(b(p.Ga,p,w),Ec(p,p.B)),p.B++,!0)}i.Ga=function(p){if(this.s)if(this.s=null,this.G==1){if(!p){this.U=Math.floor(1e5*Math.random()),p=this.U++;const Q=new Ln(this,this.j,p);let nt=this.o;if(this.S&&(nt?(nt=N(nt),j(nt,this.S)):nt=this.S),this.m!==null||this.O||(Q.H=nt,nt=null),this.P)t:{for(var w=0,x=0;x<this.i.length;x++){e:{var O=this.i[x];if("__data__"in O.map&&(O=O.map.__data__,typeof O=="string")){O=O.length;break e}O=void 0}if(O===void 0)break;if(w+=O,4096<w){w=x;break t}if(w===4096||x===this.i.length-1){w=x+1;break t}}w=1e3}else w=1e3;w=Mh(this,Q,w),x=is(this.I),he(x,"RID",p),he(x,"CVER",22),this.D&&he(x,"X-HTTP-Session-Id",this.D),za(this,x),nt&&(this.O?w="headers="+encodeURIComponent(String(_c(nt)))+"&"+w:this.m&&cn(x,this.m,nt)),Oo(this.h,Q),this.Ua&&he(x,"TYPE","init"),this.P?(he(x,"$req",w),he(x,"SID","null"),Q.T=!0,Fs(Q,x,null)):Fs(Q,x,w),this.G=2}}else this.G==3&&(p?Ac(this,p):this.i.length==0||Po(this.h)||Ac(this))};function Ac(p,w){var x;w?x=w.l:x=p.U++;const O=is(p.I);he(O,"SID",p.K),he(O,"RID",x),he(O,"AID",p.T),za(p,O),p.m&&p.o&&cn(O,p.m,p.o),x=new Ln(p,p.j,x,p.B+1),p.m===null&&(x.H=p.o),w&&(p.i=w.D.concat(p.i)),w=Mh(p,x,1e3),x.I=Math.round(.5*p.wa)+Math.round(.5*p.wa*Math.random()),Oo(p.h,x),Fs(x,O,w)}function za(p,w){p.H&&G(p.H,function(x,O){he(w,O,x)}),p.l&&pc({},function(x,O){he(w,O,x)})}function Mh(p,w,x){x=Math.min(p.i.length,x);var O=p.l?b(p.l.Na,p.l,p):null;t:{var Q=p.i;let nt=-1;for(;;){const pt=["count="+x];nt==-1?0<x?(nt=Q[0].g,pt.push("ofs="+nt)):nt=0:pt.push("ofs="+nt);let Jt=!0;for(let nn=0;nn<x;nn++){let Zt=Q[nn].g;const un=Q[nn].map;if(Zt-=nt,0>Zt)nt=Math.max(0,Q[nn].g-100),Jt=!1;else try{ai(un,pt,"req"+Zt+"_")}catch{O&&O(un)}}if(Jt){O=pt.join("&");break t}}}return p=p.i.splice(0,x),w.D=p,O}function Dh(p){if(!p.g&&!p.u){p.Y=1;var w=p.Fa;Y||q(),ut||(Y(),ut=!0),xt.add(w,p),p.v=0}}function wc(p){return p.g||p.u||3<=p.v?!1:(p.Y++,p.u=Ge(b(p.Fa,p),Ec(p,p.v)),p.v++,!0)}i.Fa=function(){if(this.u=null,Ph(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var p=2*this.R;this.j.info("BP detection timer enabled: "+p),this.A=Ge(b(this.ab,this),p)}},i.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ee(10),Ho(this),Ph(this))};function Ha(p){p.A!=null&&(u.clearTimeout(p.A),p.A=null)}function Ph(p){p.g=new Ln(p,p.j,"rpc",p.Y),p.m===null&&(p.g.H=p.o),p.g.O=0;var w=is(p.qa);he(w,"RID","rpc"),he(w,"SID",p.K),he(w,"AID",p.T),he(w,"CI",p.F?"0":"1"),!p.F&&p.ja&&he(w,"TO",p.ja),he(w,"TYPE","xmlhttp"),za(p,w),p.m&&p.o&&cn(w,p.m,p.o),p.L&&(p.g.I=p.L);var x=p.g;p=p.ia,x.L=1,x.v=La(is(w)),x.m=null,x.P=!0,ji(x,p)}i.Za=function(){this.C!=null&&(this.C=null,Ho(this),wc(this),Ee(19))};function qo(p){p.C!=null&&(u.clearTimeout(p.C),p.C=null)}function Lh(p,w){var x=null;if(p.g==w){qo(p),Ha(p),p.g=null;var O=2}else if(dc(p.h,w))x=w.D,On(p.h,w),O=1;else return;if(p.G!=0){if(w.o)if(O==1){x=w.m?w.m.length:0,w=Date.now()-w.F;var Q=p.B;O=wr(),le(O,new en(O,x)),Go(p)}else Dh(p);else if(Q=w.s,Q==3||Q==0&&0<w.X||!(O==1&&Pp(p,w)||O==2&&wc(p)))switch(x&&0<x.length&&(w=p.h,w.i=w.i.concat(x)),Q){case 1:Gi(p,5);break;case 4:Gi(p,10);break;case 3:Gi(p,6);break;default:Gi(p,2)}}}function Ec(p,w){let x=p.Ta+Math.floor(Math.random()*p.cb);return p.isActive()||(x*=2),x*w}function Gi(p,w){if(p.j.info("Error code "+w),w==2){var x=b(p.fb,p),O=p.Xa;const Q=!O;O=new qe(O||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Pa(O,"https"),La(O),Q?ja(O.toString(),x):Bs(O.toString(),x)}else Ee(2);p.G=0,p.l&&p.l.sa(w),Oh(p),kh(p)}i.fb=function(p){p?(this.j.info("Successfully pinged google.com"),Ee(2)):(this.j.info("Failed to ping google.com"),Ee(1))};function Oh(p){if(p.G=0,p.ka=[],p.l){const w=fc(p.h);(w.length!=0||p.i.length!=0)&&(T(p.ka,w),T(p.ka,p.i),p.h.i.length=0,E(p.i),p.i.length=0),p.l.ra()}}function jh(p,w,x){var O=x instanceof qe?is(x):new qe(x);if(O.g!="")w&&(O.g=w+"."+O.g),Cr(O,O.s);else{var Q=u.location;O=Q.protocol,w=w?w+"."+Q.hostname:Q.hostname,Q=+Q.port;var nt=new qe(null);O&&Pa(nt,O),w&&(nt.g=w),Q&&Cr(nt,Q),x&&(nt.l=x),O=nt}return x=p.D,w=p.ya,x&&w&&he(O,x,w),he(O,"VER",p.la),za(p,O),O}function Vh(p,w,x){if(w&&!p.J)throw Error("Can't create secondary domain capable XhrIo object.");return w=p.Ca&&!p.pa?new ae(new Rr({eb:x})):new ae(p.pa),w.Ha(p.J),w}i.isActive=function(){return!!this.l&&this.l.isActive(this)};function Uh(){}i=Uh.prototype,i.ua=function(){},i.ta=function(){},i.sa=function(){},i.ra=function(){},i.isActive=function(){return!0},i.Na=function(){};function $o(){}$o.prototype.g=function(p,w){return new jn(p,w)};function jn(p,w){Me.call(this),this.g=new zo(w),this.l=p,this.h=w&&w.messageUrlParams||null,p=w&&w.messageHeaders||null,w&&w.clientProtocolHeaderRequired&&(p?p["X-Client-Protocol"]="webchannel":p={"X-Client-Protocol":"webchannel"}),this.g.o=p,p=w&&w.initMessageHeaders||null,w&&w.messageContentType&&(p?p["X-WebChannel-Content-Type"]=w.messageContentType:p={"X-WebChannel-Content-Type":w.messageContentType}),w&&w.va&&(p?p["X-WebChannel-Client-Profile"]=w.va:p={"X-WebChannel-Client-Profile":w.va}),this.g.S=p,(p=w&&w.Sb)&&!L(p)&&(this.g.m=p),this.v=w&&w.supportsCrossDomainXhr||!1,this.u=w&&w.sendRawJson||!1,(w=w&&w.httpSessionIdParam)&&!L(w)&&(this.g.D=w,p=this.h,p!==null&&w in p&&(p=this.h,w in p&&delete p[w])),this.j=new ui(this)}S(jn,Me),jn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},jn.prototype.close=function(){bc(this.g)},jn.prototype.o=function(p){var w=this.g;if(typeof p=="string"){var x={};x.__data__=p,p=x}else this.u&&(x={},x.__data__=Us(p),p=x);w.i.push(new xh(w.Ya++,p)),w.G==3&&Go(w)},jn.prototype.N=function(){this.g.l=null,delete this.j,bc(this.g),delete this.g,jn.aa.N.call(this)};function Fh(p){Li.call(this),p.__headers__&&(this.headers=p.__headers__,this.statusCode=p.__status__,delete p.__headers__,delete p.__status__);var w=p.__sm__;if(w){t:{for(const x in w){p=x;break t}p=void 0}(this.i=p)&&(p=this.i,w=w!==null&&p in w?w[p]:void 0),this.data=w}else this.data=p}S(Fh,Li);function Bh(){lc.call(this),this.status=1}S(Bh,lc);function ui(p){this.g=p}S(ui,Uh),ui.prototype.ua=function(){le(this.g,"a")},ui.prototype.ta=function(p){le(this.g,new Fh(p))},ui.prototype.sa=function(p){le(this.g,new Bh)},ui.prototype.ra=function(){le(this.g,"b")},$o.prototype.createWebChannel=$o.prototype.g,jn.prototype.send=jn.prototype.o,jn.prototype.open=jn.prototype.m,jn.prototype.close=jn.prototype.close,QS=function(){return new $o},XS=function(){return wr()},YS=ei,my={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Tr.NO_ERROR=0,Tr.TIMEOUT=8,Tr.HTTP_ERROR=6,hf=Tr,Oi.COMPLETE="complete",WS=Oi,oc.EventType=Pi,Pi.OPEN="a",Pi.CLOSE="b",Pi.ERROR="c",Pi.MESSAGE="d",Me.prototype.listen=Me.prototype.K,bu=oc,ae.prototype.listenOnce=ae.prototype.L,ae.prototype.getLastError=ae.prototype.Ka,ae.prototype.getLastErrorCode=ae.prototype.Ba,ae.prototype.getStatus=ae.prototype.Z,ae.prototype.getResponseJson=ae.prototype.Oa,ae.prototype.getResponseText=ae.prototype.oa,ae.prototype.send=ae.prototype.ea,ae.prototype.setWithCredentials=ae.prototype.Ha,KS=ae}).apply(typeof Gd<"u"?Gd:typeof self<"u"?self:typeof window<"u"?window:{});const pE="@firebase/firestore",mE="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kn{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}kn.UNAUTHENTICATED=new kn(null),kn.GOOGLE_CREDENTIALS=new kn("google-credentials-uid"),kn.FIRST_PARTY=new kn("first-party-uid"),kn.MOCK_USER=new kn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ql="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vo=new nv("@firebase/firestore");function wl(){return vo.logLevel}function vt(i,...t){if(vo.logLevel<=Kt.DEBUG){const e=t.map(mv);vo.debug(`Firestore (${Ql}): ${i}`,...e)}}function vr(i,...t){if(vo.logLevel<=Kt.ERROR){const e=t.map(mv);vo.error(`Firestore (${Ql}): ${i}`,...e)}}function _o(i,...t){if(vo.logLevel<=Kt.WARN){const e=t.map(mv);vo.warn(`Firestore (${Ql}): ${i}`,...e)}}function mv(i){if(typeof i=="string")return i;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(e){return JSON.stringify(e)})(i)}catch{return i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pt(i,t,e){let n="Unexpected state";typeof t=="string"?n=t:e=t,JS(i,n,e)}function JS(i,t,e){let n=`FIRESTORE (${Ql}) INTERNAL ASSERTION FAILED: ${t} (ID: ${i.toString(16)})`;if(e!==void 0)try{n+=" CONTEXT: "+JSON.stringify(e)}catch{n+=" CONTEXT: "+e}throw vr(n),new Error(n)}function oe(i,t,e,n){let s="Unexpected state";typeof e=="string"?s=e:n=e,i||JS(t,s,n)}function Ft(i,t){return i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const at={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class yt extends Mi{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fr{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZS{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class tT{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(kn.UNAUTHENTICATED)))}shutdown(){}}class yD{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class vD{constructor(t){this.t=t,this.currentUser=kn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){oe(this.o===void 0,42304);let n=this.i;const s=h=>this.i!==n?(n=this.i,e(h)):Promise.resolve();let o=new fr;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new fr,t.enqueueRetryable((()=>s(this.currentUser)))};const l=()=>{const h=o;t.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},u=h=>{vt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((h=>u(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(vt("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new fr)}}),0),l()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((n=>this.i!==t?(vt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(oe(typeof n.accessToken=="string",31837,{l:n}),new ZS(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return oe(t===null||typeof t=="string",2055,{h:t}),new kn(t)}}class _D{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=kn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class bD{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new _D(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(kn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class gE{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class AD{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Jn(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){oe(this.o===void 0,3512);const n=o=>{o.error!=null&&vt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,vt("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable((()=>n(o)))};const s=o=>{vt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):vt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new gE(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((e=>e?(oe(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new gE(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wD(i){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(i);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<i;n++)e[n]=Math.floor(256*Math.random());return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zf{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const s=wD(40);for(let o=0;o<s.length;++o)n.length<20&&s[o]<e&&(n+=t.charAt(s[o]%62))}return n}}function Wt(i,t){return i<t?-1:i>t?1:0}function gy(i,t){const e=Math.min(i.length,t.length);for(let n=0;n<e;n++){const s=i.charAt(n),o=t.charAt(n);if(s!==o)return Bg(s)===Bg(o)?Wt(s,o):Bg(s)?1:-1}return Wt(i.length,t.length)}const ED=55296,SD=57343;function Bg(i){const t=i.charCodeAt(0);return t>=ED&&t<=SD}function Bl(i,t,e){return i.length===t.length&&i.every(((n,s)=>e(n,t[s])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yE="__name__";class Ei{constructor(t,e,n){e===void 0?e=0:e>t.length&&Pt(637,{offset:e,range:t.length}),n===void 0?n=t.length-e:n>t.length-e&&Pt(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return Ei.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Ei?t.forEach((n=>{e.push(n)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const o=Ei.compareSegments(t.get(s),e.get(s));if(o!==0)return o}return Wt(t.length,e.length)}static compareSegments(t,e){const n=Ei.isNumericId(t),s=Ei.isNumericId(e);return n&&!s?-1:!n&&s?1:n&&s?Ei.extractNumericId(t).compare(Ei.extractNumericId(e)):gy(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return oa.fromString(t.substring(4,t.length-2))}}class be extends Ei{construct(t,e,n){return new be(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new yt(at.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((s=>s.length>0)))}return new be(e)}static emptyPath(){return new be([])}}const TD=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class mn extends Ei{construct(t,e,n){return new mn(t,e,n)}static isValidIdentifier(t){return TD.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),mn.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===yE}static keyField(){return new mn([yE])}static fromServerFormat(t){const e=[];let n="",s=0;const o=()=>{if(n.length===0)throw new yt(at.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let l=!1;for(;s<t.length;){const u=t[s];if(u==="\\"){if(s+1===t.length)throw new yt(at.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const h=t[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new yt(at.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=h,s+=2}else u==="`"?(l=!l,s++):u!=="."||l?(n+=u,s++):(o(),s++)}if(o(),l)throw new yt(at.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new mn(e)}static emptyPath(){return new mn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class St{constructor(t){this.path=t}static fromPath(t){return new St(be.fromString(t))}static fromName(t){return new St(be.fromString(t).popFirst(5))}static empty(){return new St(be.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&be.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return be.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new St(new be(t.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eT(i,t,e){if(!e)throw new yt(at.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${t}.`)}function nT(i,t,e,n){if(t===!0&&n===!0)throw new yt(at.INVALID_ARGUMENT,`${i} and ${e} cannot be used together.`)}function vE(i){if(!St.isDocumentKey(i))throw new yt(at.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${i} has ${i.length}.`)}function _E(i){if(St.isDocumentKey(i))throw new yt(at.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${i} has ${i.length}.`)}function sT(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}function tp(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{const t=(function(n){return n.constructor?n.constructor.name:null})(i);return t?`a custom ${t} object`:"an object"}}return typeof i=="function"?"a function":Pt(12329,{type:typeof i})}function gs(i,t){if("_delegate"in i&&(i=i._delegate),!(i instanceof t)){if(t.name===i.constructor.name)throw new yt(at.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=tp(i);throw new yt(at.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return i}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tn(i,t){const e={typeString:i};return t&&(e.value=t),e}function sh(i,t){if(!sT(i))throw new yt(at.INVALID_ARGUMENT,"JSON must be an object");let e;for(const n in t)if(t[n]){const s=t[n].typeString,o="value"in t[n]?{value:t[n].value}:void 0;if(!(n in i)){e=`JSON missing required field: '${n}'`;break}const l=i[n];if(s&&typeof l!==s){e=`JSON field '${n}' must be a ${s}.`;break}if(o!==void 0&&l!==o.value){e=`Expected '${n}' field to equal '${o.value}'`;break}}if(e)throw new yt(at.INVALID_ARGUMENT,e);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bE=-62135596800,AE=1e6;class Ae{static now(){return Ae.fromMillis(Date.now())}static fromDate(t){return Ae.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*AE);return new Ae(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new yt(at.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new yt(at.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<bE)throw new yt(at.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new yt(at.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/AE}_compareTo(t){return this.seconds===t.seconds?Wt(this.nanoseconds,t.nanoseconds):Wt(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ae._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(sh(t,Ae._jsonSchema))return new Ae(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-bE;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ae._jsonSchemaVersion="firestore/timestamp/1.0",Ae._jsonSchema={type:tn("string",Ae._jsonSchemaVersion),seconds:tn("number"),nanoseconds:tn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{static fromTimestamp(t){return new jt(t)}static min(){return new jt(new Ae(0,0))}static max(){return new jt(new Ae(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uu=-1;function xD(i,t){const e=i.toTimestamp().seconds,n=i.toTimestamp().nanoseconds+1,s=jt.fromTimestamp(n===1e9?new Ae(e+1,0):new Ae(e,n));return new ua(s,St.empty(),t)}function CD(i){return new ua(i.readTime,i.key,Uu)}class ua{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new ua(jt.min(),St.empty(),Uu)}static max(){return new ua(jt.max(),St.empty(),Uu)}}function RD(i,t){let e=i.readTime.compareTo(t.readTime);return e!==0?e:(e=St.comparator(i.documentKey,t.documentKey),e!==0?e:Wt(i.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ID="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ND{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jl(i){if(i.code!==at.FAILED_PRECONDITION||i.message!==ID)throw i;vt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ct{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Pt(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new ct(((n,s)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(n,s)},this.catchCallback=o=>{this.wrapFailure(e,o).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof ct?e:ct.resolve(e)}catch(e){return ct.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):ct.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):ct.reject(e)}static resolve(t){return new ct(((e,n)=>{e(t)}))}static reject(t){return new ct(((e,n)=>{n(t)}))}static waitFor(t){return new ct(((e,n)=>{let s=0,o=0,l=!1;t.forEach((u=>{++s,u.next((()=>{++o,l&&o===s&&e()}),(h=>n(h)))})),l=!0,o===s&&e()}))}static or(t){let e=ct.resolve(!1);for(const n of t)e=e.next((s=>s?ct.resolve(s):n()));return e}static forEach(t,e){const n=[];return t.forEach(((s,o)=>{n.push(e.call(this,s,o))})),this.waitFor(n)}static mapArray(t,e){return new ct(((n,s)=>{const o=t.length,l=new Array(o);let u=0;for(let h=0;h<o;h++){const f=h;e(t[f]).next((m=>{l[f]=m,++u,u===o&&n(l)}),(m=>s(m)))}}))}static doWhile(t,e){return new ct(((n,s)=>{const o=()=>{t()===!0?e().next((()=>{o()}),s):n()};o()}))}}function kD(i){const t=i.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function Zl(i){return i.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>e.writeSequenceNumber(n))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}ep.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gv=-1;function np(i){return i==null}function If(i){return i===0&&1/i==-1/0}function MD(i){return typeof i=="number"&&Number.isInteger(i)&&!If(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iT="";function DD(i){let t="";for(let e=0;e<i.length;e++)t.length>0&&(t=wE(t)),t=PD(i.get(e),t);return wE(t)}function PD(i,t){let e=t;const n=i.length;for(let s=0;s<n;s++){const o=i.charAt(s);switch(o){case"\0":e+="";break;case iT:e+="";break;default:e+=o}}return e}function wE(i){return i+iT+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EE(i){let t=0;for(const e in i)Object.prototype.hasOwnProperty.call(i,e)&&t++;return t}function wa(i,t){for(const e in i)Object.prototype.hasOwnProperty.call(i,e)&&t(e,i[e])}function rT(i){for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ne{constructor(t,e){this.comparator=t,this.root=e||En.EMPTY}insert(t,e){return new Ne(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,En.BLACK,null,null))}remove(t){return new Ne(this.comparator,this.root.remove(t,this.comparator).copy(null,null,En.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(s===0)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new qd(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new qd(this.root,t,this.comparator,!1)}getReverseIterator(){return new qd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new qd(this.root,t,this.comparator,!0)}}class qd{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?n(t.key,e):1,e&&s&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class En{constructor(t,e,n,s,o){this.key=t,this.value=e,this.color=n??En.RED,this.left=s??En.EMPTY,this.right=o??En.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,o){return new En(t??this.key,e??this.value,n??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const o=n(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,e,n),null):o===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return En.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return En.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,En.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,En.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Pt(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Pt(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw Pt(27949);return t+(this.isRed()?0:1)}}En.EMPTY=null,En.RED=!0,En.BLACK=!1;En.EMPTY=new class{constructor(){this.size=0}get key(){throw Pt(57766)}get value(){throw Pt(16141)}get color(){throw Pt(16727)}get left(){throw Pt(29726)}get right(){throw Pt(36894)}copy(t,e,n,s,o){return this}insert(t,e,n){return new En(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln{constructor(t){this.comparator=t,this.data=new Ne(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new SE(this.data.getIterator())}getIteratorFrom(t){return new SE(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((n=>{e=e.add(n)})),e}isEqual(t){if(!(t instanceof ln)||this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const s=e.getNext().key,o=n.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new ln(this.comparator);return e.data=t,e}}class SE{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms{constructor(t){this.fields=t,t.sort(mn.comparator)}static empty(){return new ms([])}unionWith(t){let e=new ln(mn.comparator);for(const n of this.fields)e=e.add(n);for(const n of t)e=e.add(n);return new ms(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Bl(this.fields,t.fields,((e,n)=>e.isEqual(n)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aT extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn{constructor(t){this.binaryString=t}static fromBase64String(t){const e=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new aT("Invalid base64 string: "+o):o}})(t);return new gn(e)}static fromUint8Array(t){const e=(function(s){let o="";for(let l=0;l<s.length;++l)o+=String.fromCharCode(s[l]);return o})(t);return new gn(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){const n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Wt(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}gn.EMPTY_BYTE_STRING=new gn("");const LD=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ha(i){if(oe(!!i,39018),typeof i=="string"){let t=0;const e=LD.exec(i);if(oe(!!e,46558,{timestamp:i}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}const n=new Date(i);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:Be(i.seconds),nanos:Be(i.nanos)}}function Be(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function da(i){return typeof i=="string"?gn.fromBase64String(i):gn.fromUint8Array(i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oT="server_timestamp",lT="__type__",cT="__previous_value__",uT="__local_write_time__";function yv(i){return(i?.mapValue?.fields||{})[lT]?.stringValue===oT}function sp(i){const t=i.mapValue.fields[cT];return yv(t)?sp(t):t}function Fu(i){const t=ha(i.mapValue.fields[uT].timestampValue);return new Ae(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(t,e,n,s,o,l,u,h,f,m){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=m}}const Nf="(default)";class zl{constructor(t,e){this.projectId=t,this.database=e||Nf}static empty(){return new zl("","")}get isDefaultDatabase(){return this.database===Nf}isEqual(t){return t instanceof zl&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hT="__type__",jD="__max__",$d={mapValue:{}},dT="__vector__",kf="value";function fa(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?yv(i)?4:UD(i)?9007199254740991:VD(i)?10:11:Pt(28295,{value:i})}function Ii(i,t){if(i===t)return!0;const e=fa(i);if(e!==fa(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===t.booleanValue;case 4:return Fu(i).isEqual(Fu(t));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const l=ha(s.timestampValue),u=ha(o.timestampValue);return l.seconds===u.seconds&&l.nanos===u.nanos})(i,t);case 5:return i.stringValue===t.stringValue;case 6:return(function(s,o){return da(s.bytesValue).isEqual(da(o.bytesValue))})(i,t);case 7:return i.referenceValue===t.referenceValue;case 8:return(function(s,o){return Be(s.geoPointValue.latitude)===Be(o.geoPointValue.latitude)&&Be(s.geoPointValue.longitude)===Be(o.geoPointValue.longitude)})(i,t);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return Be(s.integerValue)===Be(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const l=Be(s.doubleValue),u=Be(o.doubleValue);return l===u?If(l)===If(u):isNaN(l)&&isNaN(u)}return!1})(i,t);case 9:return Bl(i.arrayValue.values||[],t.arrayValue.values||[],Ii);case 10:case 11:return(function(s,o){const l=s.mapValue.fields||{},u=o.mapValue.fields||{};if(EE(l)!==EE(u))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(u[h]===void 0||!Ii(l[h],u[h])))return!1;return!0})(i,t);default:return Pt(52216,{left:i})}}function Bu(i,t){return(i.values||[]).find((e=>Ii(e,t)))!==void 0}function Hl(i,t){if(i===t)return 0;const e=fa(i),n=fa(t);if(e!==n)return Wt(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return Wt(i.booleanValue,t.booleanValue);case 2:return(function(o,l){const u=Be(o.integerValue||o.doubleValue),h=Be(l.integerValue||l.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(i,t);case 3:return TE(i.timestampValue,t.timestampValue);case 4:return TE(Fu(i),Fu(t));case 5:return gy(i.stringValue,t.stringValue);case 6:return(function(o,l){const u=da(o),h=da(l);return u.compareTo(h)})(i.bytesValue,t.bytesValue);case 7:return(function(o,l){const u=o.split("/"),h=l.split("/");for(let f=0;f<u.length&&f<h.length;f++){const m=Wt(u[f],h[f]);if(m!==0)return m}return Wt(u.length,h.length)})(i.referenceValue,t.referenceValue);case 8:return(function(o,l){const u=Wt(Be(o.latitude),Be(l.latitude));return u!==0?u:Wt(Be(o.longitude),Be(l.longitude))})(i.geoPointValue,t.geoPointValue);case 9:return xE(i.arrayValue,t.arrayValue);case 10:return(function(o,l){const u=o.fields||{},h=l.fields||{},f=u[kf]?.arrayValue,m=h[kf]?.arrayValue,v=Wt(f?.values?.length||0,m?.values?.length||0);return v!==0?v:xE(f,m)})(i.mapValue,t.mapValue);case 11:return(function(o,l){if(o===$d.mapValue&&l===$d.mapValue)return 0;if(o===$d.mapValue)return 1;if(l===$d.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),f=l.fields||{},m=Object.keys(f);h.sort(),m.sort();for(let v=0;v<h.length&&v<m.length;++v){const b=gy(h[v],m[v]);if(b!==0)return b;const A=Hl(u[h[v]],f[m[v]]);if(A!==0)return A}return Wt(h.length,m.length)})(i.mapValue,t.mapValue);default:throw Pt(23264,{he:e})}}function TE(i,t){if(typeof i=="string"&&typeof t=="string"&&i.length===t.length)return Wt(i,t);const e=ha(i),n=ha(t),s=Wt(e.seconds,n.seconds);return s!==0?s:Wt(e.nanos,n.nanos)}function xE(i,t){const e=i.values||[],n=t.values||[];for(let s=0;s<e.length&&s<n.length;++s){const o=Hl(e[s],n[s]);if(o)return o}return Wt(e.length,n.length)}function Gl(i){return yy(i)}function yy(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?(function(e){const n=ha(e);return`time(${n.seconds},${n.nanos})`})(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?(function(e){return da(e).toBase64()})(i.bytesValue):"referenceValue"in i?(function(e){return St.fromName(e).toString()})(i.referenceValue):"geoPointValue"in i?(function(e){return`geo(${e.latitude},${e.longitude})`})(i.geoPointValue):"arrayValue"in i?(function(e){let n="[",s=!0;for(const o of e.values||[])s?s=!1:n+=",",n+=yy(o);return n+"]"})(i.arrayValue):"mapValue"in i?(function(e){const n=Object.keys(e.fields||{}).sort();let s="{",o=!0;for(const l of n)o?o=!1:s+=",",s+=`${l}:${yy(e.fields[l])}`;return s+"}"})(i.mapValue):Pt(61005,{value:i})}function df(i){switch(fa(i)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=sp(i);return t?16+df(t):16;case 5:return 2*i.stringValue.length;case 6:return da(i.bytesValue).approximateByteSize();case 7:return i.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((s,o)=>s+df(o)),0)})(i.arrayValue);case 10:case 11:return(function(n){let s=0;return wa(n.fields,((o,l)=>{s+=o.length+df(l)})),s})(i.mapValue);default:throw Pt(13486,{value:i})}}function CE(i,t){return{referenceValue:`projects/${i.projectId}/databases/${i.database}/documents/${t.path.canonicalString()}`}}function vy(i){return!!i&&"integerValue"in i}function vv(i){return!!i&&"arrayValue"in i}function RE(i){return!!i&&"nullValue"in i}function IE(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function ff(i){return!!i&&"mapValue"in i}function VD(i){return(i?.mapValue?.fields||{})[hT]?.stringValue===dT}function Iu(i){if(i.geoPointValue)return{geoPointValue:{...i.geoPointValue}};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:{...i.timestampValue}};if(i.mapValue){const t={mapValue:{fields:{}}};return wa(i.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Iu(n))),t}if(i.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(i.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Iu(i.arrayValue.values[e]);return t}return{...i}}function UD(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue===jD}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zn{constructor(t){this.value=t}static empty(){return new Zn({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!ff(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Iu(e)}setAll(t){let e=mn.emptyPath(),n={},s=[];t.forEach(((l,u)=>{if(!e.isImmediateParentOf(u)){const h=this.getFieldsMap(e);this.applyChanges(h,n,s),n={},s=[],e=u.popLast()}l?n[u.lastSegment()]=Iu(l):s.push(u.lastSegment())}));const o=this.getFieldsMap(e);this.applyChanges(o,n,s)}delete(t){const e=this.field(t.popLast());ff(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ii(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];ff(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){wa(e,((s,o)=>t[s]=o));for(const s of n)delete t[s]}clone(){return new Zn(Iu(this.value))}}function fT(i){const t=[];return wa(i.fields,((e,n)=>{const s=new mn([e]);if(ff(n)){const o=fT(n.mapValue).fields;if(o.length===0)t.push(s);else for(const l of o)t.push(s.child(l))}else t.push(s)})),new ms(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mn{constructor(t,e,n,s,o,l,u){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=o,this.data=l,this.documentState=u}static newInvalidDocument(t){return new Mn(t,0,jt.min(),jt.min(),jt.min(),Zn.empty(),0)}static newFoundDocument(t,e,n,s){return new Mn(t,1,e,jt.min(),n,s,0)}static newNoDocument(t,e){return new Mn(t,2,e,jt.min(),jt.min(),Zn.empty(),0)}static newUnknownDocument(t,e){return new Mn(t,3,e,jt.min(),jt.min(),Zn.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(jt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Zn.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Zn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=jt.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Mn&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Mn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mf{constructor(t,e){this.position=t,this.inclusive=e}}function NE(i,t,e){let n=0;for(let s=0;s<i.position.length;s++){const o=t[s],l=i.position[s];if(o.field.isKeyField()?n=St.comparator(St.fromName(l.referenceValue),e.key):n=Hl(l,e.data.field(o.field)),o.dir==="desc"&&(n*=-1),n!==0)break}return n}function kE(i,t){if(i===null)return t===null;if(t===null||i.inclusive!==t.inclusive||i.position.length!==t.position.length)return!1;for(let e=0;e<i.position.length;e++)if(!Ii(i.position[e],t.position[e]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zu{constructor(t,e="asc"){this.field=t,this.dir=e}}function FD(i,t){return i.dir===t.dir&&i.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pT{}class Je extends pT{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new zD(t,e,n):e==="array-contains"?new qD(t,n):e==="in"?new $D(t,n):e==="not-in"?new KD(t,n):e==="array-contains-any"?new WD(t,n):new Je(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new HD(t,n):new GD(t,n)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Hl(e,this.value)):e!==null&&fa(this.value)===fa(e)&&this.matchesComparison(Hl(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return Pt(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Js extends pT{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new Js(t,e)}matches(t){return mT(this)?this.filters.find((e=>!e.matches(t)))===void 0:this.filters.find((e=>e.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function mT(i){return i.op==="and"}function gT(i){return BD(i)&&mT(i)}function BD(i){for(const t of i.filters)if(t instanceof Js)return!1;return!0}function _y(i){if(i instanceof Je)return i.field.canonicalString()+i.op.toString()+Gl(i.value);if(gT(i))return i.filters.map((t=>_y(t))).join(",");{const t=i.filters.map((e=>_y(e))).join(",");return`${i.op}(${t})`}}function yT(i,t){return i instanceof Je?(function(n,s){return s instanceof Je&&n.op===s.op&&n.field.isEqual(s.field)&&Ii(n.value,s.value)})(i,t):i instanceof Js?(function(n,s){return s instanceof Js&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce(((o,l,u)=>o&&yT(l,s.filters[u])),!0):!1})(i,t):void Pt(19439)}function vT(i){return i instanceof Je?(function(e){return`${e.field.canonicalString()} ${e.op} ${Gl(e.value)}`})(i):i instanceof Js?(function(e){return e.op.toString()+" {"+e.getFilters().map(vT).join(" ,")+"}"})(i):"Filter"}class zD extends Je{constructor(t,e,n){super(t,e,n),this.key=St.fromName(n.referenceValue)}matches(t){const e=St.comparator(t.key,this.key);return this.matchesComparison(e)}}class HD extends Je{constructor(t,e){super(t,"in",e),this.keys=_T("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class GD extends Je{constructor(t,e){super(t,"not-in",e),this.keys=_T("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function _T(i,t){return(t.arrayValue?.values||[]).map((e=>St.fromName(e.referenceValue)))}class qD extends Je{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return vv(e)&&Bu(e.arrayValue,this.value)}}class $D extends Je{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&Bu(this.value.arrayValue,e)}}class KD extends Je{constructor(t,e){super(t,"not-in",e)}matches(t){if(Bu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!Bu(this.value.arrayValue,e)}}class WD extends Je{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!vv(e)||!e.arrayValue.values)&&e.arrayValue.values.some((n=>Bu(this.value.arrayValue,n)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YD{constructor(t,e=null,n=[],s=[],o=null,l=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=o,this.startAt=l,this.endAt=u,this.Te=null}}function ME(i,t=null,e=[],n=[],s=null,o=null,l=null){return new YD(i,t,e,n,s,o,l)}function _v(i){const t=Ft(i);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((n=>_y(n))).join(","),e+="|ob:",e+=t.orderBy.map((n=>(function(o){return o.field.canonicalString()+o.dir})(n))).join(","),np(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((n=>Gl(n))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((n=>Gl(n))).join(",")),t.Te=e}return t.Te}function bv(i,t){if(i.limit!==t.limit||i.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<i.orderBy.length;e++)if(!FD(i.orderBy[e],t.orderBy[e]))return!1;if(i.filters.length!==t.filters.length)return!1;for(let e=0;e<i.filters.length;e++)if(!yT(i.filters[e],t.filters[e]))return!1;return i.collectionGroup===t.collectionGroup&&!!i.path.isEqual(t.path)&&!!kE(i.startAt,t.startAt)&&kE(i.endAt,t.endAt)}function by(i){return St.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(t,e=null,n=[],s=[],o=null,l="F",u=null,h=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=o,this.limitType=l,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function XD(i,t,e,n,s,o,l,u){return new tc(i,t,e,n,s,o,l,u)}function Av(i){return new tc(i)}function DE(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function bT(i){return i.collectionGroup!==null}function Nu(i){const t=Ft(i);if(t.Ie===null){t.Ie=[];const e=new Set;for(const o of t.explicitOrderBy)t.Ie.push(o),e.add(o.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(l){let u=new ln(mn.comparator);return l.filters.forEach((h=>{h.getFlattenedFilters().forEach((f=>{f.isInequality()&&(u=u.add(f.field))}))})),u})(t).forEach((o=>{e.has(o.canonicalString())||o.isKeyField()||t.Ie.push(new zu(o,n))})),e.has(mn.keyField().canonicalString())||t.Ie.push(new zu(mn.keyField(),n))}return t.Ie}function Ci(i){const t=Ft(i);return t.Ee||(t.Ee=QD(t,Nu(i))),t.Ee}function QD(i,t){if(i.limitType==="F")return ME(i.path,i.collectionGroup,t,i.filters,i.limit,i.startAt,i.endAt);{t=t.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new zu(s.field,o)}));const e=i.endAt?new Mf(i.endAt.position,i.endAt.inclusive):null,n=i.startAt?new Mf(i.startAt.position,i.startAt.inclusive):null;return ME(i.path,i.collectionGroup,t,i.filters,i.limit,e,n)}}function Ay(i,t){const e=i.filters.concat([t]);return new tc(i.path,i.collectionGroup,i.explicitOrderBy.slice(),e,i.limit,i.limitType,i.startAt,i.endAt)}function wy(i,t,e){return new tc(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),t,e,i.startAt,i.endAt)}function ip(i,t){return bv(Ci(i),Ci(t))&&i.limitType===t.limitType}function AT(i){return`${_v(Ci(i))}|lt:${i.limitType}`}function El(i){return`Query(target=${(function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map((s=>vT(s))).join(", ")}]`),np(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map((s=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(s))).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((s=>Gl(s))).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((s=>Gl(s))).join(",")),`Target(${n})`})(Ci(i))}; limitType=${i.limitType})`}function rp(i,t){return t.isFoundDocument()&&(function(n,s){const o=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(o):St.isDocumentKey(n.path)?n.path.isEqual(o):n.path.isImmediateParentOf(o)})(i,t)&&(function(n,s){for(const o of Nu(n))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(i,t)&&(function(n,s){for(const o of n.filters)if(!o.matches(s))return!1;return!0})(i,t)&&(function(n,s){return!(n.startAt&&!(function(l,u,h){const f=NE(l,u,h);return l.inclusive?f<=0:f<0})(n.startAt,Nu(n),s)||n.endAt&&!(function(l,u,h){const f=NE(l,u,h);return l.inclusive?f>=0:f>0})(n.endAt,Nu(n),s))})(i,t)}function JD(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function wT(i){return(t,e)=>{let n=!1;for(const s of Nu(i)){const o=ZD(s,t,e);if(o!==0)return o;n=n||s.field.isKeyField()}return 0}}function ZD(i,t,e){const n=i.field.isKeyField()?St.comparator(t.key,e.key):(function(o,l,u){const h=l.data.field(o),f=u.data.field(o);return h!==null&&f!==null?Hl(h,f):Pt(42886)})(i.field,t,e);switch(i.dir){case"asc":return n;case"desc":return-1*n;default:return Pt(19790,{direction:i.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(const[s,o]of n)if(this.equalsFn(s,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(s===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],t))return void(s[o]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return n.length===1?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){wa(this.inner,((e,n)=>{for(const[s,o]of n)t(s,o)}))}isEmpty(){return rT(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tP=new Ne(St.comparator);function _r(){return tP}const ET=new Ne(St.comparator);function Au(...i){let t=ET;for(const e of i)t=t.insert(e.key,e);return t}function ST(i){let t=ET;return i.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function oo(){return ku()}function TT(){return ku()}function ku(){return new xo((i=>i.toString()),((i,t)=>i.isEqual(t)))}const eP=new Ne(St.comparator),nP=new ln(St.comparator);function Yt(...i){let t=nP;for(const e of i)t=t.add(e);return t}const sP=new ln(Wt);function iP(){return sP}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wv(i,t){if(i.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:If(t)?"-0":t}}function xT(i){return{integerValue:""+i}}function rP(i,t){return MD(t)?xT(t):wv(i,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ap{constructor(){this._=void 0}}function aP(i,t,e){return i instanceof Hu?(function(s,o){const l={fields:{[lT]:{stringValue:oT},[uT]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&yv(o)&&(o=sp(o)),o&&(l.fields[cT]=o),{mapValue:l}})(e,t):i instanceof Gu?RT(i,t):i instanceof qu?IT(i,t):(function(s,o){const l=CT(s,o),u=PE(l)+PE(s.Ae);return vy(l)&&vy(s.Ae)?xT(u):wv(s.serializer,u)})(i,t)}function oP(i,t,e){return i instanceof Gu?RT(i,t):i instanceof qu?IT(i,t):e}function CT(i,t){return i instanceof Df?(function(n){return vy(n)||(function(o){return!!o&&"doubleValue"in o})(n)})(t)?t:{integerValue:0}:null}class Hu extends ap{}class Gu extends ap{constructor(t){super(),this.elements=t}}function RT(i,t){const e=NT(t);for(const n of i.elements)e.some((s=>Ii(s,n)))||e.push(n);return{arrayValue:{values:e}}}class qu extends ap{constructor(t){super(),this.elements=t}}function IT(i,t){let e=NT(t);for(const n of i.elements)e=e.filter((s=>!Ii(s,n)));return{arrayValue:{values:e}}}class Df extends ap{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function PE(i){return Be(i.integerValue||i.doubleValue)}function NT(i){return vv(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lP{constructor(t,e){this.field=t,this.transform=e}}function cP(i,t){return i.field.isEqual(t.field)&&(function(n,s){return n instanceof Gu&&s instanceof Gu||n instanceof qu&&s instanceof qu?Bl(n.elements,s.elements,Ii):n instanceof Df&&s instanceof Df?Ii(n.Ae,s.Ae):n instanceof Hu&&s instanceof Hu})(i.transform,t.transform)}class uP{constructor(t,e){this.version=t,this.transformResults=e}}class Hn{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Hn}static exists(t){return new Hn(void 0,t)}static updateTime(t){return new Hn(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function pf(i,t){return i.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(i.updateTime):i.exists===void 0||i.exists===t.isFoundDocument()}class op{}function kT(i,t){if(!i.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return i.isNoDocument()?new lp(i.key,Hn.none()):new ih(i.key,i.data,Hn.none());{const e=i.data,n=Zn.empty();let s=new ln(mn.comparator);for(let o of t.fields)if(!s.has(o)){let l=e.field(o);l===null&&o.length>1&&(o=o.popLast(),l=e.field(o)),l===null?n.delete(o):n.set(o,l),s=s.add(o)}return new Ea(i.key,n,new ms(s.toArray()),Hn.none())}}function hP(i,t,e){i instanceof ih?(function(s,o,l){const u=s.value.clone(),h=OE(s.fieldTransforms,o,l.transformResults);u.setAll(h),o.convertToFoundDocument(l.version,u).setHasCommittedMutations()})(i,t,e):i instanceof Ea?(function(s,o,l){if(!pf(s.precondition,o))return void o.convertToUnknownDocument(l.version);const u=OE(s.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(MT(s)),h.setAll(u),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()})(i,t,e):(function(s,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()})(0,t,e)}function Mu(i,t,e,n){return i instanceof ih?(function(o,l,u,h){if(!pf(o.precondition,l))return u;const f=o.value.clone(),m=jE(o.fieldTransforms,h,l);return f.setAll(m),l.convertToFoundDocument(l.version,f).setHasLocalMutations(),null})(i,t,e,n):i instanceof Ea?(function(o,l,u,h){if(!pf(o.precondition,l))return u;const f=jE(o.fieldTransforms,h,l),m=l.data;return m.setAll(MT(o)),m.setAll(f),l.convertToFoundDocument(l.version,m).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((v=>v.field)))})(i,t,e,n):(function(o,l,u){return pf(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):u})(i,t,e)}function dP(i,t){let e=null;for(const n of i.fieldTransforms){const s=t.data.field(n.field),o=CT(n.transform,s||null);o!=null&&(e===null&&(e=Zn.empty()),e.set(n.field,o))}return e||null}function LE(i,t){return i.type===t.type&&!!i.key.isEqual(t.key)&&!!i.precondition.isEqual(t.precondition)&&!!(function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&Bl(n,s,((o,l)=>cP(o,l)))})(i.fieldTransforms,t.fieldTransforms)&&(i.type===0?i.value.isEqual(t.value):i.type!==1||i.data.isEqual(t.data)&&i.fieldMask.isEqual(t.fieldMask))}class ih extends op{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ea extends op{constructor(t,e,n,s,o=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function MT(i){const t=new Map;return i.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const n=i.data.field(e);t.set(e,n)}})),t}function OE(i,t,e){const n=new Map;oe(i.length===e.length,32656,{Re:e.length,Ve:i.length});for(let s=0;s<e.length;s++){const o=i[s],l=o.transform,u=t.data.field(o.field);n.set(o.field,oP(l,u,e[s]))}return n}function jE(i,t,e){const n=new Map;for(const s of i){const o=s.transform,l=e.data.field(s.field);n.set(s.field,aP(o,l,t))}return n}class lp extends op{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class fP extends op{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pP{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(t.key)&&hP(o,t,n[s])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Mu(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Mu(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=TT();return this.mutations.forEach((s=>{const o=t.get(s.key),l=o.overlayedDocument;let u=this.applyToLocalView(l,o.mutatedFields);u=e.has(s.key)?null:u;const h=kT(l,u);h!==null&&n.set(s.key,h),l.isValidDocument()||l.convertToNoDocument(jt.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Yt())}isEqual(t){return this.batchId===t.batchId&&Bl(this.mutations,t.mutations,((e,n)=>LE(e,n)))&&Bl(this.baseMutations,t.baseMutations,((e,n)=>LE(e,n)))}}class Ev{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){oe(t.mutations.length===n.length,58842,{me:t.mutations.length,fe:n.length});let s=(function(){return eP})();const o=t.mutations;for(let l=0;l<o.length;l++)s=s.insert(o[l].key,n[l].version);return new Ev(t,e,n,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mP{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gP{constructor(t,e){this.count=t,this.unchangedNames=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xe,ee;function yP(i){switch(i){case at.OK:return Pt(64938);case at.CANCELLED:case at.UNKNOWN:case at.DEADLINE_EXCEEDED:case at.RESOURCE_EXHAUSTED:case at.INTERNAL:case at.UNAVAILABLE:case at.UNAUTHENTICATED:return!1;case at.INVALID_ARGUMENT:case at.NOT_FOUND:case at.ALREADY_EXISTS:case at.PERMISSION_DENIED:case at.FAILED_PRECONDITION:case at.ABORTED:case at.OUT_OF_RANGE:case at.UNIMPLEMENTED:case at.DATA_LOSS:return!0;default:return Pt(15467,{code:i})}}function DT(i){if(i===void 0)return vr("GRPC error has no .code"),at.UNKNOWN;switch(i){case Xe.OK:return at.OK;case Xe.CANCELLED:return at.CANCELLED;case Xe.UNKNOWN:return at.UNKNOWN;case Xe.DEADLINE_EXCEEDED:return at.DEADLINE_EXCEEDED;case Xe.RESOURCE_EXHAUSTED:return at.RESOURCE_EXHAUSTED;case Xe.INTERNAL:return at.INTERNAL;case Xe.UNAVAILABLE:return at.UNAVAILABLE;case Xe.UNAUTHENTICATED:return at.UNAUTHENTICATED;case Xe.INVALID_ARGUMENT:return at.INVALID_ARGUMENT;case Xe.NOT_FOUND:return at.NOT_FOUND;case Xe.ALREADY_EXISTS:return at.ALREADY_EXISTS;case Xe.PERMISSION_DENIED:return at.PERMISSION_DENIED;case Xe.FAILED_PRECONDITION:return at.FAILED_PRECONDITION;case Xe.ABORTED:return at.ABORTED;case Xe.OUT_OF_RANGE:return at.OUT_OF_RANGE;case Xe.UNIMPLEMENTED:return at.UNIMPLEMENTED;case Xe.DATA_LOSS:return at.DATA_LOSS;default:return Pt(39323,{code:i})}}(ee=Xe||(Xe={}))[ee.OK=0]="OK",ee[ee.CANCELLED=1]="CANCELLED",ee[ee.UNKNOWN=2]="UNKNOWN",ee[ee.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ee[ee.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ee[ee.NOT_FOUND=5]="NOT_FOUND",ee[ee.ALREADY_EXISTS=6]="ALREADY_EXISTS",ee[ee.PERMISSION_DENIED=7]="PERMISSION_DENIED",ee[ee.UNAUTHENTICATED=16]="UNAUTHENTICATED",ee[ee.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ee[ee.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ee[ee.ABORTED=10]="ABORTED",ee[ee.OUT_OF_RANGE=11]="OUT_OF_RANGE",ee[ee.UNIMPLEMENTED=12]="UNIMPLEMENTED",ee[ee.INTERNAL=13]="INTERNAL",ee[ee.UNAVAILABLE=14]="UNAVAILABLE",ee[ee.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vP(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _P=new oa([4294967295,4294967295],0);function VE(i){const t=vP().encode(i),e=new $S;return e.update(t),new Uint8Array(e.digest())}function UE(i){const t=new DataView(i.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new oa([e,n],0),new oa([s,o],0)]}class Sv{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new wu(`Invalid padding: ${e}`);if(n<0)throw new wu(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new wu(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new wu(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=oa.fromNumber(this.ge)}ye(t,e,n){let s=t.add(e.multiply(oa.fromNumber(n)));return s.compare(_P)===1&&(s=new oa([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const e=VE(t),[n,s]=UE(e);for(let o=0;o<this.hashCount;o++){const l=this.ye(n,s,o);if(!this.we(l))return!1}return!0}static create(t,e,n){const s=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),l=new Sv(o,s,e);return n.forEach((u=>l.insert(u))),l}insert(t){if(this.ge===0)return;const e=VE(t),[n,s]=UE(e);for(let o=0;o<this.hashCount;o++){const l=this.ye(n,s,o);this.Se(l)}}Se(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class wu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cp{constructor(t,e,n,s,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const s=new Map;return s.set(t,rh.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new cp(jt.min(),s,new Ne(Wt),_r(),Yt())}}class rh{constructor(t,e,n,s,o){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new rh(n,e,Yt(),Yt(),Yt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mf{constructor(t,e,n,s){this.be=t,this.removedTargetIds=e,this.key=n,this.De=s}}class PT{constructor(t,e){this.targetId=t,this.Ce=e}}class LT{constructor(t,e,n=gn.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class FE{constructor(){this.ve=0,this.Fe=BE(),this.Me=gn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=Yt(),e=Yt(),n=Yt();return this.Fe.forEach(((s,o)=>{switch(o){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:Pt(38017,{changeType:o})}})),new rh(this.Me,this.xe,t,e,n)}qe(){this.Oe=!1,this.Fe=BE()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,oe(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class bP{constructor(t){this.Ge=t,this.ze=new Map,this.je=_r(),this.Je=Kd(),this.He=Kd(),this.Ye=new Ne(Wt)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(t.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.We(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:Pt(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((n,s)=>{this.rt(s)&&e(s)}))}st(t){const e=t.targetId,n=t.Ce.count,s=this.ot(e);if(s){const o=s.target;if(by(o))if(n===0){const l=new St(o.path);this.et(e,l,Mn.newNoDocument(l,jt.min()))}else oe(n===1,20013,{expectedCount:n});else{const l=this._t(e);if(l!==n){const u=this.ut(t),h=u?this.ct(u,t,l):1;if(h!==0){this.it(e);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,f)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:o=0}=e;let l,u;try{l=da(n).toUint8Array()}catch(h){if(h instanceof aT)return _o("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new Sv(l,s,o)}catch(h){return _o(h instanceof wu?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){const n=this.Ge.getRemoteKeysForTarget(e);let s=0;return n.forEach((o=>{const l=this.Ge.ht(),u=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;t.mightContain(u)||(this.et(e,o,null),s++)})),s}Tt(t){const e=new Map;this.ze.forEach(((o,l)=>{const u=this.ot(l);if(u){if(o.current&&by(u.target)){const h=new St(u.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,Mn.newNoDocument(h,t))}o.Be&&(e.set(l,o.ke()),o.qe())}}));let n=Yt();this.He.forEach(((o,l)=>{let u=!0;l.forEachWhile((h=>{const f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(n=n.add(o))})),this.je.forEach(((o,l)=>l.setReadTime(t)));const s=new cp(t,e,this.Ye,this.je,n);return this.je=_r(),this.Je=Kd(),this.He=Kd(),this.Ye=new Ne(Wt),s}Xe(t,e){if(!this.rt(t))return;const n=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,n),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;const s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new FE,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new ln(Wt),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new ln(Wt),this.Je=this.Je.insert(t,e)),e}rt(t){const e=this.ot(t)!==null;return e||vt("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new FE),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function Kd(){return new Ne(St.comparator)}function BE(){return new Ne(St.comparator)}const AP={asc:"ASCENDING",desc:"DESCENDING"},wP={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},EP={and:"AND",or:"OR"};class SP{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Ey(i,t){return i.useProto3Json||np(t)?t:{value:t}}function Pf(i,t){return i.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function OT(i,t){return i.useProto3Json?t.toBase64():t.toUint8Array()}function TP(i,t){return Pf(i,t.toTimestamp())}function Ri(i){return oe(!!i,49232),jt.fromTimestamp((function(e){const n=ha(e);return new Ae(n.seconds,n.nanos)})(i))}function Tv(i,t){return Sy(i,t).canonicalString()}function Sy(i,t){const e=(function(s){return new be(["projects",s.projectId,"databases",s.database])})(i).child("documents");return t===void 0?e:e.child(t)}function jT(i){const t=be.fromString(i);return oe(zT(t),10190,{key:t.toString()}),t}function Ty(i,t){return Tv(i.databaseId,t.path)}function zg(i,t){const e=jT(t);if(e.get(1)!==i.databaseId.projectId)throw new yt(at.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+i.databaseId.projectId);if(e.get(3)!==i.databaseId.database)throw new yt(at.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+i.databaseId.database);return new St(UT(e))}function VT(i,t){return Tv(i.databaseId,t)}function xP(i){const t=jT(i);return t.length===4?be.emptyPath():UT(t)}function xy(i){return new be(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function UT(i){return oe(i.length>4&&i.get(4)==="documents",29091,{key:i.toString()}),i.popFirst(5)}function zE(i,t,e){return{name:Ty(i,t),fields:e.value.mapValue.fields}}function CP(i,t){let e;if("targetChange"in t){t.targetChange;const n=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:Pt(39313,{state:f})})(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],o=(function(f,m){return f.useProto3Json?(oe(m===void 0||typeof m=="string",58123),gn.fromBase64String(m||"")):(oe(m===void 0||m instanceof Buffer||m instanceof Uint8Array,16193),gn.fromUint8Array(m||new Uint8Array))})(i,t.targetChange.resumeToken),l=t.targetChange.cause,u=l&&(function(f){const m=f.code===void 0?at.UNKNOWN:DT(f.code);return new yt(m,f.message||"")})(l);e=new LT(n,s,o,u||null)}else if("documentChange"in t){t.documentChange;const n=t.documentChange;n.document,n.document.name,n.document.updateTime;const s=zg(i,n.document.name),o=Ri(n.document.updateTime),l=n.document.createTime?Ri(n.document.createTime):jt.min(),u=new Zn({mapValue:{fields:n.document.fields}}),h=Mn.newFoundDocument(s,o,l,u),f=n.targetIds||[],m=n.removedTargetIds||[];e=new mf(f,m,h.key,h)}else if("documentDelete"in t){t.documentDelete;const n=t.documentDelete;n.document;const s=zg(i,n.document),o=n.readTime?Ri(n.readTime):jt.min(),l=Mn.newNoDocument(s,o),u=n.removedTargetIds||[];e=new mf([],u,l.key,l)}else if("documentRemove"in t){t.documentRemove;const n=t.documentRemove;n.document;const s=zg(i,n.document),o=n.removedTargetIds||[];e=new mf([],o,s,null)}else{if(!("filter"in t))return Pt(11601,{Rt:t});{t.filter;const n=t.filter;n.targetId;const{count:s=0,unchangedNames:o}=n,l=new gP(s,o),u=n.targetId;e=new PT(u,l)}}return e}function RP(i,t){let e;if(t instanceof ih)e={update:zE(i,t.key,t.value)};else if(t instanceof lp)e={delete:Ty(i,t.key)};else if(t instanceof Ea)e={update:zE(i,t.key,t.data),updateMask:jP(t.fieldMask)};else{if(!(t instanceof fP))return Pt(16599,{Vt:t.type});e={verify:Ty(i,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((n=>(function(o,l){const u=l.transform;if(u instanceof Hu)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Gu)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof qu)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Df)return{fieldPath:l.field.canonicalString(),increment:u.Ae};throw Pt(20930,{transform:l.transform})})(0,n)))),t.precondition.isNone||(e.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:TP(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Pt(27497)})(i,t.precondition)),e}function IP(i,t){return i&&i.length>0?(oe(t!==void 0,14353),i.map((e=>(function(s,o){let l=s.updateTime?Ri(s.updateTime):Ri(o);return l.isEqual(jt.min())&&(l=Ri(o)),new uP(l,s.transformResults||[])})(e,t)))):[]}function NP(i,t){return{documents:[VT(i,t.path)]}}function kP(i,t){const e={structuredQuery:{}},n=t.path;let s;t.collectionGroup!==null?(s=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=VT(i,s);const o=(function(f){if(f.length!==0)return BT(Js.create(f,"and"))})(t.filters);o&&(e.structuredQuery.where=o);const l=(function(f){if(f.length!==0)return f.map((m=>(function(b){return{field:Sl(b.field),direction:PP(b.dir)}})(m)))})(t.orderBy);l&&(e.structuredQuery.orderBy=l);const u=Ey(i,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(t.endAt)),{ft:e,parent:s}}function MP(i){let t=xP(i.parent);const e=i.structuredQuery,n=e.from?e.from.length:0;let s=null;if(n>0){oe(n===1,65062);const m=e.from[0];m.allDescendants?s=m.collectionId:t=t.child(m.collectionId)}let o=[];e.where&&(o=(function(v){const b=FT(v);return b instanceof Js&&gT(b)?b.getFilters():[b]})(e.where));let l=[];e.orderBy&&(l=(function(v){return v.map((b=>(function(S){return new zu(Tl(S.field),(function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(S.direction))})(b)))})(e.orderBy));let u=null;e.limit&&(u=(function(v){let b;return b=typeof v=="object"?v.value:v,np(b)?null:b})(e.limit));let h=null;e.startAt&&(h=(function(v){const b=!!v.before,A=v.values||[];return new Mf(A,b)})(e.startAt));let f=null;return e.endAt&&(f=(function(v){const b=!v.before,A=v.values||[];return new Mf(A,b)})(e.endAt)),XD(t,s,l,o,u,"F",h,f)}function DP(i,t){const e=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Pt(28987,{purpose:s})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function FT(i){return i.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":const n=Tl(e.unaryFilter.field);return Je.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=Tl(e.unaryFilter.field);return Je.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Tl(e.unaryFilter.field);return Je.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=Tl(e.unaryFilter.field);return Je.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Pt(61313);default:return Pt(60726)}})(i):i.fieldFilter!==void 0?(function(e){return Je.create(Tl(e.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Pt(58110);default:return Pt(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(i):i.compositeFilter!==void 0?(function(e){return Js.create(e.compositeFilter.filters.map((n=>FT(n))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Pt(1026)}})(e.compositeFilter.op))})(i):Pt(30097,{filter:i})}function PP(i){return AP[i]}function LP(i){return wP[i]}function OP(i){return EP[i]}function Sl(i){return{fieldPath:i.canonicalString()}}function Tl(i){return mn.fromServerFormat(i.fieldPath)}function BT(i){return i instanceof Je?(function(e){if(e.op==="=="){if(IE(e.value))return{unaryFilter:{field:Sl(e.field),op:"IS_NAN"}};if(RE(e.value))return{unaryFilter:{field:Sl(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(IE(e.value))return{unaryFilter:{field:Sl(e.field),op:"IS_NOT_NAN"}};if(RE(e.value))return{unaryFilter:{field:Sl(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Sl(e.field),op:LP(e.op),value:e.value}}})(i):i instanceof Js?(function(e){const n=e.getFilters().map((s=>BT(s)));return n.length===1?n[0]:{compositeFilter:{op:OP(e.op),filters:n}}})(i):Pt(54877,{filter:i})}function jP(i){const t=[];return i.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function zT(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia{constructor(t,e,n,s,o=jt.min(),l=jt.min(),u=gn.EMPTY_BYTE_STRING,h=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(t){return new ia(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new ia(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new ia(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new ia(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VP{constructor(t){this.yt=t}}function UP(i){const t=MP({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?wy(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FP{constructor(){this.Cn=new BP}addToCollectionParentIndex(t,e){return this.Cn.add(e),ct.resolve()}getCollectionParents(t,e){return ct.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return ct.resolve()}deleteFieldIndex(t,e){return ct.resolve()}deleteAllFieldIndexes(t){return ct.resolve()}createTargetIndexes(t,e){return ct.resolve()}getDocumentsMatchingTarget(t,e){return ct.resolve(null)}getIndexType(t,e){return ct.resolve(0)}getFieldIndexes(t,e){return ct.resolve([])}getNextCollectionGroupToUpdate(t){return ct.resolve(null)}getMinOffset(t,e){return ct.resolve(ua.min())}getMinOffsetFromCollectionGroup(t,e){return ct.resolve(ua.min())}updateCollectionGroup(t,e,n){return ct.resolve()}updateIndexEntries(t,e){return ct.resolve()}}class BP{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new ln(be.comparator),o=!s.has(n);return this.index[e]=s.add(n),o}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new ln(be.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},HT=41943040;class Qn{static withCacheSize(t){return new Qn(t,Qn.DEFAULT_COLLECTION_PERCENTILE,Qn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Qn.DEFAULT_COLLECTION_PERCENTILE=10,Qn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qn.DEFAULT=new Qn(HT,Qn.DEFAULT_COLLECTION_PERCENTILE,Qn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qn.DISABLED=new Qn(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ql{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new ql(0)}static cr(){return new ql(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GE="LruGarbageCollector",zP=1048576;function qE([i,t],[e,n]){const s=Wt(i,e);return s===0?Wt(t,n):s}class HP{constructor(t){this.Ir=t,this.buffer=new ln(qE),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const n=this.buffer.last();qE(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}}class GP{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){vt(GE,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Zl(e)?vt(GE,"Ignoring IndexedDB error during garbage collection: ",e):await Jl(e)}await this.Vr(3e5)}))}}class qP{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next((n=>Math.floor(e/100*n)))}nthSequenceNumber(t,e){if(e===0)return ct.resolve(ep.ce);const n=new HP(e);return this.mr.forEachTarget(t,(s=>n.Ar(s.sequenceNumber))).next((()=>this.mr.pr(t,(s=>n.Ar(s))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.mr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(vt("LruGarbageCollector","Garbage collection skipped; disabled"),ct.resolve(HE)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(vt("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),HE):this.yr(t,e)))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let n,s,o,l,u,h,f;const m=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((v=>(v>this.params.maximumSequenceNumbersToCollect?(vt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${v}`),s=this.params.maximumSequenceNumbersToCollect):s=v,l=Date.now(),this.nthSequenceNumber(t,s)))).next((v=>(n=v,u=Date.now(),this.removeTargets(t,n,e)))).next((v=>(o=v,h=Date.now(),this.removeOrphanedDocuments(t,n)))).next((v=>(f=Date.now(),wl()<=Kt.DEBUG&&vt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-m}ms
	Determined least recently used ${s} in `+(u-l)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${v} documents in `+(f-h)+`ms
Total Duration: ${f-m}ms`),ct.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:v}))))}}function $P(i,t){return new qP(i,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KP{constructor(){this.changes=new xo((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Mn.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return n!==void 0?ct.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WP{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YP{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(n=s,this.remoteDocumentCache.getEntry(t,e)))).next((s=>(n!==null&&Mu(n.mutation,s,ms.empty(),Ae.now()),s)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((n=>this.getLocalViewOfDocuments(t,n,Yt()).next((()=>n))))}getLocalViewOfDocuments(t,e,n=Yt()){const s=oo();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,n).next((o=>{let l=Au();return o.forEach(((u,h)=>{l=l.insert(u,h.overlayedDocument)})),l}))))}getOverlayedDocuments(t,e){const n=oo();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,Yt())))}populateOverlays(t,e,n){const s=[];return n.forEach((o=>{e.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(t,s).next((o=>{o.forEach(((l,u)=>{e.set(l,u)}))}))}computeViews(t,e,n,s){let o=_r();const l=ku(),u=(function(){return ku()})();return e.forEach(((h,f)=>{const m=n.get(f.key);s.has(f.key)&&(m===void 0||m.mutation instanceof Ea)?o=o.insert(f.key,f):m!==void 0?(l.set(f.key,m.mutation.getFieldMask()),Mu(m.mutation,f,m.mutation.getFieldMask(),Ae.now())):l.set(f.key,ms.empty())})),this.recalculateAndSaveOverlays(t,o).next((h=>(h.forEach(((f,m)=>l.set(f,m))),e.forEach(((f,m)=>u.set(f,new WP(m,l.get(f)??null)))),u)))}recalculateAndSaveOverlays(t,e){const n=ku();let s=new Ne(((l,u)=>l-u)),o=Yt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((l=>{for(const u of l)u.keys().forEach((h=>{const f=e.get(h);if(f===null)return;let m=n.get(h)||ms.empty();m=u.applyToLocalView(f,m),n.set(h,m);const v=(s.get(u.batchId)||Yt()).add(h);s=s.insert(u.batchId,v)}))})).next((()=>{const l=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),f=h.key,m=h.value,v=TT();m.forEach((b=>{if(!o.has(b)){const A=kT(e.get(b),n.get(b));A!==null&&v.set(b,A),o=o.add(b)}})),l.push(this.documentOverlayCache.saveOverlays(t,f,v))}return ct.waitFor(l)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((n=>this.recalculateAndSaveOverlays(t,n)))}getDocumentsMatchingQuery(t,e,n,s){return(function(l){return St.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):bT(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next((o=>{const l=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-o.size):ct.resolve(oo());let u=Uu,h=o;return l.next((f=>ct.forEach(f,((m,v)=>(u<v.largestBatchId&&(u=v.largestBatchId),o.get(m)?ct.resolve():this.remoteDocumentCache.getEntry(t,m).next((b=>{h=h.insert(m,b)}))))).next((()=>this.populateOverlays(t,f,o))).next((()=>this.computeViews(t,h,f,Yt()))).next((m=>({batchId:u,changes:ST(m)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new St(e)).next((n=>{let s=Au();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){const o=e.collectionGroup;let l=Au();return this.indexManager.getCollectionParents(t,o).next((u=>ct.forEach(u,(h=>{const f=(function(v,b){return new tc(b,null,v.explicitOrderBy.slice(),v.filters.slice(),v.limit,v.limitType,v.startAt,v.endAt)})(e,h.child(o));return this.getDocumentsMatchingCollectionQuery(t,f,n,s).next((m=>{m.forEach(((v,b)=>{l=l.insert(v,b)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(t,e,n,s){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,o,s)))).next((l=>{o.forEach(((h,f)=>{const m=f.getKey();l.get(m)===null&&(l=l.insert(m,Mn.newInvalidDocument(m)))}));let u=Au();return l.forEach(((h,f)=>{const m=o.get(h);m!==void 0&&Mu(m.mutation,f,ms.empty(),Ae.now()),rp(e,f)&&(u=u.insert(h,f))})),u}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XP{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return ct.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,(function(s){return{id:s.id,version:s.version,createTime:Ri(s.createTime)}})(e)),ct.resolve()}getNamedQuery(t,e){return ct.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,(function(s){return{name:s.name,query:UP(s.bundledQuery),readTime:Ri(s.readTime)}})(e)),ct.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QP{constructor(){this.overlays=new Ne(St.comparator),this.qr=new Map}getOverlay(t,e){return ct.resolve(this.overlays.get(e))}getOverlays(t,e){const n=oo();return ct.forEach(e,(s=>this.getOverlay(t,s).next((o=>{o!==null&&n.set(s,o)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((s,o)=>{this.St(t,e,o)})),ct.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.qr.get(n);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(n)),ct.resolve()}getOverlaysForCollection(t,e,n){const s=oo(),o=e.length+1,l=new St(e.child("")),u=this.overlays.getIteratorFrom(l);for(;u.hasNext();){const h=u.getNext().value,f=h.getKey();if(!e.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>n&&s.set(h.getKey(),h)}return ct.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let o=new Ne(((f,m)=>f-m));const l=this.overlays.getIterator();for(;l.hasNext();){const f=l.getNext().value;if(f.getKey().getCollectionGroup()===e&&f.largestBatchId>n){let m=o.get(f.largestBatchId);m===null&&(m=oo(),o=o.insert(f.largestBatchId,m)),m.set(f.getKey(),f)}}const u=oo(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((f,m)=>u.set(f,m))),!(u.size()>=s)););return ct.resolve(u)}St(t,e,n){const s=this.overlays.get(n.key);if(s!==null){const l=this.qr.get(s.largestBatchId).delete(n.key);this.qr.set(s.largestBatchId,l)}this.overlays=this.overlays.insert(n.key,new mP(e,n));let o=this.qr.get(e);o===void 0&&(o=Yt(),this.qr.set(e,o)),this.qr.set(e,o.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JP{constructor(){this.sessionToken=gn.EMPTY_BYTE_STRING}getSessionToken(t){return ct.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,ct.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xv{constructor(){this.Qr=new ln(pn.$r),this.Ur=new ln(pn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const n=new pn(t,e);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(t,e){t.forEach((n=>this.addReference(n,e)))}removeReference(t,e){this.Gr(new pn(t,e))}zr(t,e){t.forEach((n=>this.removeReference(n,e)))}jr(t){const e=new St(new be([])),n=new pn(e,t),s=new pn(e,t+1),o=[];return this.Ur.forEachInRange([n,s],(l=>{this.Gr(l),o.push(l.key)})),o}Jr(){this.Qr.forEach((t=>this.Gr(t)))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new St(new be([])),n=new pn(e,t),s=new pn(e,t+1);let o=Yt();return this.Ur.forEachInRange([n,s],(l=>{o=o.add(l.key)})),o}containsKey(t){const e=new pn(t,0),n=this.Qr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}}class pn{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return St.comparator(t.key,e.key)||Wt(t.Yr,e.Yr)}static Kr(t,e){return Wt(t.Yr,e.Yr)||St.comparator(t.key,e.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZP{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new ln(pn.$r)}checkEmpty(t){return ct.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new pP(o,e,n,s);this.mutationQueue.push(l);for(const u of s)this.Zr=this.Zr.add(new pn(u.key,o)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return ct.resolve(l)}lookupMutationBatch(t,e){return ct.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.ei(n),o=s<0?0:s;return ct.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return ct.resolve(this.mutationQueue.length===0?gv:this.tr-1)}getAllMutationBatches(t){return ct.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new pn(e,0),s=new pn(e,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([n,s],(l=>{const u=this.Xr(l.Yr);o.push(u)})),ct.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new ln(Wt);return e.forEach((s=>{const o=new pn(s,0),l=new pn(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,l],(u=>{n=n.add(u.Yr)}))})),ct.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let o=n;St.isDocumentKey(o)||(o=o.child(""));const l=new pn(new St(o),0);let u=new ln(Wt);return this.Zr.forEachWhile((h=>{const f=h.key.path;return!!n.isPrefixOf(f)&&(f.length===s&&(u=u.add(h.Yr)),!0)}),l),ct.resolve(this.ti(u))}ti(t){const e=[];return t.forEach((n=>{const s=this.Xr(n);s!==null&&e.push(s)})),e}removeMutationBatch(t,e){oe(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return ct.forEach(e.mutations,(s=>{const o=new pn(s.key,e.batchId);return n=n.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.Zr=n}))}ir(t){}containsKey(t,e){const n=new pn(e,0),s=this.Zr.firstAfterOrEqual(n);return ct.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,ct.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t2{constructor(t){this.ri=t,this.docs=(function(){return new Ne(St.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),o=s?s.size:0,l=this.ri(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return ct.resolve(n?n.document.mutableCopy():Mn.newInvalidDocument(e))}getEntries(t,e){let n=_r();return e.forEach((s=>{const o=this.docs.get(s);n=n.insert(s,o?o.document.mutableCopy():Mn.newInvalidDocument(s))})),ct.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let o=_r();const l=e.path,u=new St(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:f,value:{document:m}}=h.getNext();if(!l.isPrefixOf(f.path))break;f.path.length>l.length+1||RD(CD(m),n)<=0||(s.has(m.key)||rp(e,m))&&(o=o.insert(m.key,m.mutableCopy()))}return ct.resolve(o)}getAllFromCollectionGroup(t,e,n,s){Pt(9500)}ii(t,e){return ct.forEach(this.docs,(n=>e(n)))}newChangeBuffer(t){return new e2(this)}getSize(t){return ct.resolve(this.size)}}class e2 extends KP{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(n)})),ct.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n2{constructor(t){this.persistence=t,this.si=new xo((e=>_v(e)),bv),this.lastRemoteSnapshotVersion=jt.min(),this.highestTargetId=0,this.oi=0,this._i=new xv,this.targetCount=0,this.ai=ql.ur()}forEachTarget(t,e){return this.si.forEach(((n,s)=>e(s))),ct.resolve()}getLastRemoteSnapshotVersion(t){return ct.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return ct.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),ct.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.oi&&(this.oi=e),ct.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new ql(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,ct.resolve()}updateTargetData(t,e){return this.Pr(e),ct.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,ct.resolve()}removeTargets(t,e,n){let s=0;const o=[];return this.si.forEach(((l,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.si.delete(l),o.push(this.removeMatchingKeysForTargetId(t,u.targetId)),s++)})),ct.waitFor(o).next((()=>s))}getTargetCount(t){return ct.resolve(this.targetCount)}getTargetData(t,e){const n=this.si.get(e)||null;return ct.resolve(n)}addMatchingKeys(t,e,n){return this._i.Wr(e,n),ct.resolve()}removeMatchingKeys(t,e,n){this._i.zr(e,n);const s=this.persistence.referenceDelegate,o=[];return s&&e.forEach((l=>{o.push(s.markPotentiallyOrphaned(t,l))})),ct.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),ct.resolve()}getMatchingKeysForTargetId(t,e){const n=this._i.Hr(e);return ct.resolve(n)}containsKey(t,e){return ct.resolve(this._i.containsKey(e))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GT{constructor(t,e){this.ui={},this.overlays={},this.ci=new ep(0),this.li=!1,this.li=!0,this.hi=new JP,this.referenceDelegate=t(this),this.Pi=new n2(this),this.indexManager=new FP,this.remoteDocumentCache=(function(s){return new t2(s)})((n=>this.referenceDelegate.Ti(n))),this.serializer=new VP(e),this.Ii=new XP(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new QP,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ui[t.toKey()];return n||(n=new ZP(e,this.referenceDelegate),this.ui[t.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,n){vt("MemoryPersistence","Starting transaction:",t);const s=new s2(this.ci.next());return this.referenceDelegate.Ei(),n(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(t,e){return ct.or(Object.values(this.ui).map((n=>()=>n.containsKey(t,e))))}}class s2 extends ND{constructor(t){super(),this.currentSequenceNumber=t}}class Cv{constructor(t){this.persistence=t,this.Ri=new xv,this.Vi=null}static mi(t){return new Cv(t)}get fi(){if(this.Vi)return this.Vi;throw Pt(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.fi.delete(n.toString()),ct.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.fi.add(n.toString()),ct.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),ct.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach((s=>this.fi.add(s.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>n.removeTargetData(t,e)))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ct.forEach(this.fi,(n=>{const s=St.fromPath(n);return this.gi(t,s).next((o=>{o||e.removeEntry(s,jt.min())}))})).next((()=>(this.Vi=null,e.apply(t))))}updateLimboDocument(t,e){return this.gi(t,e).next((n=>{n?this.fi.delete(e.toString()):this.fi.add(e.toString())}))}Ti(t){return 0}gi(t,e){return ct.or([()=>ct.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class Lf{constructor(t,e){this.persistence=t,this.pi=new xo((n=>DD(n.path)),((n,s)=>n.isEqual(s))),this.garbageCollector=$P(this,e)}static mi(t,e){return new Lf(t,e)}Ei(){}di(t){return ct.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next((n=>e.next((s=>n+s))))}wr(t){let e=0;return this.pr(t,(n=>{e++})).next((()=>e))}pr(t,e){return ct.forEach(this.pi,((n,s)=>this.br(t,n,s).next((o=>o?ct.resolve():e(s)))))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(t,(l=>this.br(t,l,e).next((u=>{u||(n++,o.removeEntry(l,jt.min()))})))).next((()=>o.apply(t))).next((()=>n))}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),ct.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),ct.resolve()}removeReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),ct.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),ct.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=df(t.data.value)),e}br(t,e,n){return ct.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const s=this.pi.get(e);return ct.resolve(s!==void 0&&s>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rv{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Es=n,this.ds=s}static As(t,e){let n=Yt(),s=Yt();for(const o of e.docChanges)switch(o.type){case 0:n=n.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new Rv(t,e.fromCache,n,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i2{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r2{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return LI()?8:kD(Dn())>0?6:4})()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,s){const o={result:null};return this.ys(t,e).next((l=>{o.result=l})).next((()=>{if(!o.result)return this.ws(t,e,s,n).next((l=>{o.result=l}))})).next((()=>{if(o.result)return;const l=new i2;return this.Ss(t,e,l).next((u=>{if(o.result=u,this.Vs)return this.bs(t,e,l,u.size)}))})).next((()=>o.result))}bs(t,e,n,s){return n.documentReadCount<this.fs?(wl()<=Kt.DEBUG&&vt("QueryEngine","SDK will not create cache indexes for query:",El(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ct.resolve()):(wl()<=Kt.DEBUG&&vt("QueryEngine","Query:",El(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.gs*s?(wl()<=Kt.DEBUG&&vt("QueryEngine","The SDK decides to create cache indexes for query:",El(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ci(e))):ct.resolve())}ys(t,e){if(DE(e))return ct.resolve(null);let n=Ci(e);return this.indexManager.getIndexType(t,n).next((s=>s===0?null:(e.limit!==null&&s===1&&(e=wy(e,null,"F"),n=Ci(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((o=>{const l=Yt(...o);return this.ps.getDocuments(t,l).next((u=>this.indexManager.getMinOffset(t,n).next((h=>{const f=this.Ds(e,u);return this.Cs(e,f,l,h.readTime)?this.ys(t,wy(e,null,"F")):this.vs(t,f,e,h)}))))})))))}ws(t,e,n,s){return DE(e)||s.isEqual(jt.min())?ct.resolve(null):this.ps.getDocuments(t,n).next((o=>{const l=this.Ds(e,o);return this.Cs(e,l,n,s)?ct.resolve(null):(wl()<=Kt.DEBUG&&vt("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),El(e)),this.vs(t,l,e,xD(s,Uu)).next((u=>u)))}))}Ds(t,e){let n=new ln(wT(t));return e.forEach(((s,o)=>{rp(t,o)&&(n=n.add(o))})),n}Cs(t,e,n,s){if(t.limit===null)return!1;if(n.size!==e.size)return!0;const o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(t,e,n){return wl()<=Kt.DEBUG&&vt("QueryEngine","Using full collection scan to execute query:",El(e)),this.ps.getDocumentsMatchingQuery(t,e,ua.min(),n)}vs(t,e,n,s){return this.ps.getDocumentsMatchingQuery(t,n,s).next((o=>(e.forEach((l=>{o=o.insert(l.key,l)})),o)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iv="LocalStore",a2=3e8;class o2{constructor(t,e,n,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new Ne(Wt),this.xs=new xo((o=>_v(o)),bv),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(n)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new YP(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}function l2(i,t,e,n){return new o2(i,t,e,n)}async function qT(i,t){const e=Ft(i);return await e.persistence.runTransaction("Handle user change","readonly",(n=>{let s;return e.mutationQueue.getAllMutationBatches(n).next((o=>(s=o,e.Bs(t),e.mutationQueue.getAllMutationBatches(n)))).next((o=>{const l=[],u=[];let h=Yt();for(const f of s){l.push(f.batchId);for(const m of f.mutations)h=h.add(m.key)}for(const f of o){u.push(f.batchId);for(const m of f.mutations)h=h.add(m.key)}return e.localDocuments.getDocuments(n,h).next((f=>({Ls:f,removedBatchIds:l,addedBatchIds:u})))}))}))}function c2(i,t){const e=Ft(i);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const s=t.batch.keys(),o=e.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,h,f,m){const v=f.batch,b=v.keys();let A=ct.resolve();return b.forEach((S=>{A=A.next((()=>m.getEntry(h,S))).next((E=>{const T=f.docVersions.get(S);oe(T!==null,48541),E.version.compareTo(T)<0&&(v.applyToRemoteDocument(E,f),E.isValidDocument()&&(E.setReadTime(f.commitVersion),m.addEntry(E)))}))})),A.next((()=>u.mutationQueue.removeMutationBatch(h,v)))})(e,n,t,o).next((()=>o.apply(n))).next((()=>e.mutationQueue.performConsistencyCheck(n))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(n,s,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(u){let h=Yt();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(h=h.add(u.batch.mutations[f].key));return h})(t)))).next((()=>e.localDocuments.getDocuments(n,s)))}))}function $T(i){const t=Ft(i);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Pi.getLastRemoteSnapshotVersion(e)))}function u2(i,t){const e=Ft(i),n=t.snapshotVersion;let s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const l=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;const u=[];t.targetChanges.forEach(((m,v)=>{const b=s.get(v);if(!b)return;u.push(e.Pi.removeMatchingKeys(o,m.removedDocuments,v).next((()=>e.Pi.addMatchingKeys(o,m.addedDocuments,v))));let A=b.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(v)!==null?A=A.withResumeToken(gn.EMPTY_BYTE_STRING,jt.min()).withLastLimboFreeSnapshotVersion(jt.min()):m.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(m.resumeToken,n)),s=s.insert(v,A),(function(E,T,C){return E.resumeToken.approximateByteSize()===0||T.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=a2?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0})(b,A,m)&&u.push(e.Pi.updateTargetData(o,A))}));let h=_r(),f=Yt();if(t.documentUpdates.forEach((m=>{t.resolvedLimboDocuments.has(m)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(o,m))})),u.push(h2(o,l,t.documentUpdates).next((m=>{h=m.ks,f=m.qs}))),!n.isEqual(jt.min())){const m=e.Pi.getLastRemoteSnapshotVersion(o).next((v=>e.Pi.setTargetsMetadata(o,o.currentSequenceNumber,n)));u.push(m)}return ct.waitFor(u).next((()=>l.apply(o))).next((()=>e.localDocuments.getLocalViewOfDocuments(o,h,f))).next((()=>h))})).then((o=>(e.Ms=s,o)))}function h2(i,t,e){let n=Yt(),s=Yt();return e.forEach((o=>n=n.add(o))),t.getEntries(i,n).next((o=>{let l=_r();return e.forEach(((u,h)=>{const f=o.get(u);h.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual(jt.min())?(t.removeEntry(u,h.readTime),l=l.insert(u,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(t.addEntry(h),l=l.insert(u,h)):vt(Iv,"Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",h.version)})),{ks:l,qs:s}}))}function d2(i,t){const e=Ft(i);return e.persistence.runTransaction("Get next mutation batch","readonly",(n=>(t===void 0&&(t=gv),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t))))}function f2(i,t){const e=Ft(i);return e.persistence.runTransaction("Allocate target","readwrite",(n=>{let s;return e.Pi.getTargetData(n,t).next((o=>o?(s=o,ct.resolve(s)):e.Pi.allocateTargetId(n).next((l=>(s=new ia(t,l,"TargetPurposeListen",n.currentSequenceNumber),e.Pi.addTargetData(n,s).next((()=>s)))))))})).then((n=>{const s=e.Ms.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(n.targetId,n),e.xs.set(t,n.targetId)),n}))}async function Cy(i,t,e){const n=Ft(i),s=n.Ms.get(t),o=e?"readwrite":"readwrite-primary";try{e||await n.persistence.runTransaction("Release target",o,(l=>n.persistence.referenceDelegate.removeTarget(l,s)))}catch(l){if(!Zl(l))throw l;vt(Iv,`Failed to update sequence numbers for target ${t}: ${l}`)}n.Ms=n.Ms.remove(t),n.xs.delete(s.target)}function $E(i,t,e){const n=Ft(i);let s=jt.min(),o=Yt();return n.persistence.runTransaction("Execute query","readwrite",(l=>(function(h,f,m){const v=Ft(h),b=v.xs.get(m);return b!==void 0?ct.resolve(v.Ms.get(b)):v.Pi.getTargetData(f,m)})(n,l,Ci(t)).next((u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(l,u.targetId).next((h=>{o=h}))})).next((()=>n.Fs.getDocumentsMatchingQuery(l,t,e?s:jt.min(),e?o:Yt()))).next((u=>(p2(n,JD(t),u),{documents:u,Qs:o})))))}function p2(i,t,e){let n=i.Os.get(t)||jt.min();e.forEach(((s,o)=>{o.readTime.compareTo(n)>0&&(n=o.readTime)})),i.Os.set(t,n)}class KE{constructor(){this.activeTargetIds=iP()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class m2{constructor(){this.Mo=new KE,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,n){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new KE,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g2{Oo(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WE="ConnectivityMonitor";class YE{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){vt(WE,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){vt(WE,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wd=null;function Ry(){return Wd===null?Wd=(function(){return 268435456+Math.round(2147483648*Math.random())})():Wd++,"0x"+Wd.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hg="RestConnection",y2={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class v2{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${n}/databases/${s}`,this.Wo=this.databaseId.database===Nf?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Go(t,e,n,s,o){const l=Ry(),u=this.zo(t,e.toUriEncodedString());vt(Hg,`Sending RPC '${t}' ${l}:`,u,n);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:f}=new URL(u),m=So(f);return this.Jo(t,u,h,n,m).then((v=>(vt(Hg,`Received RPC '${t}' ${l}: `,v),v)),(v=>{throw _o(Hg,`RPC '${t}' ${l} failed with error: `,v,"url: ",u,"request:",n),v}))}Ho(t,e,n,s,o,l){return this.Go(t,e,n,s,o)}jo(t,e,n){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Ql})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((s,o)=>t[o]=s)),n&&n.headers.forEach(((s,o)=>t[o]=s))}zo(t,e){const n=y2[t];return`${this.Uo}/v1/${e}:${n}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _2{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const In="WebChannelConnection";class b2 extends v2{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,s,o){const l=Ry();return new Promise(((u,h)=>{const f=new KS;f.setWithCredentials(!0),f.listenOnce(WS.COMPLETE,(()=>{try{switch(f.getLastErrorCode()){case hf.NO_ERROR:const v=f.getResponseJson();vt(In,`XHR for RPC '${t}' ${l} received:`,JSON.stringify(v)),u(v);break;case hf.TIMEOUT:vt(In,`RPC '${t}' ${l} timed out`),h(new yt(at.DEADLINE_EXCEEDED,"Request time out"));break;case hf.HTTP_ERROR:const b=f.getStatus();if(vt(In,`RPC '${t}' ${l} failed with status:`,b,"response text:",f.getResponseText()),b>0){let A=f.getResponseJson();Array.isArray(A)&&(A=A[0]);const S=A?.error;if(S&&S.status&&S.message){const E=(function(C){const L=C.toLowerCase().replace(/_/g,"-");return Object.values(at).indexOf(L)>=0?L:at.UNKNOWN})(S.status);h(new yt(E,S.message))}else h(new yt(at.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new yt(at.UNAVAILABLE,"Connection failed."));break;default:Pt(9055,{l_:t,streamId:l,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{vt(In,`RPC '${t}' ${l} completed.`)}}));const m=JSON.stringify(s);vt(In,`RPC '${t}' ${l} sending request:`,s),f.send(e,"POST",m,n,15)}))}T_(t,e,n){const s=Ry(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],l=QS(),u=XS(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,e,n),h.encodeInitMessageHeaders=!0;const m=o.join("");vt(In,`Creating RPC '${t}' stream ${s}: ${m}`,h);const v=l.createWebChannel(m,h);this.I_(v);let b=!1,A=!1;const S=new _2({Yo:T=>{A?vt(In,`Not sending because RPC '${t}' stream ${s} is closed:`,T):(b||(vt(In,`Opening RPC '${t}' stream ${s} transport.`),v.open(),b=!0),vt(In,`RPC '${t}' stream ${s} sending:`,T),v.send(T))},Zo:()=>v.close()}),E=(T,C,L)=>{T.listen(C,(k=>{try{L(k)}catch(V){setTimeout((()=>{throw V}),0)}}))};return E(v,bu.EventType.OPEN,(()=>{A||(vt(In,`RPC '${t}' stream ${s} transport opened.`),S.o_())})),E(v,bu.EventType.CLOSE,(()=>{A||(A=!0,vt(In,`RPC '${t}' stream ${s} transport closed`),S.a_(),this.E_(v))})),E(v,bu.EventType.ERROR,(T=>{A||(A=!0,_o(In,`RPC '${t}' stream ${s} transport errored. Name:`,T.name,"Message:",T.message),S.a_(new yt(at.UNAVAILABLE,"The operation could not be completed")))})),E(v,bu.EventType.MESSAGE,(T=>{if(!A){const C=T.data[0];oe(!!C,16349);const L=C,k=L?.error||L[0]?.error;if(k){vt(In,`RPC '${t}' stream ${s} received error:`,k);const V=k.status;let P=(function(N){const M=Xe[N];if(M!==void 0)return DT(M)})(V),G=k.message;P===void 0&&(P=at.INTERNAL,G="Unknown error status: "+V+" with message "+k.message),A=!0,S.a_(new yt(P,G)),v.close()}else vt(In,`RPC '${t}' stream ${s} received:`,C),S.u_(C)}})),E(u,YS.STAT_EVENT,(T=>{T.stat===my.PROXY?vt(In,`RPC '${t}' stream ${s} detected buffering proxy`):T.stat===my.NOPROXY&&vt(In,`RPC '${t}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{S.__()}),0),S}terminate(){this.c_.forEach((t=>t.close())),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter((e=>e===t))}}function Gg(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function up(i){return new SP(i,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KT{constructor(t,e,n=1e3,s=1.5,o=6e4){this.Mi=t,this.timerId=e,this.d_=n,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-n);s>0&&vt("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),t()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XE="PersistentStream";class WT{constructor(t,e,n,s,o,l,u,h){this.Mi=t,this.S_=n,this.b_=s,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new KT(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===at.RESOURCE_EXHAUSTED?(vr(e.toString()),vr("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===at.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,s])=>{this.D_===e&&this.G_(n,s)}),(n=>{t((()=>{const s=new yt(at.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(s)}))}))}G_(t,e){const n=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{n((()=>this.z_(s)))})),this.stream.onMessage((s=>{n((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return vt(XE,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget((()=>this.D_===t?e():(vt(XE,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class A2 extends WT{constructor(t,e,n,s,o,l){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,l),this.serializer=o}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=CP(this.serializer,t),n=(function(o){if(!("targetChange"in o))return jt.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?jt.min():l.readTime?Ri(l.readTime):jt.min()})(t);return this.listener.H_(e,n)}Y_(t){const e={};e.database=xy(this.serializer),e.addTarget=(function(o,l){let u;const h=l.target;if(u=by(h)?{documents:NP(o,h)}:{query:kP(o,h).ft},u.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){u.resumeToken=OT(o,l.resumeToken);const f=Ey(o,l.expectedCount);f!==null&&(u.expectedCount=f)}else if(l.snapshotVersion.compareTo(jt.min())>0){u.readTime=Pf(o,l.snapshotVersion.toTimestamp());const f=Ey(o,l.expectedCount);f!==null&&(u.expectedCount=f)}return u})(this.serializer,t);const n=DP(this.serializer,t);n&&(e.labels=n),this.q_(e)}Z_(t){const e={};e.database=xy(this.serializer),e.removeTarget=t,this.q_(e)}}class w2 extends WT{constructor(t,e,n,s,o,l){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,l),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return oe(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,oe(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){oe(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=IP(t.writeResults,t.commitTime),n=Ri(t.commitTime);return this.listener.na(n,e)}ra(){const t={};t.database=xy(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((n=>RP(this.serializer,n)))};this.q_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E2{}class S2 extends E2{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new yt(at.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Go(t,Sy(e,n),s,o,l))).catch((o=>{throw o.name==="FirebaseError"?(o.code===at.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new yt(at.UNKNOWN,o.toString())}))}Ho(t,e,n,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,u])=>this.connection.Ho(t,Sy(e,n),s,l,u,o))).catch((l=>{throw l.name==="FirebaseError"?(l.code===at.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new yt(at.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class T2{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(vr(e),this.aa=!1):vt("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bo="RemoteStore";class x2{constructor(t,e,n,s,o){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((l=>{n.enqueueAndForget((async()=>{Co(this)&&(vt(bo,"Restarting streams for network reachability change."),await(async function(h){const f=Ft(h);f.Ea.add(4),await ah(f),f.Ra.set("Unknown"),f.Ea.delete(4),await hp(f)})(this))}))})),this.Ra=new T2(n,s)}}async function hp(i){if(Co(i))for(const t of i.da)await t(!0)}async function ah(i){for(const t of i.da)await t(!1)}function YT(i,t){const e=Ft(i);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),Dv(e)?Mv(e):ec(e).O_()&&kv(e,t))}function Nv(i,t){const e=Ft(i),n=ec(e);e.Ia.delete(t),n.O_()&&XT(e,t),e.Ia.size===0&&(n.O_()?n.L_():Co(e)&&e.Ra.set("Unknown"))}function kv(i,t){if(i.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(jt.min())>0){const e=i.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}ec(i).Y_(t)}function XT(i,t){i.Va.Ue(t),ec(i).Z_(t)}function Mv(i){i.Va=new bP({getRemoteKeysForTarget:t=>i.remoteSyncer.getRemoteKeysForTarget(t),At:t=>i.Ia.get(t)||null,ht:()=>i.datastore.serializer.databaseId}),ec(i).start(),i.Ra.ua()}function Dv(i){return Co(i)&&!ec(i).x_()&&i.Ia.size>0}function Co(i){return Ft(i).Ea.size===0}function QT(i){i.Va=void 0}async function C2(i){i.Ra.set("Online")}async function R2(i){i.Ia.forEach(((t,e)=>{kv(i,t)}))}async function I2(i,t){QT(i),Dv(i)?(i.Ra.ha(t),Mv(i)):i.Ra.set("Unknown")}async function N2(i,t,e){if(i.Ra.set("Online"),t instanceof LT&&t.state===2&&t.cause)try{await(async function(s,o){const l=o.cause;for(const u of o.targetIds)s.Ia.has(u)&&(await s.remoteSyncer.rejectListen(u,l),s.Ia.delete(u),s.Va.removeTarget(u))})(i,t)}catch(n){vt(bo,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Of(i,n)}else if(t instanceof mf?i.Va.Ze(t):t instanceof PT?i.Va.st(t):i.Va.tt(t),!e.isEqual(jt.min()))try{const n=await $T(i.localStore);e.compareTo(n)>=0&&await(function(o,l){const u=o.Va.Tt(l);return u.targetChanges.forEach(((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const m=o.Ia.get(f);m&&o.Ia.set(f,m.withResumeToken(h.resumeToken,l))}})),u.targetMismatches.forEach(((h,f)=>{const m=o.Ia.get(h);if(!m)return;o.Ia.set(h,m.withResumeToken(gn.EMPTY_BYTE_STRING,m.snapshotVersion)),XT(o,h);const v=new ia(m.target,h,f,m.sequenceNumber);kv(o,v)})),o.remoteSyncer.applyRemoteEvent(u)})(i,e)}catch(n){vt(bo,"Failed to raise snapshot:",n),await Of(i,n)}}async function Of(i,t,e){if(!Zl(t))throw t;i.Ea.add(1),await ah(i),i.Ra.set("Offline"),e||(e=()=>$T(i.localStore)),i.asyncQueue.enqueueRetryable((async()=>{vt(bo,"Retrying IndexedDB access"),await e(),i.Ea.delete(1),await hp(i)}))}function JT(i,t){return t().catch((e=>Of(i,e,t)))}async function dp(i){const t=Ft(i),e=pa(t);let n=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:gv;for(;k2(t);)try{const s=await d2(t.localStore,n);if(s===null){t.Ta.length===0&&e.L_();break}n=s.batchId,M2(t,s)}catch(s){await Of(t,s)}ZT(t)&&tx(t)}function k2(i){return Co(i)&&i.Ta.length<10}function M2(i,t){i.Ta.push(t);const e=pa(i);e.O_()&&e.X_&&e.ea(t.mutations)}function ZT(i){return Co(i)&&!pa(i).x_()&&i.Ta.length>0}function tx(i){pa(i).start()}async function D2(i){pa(i).ra()}async function P2(i){const t=pa(i);for(const e of i.Ta)t.ea(e.mutations)}async function L2(i,t,e){const n=i.Ta.shift(),s=Ev.from(n,t,e);await JT(i,(()=>i.remoteSyncer.applySuccessfulWrite(s))),await dp(i)}async function O2(i,t){t&&pa(i).X_&&await(async function(n,s){if((function(l){return yP(l)&&l!==at.ABORTED})(s.code)){const o=n.Ta.shift();pa(n).B_(),await JT(n,(()=>n.remoteSyncer.rejectFailedWrite(o.batchId,s))),await dp(n)}})(i,t),ZT(i)&&tx(i)}async function QE(i,t){const e=Ft(i);e.asyncQueue.verifyOperationInProgress(),vt(bo,"RemoteStore received new credentials");const n=Co(e);e.Ea.add(3),await ah(e),n&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await hp(e)}async function j2(i,t){const e=Ft(i);t?(e.Ea.delete(2),await hp(e)):t||(e.Ea.add(2),await ah(e),e.Ra.set("Unknown"))}function ec(i){return i.ma||(i.ma=(function(e,n,s){const o=Ft(e);return o.sa(),new A2(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(i.datastore,i.asyncQueue,{Xo:C2.bind(null,i),t_:R2.bind(null,i),r_:I2.bind(null,i),H_:N2.bind(null,i)}),i.da.push((async t=>{t?(i.ma.B_(),Dv(i)?Mv(i):i.Ra.set("Unknown")):(await i.ma.stop(),QT(i))}))),i.ma}function pa(i){return i.fa||(i.fa=(function(e,n,s){const o=Ft(e);return o.sa(),new w2(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(i.datastore,i.asyncQueue,{Xo:()=>Promise.resolve(),t_:D2.bind(null,i),r_:O2.bind(null,i),ta:P2.bind(null,i),na:L2.bind(null,i)}),i.da.push((async t=>{t?(i.fa.B_(),await dp(i)):(await i.fa.stop(),i.Ta.length>0&&(vt(bo,`Stopping write stream with ${i.Ta.length} pending writes`),i.Ta=[]))}))),i.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pv{constructor(t,e,n,s,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=o,this.deferred=new fr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,o){const l=Date.now()+n,u=new Pv(t,e,l,s,o);return u.start(n),u}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new yt(at.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Lv(i,t){if(vr("AsyncQueue",`${t}: ${i}`),Zl(i))return new yt(at.UNAVAILABLE,`${t}: ${i}`);throw i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jl{static emptySet(t){return new jl(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||St.comparator(e.key,n.key):(e,n)=>St.comparator(e.key,n.key),this.keyedMap=Au(),this.sortedSet=new Ne(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof jl)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const s=e.getNext().key,o=n.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const n=new jl;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JE{constructor(){this.ga=new Ne(St.comparator)}track(t){const e=t.doc.key,n=this.ga.get(e);n?t.type!==0&&n.type===3?this.ga=this.ga.insert(e,t):t.type===3&&n.type!==1?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.ga=this.ga.remove(e):t.type===1&&n.type===2?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):Pt(63341,{Rt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,n)=>{t.push(n)})),t}}class $l{constructor(t,e,n,s,o,l,u,h,f){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(t,e,n,s,o){const l=[];return e.forEach((u=>{l.push({type:0,doc:u})})),new $l(t,e,jl.emptySet(e),l,n,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ip(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==n[s].type||!e[s].doc.isEqual(n[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V2{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((t=>t.Da()))}}class U2{constructor(){this.queries=ZE(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,n){const s=Ft(e),o=s.queries;s.queries=ZE(),o.forEach(((l,u)=>{for(const h of u.Sa)h.onError(n)}))})(this,new yt(at.ABORTED,"Firestore shutting down"))}}function ZE(){return new xo((i=>AT(i)),ip)}async function ex(i,t){const e=Ft(i);let n=3;const s=t.query;let o=e.queries.get(s);o?!o.ba()&&t.Da()&&(n=2):(o=new V2,n=t.Da()?0:1);try{switch(n){case 0:o.wa=await e.onListen(s,!0);break;case 1:o.wa=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(l){const u=Lv(l,`Initialization of query '${El(t.query)}' failed`);return void t.onError(u)}e.queries.set(s,o),o.Sa.push(t),t.va(e.onlineState),o.wa&&t.Fa(o.wa)&&Ov(e)}async function nx(i,t){const e=Ft(i),n=t.query;let s=3;const o=e.queries.get(n);if(o){const l=o.Sa.indexOf(t);l>=0&&(o.Sa.splice(l,1),o.Sa.length===0?s=t.Da()?0:1:!o.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function F2(i,t){const e=Ft(i);let n=!1;for(const s of t){const o=s.query,l=e.queries.get(o);if(l){for(const u of l.Sa)u.Fa(s)&&(n=!0);l.wa=s}}n&&Ov(e)}function B2(i,t,e){const n=Ft(i),s=n.queries.get(t);if(s)for(const o of s.Sa)o.onError(e);n.queries.delete(t)}function Ov(i){i.Ca.forEach((t=>{t.next()}))}var Iy,t0;(t0=Iy||(Iy={})).Ma="default",t0.Cache="cache";class sx{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){const n=[];for(const s of t.docChanges)s.type!==3&&n.push(s);t=new $l(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;const n=e!=="Offline";return(!this.options.qa||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=$l.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==Iy.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ix{constructor(t){this.key=t}}class rx{constructor(t){this.key=t}}class z2{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Yt(),this.mutatedKeys=Yt(),this.eu=wT(t),this.tu=new jl(this.eu)}get nu(){return this.Ya}ru(t,e){const n=e?e.iu:new JE,s=e?e.tu:this.tu;let o=e?e.mutatedKeys:this.mutatedKeys,l=s,u=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,f=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((m,v)=>{const b=s.get(m),A=rp(this.query,v)?v:null,S=!!b&&this.mutatedKeys.has(b.key),E=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations);let T=!1;b&&A?b.data.isEqual(A.data)?S!==E&&(n.track({type:3,doc:A}),T=!0):this.su(b,A)||(n.track({type:2,doc:A}),T=!0,(h&&this.eu(A,h)>0||f&&this.eu(A,f)<0)&&(u=!0)):!b&&A?(n.track({type:0,doc:A}),T=!0):b&&!A&&(n.track({type:1,doc:b}),T=!0,(h||f)&&(u=!0)),T&&(A?(l=l.add(A),o=E?o.add(m):o.delete(m)):(l=l.delete(m),o=o.delete(m)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const m=this.query.limitType==="F"?l.last():l.first();l=l.delete(m.key),o=o.delete(m.key),n.track({type:1,doc:m})}return{tu:l,iu:n,Cs:u,mutatedKeys:o}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){const o=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const l=t.iu.ya();l.sort(((m,v)=>(function(A,S){const E=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Pt(20277,{Rt:T})}};return E(A)-E(S)})(m.type,v.type)||this.eu(m.doc,v.doc))),this.ou(n),s=s??!1;const u=e&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,f=h!==this.Za;return this.Za=h,l.length!==0||f?{snapshot:new $l(this.query,t.tu,o,l,t.mutatedKeys,h===0,f,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new JE,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((e=>this.Ya=this.Ya.add(e))),t.modifiedDocuments.forEach((e=>{})),t.removedDocuments.forEach((e=>this.Ya=this.Ya.delete(e))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=Yt(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))}));const e=[];return t.forEach((n=>{this.Xa.has(n)||e.push(new rx(n))})),this.Xa.forEach((n=>{t.has(n)||e.push(new ix(n))})),e}cu(t){this.Ya=t.Qs,this.Xa=Yt();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return $l.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const jv="SyncEngine";class H2{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class G2{constructor(t){this.key=t,this.hu=!1}}class q2{constructor(t,e,n,s,o,l){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new xo((u=>AT(u)),ip),this.Iu=new Map,this.Eu=new Set,this.du=new Ne(St.comparator),this.Au=new Map,this.Ru=new xv,this.Vu={},this.mu=new Map,this.fu=ql.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function $2(i,t,e=!0){const n=hx(i);let s;const o=n.Tu.get(t);return o?(n.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await ax(n,t,e,!0),s}async function K2(i,t){const e=hx(i);await ax(e,t,!0,!1)}async function ax(i,t,e,n){const s=await f2(i.localStore,Ci(t)),o=s.targetId,l=i.sharedClientState.addLocalQueryTarget(o,e);let u;return n&&(u=await W2(i,t,o,l==="current",s.resumeToken)),i.isPrimaryClient&&e&&YT(i.remoteStore,s),u}async function W2(i,t,e,n,s){i.pu=(v,b,A)=>(async function(E,T,C,L){let k=T.view.ru(C);k.Cs&&(k=await $E(E.localStore,T.query,!1).then((({documents:I})=>T.view.ru(I,k))));const V=L&&L.targetChanges.get(T.targetId),P=L&&L.targetMismatches.get(T.targetId)!=null,G=T.view.applyChanges(k,E.isPrimaryClient,V,P);return n0(E,T.targetId,G.au),G.snapshot})(i,v,b,A);const o=await $E(i.localStore,t,!0),l=new z2(t,o.Qs),u=l.ru(o.documents),h=rh.createSynthesizedTargetChangeForCurrentChange(e,n&&i.onlineState!=="Offline",s),f=l.applyChanges(u,i.isPrimaryClient,h);n0(i,e,f.au);const m=new H2(t,e,l);return i.Tu.set(t,m),i.Iu.has(e)?i.Iu.get(e).push(t):i.Iu.set(e,[t]),f.snapshot}async function Y2(i,t,e){const n=Ft(i),s=n.Tu.get(t),o=n.Iu.get(s.targetId);if(o.length>1)return n.Iu.set(s.targetId,o.filter((l=>!ip(l,t)))),void n.Tu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Cy(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),e&&Nv(n.remoteStore,s.targetId),Ny(n,s.targetId)})).catch(Jl)):(Ny(n,s.targetId),await Cy(n.localStore,s.targetId,!0))}async function X2(i,t){const e=Ft(i),n=e.Tu.get(t),s=e.Iu.get(n.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),Nv(e.remoteStore,n.targetId))}async function Q2(i,t,e){const n=iL(i);try{const s=await(function(l,u){const h=Ft(l),f=Ae.now(),m=u.reduce(((A,S)=>A.add(S.key)),Yt());let v,b;return h.persistence.runTransaction("Locally write mutations","readwrite",(A=>{let S=_r(),E=Yt();return h.Ns.getEntries(A,m).next((T=>{S=T,S.forEach(((C,L)=>{L.isValidDocument()||(E=E.add(C))}))})).next((()=>h.localDocuments.getOverlayedDocuments(A,S))).next((T=>{v=T;const C=[];for(const L of u){const k=dP(L,v.get(L.key).overlayedDocument);k!=null&&C.push(new Ea(L.key,k,fT(k.value.mapValue),Hn.exists(!0)))}return h.mutationQueue.addMutationBatch(A,f,C,u)})).next((T=>{b=T;const C=T.applyToLocalDocumentSet(v,E);return h.documentOverlayCache.saveOverlays(A,T.batchId,C)}))})).then((()=>({batchId:b.batchId,changes:ST(v)})))})(n.localStore,t);n.sharedClientState.addPendingMutation(s.batchId),(function(l,u,h){let f=l.Vu[l.currentUser.toKey()];f||(f=new Ne(Wt)),f=f.insert(u,h),l.Vu[l.currentUser.toKey()]=f})(n,s.batchId,e),await oh(n,s.changes),await dp(n.remoteStore)}catch(s){const o=Lv(s,"Failed to persist write");e.reject(o)}}async function ox(i,t){const e=Ft(i);try{const n=await u2(e.localStore,t);t.targetChanges.forEach(((s,o)=>{const l=e.Au.get(o);l&&(oe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?l.hu=!0:s.modifiedDocuments.size>0?oe(l.hu,14607):s.removedDocuments.size>0&&(oe(l.hu,42227),l.hu=!1))})),await oh(e,n,t)}catch(n){await Jl(n)}}function e0(i,t,e){const n=Ft(i);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){const s=[];n.Tu.forEach(((o,l)=>{const u=l.view.va(t);u.snapshot&&s.push(u.snapshot)})),(function(l,u){const h=Ft(l);h.onlineState=u;let f=!1;h.queries.forEach(((m,v)=>{for(const b of v.Sa)b.va(u)&&(f=!0)})),f&&Ov(h)})(n.eventManager,t),s.length&&n.Pu.H_(s),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function J2(i,t,e){const n=Ft(i);n.sharedClientState.updateQueryState(t,"rejected",e);const s=n.Au.get(t),o=s&&s.key;if(o){let l=new Ne(St.comparator);l=l.insert(o,Mn.newNoDocument(o,jt.min()));const u=Yt().add(o),h=new cp(jt.min(),new Map,new Ne(Wt),l,u);await ox(n,h),n.du=n.du.remove(o),n.Au.delete(t),Vv(n)}else await Cy(n.localStore,t,!1).then((()=>Ny(n,t,e))).catch(Jl)}async function Z2(i,t){const e=Ft(i),n=t.batch.batchId;try{const s=await c2(e.localStore,t);cx(e,n,null),lx(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await oh(e,s)}catch(s){await Jl(s)}}async function tL(i,t,e){const n=Ft(i);try{const s=await(function(l,u){const h=Ft(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",(f=>{let m;return h.mutationQueue.lookupMutationBatch(f,u).next((v=>(oe(v!==null,37113),m=v.keys(),h.mutationQueue.removeMutationBatch(f,v)))).next((()=>h.mutationQueue.performConsistencyCheck(f))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(f,m,u))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m))).next((()=>h.localDocuments.getDocuments(f,m)))}))})(n.localStore,t);cx(n,t,e),lx(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),await oh(n,s)}catch(s){await Jl(s)}}function lx(i,t){(i.mu.get(t)||[]).forEach((e=>{e.resolve()})),i.mu.delete(t)}function cx(i,t,e){const n=Ft(i);let s=n.Vu[n.currentUser.toKey()];if(s){const o=s.get(t);o&&(e?o.reject(e):o.resolve(),s=s.remove(t)),n.Vu[n.currentUser.toKey()]=s}}function Ny(i,t,e=null){i.sharedClientState.removeLocalQueryTarget(t);for(const n of i.Iu.get(t))i.Tu.delete(n),e&&i.Pu.yu(n,e);i.Iu.delete(t),i.isPrimaryClient&&i.Ru.jr(t).forEach((n=>{i.Ru.containsKey(n)||ux(i,n)}))}function ux(i,t){i.Eu.delete(t.path.canonicalString());const e=i.du.get(t);e!==null&&(Nv(i.remoteStore,e),i.du=i.du.remove(t),i.Au.delete(e),Vv(i))}function n0(i,t,e){for(const n of e)n instanceof ix?(i.Ru.addReference(n.key,t),eL(i,n)):n instanceof rx?(vt(jv,"Document no longer in limbo: "+n.key),i.Ru.removeReference(n.key,t),i.Ru.containsKey(n.key)||ux(i,n.key)):Pt(19791,{wu:n})}function eL(i,t){const e=t.key,n=e.path.canonicalString();i.du.get(e)||i.Eu.has(n)||(vt(jv,"New document in limbo: "+e),i.Eu.add(n),Vv(i))}function Vv(i){for(;i.Eu.size>0&&i.du.size<i.maxConcurrentLimboResolutions;){const t=i.Eu.values().next().value;i.Eu.delete(t);const e=new St(be.fromString(t)),n=i.fu.next();i.Au.set(n,new G2(e)),i.du=i.du.insert(e,n),YT(i.remoteStore,new ia(Ci(Av(e.path)),n,"TargetPurposeLimboResolution",ep.ce))}}async function oh(i,t,e){const n=Ft(i),s=[],o=[],l=[];n.Tu.isEmpty()||(n.Tu.forEach(((u,h)=>{l.push(n.pu(h,t,e).then((f=>{if((f||e)&&n.isPrimaryClient){const m=f?!f.fromCache:e?.targetChanges.get(h.targetId)?.current;n.sharedClientState.updateQueryState(h.targetId,m?"current":"not-current")}if(f){s.push(f);const m=Rv.As(h.targetId,f);o.push(m)}})))})),await Promise.all(l),n.Pu.H_(s),await(async function(h,f){const m=Ft(h);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",(v=>ct.forEach(f,(b=>ct.forEach(b.Es,(A=>m.persistence.referenceDelegate.addReference(v,b.targetId,A))).next((()=>ct.forEach(b.ds,(A=>m.persistence.referenceDelegate.removeReference(v,b.targetId,A)))))))))}catch(v){if(!Zl(v))throw v;vt(Iv,"Failed to update sequence numbers: "+v)}for(const v of f){const b=v.targetId;if(!v.fromCache){const A=m.Ms.get(b),S=A.snapshotVersion,E=A.withLastLimboFreeSnapshotVersion(S);m.Ms=m.Ms.insert(b,E)}}})(n.localStore,o))}async function nL(i,t){const e=Ft(i);if(!e.currentUser.isEqual(t)){vt(jv,"User change. New user:",t.toKey());const n=await qT(e.localStore,t);e.currentUser=t,(function(o,l){o.mu.forEach((u=>{u.forEach((h=>{h.reject(new yt(at.CANCELLED,l))}))})),o.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await oh(e,n.Ls)}}function sL(i,t){const e=Ft(i),n=e.Au.get(t);if(n&&n.hu)return Yt().add(n.key);{let s=Yt();const o=e.Iu.get(t);if(!o)return s;for(const l of o){const u=e.Tu.get(l);s=s.unionWith(u.view.nu)}return s}}function hx(i){const t=Ft(i);return t.remoteStore.remoteSyncer.applyRemoteEvent=ox.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=sL.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=J2.bind(null,t),t.Pu.H_=F2.bind(null,t.eventManager),t.Pu.yu=B2.bind(null,t.eventManager),t}function iL(i){const t=Ft(i);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Z2.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=tL.bind(null,t),t}class jf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=up(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return l2(this.persistence,new r2,t.initialUser,this.serializer)}Cu(t){return new GT(Cv.mi,this.serializer)}Du(t){return new m2}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}jf.provider={build:()=>new jf};class rL extends jf{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){oe(this.persistence.referenceDelegate instanceof Lf,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new GP(n,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?Qn.withCacheSize(this.cacheSizeBytes):Qn.DEFAULT;return new GT((n=>Lf.mi(n,e)),this.serializer)}}class ky{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>e0(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=nL.bind(null,this.syncEngine),await j2(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new U2})()}createDatastore(t){const e=up(t.databaseInfo.databaseId),n=(function(o){return new b2(o)})(t.databaseInfo);return(function(o,l,u,h){return new S2(o,l,u,h)})(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return(function(n,s,o,l,u){return new x2(n,s,o,l,u)})(this.localStore,this.datastore,t.asyncQueue,(e=>e0(this.syncEngine,e,0)),(function(){return YE.v()?new YE:new g2})())}createSyncEngine(t,e){return(function(s,o,l,u,h,f,m){const v=new q2(s,o,l,u,h,f);return m&&(v.gu=!0),v})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await(async function(e){const n=Ft(e);vt(bo,"RemoteStore shutting down."),n.Ea.add(5),await ah(n),n.Aa.shutdown(),n.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}ky.provider={build:()=>new ky};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dx{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):vr("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ma="FirestoreClient";class aL{constructor(t,e,n,s,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=kn.UNAUTHENTICATED,this.clientId=Zf.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(n,(async l=>{vt(ma,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(n,(l=>(vt(ma,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new fr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Lv(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function qg(i,t){i.asyncQueue.verifyOperationInProgress(),vt(ma,"Initializing OfflineComponentProvider");const e=i.configuration;await t.initialize(e);let n=e.initialUser;i.setCredentialChangeListener((async s=>{n.isEqual(s)||(await qT(t.localStore,s),n=s)})),t.persistence.setDatabaseDeletedListener((()=>i.terminate())),i._offlineComponents=t}async function s0(i,t){i.asyncQueue.verifyOperationInProgress();const e=await oL(i);vt(ma,"Initializing OnlineComponentProvider"),await t.initialize(e,i.configuration),i.setCredentialChangeListener((n=>QE(t.remoteStore,n))),i.setAppCheckTokenChangeListener(((n,s)=>QE(t.remoteStore,s))),i._onlineComponents=t}async function oL(i){if(!i._offlineComponents)if(i._uninitializedComponentsProvider){vt(ma,"Using user provided OfflineComponentProvider");try{await qg(i,i._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!(function(s){return s.name==="FirebaseError"?s.code===at.FAILED_PRECONDITION||s.code===at.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(e))throw e;_o("Error using user provided cache. Falling back to memory cache: "+e),await qg(i,new jf)}}else vt(ma,"Using default OfflineComponentProvider"),await qg(i,new rL(void 0));return i._offlineComponents}async function fx(i){return i._onlineComponents||(i._uninitializedComponentsProvider?(vt(ma,"Using user provided OnlineComponentProvider"),await s0(i,i._uninitializedComponentsProvider._online)):(vt(ma,"Using default OnlineComponentProvider"),await s0(i,new ky))),i._onlineComponents}function lL(i){return fx(i).then((t=>t.syncEngine))}async function px(i){const t=await fx(i),e=t.eventManager;return e.onListen=$2.bind(null,t.syncEngine),e.onUnlisten=Y2.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=K2.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=X2.bind(null,t.syncEngine),e}function cL(i,t,e={}){const n=new fr;return i.asyncQueue.enqueueAndForget((async()=>(function(o,l,u,h,f){const m=new dx({next:b=>{m.Nu(),l.enqueueAndForget((()=>nx(o,v)));const A=b.docs.has(u);!A&&b.fromCache?f.reject(new yt(at.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&b.fromCache&&h&&h.source==="server"?f.reject(new yt(at.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(b)},error:b=>f.reject(b)}),v=new sx(Av(u.path),m,{includeMetadataChanges:!0,qa:!0});return ex(o,v)})(await px(i),i.asyncQueue,t,e,n))),n.promise}function uL(i,t,e={}){const n=new fr;return i.asyncQueue.enqueueAndForget((async()=>(function(o,l,u,h,f){const m=new dx({next:b=>{m.Nu(),l.enqueueAndForget((()=>nx(o,v))),b.fromCache&&h.source==="server"?f.reject(new yt(at.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(b)},error:b=>f.reject(b)}),v=new sx(u,m,{includeMetadataChanges:!0,qa:!0});return ex(o,v)})(await px(i),i.asyncQueue,t,e,n))),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mx(i){const t={};return i.timeoutSeconds!==void 0&&(t.timeoutSeconds=i.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i0=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gx="firestore.googleapis.com",r0=!0;class a0{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new yt(at.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=gx,this.ssl=r0}else this.host=t.host,this.ssl=t.ssl??r0;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=HT;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<zP)throw new yt(at.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}nT("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=mx(t.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new yt(at.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new yt(at.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new yt(at.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(n,s){return n.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class fp{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new a0({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new yt(at.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new yt(at.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new a0(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new tT;switch(n.type){case"firstParty":return new bD(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new yt(at.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){const n=i0.get(e);n&&(vt("ComponentProvider","Removing Datastore"),i0.delete(e),n.terminate())})(this),Promise.resolve()}}function yx(i,t,e,n={}){i=gs(i,fp);const s=So(t),o=i._getSettings(),l={...o,emulatorOptions:i._getEmulatorOptions()},u=`${t}:${e}`;s&&(tv(`https://${u}`),ev("Firestore",!0)),o.host!==gx&&o.host!==u&&_o("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:s,emulatorOptions:n};if(!po(h,l)&&(i._setSettings(h),n.mockUserToken)){let f,m;if(typeof n.mockUserToken=="string")f=n.mockUserToken,m=kn.MOCK_USER;else{f=oS(n.mockUserToken,i._app?.options.projectId);const v=n.mockUserToken.sub||n.mockUserToken.user_id;if(!v)throw new yt(at.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new kn(v)}i._authCredentials=new yD(new ZS(f,m))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Sa(this.firestore,t,this._query)}}class Oe{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pr(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Oe(this.firestore,t,this._key)}toJSON(){return{type:Oe._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(sh(e,Oe._jsonSchema))return new Oe(t,n||null,new St(be.fromString(e.referencePath)))}}Oe._jsonSchemaVersion="firestore/documentReference/1.0",Oe._jsonSchema={type:tn("string",Oe._jsonSchemaVersion),referencePath:tn("string")};class pr extends Sa{constructor(t,e,n){super(t,e,Av(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Oe(this.firestore,null,new St(t))}withConverter(t){return new pr(this.firestore,t,this._path)}}function ne(i,t,...e){if(i=ze(i),eT("collection","path",t),i instanceof fp){const n=be.fromString(t,...e);return _E(n),new pr(i,null,n)}{if(!(i instanceof Oe||i instanceof pr))throw new yt(at.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=i._path.child(be.fromString(t,...e));return _E(n),new pr(i.firestore,null,n)}}function ge(i,t,...e){if(i=ze(i),arguments.length===1&&(t=Zf.newId()),eT("doc","path",t),i instanceof fp){const n=be.fromString(t,...e);return vE(n),new Oe(i,null,new St(n))}{if(!(i instanceof Oe||i instanceof pr))throw new yt(at.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=i._path.child(be.fromString(t,...e));return vE(n),new Oe(i.firestore,i instanceof pr?i.converter:null,new St(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o0="AsyncQueue";class l0{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new KT(this,"async_queue_retry"),this._c=()=>{const n=Gg();n&&vt(o0,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=t;const e=Gg();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=Gg();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new fr;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Xu.push(t),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Zl(t))throw t;vt(o0,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((n=>{throw this.nc=n,this.rc=!1,vr("INTERNAL UNHANDLED ERROR: ",c0(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const s=Pv.createAndSchedule(this,t,e,n,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&Pt(47125,{Pc:c0(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((e,n)=>e.targetTimeMs-n.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()}))}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function c0(i){let t=i.message||"";return i.stack&&(t=i.stack.includes(i.message)?i.stack:i.message+`
`+i.stack),t}class br extends fp{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new l0,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new l0(t),this._firestoreClient=void 0,await t}}}function vx(i,t){const e=typeof i=="object"?i:iv(),n=typeof i=="string"?i:Nf,s=Yf(e,"firestore").getImmediate({identifier:n});if(!s._initialized){const o=iS("firestore");o&&yx(s,...o)}return s}function lh(i){if(i._terminated)throw new yt(at.FAILED_PRECONDITION,"The client has already been terminated.");return i._firestoreClient||hL(i),i._firestoreClient}function hL(i){const t=i._freezeSettings(),e=(function(s,o,l,u){return new OD(s,o,l,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,mx(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(i._databaseId,i._app?.options.appId||"",i._persistenceKey,t);i._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(i._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),i._firestoreClient=new aL(i._authCredentials,i._appCheckCredentials,i._queue,e,i._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(i._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps{constructor(t){this._byteString=t}static fromBase64String(t){try{return new ps(gn.fromBase64String(t))}catch(e){throw new yt(at.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new ps(gn.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:ps._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(sh(t,ps._jsonSchema))return ps.fromBase64String(t.bytes)}}ps._jsonSchemaVersion="firestore/bytes/1.0",ps._jsonSchema={type:tn("string",ps._jsonSchemaVersion),bytes:tn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nc{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new yt(at.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new mn(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ch{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xs{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new yt(at.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new yt(at.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return Wt(this._lat,t._lat)||Wt(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Xs._jsonSchemaVersion}}static fromJSON(t){if(sh(t,Xs._jsonSchema))return new Xs(t.latitude,t.longitude)}}Xs._jsonSchemaVersion="firestore/geoPoint/1.0",Xs._jsonSchema={type:tn("string",Xs._jsonSchemaVersion),latitude:tn("number"),longitude:tn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{constructor(t){this._values=(t||[]).map((e=>e))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(n,s){if(n.length!==s.length)return!1;for(let o=0;o<n.length;++o)if(n[o]!==s[o])return!1;return!0})(this._values,t._values)}toJSON(){return{type:Qs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(sh(t,Qs._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e=="number")))return new Qs(t.vectorValues);throw new yt(at.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Qs._jsonSchemaVersion="firestore/vectorValue/1.0",Qs._jsonSchema={type:tn("string",Qs._jsonSchemaVersion),vectorValues:tn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dL=/^__.*__$/;class fL{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new Ea(t,this.data,this.fieldMask,e,this.fieldTransforms):new ih(t,this.data,e,this.fieldTransforms)}}class _x{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Ea(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function bx(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Pt(40011,{Ac:i})}}class Uv{constructor(t,e,n,s,o,l){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new Uv({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.gc(t),n}yc(t){const e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.Rc(),n}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return Vf(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find((e=>t.isPrefixOf(e)))!==void 0||this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(bx(this.Ac)&&dL.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class pL{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||up(t)}Cc(t,e,n,s=!1){return new Uv({Ac:t,methodName:e,Dc:n,path:mn.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function uh(i){const t=i._freezeSettings(),e=up(i._databaseId);return new pL(i._databaseId,!!t.ignoreUndefinedProperties,e)}function Fv(i,t,e,n,s,o={}){const l=i.Cc(o.merge||o.mergeFields?2:0,t,e,s);zv("Data must be an object, but it was:",l,n);const u=Ex(n,l);let h,f;if(o.merge)h=new ms(l.fieldMask),f=l.fieldTransforms;else if(o.mergeFields){const m=[];for(const v of o.mergeFields){const b=My(t,v,e);if(!l.contains(b))throw new yt(at.INVALID_ARGUMENT,`Field '${b}' is specified in your field mask but missing from your input data.`);Tx(m,b)||m.push(b)}h=new ms(m),f=l.fieldTransforms.filter((v=>h.covers(v.field)))}else h=null,f=l.fieldTransforms;return new fL(new Zn(u),h,f)}class pp extends ch{_toFieldTransform(t){if(t.Ac!==2)throw t.Ac===1?t.Sc(`${this._methodName}() can only appear at the top level of your update data`):t.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof pp}}class Bv extends ch{_toFieldTransform(t){return new lP(t.path,new Hu)}isEqual(t){return t instanceof Bv}}function Ax(i,t,e,n){const s=i.Cc(1,t,e);zv("Data must be an object, but it was:",s,n);const o=[],l=Zn.empty();wa(n,((h,f)=>{const m=Hv(t,h,e);f=ze(f);const v=s.yc(m);if(f instanceof pp)o.push(m);else{const b=hh(f,v);b!=null&&(o.push(m),l.set(m,b))}}));const u=new ms(o);return new _x(l,u,s.fieldTransforms)}function wx(i,t,e,n,s,o){const l=i.Cc(1,t,e),u=[My(t,n,e)],h=[s];if(o.length%2!=0)throw new yt(at.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let b=0;b<o.length;b+=2)u.push(My(t,o[b])),h.push(o[b+1]);const f=[],m=Zn.empty();for(let b=u.length-1;b>=0;--b)if(!Tx(f,u[b])){const A=u[b];let S=h[b];S=ze(S);const E=l.yc(A);if(S instanceof pp)f.push(A);else{const T=hh(S,E);T!=null&&(f.push(A),m.set(A,T))}}const v=new ms(f);return new _x(m,v,l.fieldTransforms)}function mL(i,t,e,n=!1){return hh(e,i.Cc(n?4:3,t))}function hh(i,t){if(Sx(i=ze(i)))return zv("Unsupported field value:",t,i),Ex(i,t);if(i instanceof ch)return(function(n,s){if(!bx(s.Ac))throw s.Sc(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${n._methodName}() is not currently supported inside arrays`);const o=n._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(i,t),null;if(i===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),i instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return(function(n,s){const o=[];let l=0;for(const u of n){let h=hh(u,s.wc(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}})(i,t)}return(function(n,s){if((n=ze(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return rP(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const o=Ae.fromDate(n);return{timestampValue:Pf(s.serializer,o)}}if(n instanceof Ae){const o=new Ae(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Pf(s.serializer,o)}}if(n instanceof Xs)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof ps)return{bytesValue:OT(s.serializer,n._byteString)};if(n instanceof Oe){const o=s.databaseId,l=n.firestore._databaseId;if(!l.isEqual(o))throw s.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Tv(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof Qs)return(function(l,u){return{mapValue:{fields:{[hT]:{stringValue:dT},[kf]:{arrayValue:{values:l.toArray().map((f=>{if(typeof f!="number")throw u.Sc("VectorValues must only contain numeric values.");return wv(u.serializer,f)}))}}}}}})(n,s);throw s.Sc(`Unsupported field value: ${tp(n)}`)})(i,t)}function Ex(i,t){const e={};return rT(i)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):wa(i,((n,s)=>{const o=hh(s,t.mc(n));o!=null&&(e[n]=o)})),{mapValue:{fields:e}}}function Sx(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof Ae||i instanceof Xs||i instanceof ps||i instanceof Oe||i instanceof ch||i instanceof Qs)}function zv(i,t,e){if(!Sx(e)||!sT(e)){const n=tp(e);throw n==="an object"?t.Sc(i+" a custom object"):t.Sc(i+" "+n)}}function My(i,t,e){if((t=ze(t))instanceof nc)return t._internalPath;if(typeof t=="string")return Hv(i,t);throw Vf("Field path arguments must be of type string or ",i,!1,void 0,e)}const gL=new RegExp("[~\\*/\\[\\]]");function Hv(i,t,e){if(t.search(gL)>=0)throw Vf(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,e);try{return new nc(...t.split("."))._internalPath}catch{throw Vf(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,e)}}function Vf(i,t,e,n,s){const o=n&&!n.isEmpty(),l=s!==void 0;let u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${n}`),l&&(h+=` in document ${s}`),h+=")"),new yt(at.INVALID_ARGUMENT,u+i+h)}function Tx(i,t){return i.some((e=>e.isEqual(t)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xx{constructor(t,e,n,s,o){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Oe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new yL(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(mp("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class yL extends xx{data(){return super.data()}}function mp(i,t){return typeof t=="string"?Hv(i,t):t instanceof nc?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vL(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new yt(at.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Gv{}class qv extends Gv{}function Le(i,t,...e){let n=[];t instanceof Gv&&n.push(t),n=n.concat(e),(function(o){const l=o.filter((h=>h instanceof gp)).length,u=o.filter((h=>h instanceof dh)).length;if(l>1||l>0&&u>0)throw new yt(at.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(const s of n)i=s._apply(i);return i}class dh extends qv{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new dh(t,e,n)}_apply(t){const e=this._parse(t);return Cx(t._query,e),new Sa(t.firestore,t.converter,Ay(t._query,e))}_parse(t){const e=uh(t.firestore);return(function(o,l,u,h,f,m,v){let b;if(f.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new yt(at.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){h0(v,m);const S=[];for(const E of v)S.push(u0(h,o,E));b={arrayValue:{values:S}}}else b=u0(h,o,v)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||h0(v,m),b=mL(u,l,v,m==="in"||m==="not-in");return Je.create(f,m,b)})(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}}function we(i,t,e){const n=t,s=mp("where",i);return dh._create(s,n,e)}class gp extends Gv{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new gp(t,e)}_parse(t){const e=this._queryConstraints.map((n=>n._parse(t))).filter((n=>n.getFilters().length>0));return e.length===1?e[0]:Js.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return e.getFilters().length===0?t:((function(s,o){let l=s;const u=o.getFlattenedFilters();for(const h of u)Cx(l,h),l=Ay(l,h)})(t._query,e),new Sa(t.firestore,t.converter,Ay(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class yp extends qv{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new yp(t,e)}_apply(t){const e=(function(s,o,l){if(s.startAt!==null)throw new yt(at.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new yt(at.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new zu(o,l)})(t._query,this._field,this._direction);return new Sa(t.firestore,t.converter,(function(s,o){const l=s.explicitOrderBy.concat([o]);return new tc(s.path,s.collectionGroup,l,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)})(t._query,e))}}function gf(i,t="asc"){const e=t,n=mp("orderBy",i);return yp._create(n,e)}function u0(i,t,e){if(typeof(e=ze(e))=="string"){if(e==="")throw new yt(at.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!bT(t)&&e.indexOf("/")!==-1)throw new yt(at.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);const n=t.path.child(be.fromString(e));if(!St.isDocumentKey(n))throw new yt(at.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return CE(i,new St(n))}if(e instanceof Oe)return CE(i,e._key);throw new yt(at.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${tp(e)}.`)}function h0(i,t){if(!Array.isArray(i)||i.length===0)throw new yt(at.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Cx(i,t){const e=(function(s,o){for(const l of s)for(const u of l.getFlattenedFilters())if(o.indexOf(u.op)>=0)return u.op;return null})(i.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(e!==null)throw e===t.op?new yt(at.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new yt(at.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}class Rx{convertValue(t,e="none"){switch(fa(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Be(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(da(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw Pt(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return wa(t,((s,o)=>{n[s]=this.convertValue(o,e)})),n}convertVectorValue(t){const e=t.fields?.[kf].arrayValue?.values?.map((n=>Be(n.doubleValue)));return new Qs(e)}convertGeoPoint(t){return new Xs(Be(t.latitude),Be(t.longitude))}convertArray(t,e){return(t.values||[]).map((n=>this.convertValue(n,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=sp(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Fu(t));default:return null}}convertTimestamp(t){const e=ha(t);return new Ae(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=be.fromString(t);oe(zT(n),9688,{name:t});const s=new zl(n.get(1),n.get(3)),o=new St(n.popFirst(5));return s.isEqual(e)||vr(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $v(i,t,e){let n;return n=i?e&&(e.merge||e.mergeFields)?i.toFirestore(t,e):i.toFirestore(t):t,n}class kl{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class la extends xx{constructor(t,e,n,s,o,l){super(t,e,n,s,l),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Du(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(mp("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new yt(at.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=la._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}la._jsonSchemaVersion="firestore/documentSnapshot/1.0",la._jsonSchema={type:tn("string",la._jsonSchemaVersion),bundleSource:tn("string","DocumentSnapshot"),bundleName:tn("string"),bundle:tn("string")};class Du extends la{data(t={}){return super.data(t)}}class fo{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new kl(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Du(this._firestore,this._userDataWriter,n.key,n,new kl(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new yt(at.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let l=0;return s._snapshot.docChanges.map((u=>{const h=new Du(s._firestore,s._userDataWriter,u.doc.key,u.doc,new kl(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}}))}{let l=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const h=new Du(s._firestore,s._userDataWriter,u.doc.key,u.doc,new kl(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let f=-1,m=-1;return u.type!==0&&(f=l.indexOf(u.doc.key),l=l.delete(u.doc.key)),u.type!==1&&(l=l.add(u.doc),m=l.indexOf(u.doc.key)),{type:_L(u.type),doc:h,oldIndex:f,newIndex:m}}))}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new yt(at.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=fo._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=Zf.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],n=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(e.push(o._document),n.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function _L(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Pt(61501,{type:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uf(i){i=gs(i,Oe);const t=gs(i.firestore,br);return cL(lh(t),i._key).then((e=>bL(t,i,e)))}fo._jsonSchemaVersion="firestore/querySnapshot/1.0",fo._jsonSchema={type:tn("string",fo._jsonSchemaVersion),bundleSource:tn("string","QuerySnapshot"),bundleName:tn("string"),bundle:tn("string")};class Ix extends Rx{constructor(t){super(),this.firestore=t}convertBytes(t){return new ps(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Oe(this.firestore,null,e)}}function me(i){i=gs(i,Sa);const t=gs(i.firestore,br),e=lh(t),n=new Ix(t);return vL(i._query),uL(e,i._query).then((s=>new fo(t,n,i,s)))}function Nx(i,t,e){i=gs(i,Oe);const n=gs(i.firestore,br),s=$v(i.converter,t,e);return sc(n,[Fv(uh(n),"setDoc",i._key,s,i.converter!==null,e).toMutation(i._key,Hn.none())])}function qs(i,t,e,...n){i=gs(i,Oe);const s=gs(i.firestore,br),o=uh(s);let l;return l=typeof(t=ze(t))=="string"||t instanceof nc?wx(o,"updateDoc",i._key,t,e,n):Ax(o,"updateDoc",i._key,t),sc(s,[l.toMutation(i._key,Hn.exists(!0))])}function Qr(i){return sc(gs(i.firestore,br),[new lp(i._key,Hn.none())])}function Jr(i,t){const e=gs(i.firestore,br),n=ge(i),s=$v(i.converter,t);return sc(e,[Fv(uh(i.firestore),"addDoc",n._key,s,i.converter!==null,{}).toMutation(n._key,Hn.exists(!1))]).then((()=>n))}function sc(i,t){return(function(n,s){const o=new fr;return n.asyncQueue.enqueueAndForget((async()=>Q2(await lL(n),s,o))),o.promise})(lh(i),t)}function bL(i,t,e){const n=e.docs.get(t._key),s=new Ix(i);return new la(i,s,t._key,n,new kl(e.hasPendingWrites,e.fromCache),t.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kx{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=uh(t)}set(t,e,n){this._verifyNotCommitted();const s=$g(t,this._firestore),o=$v(s.converter,e,n),l=Fv(this._dataReader,"WriteBatch.set",s._key,o,s.converter!==null,n);return this._mutations.push(l.toMutation(s._key,Hn.none())),this}update(t,e,n,...s){this._verifyNotCommitted();const o=$g(t,this._firestore);let l;return l=typeof(e=ze(e))=="string"||e instanceof nc?wx(this._dataReader,"WriteBatch.update",o._key,e,n,s):Ax(this._dataReader,"WriteBatch.update",o._key,e),this._mutations.push(l.toMutation(o._key,Hn.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=$g(t,this._firestore);return this._mutations=this._mutations.concat(new lp(e._key,Hn.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new yt(at.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function $g(i,t){if((i=ze(i)).firestore!==t)throw new yt(at.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return i}function Ds(){return new Bv("serverTimestamp")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eu(i){return lh(i=gs(i,br)),new kx(i,(t=>sc(i,t)))}(function(t,e=!0){(function(s){Ql=s})(To),mo(new ca("firestore",((n,{instanceIdentifier:s,options:o})=>{const l=n.getProvider("app").getImmediate(),u=new br(new vD(n.getProvider("auth-internal")),new AD(l,n.getProvider("app-check-internal")),(function(f,m){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new yt(at.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new zl(f.options.projectId,m)})(l,s),l);return o={useFetchStreams:e,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),Ti(pE,mE,t),Ti(pE,mE,"esm2020")})();const AL=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:Rx,Bytes:ps,CollectionReference:pr,DocumentReference:Oe,DocumentSnapshot:la,FieldPath:nc,FieldValue:ch,Firestore:br,FirestoreError:yt,GeoPoint:Xs,Query:Sa,QueryCompositeFilterConstraint:gp,QueryConstraint:qv,QueryDocumentSnapshot:Du,QueryFieldFilterConstraint:dh,QueryOrderByConstraint:yp,QuerySnapshot:fo,SnapshotMetadata:kl,Timestamp:Ae,VectorValue:Qs,WriteBatch:kx,_AutoId:Zf,_ByteString:gn,_DatabaseId:zl,_DocumentKey:St,_EmptyAuthCredentialsProvider:tT,_FieldPath:mn,_cast:gs,_logWarn:_o,_validateIsNotUsedTogether:nT,addDoc:Jr,collection:ne,connectFirestoreEmulator:yx,deleteDoc:Qr,doc:ge,ensureFirestoreConfigured:lh,executeWrite:sc,getDoc:Uf,getDocs:me,getFirestore:vx,orderBy:gf,query:Le,serverTimestamp:Ds,setDoc:Nx,updateDoc:qs,where:we,writeBatch:Eu},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mx="firebasestorage.googleapis.com",wL="storageBucket",EL=120*1e3,SL=600*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di extends Mi{constructor(t,e,n=0){super(Kg(t),`Firebase Storage: ${e} (${Kg(t)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Di.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return Kg(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ni;(function(i){i.UNKNOWN="unknown",i.OBJECT_NOT_FOUND="object-not-found",i.BUCKET_NOT_FOUND="bucket-not-found",i.PROJECT_NOT_FOUND="project-not-found",i.QUOTA_EXCEEDED="quota-exceeded",i.UNAUTHENTICATED="unauthenticated",i.UNAUTHORIZED="unauthorized",i.UNAUTHORIZED_APP="unauthorized-app",i.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",i.INVALID_CHECKSUM="invalid-checksum",i.CANCELED="canceled",i.INVALID_EVENT_NAME="invalid-event-name",i.INVALID_URL="invalid-url",i.INVALID_DEFAULT_BUCKET="invalid-default-bucket",i.NO_DEFAULT_BUCKET="no-default-bucket",i.CANNOT_SLICE_BLOB="cannot-slice-blob",i.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",i.NO_DOWNLOAD_URL="no-download-url",i.INVALID_ARGUMENT="invalid-argument",i.INVALID_ARGUMENT_COUNT="invalid-argument-count",i.APP_DELETED="app-deleted",i.INVALID_ROOT_OPERATION="invalid-root-operation",i.INVALID_FORMAT="invalid-format",i.INTERNAL_ERROR="internal-error",i.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Ni||(Ni={}));function Kg(i){return"storage/"+i}function TL(){const i="An unknown error occurred, please check the error payload for server response.";return new Di(Ni.UNKNOWN,i)}function xL(){return new Di(Ni.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function CL(){return new Di(Ni.CANCELED,"User canceled the upload/download.")}function RL(i){return new Di(Ni.INVALID_URL,"Invalid URL '"+i+"'.")}function IL(i){return new Di(Ni.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.")}function d0(i){return new Di(Ni.INVALID_ARGUMENT,i)}function Dx(){return new Di(Ni.APP_DELETED,"The Firebase app was deleted.")}function NL(i){return new Di(Ni.INVALID_ROOT_OPERATION,"The operation '"+i+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ws{constructor(t,e){this.bucket=t,this.path_=e}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=Ws.makeFromUrl(t,e)}catch{return new Ws(t,"")}if(n.path==="")return n;throw IL(t)}static makeFromUrl(t,e){let n=null;const s="([A-Za-z0-9.\\-_]+)";function o(V){V.path.charAt(V.path.length-1)==="/"&&(V.path_=V.path_.slice(0,-1))}const l="(/(.*))?$",u=new RegExp("^gs://"+s+l,"i"),h={bucket:1,path:3};function f(V){V.path_=decodeURIComponent(V.path)}const m="v[A-Za-z0-9_]+",v=e.replace(/[.]/g,"\\."),b="(/([^?#]*).*)?$",A=new RegExp(`^https?://${v}/${m}/b/${s}/o${b}`,"i"),S={bucket:1,path:3},E=e===Mx?"(?:storage.googleapis.com|storage.cloud.google.com)":e,T="([^?#]*)",C=new RegExp(`^https?://${E}/${s}/${T}`,"i"),k=[{regex:u,indices:h,postModify:o},{regex:A,indices:S,postModify:f},{regex:C,indices:{bucket:1,path:2},postModify:f}];for(let V=0;V<k.length;V++){const P=k[V],G=P.regex.exec(t);if(G){const I=G[P.indices.bucket];let N=G[P.indices.path];N||(N=""),n=new Ws(I,N),P.postModify(n);break}}if(n==null)throw RL(t);return n}}class kL{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ML(i,t,e){let n=1,s=null,o=null,l=!1,u=0;function h(){return u===2}let f=!1;function m(...T){f||(f=!0,t.apply(null,T))}function v(T){s=setTimeout(()=>{s=null,i(A,h())},T)}function b(){o&&clearTimeout(o)}function A(T,...C){if(f){b();return}if(T){b(),m.call(null,T,...C);return}if(h()||l){b(),m.call(null,T,...C);return}n<64&&(n*=2);let k;u===1?(u=2,k=0):k=(n+Math.random())*1e3,v(k)}let S=!1;function E(T){S||(S=!0,b(),!f&&(s!==null?(T||(u=2),clearTimeout(s),v(0)):T||(u=1)))}return v(0),o=setTimeout(()=>{l=!0,E(!0)},e),E}function DL(i){i(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PL(i){return i!==void 0}function f0(i,t,e,n){if(n<t)throw d0(`Invalid value for '${i}'. Expected ${t} or greater.`);if(n>e)throw d0(`Invalid value for '${i}'. Expected ${e} or less.`)}function LL(i){const t=encodeURIComponent;let e="?";for(const n in i)if(i.hasOwnProperty(n)){const s=t(n)+"="+t(i[n]);e=e+s+"&"}return e=e.slice(0,-1),e}var Ff;(function(i){i[i.NO_ERROR=0]="NO_ERROR",i[i.NETWORK_ERROR=1]="NETWORK_ERROR",i[i.ABORT=2]="ABORT"})(Ff||(Ff={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OL(i,t){const e=i>=500&&i<600,s=[408,429].indexOf(i)!==-1,o=t.indexOf(i)!==-1;return e||s||o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jL{constructor(t,e,n,s,o,l,u,h,f,m,v,b=!0,A=!1){this.url_=t,this.method_=e,this.headers_=n,this.body_=s,this.successCodes_=o,this.additionalRetryCodes_=l,this.callback_=u,this.errorCallback_=h,this.timeout_=f,this.progressCallback_=m,this.connectionFactory_=v,this.retry=b,this.isUsingEmulator=A,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((S,E)=>{this.resolve_=S,this.reject_=E,this.start_()})}start_(){const t=(n,s)=>{if(s){n(!1,new Yd(!1,null,!0));return}const o=this.connectionFactory_();this.pendingConnection_=o;const l=u=>{const h=u.loaded,f=u.lengthComputable?u.total:-1;this.progressCallback_!==null&&this.progressCallback_(h,f)};this.progressCallback_!==null&&o.addUploadProgressListener(l),o.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&o.removeUploadProgressListener(l),this.pendingConnection_=null;const u=o.getErrorCode()===Ff.NO_ERROR,h=o.getStatus();if(!u||OL(h,this.additionalRetryCodes_)&&this.retry){const m=o.getErrorCode()===Ff.ABORT;n(!1,new Yd(!1,null,m));return}const f=this.successCodes_.indexOf(h)!==-1;n(!0,new Yd(f,o))})},e=(n,s)=>{const o=this.resolve_,l=this.reject_,u=s.connection;if(s.wasSuccessCode)try{const h=this.callback_(u,u.getResponse());PL(h)?o(h):o()}catch(h){l(h)}else if(u!==null){const h=TL();h.serverResponse=u.getErrorText(),this.errorCallback_?l(this.errorCallback_(u,h)):l(h)}else if(s.canceled){const h=this.appDelete_?Dx():CL();l(h)}else{const h=xL();l(h)}};this.canceled_?e(!1,new Yd(!1,null,!0)):this.backoffId_=ML(t,e,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&DL(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Yd{constructor(t,e,n){this.wasSuccessCode=t,this.connection=e,this.canceled=!!n}}function VL(i,t){t!==null&&t.length>0&&(i.Authorization="Firebase "+t)}function UL(i,t){i["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function FL(i,t){t&&(i["X-Firebase-GMPID"]=t)}function BL(i,t){t!==null&&(i["X-Firebase-AppCheck"]=t)}function zL(i,t,e,n,s,o,l=!0,u=!1){const h=LL(i.urlParams),f=i.url+h,m=Object.assign({},i.headers);return FL(m,t),VL(m,e),UL(m,o),BL(m,n),new jL(f,i.method,m,i.body,i.successCodes,i.additionalRetryCodes,i.handler,i.errorHandler,i.timeout,i.progressCallback,s,l,u)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HL(i){if(i.length===0)return null;const t=i.lastIndexOf("/");return t===-1?"":i.slice(0,t)}function GL(i){const t=i.lastIndexOf("/",i.length-2);return t===-1?i:i.slice(t+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf{constructor(t,e){this._service=t,e instanceof Ws?this._location=e:this._location=Ws.makeFromUrl(e,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new Bf(t,e)}get root(){const t=new Ws(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return GL(this._location.path)}get storage(){return this._service}get parent(){const t=HL(this._location.path);if(t===null)return null;const e=new Ws(this._location.bucket,t);return new Bf(this._service,e)}_throwIfRoot(t){if(this._location.path==="")throw NL(t)}}function p0(i,t){const e=t?.[wL];return e==null?null:Ws.makeFromBucketSpec(e,i)}function qL(i,t,e,n={}){i.host=`${t}:${e}`;const s=So(t);s&&(tv(`https://${i.host}/b`),ev("Storage",!0)),i._isUsingEmulator=!0,i._protocol=s?"https":"http";const{mockUserToken:o}=n;o&&(i._overrideAuthToken=typeof o=="string"?o:oS(o,i.app.options.projectId))}class $L{constructor(t,e,n,s,o,l=!1){this.app=t,this._authProvider=e,this._appCheckProvider=n,this._url=s,this._firebaseVersion=o,this._isUsingEmulator=l,this._bucket=null,this._host=Mx,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=EL,this._maxUploadRetryTime=SL,this._requests=new Set,s!=null?this._bucket=Ws.makeFromBucketSpec(s,this._host):this._bucket=p0(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=Ws.makeFromBucketSpec(this._url,t):this._bucket=p0(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){f0("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){f0("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const e=await t.getToken();if(e!==null)return e.accessToken}return null}async _getAppCheckToken(){if(Jn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new Bf(this,t)}_makeRequest(t,e,n,s,o=!0){if(this._deleted)return new kL(Dx());{const l=zL(t,this._appId,n,s,e,this._firebaseVersion,o,this._isUsingEmulator);return this._requests.add(l),l.getPromise().then(()=>this._requests.delete(l),()=>this._requests.delete(l)),l}}async makeRequestWithTokens(t,e){const[n,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,n,s).getPromise()}}const m0="@firebase/storage",g0="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Px="storage";function KL(i=iv(),t){i=ze(i);const n=Yf(i,Px).getImmediate({identifier:t}),s=iS("storage");return s&&WL(n,...s),n}function WL(i,t,e,n={}){qL(i,t,e,n)}function YL(i,{instanceIdentifier:t}){const e=i.getProvider("app").getImmediate(),n=i.getProvider("auth-internal"),s=i.getProvider("app-check-internal");return new $L(e,n,s,t,To)}function XL(){mo(new ca(Px,YL,"PUBLIC").setMultipleInstances(!0)),Ti(m0,g0,""),Ti(m0,g0,"esm2020")}XL();const QL={apiKey:"AIzaSyBRaHhg2CmvUBtg_UC3OHB6G2Bm4fDUifQ",authDomain:"kelazgraphicdesigner.firebaseapp.com",projectId:"kelazgraphicdesigner",storageBucket:"kelazgraphicdesigner.firebasestorage.app",messagingSenderId:"568241737996",appId:"1:568241737996:web:efa6fef6c268aa29b03929"},Kv=uS(QL),xl=fD(Kv),JL=new lr,At=vx(Kv);KL(Kv);const fu={getUserRole(i){return"student"},async registerWithEmail(i,t,e,n){try{const o=(await Qk(xl,i,t)).user,l=n||this.getUserRole(i),u=l==="teacher"?"approved":"pending";return await this.saveUserToFirestore(o.uid,{name:e,email:o.email||i,role:l,status:u,createdAt:Ds()}),o}catch(s){throw console.error("Registration error:",s),s}},async loginWithEmail(i,t){try{const n=(await Jk(xl,i,t)).user;return await this.getUserFromFirestore(n.uid),n}catch(e){throw console.error("Login error:",e),e}},async loginWithGoogle(){try{const t=(await wM(xl,JL)).user;if(!await this.getUserFromFirestore(t.uid)){const n=this.getUserRole(t.email||""),s=n==="teacher"?"approved":"pending";await this.saveUserToFirestore(t.uid,{name:t.displayName||"Unknown",email:t.email||"",role:n,status:s,createdAt:Ds()})}return t}catch(i){throw console.error("Google login error:",i),i}},async logout(){try{await nM(xl)}catch(i){throw console.error("Logout error:",i),i}},async saveUserToFirestore(i,t){try{await Nx(ge(At,"users",i),t)}catch(e){throw console.error("Error saving user to Firestore:",e),e}},async getUserFromFirestore(i){try{const t=await Uf(ge(At,"users",i));return t.exists()?t.data():null}catch(t){throw console.error("Error getting user from Firestore:",t),t}},async updateUserRole(i,t){try{const e=await this.getUserFromFirestore(i);if(e){const n={...e,role:t};await this.saveUserToFirestore(i,n)}}catch(e){throw console.error("Error updating user role:",e),e}},getCurrentUser(){return xl.currentUser}},Ar=()=>{const[i,t]=B.useState({user:null,userDoc:null,loading:!0,error:null});return B.useEffect(()=>{const l=eM(xl,async u=>{t(h=>({...h,loading:!0,error:null}));try{if(u){const h=await fu.getUserFromFirestore(u.uid);t({user:u,userDoc:h,loading:!1,error:null})}else t({user:null,userDoc:null,loading:!1,error:null})}catch(h){t(f=>({...f,loading:!1,error:h instanceof Error?h.message:"Unknown error occurred"}))}});return()=>l()},[]),{...i,login:async(l,u)=>{t(h=>({...h,loading:!0,error:null}));try{await fu.loginWithEmail(l,u)}catch(h){throw t(f=>({...f,loading:!1,error:h instanceof Error?h.message:"Login failed"})),h}},loginWithGoogle:async()=>{t(l=>({...l,loading:!0,error:null}));try{await fu.loginWithGoogle()}catch(l){throw t(u=>({...u,loading:!1,error:l instanceof Error?l.message:"Google login failed"})),l}},register:async(l,u,h)=>{t(f=>({...f,loading:!0,error:null}));try{await fu.registerWithEmail(l,u,h)}catch(f){throw t(m=>({...m,loading:!1,error:f instanceof Error?f.message:"Registration failed"})),f}},logout:async()=>{t(l=>({...l,loading:!0,error:null}));try{await fu.logout()}catch(l){throw t(u=>({...u,loading:!1,error:l instanceof Error?l.message:"Logout failed"})),l}},isAuthenticated:!!i.user,isTeacher:i.userDoc?.role==="teacher",isStudent:i.userDoc?.role==="student"}};function Wg(i){B.useEffect(()=>{const t=i.current;if(!t)return;const e=()=>t?.classList?.add("mv-error");return t?.addEventListener?.("error",e),()=>t?.removeEventListener?.("error",e)},[i])}const Yg=i=>zC.createElement("model-viewer",i),ZL=()=>{const i=B.useRef(null),t=B.useRef(null),e=B.useRef(null);Wg(i),Wg(t),Wg(e);const n={lantern:"https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/Lantern/glTF-Binary/Lantern.glb",avocado:"https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/Avocado/glTF-Binary/Avocado.glb",duck:"https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/Duck/glTF-Binary/Duck.glb"};return g.jsxs("div",{className:"hero-visual","aria-hidden":!0,children:[g.jsxs("div",{className:"mv-grid",children:[g.jsx("div",{className:"mv-tile mv-a",children:g.jsx(Yg,{ref:i,src:n.lantern,alt:"Creative light","camera-controls":!0,"auto-rotate":!0,"rotation-per-second":"16deg","shadow-intensity":"0.2",exposure:"1.05","interaction-prompt":"none",loading:"lazy",reveal:"auto","disable-zoom":!0,style:{width:"100%",height:"100%"}})}),g.jsx("div",{className:"mv-tile mv-b",children:g.jsx(Yg,{ref:t,src:n.avocado,alt:"Fresh ideas","camera-controls":!0,"auto-rotate":!0,"rotation-per-second":"12deg","shadow-intensity":"0.2",exposure:"1.05","interaction-prompt":"none",loading:"lazy",reveal:"auto","disable-zoom":!0,style:{width:"100%",height:"100%"}})}),g.jsx("div",{className:"mv-tile mv-c",children:g.jsx(Yg,{ref:e,src:n.duck,alt:"Playful learning","camera-controls":!0,"auto-rotate":!0,"rotation-per-second":"10deg","shadow-intensity":"0.2",exposure:"1.05","interaction-prompt":"none",loading:"lazy",reveal:"auto","disable-zoom":!0,style:{width:"100%",height:"100%"}})})]}),g.jsx("div",{className:"hero-glow"})]})},y0=({onLoginClick:i})=>{const[t,e]=B.useState("home"),[n,s]=B.useState(null);return B.useEffect(()=>{const o=window.location.hash||"",l=o.indexOf("?");l>=0&&(new URLSearchParams(o.substring(l+1)).get("msg")||"")==="rejected"&&s("Maaf, pendaftaran Anda ditolak oleh guru. Silakan hubungi guru untuk informasi lebih lanjut.")},[]),g.jsxs("div",{className:"home-page",children:[g.jsx("header",{className:"header",children:g.jsxs("div",{className:"container",children:[g.jsxs("div",{className:"logo",children:[g.jsx("h2",{children:"Kelaz"}),g.jsx("span",{children:"Kelas Desain Grafis Online"})]}),g.jsx("nav",{className:"nav",children:g.jsxs("ul",{children:[g.jsx("li",{children:g.jsx("a",{href:"#home",className:t==="home"?"active":"",onClick:()=>e("home"),children:"Beranda"})}),g.jsx("li",{children:g.jsx("button",{className:"btn-login",onClick:i,children:"Masuk"})})]})})]})}),n&&g.jsx("div",{className:"container",style:{marginTop:12},children:g.jsx("div",{className:"error-message",style:{background:"#fef2f2",borderColor:"#fecaca"},children:n})}),g.jsx("section",{className:"hero",children:g.jsxs("div",{className:"container",children:[g.jsxs("div",{className:"hero-content",children:[g.jsx("h1",{children:"Belajar Desain Grafis Secara Online"}),g.jsx("p",{children:"Bergabunglah dengan kelas desain grafis online gratis kami. Kuasai dasar-dasar desain melalui materi interaktif, kuis, dan proyek langsung."}),g.jsxs("div",{className:"hero-stats",children:[g.jsxs("div",{className:"stat",children:[g.jsx("h3",{children:"Gratis"}),g.jsx("p",{children:"Kursus 100% Gratis"})]}),g.jsxs("div",{className:"stat",children:[g.jsx("h3",{children:"Online"}),g.jsx("p",{children:"Belajar di Mana Saja"})]})]}),g.jsxs("div",{className:"hero-buttons",children:[g.jsx("button",{className:"hero-btn hero-btn--primary",onClick:i,children:"Mulai Belajar"}),g.jsxs("button",{className:"hero-btn hero-btn--ghost hero-btn--icon",onClick:()=>{document.getElementById("modules")?.scrollIntoView({behavior:"smooth",block:"start"})},children:[g.jsx("span",{children:"Lihat Kurikulum"}),g.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:g.jsx("path",{d:"M5 12h14M13 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})]}),g.jsx("div",{className:"hero-image",children:g.jsx(ZL,{})})]})}),g.jsx("section",{className:"features",children:g.jsxs("div",{className:"container",children:[g.jsx("h2",{children:"Mengapa Memilih Kelas Ini?"}),g.jsxs("div",{className:"features-grid",children:[g.jsxs("div",{className:"feature-card",children:[g.jsx("div",{className:"feature-icon",children:""}),g.jsx("h3",{children:"Pelajaran Interaktif"}),g.jsx("p",{children:"Belajar melalui konten menarik dengan teks, gambar, dan materi video."})]}),g.jsxs("div",{className:"feature-card",children:[g.jsx("div",{className:"feature-icon",children:""}),g.jsx("h3",{children:"Kuis & Penilaian"}),g.jsx("p",{children:"Uji pemahaman dengan kuis pilihan ganda dan pantau progres belajar."})]}),g.jsxs("div",{className:"feature-card",children:[g.jsx("div",{className:"feature-icon",children:""}),g.jsx("h3",{children:"Belajar Kelompok Kecil"}),g.jsx("p",{children:"Perhatian lebih personal: maksimal 3 siswa per kelas untuk bimbingan optimal."})]}),g.jsxs("div",{className:"feature-card",children:[g.jsx("div",{className:"feature-icon",children:""}),g.jsx("h3",{children:"Pelacakan Progres"}),g.jsx("p",{children:"Monitor perjalanan belajar Anda dan lihat peningkatan dari waktu ke waktu."})]})]})]})}),g.jsx("section",{className:"modules",id:"modules",children:g.jsxs("div",{className:"container",children:[g.jsx("h2",{children:"Tingkat Pembelajaran"}),g.jsxs("div",{className:"modules-list",children:[g.jsxs("div",{className:"module-card",children:[g.jsx("div",{className:"module-number",children:"01"}),g.jsxs("div",{className:"module-content",children:[g.jsx("h3",{children:"Basic"}),g.jsx("p",{children:"Pelajari prinsip dasar desain termasuk teori warna, tipografi, dan komposisi."}),g.jsxs("div",{className:"module-meta",children:[g.jsx("span",{children:"5 Materi"}),g.jsx("span",{children:"2 Kuis"})]})]})]}),g.jsxs("div",{className:"module-card",children:[g.jsx("div",{className:"module-number",children:"02"}),g.jsxs("div",{className:"module-content",children:[g.jsx("h3",{children:"Intermediate"}),g.jsx("p",{children:"Membuat karya yang lebih kuat dan memahami pengembangan identitas visual."}),g.jsxs("div",{className:"module-meta",children:[g.jsx("span",{children:"6 Materi"}),g.jsx("span",{children:"3 Kuis"})]})]})]}),g.jsxs("div",{className:"module-card",children:[g.jsx("div",{className:"module-number",children:"03"}),g.jsxs("div",{className:"module-content",children:[g.jsx("h3",{children:"Advanced"}),g.jsx("p",{children:"Kuasai tools desain populer dan teknik lanjutan untuk hasil profesional."}),g.jsxs("div",{className:"module-meta",children:[g.jsx("span",{children:"8 Materi"}),g.jsx("span",{children:"4 Kuis"})]})]})]})]})]})}),g.jsx("section",{className:"cta",children:g.jsxs("div",{className:"container",children:[g.jsx("h2",{children:"Siap Memulai Perjalanan Desain Anda?"}),g.jsx("p",{children:"Bergabung sekarang dan buka potensi kreatif Anda melalui kelas desain grafis gratis."}),g.jsx("button",{className:"hero-btn hero-btn--primary",onClick:i,children:"Mulai Sekarang"})]})}),g.jsx("footer",{className:"footer",children:g.jsxs("div",{className:"container",children:[g.jsxs("div",{className:"footer-content",children:[g.jsxs("div",{className:"footer-section",children:[g.jsx("h3",{children:"Kelaz Desain Grafis"}),g.jsx("p",{children:"Pembelajaran desain grafis gratis untuk semua."})]}),g.jsxs("div",{className:"footer-section",children:[g.jsx("h4",{children:"Akses"}),g.jsx("ul",{children:g.jsx("li",{children:g.jsx("button",{onClick:i,className:"footer-link",children:"Masuk"})})})]})]}),g.jsx("div",{className:"footer-bottom",children:g.jsx("p",{children:" 2025 Kelaz Graphic Design Online Class. Free for everyone."})})]})})]})},tO=()=>{const[i,t]=B.useState(!0),[e,n]=B.useState({email:"",password:"",name:"",confirmPassword:""}),[s,o]=B.useState(""),{login:l,register:u,loginWithGoogle:h,loading:f,isAuthenticated:m}=Ar(),v=C=>{const{name:L,value:k}=C.target;n(V=>({...V,[L]:k})),s&&o("")},b=()=>{if(!e.email||!e.password)return o("Email dan kata sandi wajib diisi"),!1;if(!i){if(!e.name)return o("Nama wajib diisi"),!1;if(e.password.length<6)return o("Kata sandi minimal 6 karakter"),!1;if(e.password!==e.confirmPassword)return o("Kata sandi tidak cocok"),!1}return!0},A=async C=>{if(C.preventDefault(),o(""),!!b())try{i?await l(e.email,e.password):await u(e.email,e.password,e.name)}catch(L){o(L instanceof Error?L.message:"Terjadi kesalahan")}},S=async()=>{o("");try{await h()}catch(C){o(C instanceof Error?C.message:"Masuk dengan Google gagal")}},E=()=>{t(!i),n({email:"",password:"",name:"",confirmPassword:""}),o("")},T=()=>{m?window.location.hash="#/dashboard":window.location.hash="#/"};return g.jsx("div",{className:"auth-page",children:g.jsxs("div",{className:"auth-container",children:[g.jsxs("div",{className:"auth-header",children:[g.jsx("h1",{children:"Kelaz Desain Grafis"}),g.jsx("p",{children:"Platform Pembelajaran Online"})]}),g.jsxs("div",{className:"auth-card",children:[g.jsxs("div",{className:"auth-tabs",children:[g.jsx("button",{className:`tab ${i?"active":""}`,onClick:()=>t(!0),type:"button",children:"Masuk"}),g.jsx("button",{className:`tab ${i?"":"active"}`,onClick:()=>t(!1),type:"button",children:"Daftar"})]}),g.jsxs("form",{onSubmit:A,className:"auth-form",children:[!i&&g.jsxs("div",{className:"form-group",children:[g.jsx("label",{htmlFor:"name",children:"Nama Lengkap"}),g.jsx("input",{type:"text",id:"name",name:"name",value:e.name,onChange:v,placeholder:"Masukkan nama lengkap",required:!i})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{htmlFor:"email",children:"Alamat Email"}),g.jsx("input",{type:"email",id:"email",name:"email",value:e.email,onChange:v,placeholder:"Masukkan email",required:!0})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{htmlFor:"password",children:"Kata Sandi"}),g.jsx("input",{type:"password",id:"password",name:"password",value:e.password,onChange:v,placeholder:"Masukkan kata sandi",required:!0})]}),!i&&g.jsxs("div",{className:"form-group",children:[g.jsx("label",{htmlFor:"confirmPassword",children:"Konfirmasi Kata Sandi"}),g.jsx("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:e.confirmPassword,onChange:v,placeholder:"Konfirmasi kata sandi",required:!i})]}),s&&g.jsx("div",{className:"error-message",children:s}),g.jsx("button",{type:"submit",className:"btn-primary btn-full",disabled:f,children:f?"Mohon tunggu...":i?"Masuk":"Buat Akun"})]}),g.jsx("div",{className:"auth-divider",children:g.jsx("span",{children:"atau"})}),g.jsxs("button",{type:"button",onClick:S,className:"btn-google",disabled:f,children:[g.jsx("span",{className:"google-icon","aria-hidden":"true",children:g.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",focusable:"false",role:"img",children:[g.jsx("path",{fill:"#FFC107",d:"M43.6 20.5H42V20H24v8h11.3c-1.6 4.6-6 8-11.3 8-6.6 0-12-5.4-12-12S17.4 12 24 12c3.1 0 5.9 1.2 8 3.1l5.7-5.7C34.6 6.1 29.6 4 24 4 12.9 4 4 12.9 4 24s8.9 20 20 20 20-8.9 20-20c0-1.2-.1-2.3-.4-3.5z"}),g.jsx("path",{fill:"#FF3D00",d:"M6.3 14.7l6.6 4.8C14.8 16 18.9 12 24 12c3.1 0 5.9 1.2 8 3.1l5.7-5.7C34.6 6.1 29.6 4 24 4c-7.7 0-14.3 4.3-17.7 10.7z"}),g.jsx("path",{fill:"#4CAF50",d:"M24 44c5.3 0 10.2-2 13.9-5.3l-6.4-5.4C29.4 34.5 26.9 36 24 36c-5.2 0-9.6-3.3-11.2-7.9l-6.5 5C9.7 39.6 16.3 44 24 44z"}),g.jsx("path",{fill:"#1976D2",d:"M43.6 20.5H42V20H24v8h11.3c-1 2.8-3 5.2-5.6 6.8l.1-.1 6.4 5.4C34.9 42 40 38 42.9 32.3c1.1-2.1 1.7-4.6 1.7-7.3 0-1.2-.1-2.3-.4-3.5z"})]})}),"Lanjutkan dengan Google"]}),g.jsxs("div",{className:"auth-footer",children:[g.jsxs("p",{children:[i?"Belum punya akun? ":"Sudah punya akun? ",g.jsx("button",{type:"button",onClick:E,className:"link-button",children:i?"Daftar":"Masuk"})]}),g.jsx("p",{className:"back-row",children:g.jsx("button",{type:"button",onClick:T,className:"link-button",children:" Kembali ke Dashboard"})}),g.jsxs("div",{className:"role-info",children:[g.jsx("p",{children:" Bergabung dengan kelas desain grafis online gratis"}),g.jsx("p",{children:" Mulai belajar dengan materi interaktif dan kuis"})]})]})]})]})})},eO="modulepreload",nO=function(i){return"/kelazgraphicdesigner/"+i},v0={},sO=function(t,e,n){let s=Promise.resolve();if(e&&e.length>0){let h=function(f){return Promise.all(f.map(m=>Promise.resolve(m).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=l?.nonce||l?.getAttribute("nonce");s=h(e.map(f=>{if(f=nO(f),f in v0)return;v0[f]=!0;const m=f.endsWith(".css"),v=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${v}`))return;const b=document.createElement("link");if(b.rel=m?"stylesheet":eO,m||(b.as="script"),b.crossOrigin="",b.href=f,u&&b.setAttribute("nonce",u),document.head.appendChild(b),m)return new Promise((A,S)=>{b.addEventListener("load",A),b.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${f}`)))})}))}function o(l){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l}return s.then(l=>{for(const u of l||[])u.status==="rejected"&&o(u.reason);return t().catch(o)})},gt={async getModules(){try{const i=ne(At,"modules"),t=Le(i,gf("createdAt","desc"));let n=(await me(t)).docs.map(s=>({id:s.id,...s.data()}));return n.sort((s,o)=>(s.order||999)-(o.order||999)),n}catch(i){throw console.error("Error getting modules:",i),i}},async createModule(i){try{return(await Jr(ne(At,"modules"),{...i,createdAt:Ds()})).id}catch(t){throw console.error("Error creating module:",t),t}},async updateModule(i,t){try{await qs(ge(At,"modules",i),t)}catch(e){throw console.error("Error updating module:",e),e}},async deleteModule(i){try{const t=await me(ne(At,"modules",i,"lessons"));if(!t.empty){const e=Eu(At);t.forEach(n=>{e.delete(ge(At,"modules",i,"lessons",n.id))}),await e.commit()}await Qr(ge(At,"modules",i))}catch(t){throw console.error("Error deleting module:",t),t}},async getModuleWithLessons(i){try{const t=await Uf(ge(At,"modules",i));if(!t.exists())return null;const e={id:t.id,...t.data()},n=await this.getLessons(i);return{...e,lessons:n}}catch(t){throw console.error("Error getting module with lessons:",t),t}},async getLessons(i){try{const t=ne(At,"modules",i,"lessons"),e=Le(t,gf("createdAt","desc"));let s=(await me(e)).docs.map(o=>({id:o.id,...o.data()}));return s.sort((o,l)=>(o.order||999)-(l.order||999)),s}catch(t){throw console.error("Error getting lessons:",t),t}},async getAllLessons(){try{const i=await this.getModules(),t=[];for(const e of i){const n=await this.getLessons(e.id);t.push(...n)}return t}catch(i){return console.error("Error getting all lessons:",i),[]}},async getAllLessonsCount(){try{const i=await this.getModules();let t=0;for(const e of i){const n=await this.getLessons(e.id);t+=n.length}return t}catch(i){return console.error("Error getting lessons count:",i),0}},async createLesson(i,t){try{const e=ne(At,"modules",i,"lessons");return(await Jr(e,{...t,createdAt:Ds()})).id}catch(e){throw console.error("Error creating lesson:",e),e}},async updateLesson(i,t,e){try{await qs(ge(At,"modules",i,"lessons",t),e)}catch(n){throw console.error("Error updating lesson:",n),n}},async deleteLesson(i,t){try{await Qr(ge(At,"modules",i,"lessons",t))}catch(e){throw console.error("Error deleting lesson:",e),e}},async getQuizzes(i){try{const t=ne(At,"quizzes"),e=Le(t,gf("createdAt","desc"));let s=(await me(e)).docs.map(o=>({id:o.id,...o.data()}));return i&&(s=s.filter(o=>o.moduleId===i)),s}catch(t){return console.error("Error getting quizzes:",t),[]}},async createQuiz(i){try{return(await Jr(ne(At,"quizzes"),{...i,createdAt:Ds()})).id}catch(t){throw console.error("Error creating quiz:",t),t}},async addQuestionToQuiz(i,t){try{const e=ne(At,"quizzes",i,"questions");return(await Jr(e,{...t,order:1})).id}catch(e){throw console.error("Error adding question to quiz:",e),e}},async updateQuiz(i,t){try{await qs(ge(At,"quizzes",i),t)}catch(e){throw console.error("Error updating quiz:",e),e}},async deleteQuiz(i){try{const t=await me(ne(At,"quizzes",i,"questions"));if(!t.empty){const s=Eu(At);t.forEach(o=>{s.delete(ge(At,"quizzes",i,"questions",o.id))}),await s.commit()}const e=ne(At,"answers"),n=await me(Le(e,we("quizId","==",i)));if(!n.empty){const s=Eu(At);n.forEach(o=>s.delete(ge(At,"answers",o.id))),await s.commit()}await Qr(ge(At,"quizzes",i))}catch(t){throw console.error("Error deleting quiz:",t),t}},async getQuestions(i){try{const t=ne(At,"quizzes",i,"questions"),n=(await me(t)).docs.map(s=>({id:s.id,...s.data()}));return n.sort((s,o)=>(s.order??999)-(o.order??999)),n}catch(t){return console.error("Error getting questions:",t),[]}},async getQuiz(i){try{const t=await Uf(ge(At,"quizzes",i));return t.exists()?{id:t.id,...t.data()}:null}catch(t){return console.error("Error getting quiz:",t),null}},async updateQuestion(i,t,e){try{await qs(ge(At,"quizzes",i,"questions",t),e)}catch(n){throw console.error("Error updating question:",n),n}},async deleteQuestion(i,t){try{await Qr(ge(At,"quizzes",i,"questions",t))}catch(e){throw console.error("Error deleting question:",e),e}},async markLessonRead(i,t,e){try{const n=`${i}_${t}_${e}`;await(await sO(async()=>{const{setDoc:s}=await Promise.resolve().then(()=>AL);return{setDoc:s}},[])).setDoc(ge(At,"lessonReads",n),{userId:i,moduleId:t,lessonId:e,readAt:Ds()},{merge:!0})}catch(n){console.error("Error marking lesson read:",n)}},async getLessonReadsByUser(i){try{const t=ne(At,"lessonReads");return(await me(Le(t,we("userId","==",i)))).docs.map(n=>({id:n.id,...n.data()}))}catch(t){return console.error("Error getting lesson reads:",t),[]}},async replaceAnswers(i,t,e){try{const n=ne(At,"answers"),s=await me(Le(n,we("userId","==",i),we("quizId","==",t)));if(!s.empty){const o=Eu(At);s.forEach(l=>o.delete(ge(At,"answers",l.id))),await o.commit()}for(const o of e)await Jr(n,{userId:i,quizId:t,questionId:o.questionId,selectedIndex:o.selectedIndex,isCorrect:o.isCorrect,...o.textAnswer?{textAnswer:o.textAnswer}:{},answeredAt:Ds()})}catch(n){throw console.error("Error replacing answers:",n),n}},async getLatestAnswersByQuiz(i){try{const t=ne(At,"answers"),e=await me(Le(t,we("quizId","==",i))),n={};e.forEach(o=>{const l=o.data(),u=l.answeredAt?.toMillis?.()??0,h=l.userId,f=l.questionId;n[h]||(n[h]={});const m=n[h][f];(!m||u>m.ts)&&(n[h][f]={id:o.id,doc:l,ts:u})});const s={};return Object.keys(n).forEach(o=>{s[o]={},Object.keys(n[o]).forEach(l=>{const u=n[o][l];s[o][l]={id:u.id,...u.doc}})}),s}catch(t){return console.error("Error getting latest answers by quiz:",t),{}}},async getLatestAnswersByUserForQuiz(i,t){try{const e=ne(At,"answers"),n=await me(Le(e,we("userId","==",i),we("quizId","==",t))),s={};return n.forEach(o=>{const l=o.data(),u=l.answeredAt?.toMillis?.()??0,h=l.questionId,f=s[h];(!f||u>f.ts)&&(s[h]={id:o.id,doc:l,ts:u})}),Object.values(s).sort((o,l)=>o.ts-l.ts).map(o=>({id:o.id,...o.doc}))}catch(e){return console.error("Error getting latest answers by user for quiz:",e),[]}},async updateManualScore(i,t){try{await qs(ge(At,"answers",i),{isCorrect:t})}catch(e){throw console.error("Error updating manual score:",e),e}},async getAnswersByUser(i,t){try{const e=ne(At,"answers"),n=Le(e,we("userId","==",i));let o=(await me(n)).docs.map(l=>({id:l.id,...l.data()}));return t&&(o=o.filter(l=>l.quizId===t)),o.sort((l,u)=>{const h=l.answeredAt?.toMillis?.()??0;return(u.answeredAt?.toMillis?.()??0)-h}),o}catch(e){return console.error("Error getting answers:",e),[]}},async getRetakeGrant(i,t){try{const e=ne(At,"retakeGrants"),n=await me(Le(e,we("userId","==",i),we("quizId","==",t)));if(n.empty)return null;const s=n.docs[0];return{id:s.id,...s.data()}}catch(e){return console.error("Error getting retake grant:",e),null}},async grantRetake(i,t,e,n){try{const s=ne(At,"retakeGrants"),o=await me(Le(s,we("userId","==",i),we("quizId","==",t)));if(!o.empty){const u=o.docs[0],h=u.data().allowed||0;return await qs(ge(At,"retakeGrants",u.id),{allowed:Math.max(0,h+e),grantedBy:n,grantedAt:Ds()}),u.id}return(await Jr(s,{userId:i,quizId:t,allowed:Math.max(0,e),grantedBy:n,grantedAt:Ds()})).id}catch(s){throw console.error("Error granting retake:",s),s}},async consumeRetake(i,t){try{const e=await this.getRetakeGrant(i,t);return!e||e.allowed<=0?!1:(await qs(ge(At,"retakeGrants",e.id),{allowed:Math.max(0,(e.allowed||0)-1)}),!0)}catch(e){return console.error("Error consuming retake:",e),!1}},async revokeRetake(i,t){try{const e=ne(At,"retakeGrants"),n=await me(Le(e,we("userId","==",i),we("quizId","==",t)));n.empty||await Qr(ge(At,"retakeGrants",n.docs[0].id))}catch(e){console.error("Error revoking retake:",e)}},async getUserProgress(i,t){try{const e=ne(At,"progress");let n;return t?n=Le(e,we("userId","==",i),we("moduleId","==",t)):n=Le(e,we("userId","==",i)),(await me(n)).docs.map(o=>({id:o.id,...o.data()}))}catch(e){return console.error("Error getting user progress:",e),[]}},async getEnrollmentsByUser(i){try{const t=ne(At,"enrollments");return(await me(Le(t,we("userId","==",i)))).docs.map(n=>({id:n.id,...n.data()}))}catch(t){return console.error("Error getting enrollments:",t),[]}},async enrollUserToModule(i,t){try{return(await Jr(ne(At,"enrollments"),{userId:i,moduleId:t,enrolledAt:Ds()})).id}catch(e){throw console.error("Error creating enrollment:",e),e}},async unenrollUser(i){try{await Qr(ge(At,"enrollments",i))}catch(t){throw console.error("Error deleting enrollment:",t),t}},async getStudentCount(){try{const i=ne(At,"users"),t=Le(i,we("role","==","student"));return(await me(t)).size}catch(i){return console.error("Error getting student count:",i),0}},async updateUser(i,t){try{await qs(ge(At,"users",i),t)}catch(e){throw console.error("Error updating user:",e),e}},async deleteUser(i){try{await Qr(ge(At,"users",i))}catch(t){throw console.error("Error deleting user:",t),t}},async getStudents(){try{const i=ne(At,"users"),t=Le(i,we("role","==","student"));return(await me(t)).docs.map(n=>({id:n.id,...n.data()}))}catch(i){return console.error("Error getting students:",i),[]}},async getPendingStudents(){try{const i=ne(At,"users"),t=Le(i,we("role","==","student"));return(await me(t)).docs.map(s=>({id:s.id,...s.data()})).filter(s=>(s.status??"approved")!=="approved")}catch(i){return console.error("Error getting pending students:",i),[]}},async approveUser(i){try{await qs(ge(At,"users",i),{status:"approved",approvedAt:Ds()})}catch(t){throw console.error("Error approving user:",t),t}},async rejectUser(i){try{await qs(ge(At,"users",i),{status:"rejected"})}catch(t){throw console.error("Error rejecting user:",t),t}},async getAnalytics(){try{const[i,t,e,n]=await Promise.all([this.getStudentCount(),this.getTotalQuizzes(),this.getCompletedQuizzes(),this.getAverageQuizScore()]),s=await this.getTotalSubmissions(),o=i>0?e/i*100:0;return{totalStudents:i,totalQuizzes:t,totalSubmissions:s,completedQuizzes:e,avgScore:n,completionRate:o}}catch(i){return console.error("Error getting analytics:",i),{totalStudents:0,totalQuizzes:0,totalSubmissions:0,completedQuizzes:0,avgScore:0,completionRate:0}}},async getTotalQuizzes(){try{const i=ne(At,"quizzes");return(await me(i)).size}catch(i){return console.error("Error getting total quizzes:",i),0}},async getTotalSubmissions(){try{const i=ne(At,"answers");return(await me(i)).size}catch(i){return console.error("Error getting total submissions:",i),0}},async getCompletedQuizzes(){try{const i=ne(At,"answers"),t=await me(i),e=new Set;return t.forEach(n=>{const s=n.data();e.add(`${s.userId}-${s.quizId}`)}),e.size}catch(i){return console.error("Error getting completed quizzes count:",i),0}},async getAverageQuizScore(){try{const i=ne(At,"answers"),t=await me(i);if(t.empty)return 0;const e={};t.forEach(s=>{const o=s.data(),l=`${o.userId}-${o.quizId}`;e[l]||(e[l]={correct:0,total:0}),e[l].total++,o.isCorrect&&e[l].correct++});const n=Object.values(e).map(s=>s.total>0?s.correct/s.total*100:0);return n.length>0?n.reduce((s,o)=>s+o,0)/n.length:0}catch(i){return console.error("Error getting average quiz score:",i),0}},async getCompletionsByQuiz(i){try{const t=ne(At,"answers"),e=await me(Le(t,we("quizId","==",i))),n={};return e.forEach(s=>{const o=s.data(),l=o.answeredAt?.toMillis?.()??0,u=n[o.userId]?.lastAnsweredAt??0;l>u&&(n[o.userId]={lastAnsweredAt:l})}),n}catch(t){return console.error("Error getting completions by quiz:",t),{}}},async getRetakeGrantsByQuiz(i){try{const t=ne(At,"retakeGrants");return(await me(Le(t,we("quizId","==",i)))).docs.map(n=>({id:n.id,...n.data()}))}catch(t){return console.error("Error getting retake grants by quiz:",t),[]}},async getRetakeGrantsByUser(i){try{const t=ne(At,"retakeGrants");return(await me(Le(t,we("userId","==",i)))).docs.map(n=>({id:n.id,...n.data()}))}catch(t){return console.error("Error getting retake grants by user:",t),[]}},async createSampleData(i){try{console.log("Creating sample data...");const t=await this.createModule({title:"Dasar-dasar Desain",description:"Pelajari prinsip-prinsip dasar desain grafis termasuk teori warna, tipografi, dan komposisi.",createdBy:i,order:1}),e=await this.createModule({title:"Tipografi & Tata Letak",description:"Kuasai seni tipografi dan buat tata letak menakjub untuk berbagai media.",createdBy:i,order:2}),n=await this.createModule({title:"Tools Desain Digital",description:"Kuasai software desain populer dan teknik desain digital.",createdBy:i,order:3});await this.createLesson(t,{title:"Pengenalan Prinsip Desain",content:"Selamat datang di dunia desain grafis! Dalam materi ini, kita akan menjelajahi prinsip-prinsip dasar yang memandu semua desain yang baik.",order:1}),await this.createLesson(t,{title:"Dasar-dasar Teori Warna",content:"Memahami hubungan warna, roda warna, dan cara membuat palet warna yang efektif untuk desain Anda.",order:2}),await this.createLesson(e,{title:"Dasar Tipografi",content:"Pelajari tentang berbagai jenis font, spasi, hierarki, dan bagaimana tipografi mempengaruhi keterbacaan dan suasana.",order:1}),await this.createLesson(e,{title:"Tata Letak dan Komposisi",content:"Kuasai sistem grid, ruang kosong, dan keseimbangan visual untuk menciptakan tata letak yang menarik.",order:2}),await this.createLesson(n,{title:"Tinjauan Tools Desain Digital",content:"Pelajari tentang software desain paling populer dan cara memilih tools yang tepat untuk proyek Anda.",order:1});const s=await this.createQuiz({moduleId:t,title:"Kuis Prinsip Desain",createdBy:i,timeLimitSec:600}),o=await this.createQuiz({moduleId:t,title:"Kuis Teori Warna",createdBy:i,timeLimitSec:480});console.log("Sample data created successfully!"),console.log("Created modules:",t,e,n),console.log("Created quizzes:",s,o)}catch(t){throw console.error("Error creating sample data:",t),t}}},iO=()=>{const[i,t]=B.useState({students:[],modules:[],totalLessons:0,analytics:{totalStudents:0,totalQuizzes:0,totalSubmissions:0,completionRate:0,avgScore:0},loading:!0,error:null}),e=async()=>{t(s=>({...s,loading:!0,error:null}));try{const[s,o,l,u]=await Promise.all([gt.getStudents(),gt.getModules(),gt.getAllLessonsCount(),gt.getAnalytics()]);t({students:s,modules:o,totalLessons:l,analytics:u,loading:!1,error:null})}catch(s){t(o=>({...o,loading:!1,error:s instanceof Error?s.message:"Failed to load dashboard data"}))}},n=async s=>{try{await gt.createSampleData(s),await e()}catch(o){throw console.error("Error creating sample data:",o),o}};return B.useEffect(()=>{e()},[]),{...i,refreshData:e,createSampleData:n}},rO=i=>{const[t,e]=B.useState(!0),[n,s]=B.useState(null),[o,l]=B.useState([]),[u,h]=B.useState([]),[f,m]=B.useState([]),[v,b]=B.useState([]),[A,S]=B.useState({});B.useEffect(()=>{(async()=>{if(i){e(!0),s(null);try{const[P,G,I,N]=await Promise.all([gt.getQuizzes(),gt.getAnswersByUser(i),gt.getModules(),gt.getLessonReadsByUser(i)]);l(P),h(G),m(I),b(N);const M=I.filter(z=>z.visible??!0),j=await Promise.all(M.map(async z=>[z.id,(await gt.getLessons(z.id)).length])),F={};j.forEach(([z,U])=>{F[z]=U}),S(F)}catch(P){s(P?.message||"Gagal memuat data siswa")}finally{e(!1)}}})()},[i]);const{totalQuizzes:E,completedQuizzes:T,averageScore:C,progressPercent:L,moduleProgress:k}=B.useMemo(()=>{const V=f.filter(Y=>Y.visible??!0),P=new Set(V.map(Y=>Y.id)),G=o.filter(Y=>!Y.moduleId||P.has(Y.moduleId)),I=G.length,N=new Map;u.forEach(Y=>{const ut=N.get(Y.quizId)||{correct:0,total:0};ut.total+=1,Y.isCorrect&&(ut.correct+=1),N.set(Y.quizId,ut)});const M=N.size;let j=0;const F=Array.from(N.values()).map(Y=>Y.total>0?Y.correct/Y.total*100:0);F.length>0&&(j=F.reduce((Y,ut)=>Y+ut,0)/F.length);const z=V.reduce((Y,ut)=>Y+(A[ut.id]||0),0);let U=0;if(z>0){const Y=v.filter(ut=>P.has(ut.moduleId)).length;U=Math.min(100,Math.round(Y/z*100))}const st=z>0?U:I>0?Math.round(M/I*100):0,dt=new Map;G.forEach(Y=>{if(!Y.moduleId)return;const ut=dt.get(Y.moduleId)||{total:0,done:0};ut.total+=1,N.has(Y.id)&&(ut.done+=1),dt.set(Y.moduleId,ut)});const $=V.map(Y=>{const ut=A[Y.id]||0;let xt=0;if(ut>0){const q=v.filter(it=>it.moduleId===Y.id).length;xt=Math.round(q/ut*100)}else{const q=dt.get(Y.id)||{total:0,done:0};xt=q.total>0?Math.round(q.done/q.total*100):0}return{moduleId:Y.id,title:Y.title,percent:xt}});return{totalQuizzes:I,completedQuizzes:M,averageScore:Math.round(j),progressPercent:st,moduleProgress:$}},[o,u,f,v,A]);return{loading:t,error:n,totalQuizzes:E,completedQuizzes:T,averageScore:C,progressPercent:L,moduleProgress:k}},aO=({onClose:i})=>{const[t,e]=B.useState([]),[n,s]=B.useState([]),[o,l]=B.useState("modules"),[u,h]=B.useState(!0),[f,m]=B.useState(!1),[v,b]=B.useState(!1),[A,S]=B.useState(""),[E,T]=B.useState(""),[C,L]=B.useState(""),[k,V]=B.useState(null),[P,G]=B.useState({title:"",description:"",order:1,visible:!0}),[I,N]=B.useState({title:"",content:"",order:1,assetUrl:"",visible:!0}),[M,j]=B.useState({title:"",description:"",order:1,visible:!0}),[F,z]=B.useState({title:"",content:"",order:1,assetUrl:"",visible:!0});B.useEffect(()=>{U()},[]);const U=async()=>{try{h(!0);const W=await gt.getModules();if(e(W),A){const ft=await gt.getLessons(A);s(ft)}else s([])}catch(W){console.error("Error loading data:",W)}finally{h(!1)}};B.useEffect(()=>{u||(async()=>{if(A){const W=await gt.getLessons(A);s(W)}else s([])})()},[A]);const st=async W=>{W.preventDefault();try{await gt.createModule({title:P.title,description:P.description,createdBy:"current-user",order:P.order,visible:P.visible}),G({title:"",description:"",order:1,visible:!0}),m(!1),U()}catch(ft){console.error("Error creating module:",ft)}},dt=async W=>{if(W.preventDefault(),!A){alert("Pilih bab terlebih dahulu");return}try{await gt.createLesson(A,{title:I.title,content:I.content,order:I.order,assets:I.assetUrl?[I.assetUrl.trim()]:void 0,visible:I.visible}),N({title:"",content:"",order:1,assetUrl:"",visible:!0}),b(!1),U()}catch(ft){console.error("Error creating lesson:",ft)}},$=W=>{T(W.id),j({title:W.title,description:W.description??"",order:W.order||1,visible:W.visible??!0})},Y=async()=>{try{await gt.updateModule(E,{title:M.title,description:M.description,order:M.order,visible:M.visible}),T(""),await U()}catch(W){console.error("Error updating module:",W)}},ut=W=>V({type:"module",id:W}),xt=W=>V({type:"lesson",id:W}),q=async()=>{if(k)try{k.type==="module"?(await gt.deleteModule(k.id),A===k.id&&S("")):k.type==="lesson"&&A&&await gt.deleteLesson(A,k.id),V(null),await U()}catch(W){console.error("Error deleting:",W)}},it=W=>{L(W.id),z({title:W.title,content:W.content??"",order:W.order||1,assetUrl:W.assets&&W.assets[0]||"",visible:W.visible??!0})},ht=async()=>{if(A)try{await gt.updateLesson(A,C,{title:F.title,content:F.content,order:F.order,assets:F.assetUrl?[F.assetUrl.trim()]:[],visible:F.visible}),L(""),await U()}catch(W){console.error("Error updating lesson:",W)}};return u?g.jsx("div",{className:"modal-overlay",children:g.jsx("div",{className:"modal-container",children:g.jsxs("div",{className:"loading-spinner",children:[g.jsx("div",{className:"spinner"}),g.jsx("p",{children:"Loading content..."})]})})}):g.jsx("div",{className:"modal-overlay",children:g.jsxs("div",{className:"modal-container large",children:[g.jsxs("div",{className:"modal-header",children:[g.jsxs("h2",{children:[g.jsx("i",{className:"fas fa-cogs"}),"Manage Content"]}),g.jsx("button",{className:"close-btn",onClick:i,title:"Tutup","aria-label":"Tutup",children:g.jsx("svg",{viewBox:"0 0 24 24","aria-hidden":"true",children:g.jsx("path",{d:"M6 6l12 12M18 6l-12 12"})})})]}),g.jsx("div",{className:"tabs-container",children:g.jsxs("div",{className:"tabs",children:[g.jsxs("button",{className:`tab ${o==="modules"?"active":""}`,onClick:()=>l("modules"),children:[g.jsx("i",{className:"fas fa-th-large"}),"Bab (",t.length,")"]}),g.jsxs("button",{className:`tab ${o==="lessons"?"active":""}`,onClick:()=>l("lessons"),children:[g.jsx("i",{className:"fas fa-book-open"}),"Materi ",A?"(Bab terpilih)":""]})]})}),g.jsxs("div",{className:"modal-content",children:[o==="modules"&&g.jsxs("div",{className:"tab-content",children:[g.jsxs("div",{className:"content-header",children:[g.jsx("h3",{children:"Bab Pembelajaran"}),g.jsxs("button",{className:"btn-primary",onClick:()=>m(!0),children:[g.jsx("i",{className:"fas fa-plus"}),"Tambah Bab"]})]}),f&&g.jsx("div",{className:"form-card",children:g.jsxs("form",{onSubmit:st,children:[g.jsxs("h4",{children:[g.jsx("i",{className:"fas fa-plus-circle"}),"Buat Bab Baru"]}),g.jsxs("div",{className:"form-row",children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Judul Bab *"}),g.jsx("input",{type:"text",value:P.title,onChange:W=>G({...P,title:W.target.value}),placeholder:"Contoh: Design Fundamental",required:!0})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Urutan"}),g.jsx("input",{type:"number",value:P.order,onChange:W=>G({...P,order:parseInt(W.target.value)}),min:"1",required:!0})]})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Deskripsi Bab *"}),g.jsx("textarea",{value:P.description,onChange:W=>G({...P,description:W.target.value}),placeholder:"Jelaskan apa yang akan dipelajari siswa dalam bab ini",rows:3,required:!0})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Tampilkan ke siswa"}),g.jsxs("select",{value:P.visible?"1":"0",onChange:W=>G({...P,visible:W.target.value==="1"}),children:[g.jsx("option",{value:"1",children:"Ya"}),g.jsx("option",{value:"0",children:"Tidak"})]})]}),g.jsxs("div",{className:"form-actions",children:[g.jsxs("button",{type:"submit",className:"btn-primary",children:[g.jsx("i",{className:"fas fa-save"}),"Buat Bab"]}),g.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>m(!1),children:"Batal"})]})]})}),g.jsx("div",{className:"content-grid",children:t.length===0?g.jsxs("div",{className:"empty-state",children:[g.jsx("i",{className:"fas fa-th-large"}),g.jsx("h4",{children:"Belum ada bab yang dibuat"}),g.jsx("p",{children:"Buat bab pertama untuk mulai mengorganisir konten pembelajaran."})]}):t.map(W=>g.jsxs("div",{className:"content-card",children:[g.jsxs("div",{className:"card-header",children:[g.jsxs("div",{className:"module-order",children:["Bab #",W.order]}),g.jsxs("div",{className:"card-actions",children:[g.jsxs("button",{className:`btn-action ${A===W.id?"secondary":"primary"}`,title:A===W.id?"Bab terpilih":"Pilih bab untuk dikelola",onClick:()=>S(W.id),children:[g.jsx("i",{className:"fas fa-check"}),g.jsx("span",{children:A===W.id?"Dipilih":"Pilih Bab"})]}),g.jsxs("button",{className:"btn-action edit",onClick:()=>$(W),title:"Edit bab",children:[g.jsx("i",{className:"fas fa-edit"}),g.jsx("span",{children:"Edit"})]}),g.jsxs("button",{className:"btn-action delete",onClick:()=>ut(W.id),title:"Hapus bab",children:[g.jsx("i",{className:"fas fa-trash"}),g.jsx("span",{children:"Hapus"})]})]})]}),g.jsxs("div",{className:"card-content",children:[E===W.id?g.jsxs("div",{className:"form-inline",children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Judul"}),g.jsx("input",{value:M.title,onChange:ft=>j({...M,title:ft.target.value})})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Deskripsi"}),g.jsx("textarea",{rows:2,value:M.description,onChange:ft=>j({...M,description:ft.target.value})})]}),g.jsxs("div",{className:"form-row",children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Urutan"}),g.jsx("input",{type:"number",min:1,value:M.order,onChange:ft=>j({...M,order:parseInt(ft.target.value)})})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Tampilkan ke siswa"}),g.jsxs("select",{value:M.visible?"1":"0",onChange:ft=>j({...M,visible:ft.target.value==="1"}),children:[g.jsx("option",{value:"1",children:"Ya"}),g.jsx("option",{value:"0",children:"Tidak"})]})]}),g.jsxs("div",{className:"form-actions small",children:[g.jsx("button",{className:"btn-primary",onClick:Y,children:"Simpan"}),g.jsx("button",{className:"btn-secondary",onClick:()=>T(""),children:"Batal"})]})]})]}):g.jsxs(g.Fragment,{children:[g.jsx("h4",{children:W.title}),g.jsx("p",{children:W.description}),A===W.id&&g.jsx("div",{className:"selected-badge",children:"Dipilih untuk dikelola"})]}),g.jsx("div",{className:"card-meta",children:g.jsxs("span",{children:[g.jsx("i",{className:"fas fa-calendar"})," Dibuat: ",new Date().toLocaleDateString("id-ID")]})})]})]},W.id))})]}),o==="lessons"&&g.jsxs("div",{className:"tab-content",children:[g.jsxs("div",{className:"content-header",children:[g.jsx("h3",{children:"Materi Pembelajaran"}),g.jsxs("div",{className:"form-row",children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Pilih Bab untuk dikelola"}),g.jsxs("select",{value:A,onChange:W=>S(W.target.value),children:[g.jsx("option",{value:"",children:"-- Pilih Bab --"}),t.map(W=>g.jsxs("option",{value:W.id,children:["Bab ",W.order,": ",W.title]},W.id))]})]}),g.jsxs("button",{className:"btn-primary",onClick:()=>b(!0),disabled:!A,title:A?"Tambah materi":"Pilih bab dahulu",children:[g.jsx("i",{className:"fas fa-plus"}),"Tambah Materi"]})]})]}),!A&&g.jsxs("div",{className:"empty-state",children:[g.jsx("i",{className:"fas fa-layer-group"}),g.jsx("h4",{children:"Pilih Bab"}),g.jsx("p",{children:"Silakan pilih bab terlebih dahulu untuk melihat dan mengelola materi."})]}),v&&g.jsx("div",{className:"form-card",children:g.jsxs("form",{onSubmit:dt,children:[g.jsxs("h4",{children:[g.jsx("i",{className:"fas fa-plus-circle"}),"Buat Materi Baru"]}),g.jsxs("div",{className:"form-row",children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Bab *"}),g.jsx("input",{value:t.find(W=>W.id===A)?.title||"",disabled:!0})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Urutan"}),g.jsx("input",{type:"number",value:I.order,onChange:W=>N({...I,order:parseInt(W.target.value)}),min:"1",required:!0})]})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Judul Materi *"}),g.jsx("input",{type:"text",value:I.title,onChange:W=>N({...I,title:W.target.value}),placeholder:"Contoh: Pengertian Desain Grafis",required:!0})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Konten Materi *"}),g.jsx("textarea",{value:I.content,onChange:W=>N({...I,content:W.target.value}),placeholder:"Tulis konten pembelajaran untuk materi ini",rows:4,required:!0})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Lampiran PDF / Google Drive (opsional)"}),g.jsx("input",{type:"url",value:I.assetUrl,onChange:W=>N({...I,assetUrl:W.target.value}),placeholder:"Tempel URL PDF atau tautan Google Drive"}),g.jsx("small",{style:{color:"#64748b"},children:'Tips: Untuk Google Drive, gunakan link "preview" atau tempel link biasasistem akan menormalkan untuk ditampilkan.'})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Tampilkan ke siswa"}),g.jsxs("select",{value:I.visible?"1":"0",onChange:W=>N({...I,visible:W.target.value==="1"}),children:[g.jsx("option",{value:"1",children:"Ya"}),g.jsx("option",{value:"0",children:"Tidak"})]})]}),g.jsxs("div",{className:"form-actions",children:[g.jsxs("button",{type:"submit",className:"btn-primary",children:[g.jsx("i",{className:"fas fa-save"}),"Buat Materi"]}),g.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>b(!1),children:"Batal"})]})]})}),g.jsx("div",{className:"content-grid",children:A&&n.length===0?g.jsxs("div",{className:"empty-state",children:[g.jsx("i",{className:"fas fa-book-open"}),g.jsx("h4",{children:"Belum ada materi yang dibuat"}),g.jsx("p",{children:"Buat materi pertama untuk mulai menambahkan konten pembelajaran."})]}):n.map(W=>g.jsxs("div",{className:"content-card",children:[g.jsxs("div",{className:"card-header",children:[g.jsxs("div",{className:"lesson-order",children:["Materi #",W.order]}),g.jsxs("div",{className:"card-actions",children:[g.jsxs("button",{className:"btn-action edit",onClick:()=>it(W),title:"Edit materi",children:[g.jsx("i",{className:"fas fa-edit"}),g.jsx("span",{children:"Edit"})]}),g.jsxs("button",{className:"btn-action delete",onClick:()=>xt(W.id),title:"Hapus materi",children:[g.jsx("i",{className:"fas fa-trash"}),g.jsx("span",{children:"Hapus"})]})]})]}),g.jsxs("div",{className:"card-content",children:[C===W.id?g.jsxs("div",{className:"form-inline",children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Judul Materi"}),g.jsx("input",{value:F.title,onChange:ft=>z({...F,title:ft.target.value})})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Konten"}),g.jsx("textarea",{rows:3,value:F.content,onChange:ft=>z({...F,content:ft.target.value})})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Lampiran PDF / Google Drive (opsional)"}),g.jsx("input",{type:"url",value:F.assetUrl,onChange:ft=>z({...F,assetUrl:ft.target.value})}),g.jsx("small",{style:{color:"#64748b"},children:"Tempel URL PDF atau tautan Google Drive yang berisi materi."})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Tampilkan ke siswa"}),g.jsxs("select",{value:F.visible?"1":"0",onChange:ft=>z({...F,visible:ft.target.value==="1"}),children:[g.jsx("option",{value:"1",children:"Ya"}),g.jsx("option",{value:"0",children:"Tidak"})]})]}),g.jsxs("div",{className:"form-row",children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Urutan"}),g.jsx("input",{type:"number",min:1,value:F.order,onChange:ft=>z({...F,order:parseInt(ft.target.value)})})]}),g.jsxs("div",{className:"form-actions small",children:[g.jsx("button",{className:"btn-primary",onClick:ht,children:"Simpan"}),g.jsx("button",{className:"btn-secondary",onClick:()=>L(""),children:"Batal"})]})]})]}):g.jsxs(g.Fragment,{children:[g.jsx("h4",{children:W.title}),g.jsx("p",{children:W.content?W.content.substring(0,100)+"...":"Belum ada konten"})]}),g.jsx("div",{className:"card-meta",children:g.jsxs("span",{children:[g.jsx("i",{className:"fas fa-clock"})," Durasi: 30 menit"]})})]})]},W.id))})]})]}),k&&g.jsx("div",{className:"modal-overlay confirm",children:g.jsxs("div",{className:"modal-container small",children:[g.jsxs("div",{className:"modal-header",children:[g.jsxs("h2",{children:[g.jsx("i",{className:"fas fa-exclamation-triangle"}),"Konfirmasi Hapus"]}),g.jsx("button",{className:"close-btn",onClick:()=>V(null),children:g.jsx("i",{className:"fas fa-times"})})]}),g.jsxs("div",{className:"modal-content",children:[g.jsx("p",{children:k.type==="module"?"Menghapus bab juga akan menghapus semua materi di dalamnya. Lanjutkan?":"Anda yakin ingin menghapus materi ini?"}),g.jsxs("div",{className:"form-actions",children:[g.jsx("button",{className:"btn-secondary",onClick:()=>V(null),children:"Batal"}),g.jsx("button",{className:"btn-danger",onClick:q,children:"Hapus"})]})]})]})})]})})},oO=({onClose:i})=>{const t="dgkh8fleg",e="kelazgraphicdesigner",[n,s]=B.useState([]),[o,l]=B.useState([]),[u,h]=B.useState(!0),[f,m]=B.useState("quiz-info"),[v,b]=B.useState(!1),[A,S]=B.useState(null),[E,T]=B.useState({moduleId:"",lessonId:"",title:"",timeLimitSec:600}),[C,L]=B.useState([]),[k,V]=B.useState({type:"multiple_choice",text:"",options:["","",""],correctIndex:0,correctIndexes:[],imageUrl:"",imageAlt:""});B.useEffect(()=>{(async()=>{try{h(!0);const dt=await gt.getModules();s(dt)}catch(dt){console.error("Error loading modules:",dt)}finally{h(!1)}})()},[]),B.useEffect(()=>{(async()=>{if(!E.moduleId){l([]),T(dt=>({...dt,lessonId:""}));return}try{h(!0);const dt=await gt.getLessons(E.moduleId);l(dt),dt.find($=>$.id===E.lessonId)||T($=>({...$,lessonId:""}))}catch(dt){console.error("Error loading lessons:",dt)}finally{h(!1)}})()},[E.moduleId]);const P=st=>{if(st.preventDefault(),!E.moduleId||!E.lessonId||!E.title){alert("Mohon lengkapi semua kolom yang diperlukan");return}m("questions")},G=(st,dt)=>{const $=k.options?[...k.options]:[];$[st]=dt,V({...k,options:$})},I=()=>{const st=k.options?[...k.options]:[];st.push(""),V({...k,options:st})},N=st=>{const dt=(k.options||[]).filter((Y,ut)=>ut!==st),$={...k,options:dt};k.type!=="checkboxes"?(k.correctIndex??0)>=dt.length&&($.correctIndex=0):$.correctIndexes=(k.correctIndexes||[]).filter(Y=>Y!==st).map(Y=>Y>st?Y-1:Y),V($)},M=()=>{if(!k.text.trim()){alert("Mohon isi teks pertanyaan");return}if(["multiple_choice","checkboxes","dropdown"].includes(k.type)){const st=k.options||[];if(st.length<2||st.some(dt=>!dt.trim())){alert("Minimal 2 pilihan dan tidak boleh kosong");return}if(k.type!=="checkboxes"&&(k.correctIndex??-1)<0){alert("Pilih jawaban benar");return}if(k.type==="checkboxes"&&(!k.correctIndexes||k.correctIndexes.length===0)){alert("Pilih minimal satu jawaban benar");return}}L([...C,{...k}]),V({type:"multiple_choice",text:"",options:["","",""],correctIndex:0,correctIndexes:[],imageUrl:"",imageAlt:""})},j=st=>{L(C.filter((dt,$)=>$!==st))},F=async()=>{if(C.length===0){alert("Mohon tambahkan minimal satu pertanyaan");return}try{h(!0);const st=await gt.createQuiz({moduleId:E.moduleId,lessonId:E.lessonId,title:E.title,createdBy:"current-user",timeLimitSec:E.timeLimitSec});for(const dt of C)await gt.addQuestionToQuiz(st,dt);alert("Kuis berhasil dibuat!"),i()}catch(st){console.error("Error creating quiz:",st),alert("Gagal membuat kuis. Silakan coba lagi.")}finally{h(!1)}};async function z(st){const dt=new FormData;dt.append("file",st),dt.append("upload_preset",e);const $=await fetch(`https://api.cloudinary.com/v1_1/${t}/image/upload`,{method:"POST",body:dt});if(!$.ok)throw new Error("Upload gagal");return $.json()}function U(st){return st.replace("/upload/","/upload/f_auto,q_auto,w_1600,c_limit/")}return u?g.jsx("div",{className:"modal-overlay",children:g.jsx("div",{className:"modal",children:g.jsx("div",{className:"modal-content",children:"Memuat..."})})}):g.jsx("div",{className:"modal-overlay",children:g.jsxs("div",{className:"modal-container large",children:[g.jsxs("div",{className:"modal-header",children:[g.jsx("h2",{children:"Buat Kuis"}),g.jsx("button",{className:"close-btn",onClick:i,"aria-label":"Tutup",children:""})]}),g.jsxs("div",{className:"modal-content",children:[g.jsxs("div",{className:"tabs",children:[g.jsx("button",{className:`tab ${f==="quiz-info"?"active":""}`,onClick:()=>m("quiz-info"),children:"Info Kuis"}),g.jsx("button",{className:`tab ${f==="questions"?"active":""}`,onClick:()=>m("questions"),disabled:!E.moduleId||!E.lessonId||!E.title,children:"Pertanyaan"})]}),f==="quiz-info"&&g.jsxs("form",{onSubmit:P,children:[g.jsxs("div",{className:"form-card",children:[g.jsx("h4",{children:"Informasi Kuis"}),g.jsxs("div",{className:"form-row",children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Pilih Bab *"}),g.jsxs("select",{value:E.moduleId,onChange:st=>T({...E,moduleId:st.target.value}),className:E.moduleId?void 0:"empty",children:[g.jsx("option",{value:"",children:"-- Pilih Bab --"}),n.map(st=>g.jsx("option",{value:st.id,children:st.title},st.id))]})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Pilih Materi *"}),g.jsxs("select",{value:E.lessonId,onChange:st=>T({...E,lessonId:st.target.value}),disabled:!E.moduleId,className:E.lessonId?void 0:"empty",children:[g.jsx("option",{value:"",children:"-- Pilih Materi --"}),o.map(st=>g.jsx("option",{value:st.id,children:st.title},st.id))]})]})]}),g.jsxs("div",{className:"form-row",children:[g.jsxs("div",{className:"form-group",style:{flex:2},children:[g.jsx("label",{children:"Judul Kuis *"}),g.jsx("input",{type:"text",value:E.title,onChange:st=>T({...E,title:st.target.value}),placeholder:"Contoh: Kuis Bab 1 - Desain Dasar"})]}),g.jsxs("div",{className:"form-group",style:{maxWidth:"220px"},children:[g.jsx("label",{children:"Batas Waktu (menit)"}),g.jsx("input",{type:"number",min:1,value:Math.max(1,Math.round(E.timeLimitSec/60)),onChange:st=>{const dt=Math.max(1,parseInt(st.target.value||"1",10));T({...E,timeLimitSec:dt*60})}})]})]})]}),g.jsxs("div",{className:"form-actions",children:[g.jsx("button",{type:"button",className:"btn-secondary",onClick:i,children:"Batal"}),g.jsx("button",{type:"submit",className:"btn-primary",children:"Lanjut ke Pertanyaan"})]})]}),f==="questions"&&g.jsxs("div",{children:[g.jsxs("div",{className:"form-card",children:[g.jsx("h4",{children:"Ringkasan"}),g.jsxs("div",{className:"card-meta",style:{gap:"24px"},children:[g.jsxs("span",{children:["Bab: ",n.find(st=>st.id===E.moduleId)?.title]}),g.jsxs("span",{children:["Materi: ",o.find(st=>st.id===E.lessonId)?.title||"-"]}),g.jsxs("span",{children:["Batas Waktu: ",Math.floor(E.timeLimitSec/60)," menit"]})]})]}),g.jsxs("div",{className:"form-card",children:[g.jsx("h4",{children:"Tambah Pertanyaan Baru"}),g.jsx("div",{className:"form-row",children:g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Tipe Pertanyaan"}),g.jsxs("select",{value:k.type,onChange:st=>V({...k,type:st.target.value}),children:[g.jsx("option",{value:"multiple_choice",children:"Multiple Choice"}),g.jsx("option",{value:"checkboxes",children:"Checkboxes"}),g.jsx("option",{value:"dropdown",children:"Dropdown"}),g.jsx("option",{value:"short_answer",children:"Short Answer"}),g.jsx("option",{value:"paragraph",children:"Paragraph"})]})]})}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Pertanyaan *"}),g.jsx("textarea",{value:k.text,onChange:st=>V({...k,text:st.target.value}),rows:3,placeholder:"Masukkan pertanyaan Anda"})]}),g.jsxs("div",{className:"form-row",children:[g.jsxs("div",{className:"form-group",style:{flex:2},children:[g.jsx("label",{children:"Gambar (opsional)"}),g.jsx("input",{type:"text",value:k.imageUrl||"",onChange:st=>V({...k,imageUrl:st.target.value}),placeholder:"Tempel URL gambar atau upload file di bawah"}),g.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,alignItems:"center"},children:[g.jsx("input",{type:"file",accept:"image/*",onChange:async st=>{const dt=st.target.files?.[0];if(dt)try{S(null),b(!0);const $=await z(dt),Y=U($.secure_url);V(ut=>({...ut,imageUrl:Y}))}catch($){S($?.message||"Upload gagal")}finally{b(!1)}}}),v&&g.jsx("span",{style:{color:"#64748b"},children:"Mengunggah..."})]}),A&&g.jsx("p",{style:{color:"#ef4444",marginTop:6},children:A}),g.jsxs("p",{style:{color:"#64748b",fontSize:12,marginTop:6},children:["Tips: format/quality otomatis dengan ",g.jsx("code",{children:"f_auto,q_auto"})," dan lebar maks ",g.jsx("code",{children:"w_1600"})," sudah diterapkan."]})]}),g.jsxs("div",{className:"form-group",style:{flex:1},children:[g.jsx("label",{children:"Alt text"}),g.jsx("input",{type:"text",value:k.imageAlt||"",onChange:st=>V({...k,imageAlt:st.target.value}),placeholder:"Deskripsi gambar"})]})]}),["multiple_choice","checkboxes","dropdown"].includes(k.type)&&g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Pilihan"}),(k.options||[]).map((st,dt)=>g.jsxs("div",{className:"option-row",children:[k.type==="checkboxes"?g.jsx("input",{type:"checkbox",checked:(k.correctIndexes||[]).includes(dt),onChange:$=>{const Y=new Set(k.correctIndexes||[]);$.target.checked?Y.add(dt):Y.delete(dt),V({...k,correctIndexes:Array.from(Y).sort((ut,xt)=>ut-xt)})}}):g.jsx("input",{type:"radio",name:"correct",checked:(k.correctIndex??0)===dt,onChange:()=>V({...k,correctIndex:dt})}),g.jsx("input",{type:"text",value:st,onChange:$=>G(dt,$.target.value),placeholder:`Pilihan ${dt+1}`,className:"option-input"}),g.jsx("button",{type:"button",className:"btn-delete",onClick:()=>N(dt),title:"Hapus pilihan",children:g.jsx("span",{children:"Hapus"})})]},dt)),g.jsx("div",{className:"form-actions",style:{marginTop:"8px"},children:g.jsx("button",{type:"button",className:"btn-secondary",onClick:I,children:"+ Tambah Pilihan"})})]}),g.jsxs("div",{className:"form-actions",children:[g.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>m("quiz-info"),children:"Kembali"}),g.jsx("button",{type:"button",className:"btn-primary",onClick:M,children:"Tambahkan ke Daftar"})]})]}),g.jsxs("div",{className:"form-card",children:[g.jsxs("h4",{children:["Pertanyaan (",C.length,")"]}),C.length===0?g.jsx("div",{className:"empty-state",style:{padding:"20px"},children:"Belum ada pertanyaan ditambahkan"}):g.jsx("div",{className:"content-grid",style:{gridTemplateColumns:"1fr"},children:C.map((st,dt)=>g.jsxs("div",{className:"content-card",children:[g.jsxs("div",{className:"card-header",children:[g.jsxs("div",{className:"lesson-order",children:["P",dt+1]}),g.jsx("div",{className:"card-actions",children:g.jsx("button",{className:"btn-action delete",onClick:()=>j(dt),children:g.jsx("span",{children:"Hapus"})})})]}),g.jsxs("div",{className:"card-content",children:[g.jsx("h4",{children:st.type==="multiple_choice"?"Multiple Choice":st.type==="checkboxes"?"Checkboxes":st.type==="dropdown"?"Dropdown":st.type==="short_answer"?"Short Answer":"Paragraph"}),st.imageUrl&&g.jsx("img",{src:st.imageUrl,alt:st.imageAlt||"",style:{maxWidth:"100%",height:"auto",borderRadius:8,marginBottom:8}}),g.jsx("p",{children:st.text}),["multiple_choice","checkboxes","dropdown"].includes(st.type)&&g.jsx("div",{className:"card-meta",style:{display:"block",color:"#475569"},children:(st.options||[]).map(($,Y)=>{const ut=st.type==="checkboxes"?(st.correctIndexes||[]).includes(Y):(st.correctIndex??-1)===Y;return g.jsxs("div",{style:{marginBottom:"4px"},children:[ut?"":""," ",$]},Y)})})]})]},dt))}),g.jsx("div",{className:"form-actions",children:g.jsx("button",{className:"btn-primary",onClick:F,disabled:C.length===0,children:"Buat Kuis"})})]})]})]})]})})},lO=({onClose:i})=>{const{user:t}=Ar(),[e,n]=B.useState([]),[s,o]=B.useState(!0),[l,u]=B.useState(null),[h,f]=B.useState(null),[m,v]=B.useState({title:"",timeLimitMin:10}),[b,A]=B.useState(null),[S,E]=B.useState([]),[T,C]=B.useState([]),[L,k]=B.useState(null),[V,P]=B.useState({}),[G,I]=B.useState(null),[N,M]=B.useState(null),[j,F]=B.useState([]),[z,U]=B.useState(null),[st,dt]=B.useState(!1),[$,Y]=B.useState(!1),[ut,xt]=B.useState(1),[q,it]=B.useState(""),[ht,W]=B.useState({}),[ft,Nt]=B.useState(!1),wt=mt=>mt?/^https?:\/\//i.test(mt)?mt:("/kelazgraphicdesigner"+(mt.startsWith("~/")?mt.slice(1):mt).replace(/^\//,"")).replace(/\/+/g,"/"):"",Ot=async()=>{try{o(!0);const[mt,Ct,ie,ke]=await Promise.all([gt.getQuizzes(),gt.getModules(),gt.getAllLessons(),gt.getStudents()]);n(mt),E(Ct),C(ie),F(ke),u(null)}catch{u("Gagal memuat daftar kuis")}finally{o(!1)}};B.useEffect(()=>{Ot()},[]);const Qt=async()=>{if(h)try{await gt.updateQuiz(h,{title:m.title.trim(),timeLimitSec:Math.max(60,m.timeLimitMin*60)}),f(null),await Ot()}catch{alert("Gagal menyimpan perubahan kuis")}},Gn=async()=>{if(b)try{await gt.deleteQuiz(b.id),A(null),await Ot()}catch{alert("Gagal menghapus kuis")}},ys=mt=>S.find(Ct=>Ct.id===mt)?.title||"-",Pn=mt=>T.find(Ct=>Ct.id===mt)?.title||"-",es=async mt=>{if(k(Ct=>Ct===mt?null:mt),!V[mt])try{I(mt);const Ct=await gt.getQuestions(mt);P(ie=>({...ie,[mt]:Ct}))}finally{I(null)}Nt(!0);try{const Ct=await gt.getLatestAnswersByQuiz(mt);W(Ct)}finally{Nt(!1)}},vs=async mt=>{M(mt),dt(!0);try{const[Ct,ie]=await Promise.all([gt.getCompletionsByQuiz(mt),gt.getRetakeGrantsByQuiz(mt)]);U({completions:Ct,grants:ie})}finally{dt(!1)}},Vs=async()=>{if(!(!N||!q||ut<1))try{Y(!0),await gt.grantRetake(q,N,ut,t?.uid||"-");const[mt,Ct]=await Promise.all([gt.getCompletionsByQuiz(N),gt.getRetakeGrantsByQuiz(N)]);U({completions:mt,grants:Ct}),xt(1)}catch{alert("Gagal memberikan akses ulang")}finally{Y(!1)}},Ta=async mt=>{if(N)try{await gt.revokeRetake(mt,N);const[Ct,ie]=await Promise.all([gt.getCompletionsByQuiz(N),gt.getRetakeGrantsByQuiz(N)]);U({completions:Ct,grants:ie})}catch{alert("Gagal mencabut akses ulang")}};return g.jsxs("div",{className:"modal-overlay",children:[g.jsxs("div",{className:"modal-container large",children:[g.jsxs("div",{className:"modal-header",children:[g.jsx("h2",{children:"Kelola Kuis"}),g.jsx("button",{className:"close-btn",onClick:i,"aria-label":"Tutup",children:""})]}),g.jsxs("div",{className:"modal-content",children:[l&&g.jsx("div",{className:"error-message",children:l}),s?g.jsxs("div",{className:"loading-state",children:[g.jsx("div",{className:"loading-spinner"}),g.jsx("p",{children:"Memuat kuis..."})]}):g.jsxs("div",{className:"content-grid",style:{gridTemplateColumns:"1fr"},children:[e.length===0&&g.jsx("div",{className:"empty-state",children:"Belum ada kuis dibuat"}),e.map(mt=>g.jsxs("div",{className:"content-card",children:[g.jsxs("div",{className:"card-header",children:[g.jsx("div",{className:"lesson-order",children:"KZ"}),g.jsx("div",{className:"card-actions",children:h===mt.id?g.jsxs(g.Fragment,{children:[g.jsx("button",{className:"btn-action secondary",onClick:()=>f(null),children:"Batal"}),g.jsx("button",{className:"btn-action primary",onClick:Qt,children:"Simpan"})]}):g.jsxs(g.Fragment,{children:[g.jsx("button",{className:"btn-action",onClick:()=>es(mt.id),children:L===mt.id?"Tutup":"Lihat"}),g.jsx("button",{className:"btn-action edit",onClick:()=>{window.location.hash=`#/dashboard/edit-quiz/${mt.id}`},children:"Edit"}),g.jsx("button",{className:"btn-action",onClick:()=>vs(mt.id),children:"Kelola Akses Ulang"}),g.jsx("button",{className:"btn-action delete",onClick:()=>A({id:mt.id,title:mt.title}),children:"Hapus"})]})})]}),g.jsx("div",{className:"card-content",children:h===mt.id?g.jsxs("div",{className:"form-row",children:[g.jsxs("div",{className:"form-group",style:{flex:2},children:[g.jsx("label",{children:"Judul Kuis"}),g.jsx("input",{value:m.title,onChange:Ct=>v(ie=>({...ie,title:Ct.target.value}))})]}),g.jsxs("div",{className:"form-group",style:{maxWidth:220},children:[g.jsx("label",{children:"Batas Waktu (menit)"}),g.jsx("input",{type:"number",min:1,value:m.timeLimitMin,onChange:Ct=>v(ie=>({...ie,timeLimitMin:Math.max(1,parseInt(Ct.target.value||"1",10))}))})]})]}):g.jsxs(g.Fragment,{children:[g.jsx("h4",{children:mt.title}),g.jsxs("p",{children:["Bab: ",ys(mt.moduleId)]}),mt.lessonId&&g.jsxs("p",{children:["Materi: ",Pn(mt.lessonId)]}),g.jsx("div",{className:"card-meta",children:g.jsxs("span",{children:["Waktu: ",Math.floor((mt.timeLimitSec??600)/60)," menit"]})}),L===mt.id&&g.jsxs(g.Fragment,{children:[g.jsxs("div",{style:{marginTop:12},children:[g.jsx("h5",{style:{margin:"8px 0"},children:"Pertanyaan"}),G===mt.id&&g.jsx("div",{style:{color:"#64748b"},children:"Memuat pertanyaan..."}),V[mt.id]&&V[mt.id].length===0&&g.jsx("div",{className:"empty-state",children:"Belum ada pertanyaan"}),V[mt.id]&&V[mt.id].length>0&&g.jsx("ul",{style:{paddingLeft:16,margin:0},children:V[mt.id].map((Ct,ie)=>g.jsxs("li",{style:{marginBottom:12},children:[g.jsxs("div",{style:{fontWeight:600},children:[ie+1,". ",Ct.text]}),Ct.imageUrl&&g.jsx("div",{style:{margin:"6px 0"},children:g.jsx("img",{src:wt(Ct.imageUrl),alt:Ct.imageAlt||"Ilustrasi",style:{maxWidth:"100%",borderRadius:8}})}),["multiple_choice","checkboxes","dropdown"].includes(Ct.type)&&g.jsx("div",{style:{marginTop:4,color:"#475569"},children:(Ct.options||[]).map((ke,_s)=>{const ns=Ct.type==="checkboxes"?(Ct.correctIndexes||[]).includes(_s):(Ct.correctIndex??-1)===_s;return g.jsxs("div",{children:[ns?"":""," ",ke]},_s)})})]},Ct.id))})]}),g.jsxs("div",{style:{marginTop:16},children:[g.jsx("h5",{style:{margin:"8px 0"},children:"Penilaian Manual & Jawaban Terakhir"}),ft&&g.jsx("div",{style:{color:"#64748b"},children:"Memuat jawaban..."}),!ft&&j.length===0&&g.jsx("div",{className:"empty-state",children:"Belum ada siswa"}),!ft&&j.length>0&&g.jsx("div",{className:"content-grid",style:{gridTemplateColumns:"1fr"},children:j.map(Ct=>g.jsx("div",{className:"content-card",children:g.jsxs("div",{className:"card-content",children:[g.jsx("div",{style:{fontWeight:600,marginBottom:6},children:Ct.name||Ct.email}),V[mt.id]?.map(ie=>{const ke=ht[Ct.id]?.[ie.id],_s=ie.type==="short_answer"||ie.type==="paragraph";return g.jsxs("div",{style:{padding:"8px 0",borderTop:"1px solid #f1f5f9"},children:[g.jsx("div",{style:{fontWeight:500},children:ie.text}),ie.imageUrl&&g.jsx("img",{src:wt(ie.imageUrl),alt:ie.imageAlt||"Ilustrasi",style:{maxWidth:"100%",borderRadius:6,marginTop:6}}),g.jsx("div",{style:{color:"#475569",marginTop:6},children:ke?_s?g.jsxs(g.Fragment,{children:[g.jsx("div",{style:{whiteSpace:"pre-wrap",background:"#f8fafc",padding:8,borderRadius:6},children:ke.textAnswer||"(kosong)"}),g.jsxs("div",{className:"form-actions",style:{gap:8,marginTop:8},children:[g.jsx("button",{className:"btn-action primary",onClick:async()=>{await gt.updateManualScore(ke.id,!0);const ns=await gt.getLatestAnswersByQuiz(mt.id);W(ns)},children:"Tandai Benar"}),g.jsx("button",{className:"btn-action delete",onClick:async()=>{await gt.updateManualScore(ke.id,!1);const ns=await gt.getLatestAnswersByQuiz(mt.id);W(ns)},children:"Tandai Salah"}),g.jsx("span",{style:{color:ke.isCorrect?"#16a34a":"#ef4444"},children:ke.isCorrect?" Benar":" Salah"})]})]}):g.jsxs(g.Fragment,{children:[g.jsxs("span",{children:["Jawaban: ",ke.selectedIndex>=0?`Pilihan #${ke.selectedIndex+1}`:""]}),g.jsx("span",{style:{marginLeft:8,color:ke.isCorrect?"#16a34a":"#ef4444"},children:ke.isCorrect?"":""})]}):g.jsx("span",{style:{color:"#9ca3af"},children:"Belum ada jawaban"})})]},ie.id)})]})},Ct.id))})]})]})]})})]},mt.id))]})]})]}),b&&g.jsx("div",{className:"modal-overlay",children:g.jsxs("div",{className:"modal-container",style:{maxWidth:520},children:[g.jsxs("div",{className:"modal-header",children:[g.jsx("h2",{children:"Konfirmasi Hapus"}),g.jsx("button",{className:"close-btn",onClick:()=>A(null),"aria-label":"Tutup",children:""})]}),g.jsxs("div",{className:"modal-content",children:[g.jsxs("p",{children:['Hapus kuis "',b.title,'"? Tindakan ini juga akan menghapus pertanyaan dan jawaban terkait.']}),g.jsxs("div",{className:"form-actions",children:[g.jsx("button",{className:"btn-secondary",onClick:()=>A(null),children:"Batal"}),g.jsx("button",{className:"btn-primary",onClick:Gn,children:"Hapus"})]})]})]})}),N&&g.jsx("div",{className:"modal-overlay",children:g.jsxs("div",{className:"modal-container",style:{maxWidth:720},children:[g.jsxs("div",{className:"modal-header",children:[g.jsx("h2",{children:"Kelola Akses Ulang Kuis"}),g.jsx("button",{className:"close-btn",onClick:()=>{M(null),U(null)},"aria-label":"Tutup",children:""})]}),g.jsx("div",{className:"modal-content",children:st||!z?g.jsxs("div",{className:"loading-state",children:[g.jsx("div",{className:"loading-spinner"}),g.jsx("p",{children:"Memuat data..."})]}):g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"form-row",style:{gridTemplateColumns:"2fr 1fr 1fr auto"},children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Pilih Siswa"}),g.jsxs("select",{value:q,onChange:mt=>it(mt.target.value),children:[g.jsx("option",{value:"",children:"-- pilih siswa --"}),j.map(mt=>g.jsx("option",{value:mt.id,children:mt.name||mt.email},mt.id))]})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Jumlah Kesempatan"}),g.jsx("input",{type:"number",min:1,value:ut,onChange:mt=>xt(Math.max(1,parseInt(mt.target.value||"1",10)))})]}),g.jsx("div",{className:"form-group",style:{alignSelf:"end"},children:g.jsx("button",{className:"btn-primary",disabled:!q||$,onClick:Vs,children:$?"Menyimpan...":"Beri Akses Ulang"})})]}),g.jsx("h5",{style:{marginTop:8},children:"Status Siswa"}),g.jsx("div",{className:"content-grid",style:{gridTemplateColumns:"1fr"},children:j.map(mt=>{const Ct=!!z.completions[mt.id],ie=z.grants.find(ke=>ke.userId===mt.id);return g.jsx("div",{className:"content-card",children:g.jsxs("div",{className:"card-content",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[g.jsxs("div",{children:[g.jsx("div",{style:{fontWeight:600},children:mt.name||mt.email}),g.jsxs("div",{className:"card-meta",children:[g.jsx("span",{children:Ct?"Sudah pernah mengerjakan":"Belum mengerjakan"}),ie&&g.jsxs("span",{children:["Akses ulang tersisa: ",ie.allowed]})]})]}),g.jsx("div",{className:"card-actions",children:ie?g.jsx("button",{className:"btn-action delete",onClick:()=>Ta(mt.id),children:"Cabut"}):g.jsx("button",{className:"btn-action",onClick:()=>{it(mt.id),xt(1)},children:"Beri 1x"})})]})},mt.id)})})]})})]})})]})},cO=({onClose:i})=>{const[t,e]=B.useState([]),[n,s]=B.useState(!0),[o,l]=B.useState(!0),[u,h]=B.useState(null),[f,m]=B.useState(null),[v,b]=B.useState({name:"",role:"student"}),[A,S]=B.useState(null),E=async()=>{try{l(!0);const k=await gt.getStudents();e(k),h(null)}catch{h("Gagal memuat daftar siswa")}finally{l(!1)}};B.useEffect(()=>{E()},[]);const T=k=>{m(k.id),b({name:k.name,role:k.role})},C=async()=>{if(f)try{const k={name:v.name.trim(),role:v.role};await gt.updateUser(f,k),m(null),await E()}catch{alert("Gagal menyimpan perubahan siswa")}},L=async()=>{if(A)try{await gt.deleteUser(A.id),S(null),await E()}catch{alert("Gagal menghapus siswa")}};return g.jsxs("div",{className:"modal-overlay",children:[g.jsxs("div",{className:"modal-container large",children:[g.jsxs("div",{className:"modal-header",children:[g.jsx("h2",{children:"Kelola Siswa"}),g.jsx("button",{className:"close-btn",onClick:i,"aria-label":"Tutup",children:""})]}),g.jsxs("div",{className:"modal-content",children:[u&&g.jsx("div",{className:"error-message",children:u}),o?g.jsxs("div",{className:"loading-state",children:[g.jsx("div",{className:"loading-spinner"}),g.jsx("p",{children:"Memuat siswa..."})]}):g.jsxs("div",{children:[g.jsxs("div",{className:"form-actions",style:{justifyContent:"space-between"},children:[g.jsx("div",{}),g.jsxs("label",{className:"btn-action",style:{cursor:"pointer"},children:[g.jsx("input",{type:"checkbox",checked:n,onChange:k=>s(k.target.checked)})," Tampilkan hanya yang perlu persetujuan"]})]}),g.jsxs("div",{className:"content-grid",style:{gridTemplateColumns:"1fr"},children:[t.length===0&&g.jsx("div",{className:"empty-state",children:"Belum ada siswa terdaftar"}),t.filter(k=>!n||(k.status??"approved")!=="approved").map(k=>g.jsxs("div",{className:"content-card",children:[g.jsxs("div",{className:"card-header",children:[g.jsx("div",{className:"module-order",children:"S"}),g.jsx("div",{className:"card-actions",children:f===k.id?g.jsxs(g.Fragment,{children:[g.jsx("button",{className:"btn-action secondary",onClick:()=>m(null),children:"Batal"}),g.jsx("button",{className:"btn-action primary",onClick:C,children:"Simpan"})]}):g.jsxs(g.Fragment,{children:[(k.status??"approved")!=="approved"&&g.jsxs(g.Fragment,{children:[g.jsx("button",{className:"btn-action primary",onClick:async()=>{await gt.approveUser(k.id),await E()},children:"Setujui"}),g.jsx("button",{className:"btn-action delete",onClick:async()=>{await gt.rejectUser(k.id),await E()},children:"Tolak"})]}),g.jsx("button",{className:"btn-action edit",onClick:()=>T(k),children:"Edit"}),g.jsx("button",{className:"btn-action delete",onClick:()=>S({id:k.id,name:k.name}),children:"Hapus"})]})})]}),g.jsx("div",{className:"card-content",children:f===k.id?g.jsxs("div",{className:"form-row",style:{gridTemplateColumns:"2fr 1fr"},children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Nama"}),g.jsx("input",{value:v.name,onChange:V=>b(P=>({...P,name:V.target.value}))})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Role"}),g.jsxs("select",{value:v.role,onChange:V=>b(P=>({...P,role:V.target.value})),children:[g.jsx("option",{value:"student",children:"Siswa"}),g.jsx("option",{value:"teacher",children:"Guru"})]})]})]}):g.jsxs(g.Fragment,{children:[g.jsx("h4",{children:k.name}),g.jsxs("p",{children:["Email: ",k.email||"-"]}),g.jsxs("div",{className:"card-meta",children:[g.jsxs("span",{children:["Role: ",k.role==="teacher"?"Guru":"Siswa"]}),g.jsxs("span",{children:["Status: ",(k.status??"approved")==="approved"?"Disetujui":(k.status??"pending")==="pending"?"Menunggu":"Ditolak"]}),g.jsx("span",{children:"Dibuat: "})]})]})})]},k.id))]})]})]})]}),A&&g.jsx("div",{className:"modal-overlay",children:g.jsxs("div",{className:"modal-container",style:{maxWidth:520},children:[g.jsxs("div",{className:"modal-header",children:[g.jsx("h2",{children:"Konfirmasi Hapus"}),g.jsx("button",{className:"close-btn",onClick:()=>S(null),"aria-label":"Tutup",children:""})]}),g.jsxs("div",{className:"modal-content",children:[g.jsxs("p",{children:['Hapus siswa "',A.name,'"? Ini hanya menghapus data di aplikasi, bukan akun login.']}),g.jsxs("div",{className:"form-actions",children:[g.jsx("button",{className:"btn-secondary",onClick:()=>S(null),children:"Batal"}),g.jsx("button",{className:"btn-primary",onClick:L,children:"Hapus"})]})]})]})})]})},uO=()=>{const{userDoc:i,logout:t,isTeacher:e,isStudent:n,user:s}=Ar(),{students:o,modules:l,totalLessons:u,analytics:h,loading:f,error:m,refreshData:v,createSampleData:b}=iO(),A=rO(s?.uid),[S,E]=B.useState(!1),[T,C]=B.useState(!1),[L,k]=B.useState(!1),[V,P]=B.useState(!1),G=async()=>{try{await t()}catch(U){console.error("Logout error:",U)}},I=async()=>{if(s&&e)try{await b(s.uid),alert("Data contoh berhasil dibuat!")}catch(U){console.error("Error creating sample data:",U),alert("Gagal membuat data contoh. Silakan coba lagi.")}},N=()=>{E(!0)},M=()=>{C(!0)},j=()=>{k(!0)},F=()=>{alert(`Dashboard Analitik:

 Progres Siswa: ${h.completionRate}% rata-rata penyelesaian
 Performa Kuis: ${h.avgScore}% rata-rata nilai
 Siswa Aktif: ${o.length}
 Total Konten: ${l.length} bab, ${u} materi`)},z=()=>{P(!0)};return i?g.jsxs("div",{className:"dashboard",children:[g.jsx("header",{className:"dashboard-header",children:g.jsxs("div",{className:"container",children:[g.jsxs("div",{className:"logo",children:[g.jsx("h2",{children:"Kelaz"}),g.jsx("span",{children:"Kelas Online Desain Grafis"})]}),g.jsxs("div",{className:"user-menu",children:[g.jsxs("span",{className:"user-name",children:["Selamat datang, ",i.name]}),g.jsx("span",{className:`user-role ${i.role}`,children:i.role==="teacher"?" Guru":" Siswa"}),g.jsx("button",{onClick:G,className:"btn-logout",children:"Keluar"})]})]})}),g.jsx("main",{className:"dashboard-main",children:g.jsxs("div",{className:"container",children:[n&&g.jsxs("div",{className:"student-dashboard",children:[g.jsx("h1",{children:"Dashboard Siswa"}),g.jsxs("div",{className:"dashboard-grid",children:[g.jsxs("div",{className:"card",children:[g.jsx("h3",{children:" Kelas Saya"}),g.jsx("p",{children:"Akses kelas yang Anda ikuti dan pantau progres pembelajaran"}),g.jsxs("div",{className:"course-progress",children:[g.jsx("div",{className:"progress-bar",children:g.jsx("div",{className:"progress-fill",style:{width:`${A.progressPercent}%`}})}),g.jsxs("span",{children:[A.progressPercent,"% Selesai"]})]}),g.jsx("button",{className:"btn-primary",onClick:()=>{window.location.hash="#/belajar"},children:"Lanjutkan Belajar"})]}),g.jsxs("div",{className:"card",children:[g.jsx("h3",{children:" Kuis"}),g.jsx("p",{children:"Uji pengetahuan Anda dengan kuis interaktif"}),g.jsxs("div",{className:"quiz-stats",children:[g.jsxs("div",{className:"stat",children:[g.jsx("strong",{children:A.completedQuizzes}),g.jsx("span",{children:"Selesai"})]}),g.jsxs("div",{className:"stat",children:[g.jsxs("strong",{children:[A.averageScore,"%"]}),g.jsx("span",{children:"Rata-rata Nilai"})]})]}),g.jsx("button",{className:"btn-secondary",onClick:()=>{window.location.hash="#/kuis"},children:"Ikuti Kuis"})]}),g.jsxs("div",{className:"card",children:[g.jsx("h3",{children:" Progres"}),g.jsx("p",{children:"Pantau perjalanan belajar Anda"}),g.jsxs("div",{className:"progress-stats",children:[A.moduleProgress.slice(0,3).map(U=>g.jsxs("div",{className:"progress-item",children:[g.jsx("span",{children:U.title}),g.jsx("div",{className:"progress-bar small",children:g.jsx("div",{className:"progress-fill",style:{width:`${U.percent}%`}})})]},U.moduleId)),A.moduleProgress.length===0&&g.jsx("div",{className:"empty-state",children:"Belum ada progres untuk ditampilkan"})]})]}),g.jsxs("div",{className:"card",children:[g.jsx("h3",{children:" Pencapaian"}),g.jsx("p",{children:"Milestone pembelajaran Anda"}),g.jsxs("div",{className:"achievements",children:[g.jsx("div",{className:`achievement ${A.completedQuizzes>=1?"earned":""}`,children:" Kuis Pertama Selesai"}),g.jsx("div",{className:`achievement ${A.averageScore>=90?"earned":""}`,children:" Rata-rata Nilai  90%"})]})]})]})]}),e&&g.jsxs("div",{className:"teacher-dashboard",children:[g.jsxs("div",{className:"dashboard-header-controls",children:[g.jsx("h1",{children:"Dashboard Guru"}),g.jsx("button",{onClick:v,className:"btn-refresh",disabled:f,children:" Refresh Data"}),l.length===0&&g.jsx("button",{onClick:I,className:"btn-sample-data",children:" Buat Data Contoh"})]}),m&&g.jsxs("div",{className:"error-message",children:["Error memuat dashboard: ",m]}),f?g.jsxs("div",{className:"loading-state",children:[g.jsx("div",{className:"loading-spinner"}),g.jsx("p",{children:"Memuat data dashboard..."})]}):g.jsxs("div",{className:"dashboard-grid",children:[g.jsxs("div",{className:"card",children:[g.jsx("h3",{children:" Siswa"}),g.jsx("p",{children:"Kelola dan pantau progres siswa"}),g.jsxs("div",{className:"student-count",children:[g.jsx("strong",{children:h.totalStudents})," Siswa Aktif"]}),g.jsxs("div",{className:"student-list",children:[o.slice(0,3).map(U=>g.jsxs("div",{className:"student-item",children:[" ",U.name]},U.id)),o.length>3&&g.jsxs("div",{className:"student-more",children:["+",o.length-3," siswa lainnya"]})]}),g.jsx("button",{className:"btn-primary",onClick:z,children:"Lihat Semua Siswa"})]}),g.jsxs("div",{className:"card",children:[g.jsx("h3",{children:" Konten Kelas"}),g.jsx("p",{children:"Buat dan kelola materi, bab, dan konten pembelajaran"}),g.jsxs("div",{className:"content-stats",children:[g.jsxs("div",{className:"stat",children:[g.jsx("strong",{children:l.length}),g.jsx("span",{children:"Bab"})]}),g.jsxs("div",{className:"stat",children:[g.jsx("strong",{children:u}),g.jsx("span",{children:"Materi"})]})]}),g.jsxs("div",{className:"module-list",children:[l.slice(0,2).map(U=>g.jsxs("div",{className:"module-item",children:[" ",U.title]},U.id)),l.length>2&&g.jsxs("div",{className:"module-more",children:["+",l.length-2," bab lainnya"]})]}),g.jsx("button",{className:"btn-primary",onClick:N,children:"Kelola Konten"})]}),g.jsxs("div",{className:"card",children:[g.jsx("h3",{children:" Kuis"}),g.jsx("p",{children:"Buat dan kelola kuis serta penilaian"}),g.jsxs("div",{className:"quiz-stats",children:[g.jsxs("div",{className:"stat",children:[g.jsx("strong",{children:h.totalQuizzes}),g.jsx("span",{children:"Total Kuis"})]}),g.jsxs("div",{className:"stat",children:[g.jsx("strong",{children:h.totalSubmissions}),g.jsx("span",{children:"Pengumpulan"})]})]}),g.jsxs("div",{className:"form-actions",style:{justifyContent:"flex-start",gap:"8px"},children:[g.jsx("button",{className:"btn-secondary",onClick:M,children:"Buat Kuis"}),g.jsx("button",{className:"btn-primary",onClick:j,children:"Kelola Kuis"})]})]}),g.jsxs("div",{className:"card",children:[g.jsx("h3",{children:" Analitik"}),g.jsx("p",{children:"Lihat analitik dan wawasan detail"}),g.jsxs("div",{className:"analytics-preview",children:[g.jsxs("div",{className:"metric",children:[g.jsx("span",{children:"Tingkat Penyelesaian"}),g.jsxs("strong",{children:[h.completionRate,"%"]})]}),g.jsxs("div",{className:"metric",children:[g.jsx("span",{children:"Rata-rata Nilai Kuis"}),g.jsxs("strong",{children:[h.avgScore,"%"]})]})]}),g.jsx("button",{className:"btn-secondary",onClick:F,children:"Lihat Analitik"})]})]})]})]})}),S&&g.jsx(aO,{onClose:()=>E(!1)}),T&&g.jsx(oO,{onClose:()=>C(!1)}),L&&g.jsx(lO,{onClose:()=>k(!1)}),V&&g.jsx(cO,{onClose:()=>P(!1)})]}):g.jsx("div",{className:"dashboard-loading",children:g.jsx("p",{children:"Memuat data pengguna..."})})},hO=()=>{const{user:i}=Ar(),[t,e]=B.useState(!0),[n,s]=B.useState(null),[o,l]=B.useState([]),[u,h]=B.useState([]),[f,m]=B.useState([]),[v,b]=B.useState(new Set),[A,S]=B.useState(null);B.useEffect(()=>{(async()=>{if(i){e(!0),s(null);try{const k=(await gt.getModules()).filter(N=>N.visible??!0),V=[];for(const N of k){const[M,j]=await Promise.all([gt.getLessons(N.id),gt.getQuizzes(N.id)]),F=M.filter(z=>z.visible??!0);V.push({module:N,lessons:F,quizzes:j})}l(V);const[P,G,I]=await Promise.all([gt.getAnswersByUser(i.uid),gt.getLessonReadsByUser(i.uid),gt.getRetakeGrantsByUser(i.uid)]);h(P),m(G),b(new Set((I||[]).filter(N=>(N.allowed??0)>0).map(N=>N.quizId)))}catch(L){s(L?.message||"Gagal memuat data belajar")}finally{e(!1)}}})()},[i]);const E=B.useMemo(()=>new Set(u.map(C=>C.quizId)),[u]),T=B.useMemo(()=>new Set(f.map(C=>`${C.moduleId}:${C.lessonId}`)),[f]);return i?g.jsxs("div",{className:"dashboard-main",children:[g.jsxs("div",{className:"container",children:[g.jsx("h1",{style:{marginTop:0},children:"Belajar"}),g.jsx("div",{style:{marginTop:8,marginBottom:16},children:g.jsx(ts,{className:"btn-secondary",to:"/dashboard",style:{display:"inline-block",width:"auto"},children:" Kembali ke Dashboard"})}),n&&g.jsx("div",{className:"error-message",children:n}),t?g.jsxs("div",{className:"loading-state",children:[g.jsx("div",{className:"loading-spinner"}),g.jsx("p",{children:"Memuat konten belajar..."})]}):g.jsx("div",{className:"content-grid",style:{gridTemplateColumns:"1fr"},children:o.map(C=>{const L=C.quizzes.filter(G=>E.has(G.id)).length,k=C.lessons.filter(G=>T.has(`${C.module.id}:${G.id}`)).length,V=C.lessons.length>0?Math.round(k/C.lessons.length*100):0,P=C.quizzes.length>0?Math.round(L/C.quizzes.length*100):0;return g.jsxs("div",{className:"content-card",children:[g.jsxs("div",{className:"card-header",children:[g.jsx("div",{className:"module-order",children:"BAB"}),g.jsx("div",{className:"card-actions"})]}),g.jsxs("div",{className:"card-content",children:[g.jsx("h4",{children:C.module.title}),C.module.description&&g.jsx("p",{children:C.module.description}),g.jsxs("div",{className:"card-meta",children:[g.jsxs("span",{children:[C.lessons.length," materi"]}),g.jsxs("span",{children:[C.quizzes.length," kuis"]}),g.jsxs("span",{children:[L,"/",C.quizzes.length," kuis selesai"]})]}),g.jsxs("div",{className:"course-progress",style:{marginTop:12},children:[g.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:6},children:[g.jsx("span",{style:{color:"#374151",fontWeight:600,fontSize:13},children:"Progress Materi"}),g.jsxs("span",{style:{color:"#64748b",fontSize:12},children:[k,"/",C.lessons.length]})]}),g.jsx("div",{className:"progress-bar small",children:g.jsx("div",{className:"progress-fill",style:{width:`${V}%`}})})]}),g.jsxs("div",{className:"course-progress",style:{marginTop:6},children:[g.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:6},children:[g.jsx("span",{style:{color:"#374151",fontWeight:600,fontSize:13},children:"Progress Kuis"}),g.jsxs("span",{style:{color:"#64748b",fontSize:12},children:[L,"/",C.quizzes.length]})]}),g.jsx("div",{className:"progress-bar small",children:g.jsx("div",{className:"progress-fill",style:{width:`${P}%`}})})]}),g.jsxs("div",{style:{marginTop:12},children:[g.jsx("h5",{style:{margin:"8px 0"},children:"Materi"}),C.lessons.length===0?g.jsx("div",{className:"empty-state",children:"Belum ada materi"}):g.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:C.lessons.map(G=>{const I=T.has(`${C.module.id}:${G.id}`);return g.jsxs(ts,{to:`/belajar/m/${C.module.id}/lesson/${G.id}`,className:"btn-action secondary",style:{textAlign:"left"},children:[g.jsx("i",{children:""}),g.jsx("span",{style:{flex:1},children:G.title}),I&&g.jsx("span",{style:{color:"#059669",fontWeight:700},children:""})]},G.id)})})]}),g.jsxs("div",{style:{marginTop:12},children:[g.jsx("h5",{style:{margin:"8px 0"},children:"Kuis"}),C.quizzes.length===0?g.jsx("div",{className:"empty-state",children:"Belum ada kuis"}):g.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:C.quizzes.map(G=>{const I=G.lessonId?C.lessons.find(z=>z.id===G.lessonId):void 0,N=E.has(G.id),M=v.has(G.id),j=(!G.lessonId||T.has(`${C.module.id}:${G.lessonId}`))&&(!N||M),F=N&&!M?" Selesai":N&&M?"(Akses ulang tersedia)":"";return g.jsxs("button",{type:"button",className:"btn-action primary",onClick:()=>j&&S(G.id),disabled:!j,title:j?"Mulai kuis":"Baca materi terlebih dahulu",style:{opacity:j?1:.6,cursor:j?"pointer":"not-allowed",textAlign:"left"},children:[g.jsx("i",{children:""}),g.jsx("span",{style:{flex:1},children:G.title}),F&&g.jsx("span",{style:{color:N?"#059669":"#0ea5e9",fontWeight:700},children:F}),I&&g.jsxs("span",{style:{marginLeft:8,color:"#64748b",fontStyle:"italic"},children:["(Materi: ",I.title,")"]}),!j&&I&&g.jsxs("span",{style:{marginLeft:8,color:"#ef4444"},children:[' Baca "',I.title,'" dulu']})]},G.id)})})]})]})]},C.module.id)})})]}),A&&g.jsx("div",{className:"modal-overlay",role:"dialog","aria-modal":"true",children:g.jsxs("div",{className:"modal-container",style:{maxWidth:520},children:[g.jsxs("div",{className:"modal-header",children:[g.jsx("h2",{children:"Konfirmasi Mulai Kuis"}),g.jsx("button",{className:"close-btn",onClick:()=>S(null),"aria-label":"Tutup",children:""})]}),g.jsx("div",{className:"modal-content",children:(()=>{const C=o.find(V=>V.quizzes.some(P=>P.id===A)),L=C?.quizzes.find(V=>V.id===A),k=L?.lessonId?C?.lessons.find(V=>V.id===L.lessonId):void 0;return g.jsxs(g.Fragment,{children:[g.jsxs("p",{children:["Anda akan mengerjakan kuis: ",g.jsx("strong",{children:L?.title})]}),k&&g.jsxs("p",{children:["Kuis ini terkait materi: ",g.jsx("em",{children:k.title})]}),L?.timeLimitSec&&g.jsxs("p",{children:["Batas waktu: ",Math.round(L.timeLimitSec/60)," menit"]})]})})()}),g.jsxs("div",{className:"form-actions",children:[g.jsx("button",{className:"btn-secondary",onClick:()=>S(null),children:"Tidak"}),g.jsx("button",{className:"btn-primary",onClick:()=>{const C=A;S(null),window.location.hash=`#/kuis/${C}`},children:"Siap, Lanjut"})]})]})})]}):null},dO=()=>{const{user:i}=Ar(),[t,e]=B.useState(!0),[n,s]=B.useState(null),[o,l]=B.useState([]),[u,h]=B.useState([]),[f,m]=B.useState({}),[v,b]=B.useState([]),[A,S]=B.useState([]),[E,T]=B.useState(new Set),[C,L]=B.useState(null);B.useEffect(()=>{(async()=>{if(i){e(!0),s(null);try{const I=(await gt.getModules()).filter(U=>U.visible??!0);h(I);const N={};for(const U of I)N[U.id]=await gt.getLessons(U.id);m(N);const[M,j,F,z]=await Promise.all([gt.getQuizzes(),gt.getAnswersByUser(i.uid),gt.getLessonReadsByUser(i.uid),gt.getRetakeGrantsByUser(i.uid)]);l(M),b(j),S(F),T(new Set((z||[]).filter(U=>(U.allowed??0)>0).map(U=>U.quizId)))}catch(G){s(G?.message||"Gagal memuat daftar kuis")}finally{e(!1)}}})()},[i]);const k=B.useMemo(()=>new Set(v.map(P=>P.quizId)),[v]),V=B.useMemo(()=>new Set(A.map(P=>`${P.moduleId}:${P.lessonId}`)),[A]);return i?g.jsxs("div",{className:"dashboard-main",children:[g.jsxs("div",{className:"container",children:[g.jsx("h1",{style:{marginTop:0},children:"Kuis"}),g.jsx("div",{style:{marginTop:8,marginBottom:16},children:g.jsx(ts,{className:"btn-secondary",to:"/dashboard",style:{display:"inline-block",width:"auto"},children:" Kembali ke Dashboard"})}),n&&g.jsx("div",{className:"error-message",children:n}),t?g.jsxs("div",{className:"loading-state",children:[g.jsx("div",{className:"loading-spinner"}),g.jsx("p",{children:"Memuat kuis..."})]}):g.jsx("div",{className:"content-grid",style:{gridTemplateColumns:"1fr"},children:o.length===0?g.jsx("div",{className:"empty-state",children:"Belum ada kuis tersedia."}):o.map(P=>{const G=u.find(z=>z.id===P.moduleId)?.title||"Umum",I=P.lessonId&&P.moduleId?f[P.moduleId]?.find(z=>z.id===P.lessonId):void 0,N=k.has(P.id),M=E.has(P.id),j=(!P.lessonId||P.moduleId&&V.has(`${P.moduleId}:${P.lessonId}`))&&(!N||M),F=N&&!M?" Selesai":N&&M?"(Akses ulang tersedia)":"";return g.jsxs("div",{className:"content-card",children:[g.jsxs("div",{className:"card-header",children:[g.jsx("div",{className:"lesson-order",children:"KUIS"}),g.jsx("div",{className:"card-actions"})]}),g.jsxs("div",{className:"card-content",children:[g.jsx("h4",{children:P.title}),g.jsxs("p",{style:{marginBottom:8},children:["Bab: ",g.jsx("strong",{children:G})]}),P.timeLimitSec&&g.jsxs("p",{style:{color:"#64748b"},children:["Batas waktu: ",Math.round(P.timeLimitSec/60)," menit"]}),I&&g.jsxs("p",{style:{marginTop:4,fontStyle:"italic",color:"#64748b"},children:["Materi terkait: ",I.title]}),!j&&I&&g.jsxs("p",{style:{color:"#ef4444"},children:['Baca materi "',I.title,'" terlebih dahulu agar bisa mulai.']}),g.jsxs("div",{className:"form-actions",style:{justifyContent:"space-between"},children:[g.jsx("button",{className:"btn-action primary",onClick:()=>j&&L(P.id),disabled:!j,style:{opacity:j?1:.6,cursor:j?"pointer":"not-allowed"},children:" Mulai Kuis"}),g.jsx("span",{style:{alignSelf:"center",color:N?"#059669":"#94a3b8",fontWeight:600},children:F})]})]})]},P.id)})})]}),C&&g.jsx("div",{className:"modal-overlay",role:"dialog","aria-modal":"true",children:g.jsxs("div",{className:"modal-container",style:{maxWidth:520},children:[g.jsxs("div",{className:"modal-header",children:[g.jsx("h2",{children:"Konfirmasi Mulai Kuis"}),g.jsx("button",{className:"close-btn",onClick:()=>L(null),"aria-label":"Tutup",children:""})]}),g.jsx("div",{className:"modal-content",children:(()=>{const P=o.find(N=>N.id===C),G=u.find(N=>N.id===P?.moduleId)?.title||"Umum",I=P?.lessonId&&P?.moduleId?f[P.moduleId]?.find(N=>N.id===P.lessonId):void 0;return g.jsxs(g.Fragment,{children:[g.jsxs("p",{children:["Anda akan mengerjakan kuis: ",g.jsx("strong",{children:P?.title})]}),g.jsxs("p",{children:["Bab: ",g.jsx("strong",{children:G})]}),I&&g.jsxs("p",{children:["Kuis ini terkait materi: ",g.jsx("em",{children:I.title})]}),P?.timeLimitSec&&g.jsxs("p",{children:["Batas waktu: ",Math.round(P.timeLimitSec/60)," menit"]})]})})()}),g.jsxs("div",{className:"form-actions",children:[g.jsx("button",{className:"btn-secondary",onClick:()=>L(null),children:"Tidak"}),g.jsx("button",{className:"btn-primary",onClick:()=>{const P=C;L(null),window.location.hash=`#/kuis/${P}`},children:"Siap, Lanjut"})]})]})})]}):null},Fn=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Dy=[.001,0,0,.001,0,0],Xg=1.35,ds={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},na={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Lx="pdfjs_internal_editor_",Vt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101,COMMENT:102},Xt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},fO={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Nn={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},yf={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Ye={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Cl={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},vp={ERRORS:0,WARNINGS:1,INFOS:5},zf={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Xd={moveTo:0,lineTo:1,curveTo:2,closePath:3},pO={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let _p=vp.WARNINGS;function mO(i){Number.isInteger(i)&&(_p=i)}function gO(){return _p}function bp(i){_p>=vp.INFOS&&console.log(`Info: ${i}`)}function Ut(i){_p>=vp.WARNINGS&&console.log(`Warning: ${i}`)}function ye(i){throw new Error(i)}function Ze(i,t){i||ye(t)}function yO(i){switch(i?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Ox(i,t=null,e=null){if(!i)return null;if(e&&typeof i=="string"&&(e.addDefaultProtocol&&i.startsWith("www.")&&i.match(/\./g)?.length>=2&&(i=`http://${i}`),e.tryConvertEncoding))try{i=wO(i)}catch{}const n=t?URL.parse(i,t):URL.parse(i);return yO(n)?n:null}function jx(i,t,e=!1){const n=URL.parse(i);return n?(n.hash=t,n.href):e&&Ox(i,"http://example.com")?i.split("#",1)[0]+`${t?`#${t}`:""}`:""}function Gt(i,t,e,n=!1){return Object.defineProperty(i,t,{value:e,enumerable:!n,configurable:!0,writable:!1}),e}const Ro=(function(){function t(e,n){this.message=e,this.name=n}return t.prototype=new Error,t.constructor=t,t})();class _0 extends Ro{constructor(t,e){super(t,"PasswordException"),this.code=e}}class Qg extends Ro{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class Py extends Ro{constructor(t){super(t,"InvalidPDFException")}}class Hf extends Ro{constructor(t,e,n){super(t,"ResponseException"),this.status=e,this.missing=n}}class vO extends Ro{constructor(t){super(t,"FormatError")}}class ga extends Ro{constructor(t){super(t,"AbortException")}}function Vx(i){(typeof i!="object"||i?.length===void 0)&&ye("Invalid argument for bytesToString");const t=i.length,e=8192;if(t<e)return String.fromCharCode.apply(null,i);const n=[];for(let s=0;s<t;s+=e){const o=Math.min(s+e,t),l=i.subarray(s,o);n.push(String.fromCharCode.apply(null,l))}return n.join("")}function fh(i){typeof i!="string"&&ye("Invalid argument for stringToBytes");const t=i.length,e=new Uint8Array(t);for(let n=0;n<t;++n)e[n]=i.charCodeAt(n)&255;return e}function _O(i){return String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255)}function bO(){const i=new Uint8Array(4);return i[0]=1,new Uint32Array(i.buffer,0,1)[0]===1}function AO(){try{return new Function(""),!0}catch{return!1}}class Tn{static get isLittleEndian(){return Gt(this,"isLittleEndian",bO())}static get isEvalSupported(){return Gt(this,"isEvalSupported",AO())}static get isOffscreenCanvasSupported(){return Gt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Gt(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return Gt(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return Gt(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Jg=Array.from(Array(256).keys(),i=>i.toString(16).padStart(2,"0"));class Tt{static makeHexColor(t,e,n){return`#${Jg[t]}${Jg[e]}${Jg[n]}`}static scaleMinMax(t,e){let n;t[0]?(t[0]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[3],e[3]*=t[3]):(n=e[0],e[0]=e[1],e[1]=n,n=e[2],e[2]=e[3],e[3]=n,t[1]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e,n=0){const s=t[n],o=t[n+1];t[n]=s*e[0]+o*e[2]+e[4],t[n+1]=s*e[1]+o*e[3]+e[5]}static applyTransformToBezier(t,e,n=0){const s=e[0],o=e[1],l=e[2],u=e[3],h=e[4],f=e[5];for(let m=0;m<6;m+=2){const v=t[n+m],b=t[n+m+1];t[n+m]=v*s+b*l+h,t[n+m+1]=v*o+b*u+f}}static applyInverseTransform(t,e){const n=t[0],s=t[1],o=e[0]*e[3]-e[1]*e[2];t[0]=(n*e[3]-s*e[2]+e[2]*e[5]-e[4]*e[3])/o,t[1]=(-n*e[1]+s*e[0]+e[4]*e[1]-e[5]*e[0])/o}static axialAlignedBoundingBox(t,e,n){const s=e[0],o=e[1],l=e[2],u=e[3],h=e[4],f=e[5],m=t[0],v=t[1],b=t[2],A=t[3];let S=s*m+h,E=S,T=s*b+h,C=T,L=u*v+f,k=L,V=u*A+f,P=V;if(o!==0||l!==0){const G=o*m,I=o*b,N=l*v,M=l*A;S+=N,C+=N,T+=M,E+=M,L+=G,P+=G,V+=I,k+=I}n[0]=Math.min(n[0],S,T,E,C),n[1]=Math.min(n[1],L,V,k,P),n[2]=Math.max(n[2],S,T,E,C),n[3]=Math.max(n[3],L,V,k,P)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const n=t[0],s=t[1],o=t[2],l=t[3],u=n**2+s**2,h=n*o+s*l,f=o**2+l**2,m=(u+f)/2,v=Math.sqrt(m**2-(u*f-h**2));e[0]=Math.sqrt(m+v||1),e[1]=Math.sqrt(m-v||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const n=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),s=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(n>s)return null;const o=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),l=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return o>l?null:[n,o,s,l]}static pointBoundingBox(t,e,n){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}static rectBoundingBox(t,e,n,s,o){o[0]=Math.min(o[0],t,n),o[1]=Math.min(o[1],e,s),o[2]=Math.max(o[2],t,n),o[3]=Math.max(o[3],e,s)}static#t(t,e,n,s,o,l,u,h,f,m){if(f<=0||f>=1)return;const v=1-f,b=f*f,A=b*f,S=v*(v*(v*t+3*f*e)+3*b*n)+A*s,E=v*(v*(v*o+3*f*l)+3*b*u)+A*h;m[0]=Math.min(m[0],S),m[1]=Math.min(m[1],E),m[2]=Math.max(m[2],S),m[3]=Math.max(m[3],E)}static#e(t,e,n,s,o,l,u,h,f,m,v,b){if(Math.abs(f)<1e-12){Math.abs(m)>=1e-12&&this.#t(t,e,n,s,o,l,u,h,-v/m,b);return}const A=m**2-4*v*f;if(A<0)return;const S=Math.sqrt(A),E=2*f;this.#t(t,e,n,s,o,l,u,h,(-m+S)/E,b),this.#t(t,e,n,s,o,l,u,h,(-m-S)/E,b)}static bezierBoundingBox(t,e,n,s,o,l,u,h,f){f[0]=Math.min(f[0],t,u),f[1]=Math.min(f[1],e,h),f[2]=Math.max(f[2],t,u),f[3]=Math.max(f[3],e,h),this.#e(t,n,o,u,e,s,l,h,3*(-t+3*(n-o)+u),6*(t-2*n+o),3*(n-t),f),this.#e(t,n,o,u,e,s,l,h,3*(-e+3*(s-l)+h),6*(e-2*s+l),3*(s-e),f)}}function wO(i){return decodeURIComponent(escape(i))}let Zg=null,b0=null;function EO(i){return Zg||(Zg=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,b0=new Map([["","t"]])),i.replaceAll(Zg,(t,e,n)=>e?e.normalize("NFKC"):b0.get(n))}function Ux(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const i=new Uint8Array(32);return crypto.getRandomValues(i),Vx(i)}const Wv="pdfjs_internal_id_";function SO(i,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[n,s,...o]=e;if(!i(n)&&!Number.isInteger(n)||!t(s))return!1;const l=o.length;let u=!0;switch(s.name){case"XYZ":if(l<2||l>3)return!1;break;case"Fit":case"FitB":return l===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(l>1)return!1;break;case"FitR":if(l!==4)return!1;u=!1;break;default:return!1}for(const h of o)if(!(typeof h=="number"||u&&h===null))return!1;return!0}function Bn(i,t,e){return Math.min(Math.max(i,t),e)}function Fx(i){return Uint8Array.prototype.toBase64?i.toBase64():btoa(Vx(i))}function TO(i){return Uint8Array.fromBase64?Uint8Array.fromBase64(i):fh(atob(i))}typeof Promise.try!="function"&&(Promise.try=function(i,...t){return new Promise(e=>{e(i(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(i){return i.reduce((t,e)=>t+e,0)});const rr="http://www.w3.org/2000/svg";class Kl{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function ph(i,t="text"){if(Su(i,document.baseURI)){const e=await fetch(i);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,n)=>{const s=new XMLHttpRequest;s.open("GET",i,!0),s.responseType=t,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(s.response);return}e(s.responseText);return}n(new Error(s.statusText))}},s.send(null)})}class mh{constructor({viewBox:t,userUnit:e,scale:n,rotation:s,offsetX:o=0,offsetY:l=0,dontFlip:u=!1}){this.viewBox=t,this.userUnit=e,this.scale=n,this.rotation=s,this.offsetX=o,this.offsetY=l,n*=e;const h=(t[2]+t[0])/2,f=(t[3]+t[1])/2;let m,v,b,A;switch(s%=360,s<0&&(s+=360),s){case 180:m=-1,v=0,b=0,A=1;break;case 90:m=0,v=1,b=1,A=0;break;case 270:m=0,v=-1,b=-1,A=0;break;case 0:m=1,v=0,b=0,A=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}u&&(b=-b,A=-A);let S,E,T,C;m===0?(S=Math.abs(f-t[1])*n+o,E=Math.abs(h-t[0])*n+l,T=(t[3]-t[1])*n,C=(t[2]-t[0])*n):(S=Math.abs(h-t[0])*n+o,E=Math.abs(f-t[1])*n+l,T=(t[2]-t[0])*n,C=(t[3]-t[1])*n),this.transform=[m*n,v*n,b*n,A*n,S-m*n*h-b*n*f,E-v*n*h-A*n*f],this.width=T,this.height=C}get rawDims(){const t=this.viewBox;return Gt(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:n=this.offsetX,offsetY:s=this.offsetY,dontFlip:o=!1}={}){return new mh({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:s,dontFlip:o})}convertToViewportPoint(t,e){const n=[t,e];return Tt.applyTransform(n,this.transform),n}convertToViewportRectangle(t){const e=[t[0],t[1]];Tt.applyTransform(e,this.transform);const n=[t[2],t[3]];return Tt.applyTransform(n,this.transform),[e[0],e[1],n[0],n[1]]}convertToPdfPoint(t,e){const n=[t,e];return Tt.applyInverseTransform(n,this.transform),n}}class Yv extends Ro{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function Ap(i){const t=i.length;let e=0;for(;e<t&&i[e].trim()==="";)e++;return i.substring(e,e+5).toLowerCase()==="data:"}function Xv(i){return typeof i=="string"&&/\.pdf$/i.test(i)}function xO(i){return[i]=i.split(/[#?]/,1),i.substring(i.lastIndexOf("/")+1)}function CO(i,t="document.pdf"){if(typeof i!="string")return t;if(Ap(i))return Ut('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const n=(u=>{try{return new URL(u)}catch{try{return new URL(decodeURIComponent(u))}catch{try{return new URL(u,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(u),"https://foo.bar")}catch{return null}}}}})(i);if(!n)return t;const s=u=>{try{let h=decodeURIComponent(u);return h.includes("/")?(h=h.split("/").at(-1),h.test(/^\.pdf$/i)?h:u):h}catch{return u}},o=/\.pdf$/i,l=n.pathname.split("/").at(-1);if(o.test(l))return s(l);if(n.searchParams.size>0){const u=Array.from(n.searchParams.values()).reverse();for(const f of u)if(o.test(f))return s(f);const h=Array.from(n.searchParams.keys()).reverse();for(const f of h)if(o.test(f))return s(f)}if(n.hash){const h=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(h)return s(h[0])}return t}class A0{started=Object.create(null);times=[];time(t){t in this.started&&Ut(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||Ut(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:n}of this.times)e=Math.max(n.length,e);for(const{name:n,start:s,end:o}of this.times)t.push(`${n.padEnd(e)} ${o-s}ms
`);return t.join("")}}function Su(i,t){const e=t?URL.parse(i,t):URL.parse(i);return e?.protocol==="http:"||e?.protocol==="https:"}function js(i){i.preventDefault()}function Qe(i){i.preventDefault(),i.stopPropagation()}function RO(i){console.log("Deprecated API usage: "+i)}class Ly{static#t;static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const n=parseInt(e[1],10);let s=parseInt(e[2],10);s=s>=1&&s<=12?s-1:0;let o=parseInt(e[3],10);o=o>=1&&o<=31?o:1;let l=parseInt(e[4],10);l=l>=0&&l<=23?l:0;let u=parseInt(e[5],10);u=u>=0&&u<=59?u:0;let h=parseInt(e[6],10);h=h>=0&&h<=59?h:0;const f=e[7]||"Z";let m=parseInt(e[8],10);m=m>=0&&m<=23?m:0;let v=parseInt(e[9],10)||0;return v=v>=0&&v<=59?v:0,f==="-"?(l+=m,u+=v):f==="+"&&(l-=m,u-=v),new Date(Date.UTC(n,s,o,l,u,h))}}function IO(i,{scale:t=1,rotation:e=0}){const{width:n,height:s}=i.attributes.style,o=[0,0,parseInt(n),parseInt(s)];return new mh({viewBox:o,userUnit:1,scale:t,rotation:e})}function wp(i){if(i.startsWith("#")){const t=parseInt(i.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return i.startsWith("rgb(")?i.slice(4,-1).split(",").map(t=>parseInt(t)):i.startsWith("rgba(")?i.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(Ut(`Not a valid color format: "${i}"`),[0,0,0])}function NO(i){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of i.keys()){t.style.color=e;const n=window.getComputedStyle(t).color;i.set(e,wp(n))}t.remove()}function Ie(i){const{a:t,b:e,c:n,d:s,e:o,f:l}=i.getTransform();return[t,e,n,s,o,l]}function _i(i){const{a:t,b:e,c:n,d:s,e:o,f:l}=i.getTransform().invertSelf();return[t,e,n,s,o,l]}function Ao(i,t,e=!1,n=!0){if(t instanceof mh){const{pageWidth:s,pageHeight:o}=t.rawDims,{style:l}=i,u=Tn.isCSSRoundSupported,h=`var(--total-scale-factor) * ${s}px`,f=`var(--total-scale-factor) * ${o}px`,m=u?`round(down, ${h}, var(--scale-round-x))`:`calc(${h})`,v=u?`round(down, ${f}, var(--scale-round-y))`:`calc(${f})`;!e||t.rotation%180===0?(l.width=m,l.height=v):(l.width=v,l.height=m)}n&&i.setAttribute("data-main-rotation",t.rotation)}class ki{constructor(){const{pixelRatio:t}=ki;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,n,s,o=-1){let l=1/0,u=1/0,h=1/0;n=ki.capPixels(n,o),n>0&&(l=Math.sqrt(n/(t*e))),s!==-1&&(u=s/t,h=s/e);const f=Math.min(l,u,h);return this.sx>f||this.sy>f?(this.sx=f,this.sy=f,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,n):n}return t}}const Oy=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class Pu{#t=null;#e=null;#n;#s=null;#r=null;#i=null;#a=null;static#o=null;constructor(t){this.#n=t,Pu.#o||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#n._uiManager._signal;t.addEventListener("contextmenu",js,{signal:e}),t.addEventListener("pointerdown",Pu.#u,{signal:e});const n=this.#s=document.createElement("div");n.className="buttons",t.append(n);const s=this.#n.toolbarPosition;if(s){const{style:o}=t,l=this.#n._uiManager.direction==="ltr"?1-s[0]:s[0];o.insetInlineEnd=`${100*l}%`,o.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#t}static#u(t){t.stopPropagation()}#c(t){this.#n._focusEventsAllowed=!1,Qe(t)}#d(t){this.#n._focusEventsAllowed=!0,Qe(t)}#l(t){const e=this.#n._uiManager._signal;t.addEventListener("focusin",this.#c.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",js,{signal:e})}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#r?.shown(),this.#i?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#n,n=document.createElement("button");n.className="delete",n.tabIndex=0,n.setAttribute("data-l10n-id",Pu.#o[t]),this.#l(n),n.addEventListener("click",s=>{e.delete()},{signal:e._signal}),this.#s.append(n)}get#p(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#l(e),this.#s.append(e,this.#p),this.#r=t}addComment(t){if(this.#i)return;const e=t.render();e&&(this.#l(e),this.#s.prepend(e,this.#p),this.#i=t,t.toolbar=this)}addColorPicker(t){if(this.#e)return;this.#e=t;const e=t.renderButton();this.#l(e),this.#s.append(e,this.#p)}async addEditSignatureButton(t){const e=this.#a=await t.renderEditButton(this.#n);this.#l(e),this.#s.append(e,this.#p)}async addButton(t,e){switch(t){case"colorPicker":this.addColorPicker(e);break;case"altText":await this.addAltText(e);break;case"editSignature":await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(e);break}}updateEditSignatureButton(t){this.#a&&(this.#a.title=t)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class kO{#t=null;#e=null;#n;constructor(t){this.#n=t}#s(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",js,{signal:this.#n._signal});const e=this.#t=document.createElement("div");return e.className="buttons",t.append(e),this.#i(),t}#r(t,e){let n=0,s=0;for(const o of t){const l=o.y+o.height;if(l<n)continue;const u=o.x+(e?o.width:0);if(l>n){s=u,n=l;continue}e?u>s&&(s=u):u<s&&(s=u)}return[e?1-s:s,n]}show(t,e,n){const[s,o]=this.#r(e,n),{style:l}=this.#e||=this.#s();t.append(this.#e),l.insetInlineEnd=`${100*s}%`,l.top=`calc(${100*o}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#i(){const t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const e=document.createElement("span");t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const n=this.#n._signal;t.addEventListener("contextmenu",js,{signal:n}),t.addEventListener("click",()=>{this.#n.highlightSelection("floating_button")},{signal:n}),this.#t.append(t)}}function Bx(i,t,e){for(const n of e)t.addEventListener(n,i[n].bind(i))}class MO{#t=0;get id(){return`${Lx}${this.#t++}`}}class Qv{#t=Ux();#e=0;#n=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=t;const o=s.decode().then(()=>(n.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return Gt(this,"_isSVGFittingCanvas",o)}async#s(t,e){this.#n||=new Map;let n=this.#n.get(t);if(n===null)return null;if(n?.bitmap)return n.refCounter+=1,n;try{n||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let s;if(typeof e=="string"?(n.url=e,s=await ph(e,"blob")):e instanceof File?s=n.file=e:e instanceof Blob&&(s=e),s.type==="image/svg+xml"){const o=Qv._isSVGFittingCanvas,l=new FileReader,u=new Image,h=new Promise((f,m)=>{u.onload=()=>{n.bitmap=u,n.isSvg=!0,f()},l.onload=async()=>{const v=n.svgUrl=l.result;u.src=await o?`${v}#svgView(preserveAspectRatio(none))`:v},u.onerror=l.onerror=m});l.readAsDataURL(s),await h}else n.bitmap=await createImageBitmap(s);n.refCounter=1}catch(s){Ut(s),n=null}return this.#n.set(t,n),n&&this.#n.set(n.id,n),n}async getFromFile(t){const{lastModified:e,name:n,size:s,type:o}=t;return this.#s(`${e}_${n}_${s}_${o}`,t)}async getFromUrl(t){return this.#s(t,t)}async getFromBlob(t,e){const n=await e;return this.#s(t,n)}async getFromId(t){this.#n||=new Map;const e=this.#n.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:n}=e;return delete e.blobPromise,this.getFromBlob(e.id,n)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#n||=new Map;let n=this.#n.get(t);if(n?.bitmap)return n.refCounter+=1,n;const s=new OffscreenCanvas(e.width,e.height);return s.getContext("2d").drawImage(e,0,0),n={bitmap:s.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#n.set(t,n),this.#n.set(n.id,n),n}getSvgUrl(t){const e=this.#n.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#n||=new Map;const e=this.#n.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:n}=e;if(!e.url&&!e.file){const s=new OffscreenCanvas(n.width,n.height);s.getContext("bitmaprenderer").transferFromImageBitmap(n),e.blobPromise=s.convertToBlob()}n.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class DO{#t=[];#e=!1;#n;#s=-1;constructor(t=128){this.#n=t}add({cmd:t,undo:e,post:n,mustExec:s,type:o=NaN,overwriteIfSameType:l=!1,keepUndo:u=!1}){if(s&&t(),this.#e)return;const h={cmd:t,undo:e,post:n,type:o};if(this.#s===-1){this.#t.length>0&&(this.#t.length=0),this.#s=0,this.#t.push(h);return}if(l&&this.#t[this.#s].type===o){u&&(h.undo=this.#t[this.#s].undo),this.#t[this.#s]=h;return}const f=this.#s+1;f===this.#n?this.#t.splice(0,1):(this.#s=f,f<this.#t.length&&this.#t.splice(f)),this.#t.push(h)}undo(){if(this.#s===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#s];t(),e?.(),this.#e=!1,this.#s-=1}redo(){if(this.#s<this.#t.length-1){this.#s+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#s];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#s!==-1}hasSomethingToRedo(){return this.#s<this.#t.length-1}cleanType(t){if(this.#s!==-1){for(let e=this.#s;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#s-e),this.#s=e;return}this.#t.length=0,this.#s=-1}}destroy(){this.#t=null}}class gh{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=Tn.platform;for(const[n,s,o={}]of t)for(const l of n){const u=l.startsWith("mac+");e&&u?(this.callbacks.set(l.slice(4),{callback:s,options:o}),this.allKeys.add(l.split("+").at(-1))):!e&&!u&&(this.callbacks.set(l,{callback:s,options:o}),this.allKeys.add(l.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const n=this.callbacks.get(this.#t(e));if(!n)return;const{callback:s,options:{bubbles:o=!1,args:l=[],checker:u=null}}=n;u&&!u(t,e)||(s.bind(t,...l,e)(),o||Qe(e))}}class Jv{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return NO(t),Gt(this,"_colors",t)}convert(t){const e=wp(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[n,s]of this._colors)if(s.every((o,l)=>o===e[l]))return Jv._colorsMapping.get(n);return e}getHexCode(t){const e=this._colors.get(t);return e?Tt.makeHexColor(...e):t}}class ya{#t=new AbortController;#e=null;#n=new Map;#s=new Map;#r=null;#i=null;#a=null;#o=new DO;#u=null;#c=null;#d=null;#l=0;#p=new Set;#g=null;#f=null;#h=new Set;_editorUndoBar=null;#m=!1;#_=!1;#y=!1;#A=null;#w=null;#v=null;#S=null;#I=!1;#E=null;#N=new MO;#R=!1;#C=!1;#x=null;#M=null;#j=null;#D=null;#B=null;#T=Vt.NONE;#b=new Set;#V=null;#U=null;#z=null;#q=null;#$={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#H=[0,0];#P=null;#L=null;#G=null;#X=null;#O=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=ya.prototype,e=l=>l.#L.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&l.hasSomethingToControl(),n=(l,{target:u})=>{if(u instanceof HTMLInputElement){const{type:h}=u;return h!=="text"&&h!=="number"}return!0},s=this.TRANSLATE_SMALL,o=this.TRANSLATE_BIG;return Gt(this,"_keyboardManager",new gh([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],t.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:n}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(l,{target:u})=>!(u instanceof HTMLButtonElement)&&l.#L.contains(u)&&!l.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(l,{target:u})=>!(u instanceof HTMLButtonElement)&&l.#L.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-o,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[o,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-o],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,o],checker:e}]]))}constructor(t,e,n,s,o,l,u,h,f,m,v,b,A,S,E,T){const C=this._signal=this.#t.signal;this.#L=t,this.#G=e,this.#X=n,this.#r=s,this.#u=o,this.#U=l,this._eventBus=u,u._on("editingaction",this.onEditingAction.bind(this),{signal:C}),u._on("pagechanging",this.onPageChanging.bind(this),{signal:C}),u._on("scalechanging",this.onScaleChanging.bind(this),{signal:C}),u._on("rotationchanging",this.onRotationChanging.bind(this),{signal:C}),u._on("setpreference",this.onSetPreference.bind(this),{signal:C}),u._on("switchannotationeditorparams",L=>this.updateParams(L.type,L.value),{signal:C}),this.#rt(),this.#ct(),this.#J(),this.#i=h.annotationStorage,this.#A=h.filterFactory,this.#z=f,this.#S=m||null,this.#m=v,this.#_=b,this.#y=A,this.#B=S||null,this.viewParameters={realScale:Kl.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=E||null,this._supportsPinchToZoom=T!==!1}destroy(){this.#O?.resolve(),this.#O=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#s.values())t.destroy();this.#s.clear(),this.#n.clear(),this.#h.clear(),this.#D?.clear(),this.#e=null,this.#b.clear(),this.#o.destroy(),this.#r?.destroy(),this.#u?.destroy(),this.#U?.destroy(),this.#E?.hide(),this.#E=null,this.#j?.destroy(),this.#j=null,this.#w&&(clearTimeout(this.#w),this.#w=null),this.#P&&(clearTimeout(this.#P),this.#P=null),this._editorUndoBar?.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#B}get useNewAltTextFlow(){return this.#_}get useNewAltTextWhenAddingImage(){return this.#y}get hcmFilter(){return Gt(this,"hcmFilter",this.#z?this.#A.addHCMFilter(this.#z.foreground,this.#z.background):"none")}get direction(){return Gt(this,"direction",getComputedStyle(this.#L).direction)}get _highlightColors(){return Gt(this,"_highlightColors",this.#S?new Map(this.#S.split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return Gt(this,"highlightColors",null);const e=new Map,n=!!this.#z;for(const[s,o]of t){const l=s.endsWith("_HCM");if(n&&l){e.set(s.replace("_HCM",""),o);continue}!n&&!l&&e.set(s,o)}return Gt(this,"highlightColors",e)}get highlightColorNames(){return Gt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#d=t}setMainHighlightColorPicker(t){this.#j=t}editAltText(t,e=!1){this.#r?.editAltText(this,t,e)}hasCommentManager(){return!!this.#u}editComment(t,e){this.#u?.open(this,t,e)}getSignature(t){this.#U?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#U}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":this.#y=e;break}}onPageChanging({pageNumber:t}){this.#l=t-1}focusMainContainer(){this.#L.focus()}findParent(t,e){for(const n of this.#s.values()){const{x:s,y:o,width:l,height:u}=n.div.getBoundingClientRect();if(t>=s&&t<=s+l&&e>=o&&e<=o+u)return n}return null}disableUserSelect(t=!1){this.#G.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#h.add(t)}removeShouldRescale(t){this.#h.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*Kl.PDF_TO_CSS_UNITS;for(const e of this.#h)e.onScaleChanging();this.#d?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#W({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#Q(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const n of this.#s.values())if(n.hasTextLayer(t))return n;return null}highlightSelection(t=""){const e=document.getSelection();if(!e||e.isCollapsed)return;const{anchorNode:n,anchorOffset:s,focusNode:o,focusOffset:l}=e,u=e.toString(),f=this.#W(e).closest(".textLayer"),m=this.getSelectionBoxes(f);if(!m)return;e.empty();const v=this.#Q(f),b=this.#T===Vt.NONE,A=()=>{v?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:m,anchorNode:n,anchorOffset:s,focusNode:o,focusOffset:l,text:u}),b&&this.showAllEditors("highlight",!0,!0)};if(b){this.switchToMode(Vt.HIGHLIGHT,A);return}A()}#st(){const t=document.getSelection();if(!t||t.isCollapsed)return;const n=this.#W(t).closest(".textLayer"),s=this.getSelectionBoxes(n);s&&(this.#E||=new kO(this),this.#E.show(n,s,this.direction==="ltr"))}addToAnnotationStorage(t){!t.isEmpty()&&this.#i&&!this.#i.has(t.id)&&this.#i.setValue(t.id,t)}a11yAlert(t,e=null){const n=this.#X;n&&(n.setAttribute("data-l10n-id",t),e?n.setAttribute("data-l10n-args",JSON.stringify(e)):n.removeAttribute("data-l10n-args"))}#it(){const t=document.getSelection();if(!t||t.isCollapsed){this.#V&&(this.#E?.hide(),this.#V=null,this.#k({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#V)return;const s=this.#W(t).closest(".textLayer");if(!s){this.#V&&(this.#E?.hide(),this.#V=null,this.#k({hasSelectedText:!1}));return}if(this.#E?.hide(),this.#V=e,this.#k({hasSelectedText:!0}),!(this.#T!==Vt.HIGHLIGHT&&this.#T!==Vt.NONE)&&(this.#T===Vt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#I=this.isShiftKeyDown,!this.isShiftKeyDown)){const o=this.#T===Vt.HIGHLIGHT?this.#Q(s):null;o?.toggleDrawing();const l=new AbortController,u=this.combinedSignal(l),h=f=>{f.type==="pointerup"&&f.button!==0||(l.abort(),o?.toggleDrawing(!0),f.type==="pointerup"&&this.#Y("main_toolbar"))};window.addEventListener("pointerup",h,{signal:u}),window.addEventListener("blur",h,{signal:u})}}#Y(t=""){this.#T===Vt.HIGHLIGHT?this.highlightSelection(t):this.#m&&this.#st()}#rt(){document.addEventListener("selectionchange",this.#it.bind(this),{signal:this._signal})}#at(){if(this.#v)return;this.#v=new AbortController;const t=this.combinedSignal(this.#v);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#ot(){this.#v?.abort(),this.#v=null}blur(){if(this.isShiftKeyDown=!1,this.#I&&(this.#I=!1,this.#Y("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#b)if(e.div.contains(t)){this.#M=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#M)return;const[t,e]=this.#M;this.#M=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#J(){if(this.#x)return;this.#x=new AbortController;const t=this.combinedSignal(this.#x);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#lt(){this.#x?.abort(),this.#x=null}#Z(){if(this.#c)return;this.#c=new AbortController;const t=this.combinedSignal(this.#c);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#tt(){this.#c?.abort(),this.#c=null}#ct(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#J(),this.#Z()}removeEditListeners(){this.#lt(),this.#tt()}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const n of this.#f)if(n.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const n of this.#f)if(n.isHandlingMimeForPasting(e.type)){n.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const n of this.#b){const s=n.serialize(!0);s&&e.push(s)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const o of e.items)for(const l of this.#f)if(l.isHandlingMimeForPasting(o.type)){l.paste(o,this.currentLayer);return}let n=e.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(o){Ut(`paste: "${o.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const s=this.currentLayer;try{const o=[];for(const h of n){const f=await s.deserialize(h);if(!f)return;o.push(f)}const l=()=>{for(const h of o)this.#et(h);this.#nt(o)},u=()=>{for(const h of o)h.remove()};this.addCommands({cmd:l,undo:u,mustExec:!0})}catch(o){Ut(`paste: "${o.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#T!==Vt.NONE&&!this.isEditorHandlingKeyboard&&ya._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#I&&(this.#I=!1,this.#Y("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#k(t){Object.entries(t).some(([n,s])=>this.#$[n]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#$,t)}),this.#T===Vt.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#F([[Xt.HIGHLIGHT_FREE,!0]]))}#F(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#at(),this.#Z(),this.#k({isEditing:this.#T!==Vt.NONE,isEmpty:this.#K(),hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:this.#o.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#ot(),this.#tt(),this.#k({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#f){this.#f=t;for(const e of this.#f)this.#F(e.defaultPropertiesToUpdate)}}getId(){return this.#N.id}get currentLayer(){return this.#s.get(this.#l)}getLayer(t){return this.#s.get(t)}get currentPageIndex(){return this.#l}addLayer(t){this.#s.set(t.pageIndex,t),this.#R?t.enable():t.disable()}removeLayer(t){this.#s.delete(t.pageIndex)}async updateMode(t,e=null,n=!1,s=!1,o=!1){if(this.#T!==t&&!(this.#O&&(await this.#O.promise,!this.#O))){if(this.#O=Promise.withResolvers(),this.#d?.commitOrRemove(),this.#T=t,t===Vt.NONE){this.setEditingState(!1),this.#ht(),this._editorUndoBar?.hide(),this.#O.resolve();return}t===Vt.SIGNATURE&&await this.#U?.loadSignatures(),this.setEditingState(!0),await this.#ut(),this.unselectAll();for(const l of this.#s.values())l.updateMode(t);if(!e){n&&this.addNewEditorFromKeyboard(),this.#O.resolve();return}for(const l of this.#n.values())l.annotationElementId===e||l.id===e?(this.setSelected(l),o?l.editComment():s&&l.enterInEditMode()):l.unselect();this.#O.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#T&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#f){switch(t){case Xt.CREATE:this.currentLayer.addNewEditor(e);return;case Xt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#q||=new Map).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const n of this.#b)n.updateParams(t,e);else for(const n of this.#f)n.updateDefaultParams(t,e)}}showAllEditors(t,e,n=!1){for(const o of this.#n.values())o.editorType===t&&o.show(e);(this.#q?.get(Xt.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#F([[Xt.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#C!==t){this.#C=t;for(const e of this.#s.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#ut(){if(!this.#R){this.#R=!0;const t=[];for(const e of this.#s.values())t.push(e.enable());await Promise.all(t);for(const e of this.#n.values())e.enable()}}#ht(){if(this.unselectAll(),this.#R){this.#R=!1;for(const t of this.#s.values())t.disable();for(const t of this.#n.values())t.disable()}}getEditors(t){const e=[];for(const n of this.#n.values())n.pageIndex===t&&e.push(n);return e}getEditor(t){return this.#n.get(t)}addEditor(t){this.#n.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#w&&clearTimeout(this.#w),this.#w=setTimeout(()=>{this.focusMainContainer(),this.#w=null},0)),this.#n.delete(t.id),t.annotationElementId&&this.#D?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#p.has(t.annotationElementId))&&this.#i?.remove(t.id)}addDeletedAnnotationElement(t){this.#p.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#p.has(t)}removeDeletedAnnotationElement(t){this.#p.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#et(t){const e=this.#s.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#F(t.propertiesToUpdate))}get#dt(){let t=null;for(t of this.#b);return t}updateUI(t){this.#dt===t&&this.#F(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#F(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#b.has(t)){this.#b.delete(t),t.unselect(),this.#k({hasSelectedEditor:this.hasSelection});return}this.#b.add(t),t.select(),this.#F(t.propertiesToUpdate),this.#k({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.id}),this.#d?.commitOrRemove();for(const e of this.#b)e!==t&&e.unselect();this.#b.clear(),this.#b.add(t),t.select(),this.#F(t.propertiesToUpdate),this.#k({hasSelectedEditor:!0})}isSelected(t){return this.#b.has(t)}get firstSelectedEditor(){return this.#b.values().next().value}unselect(t){t.unselect(),this.#b.delete(t),this.#k({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#b.size!==0}get isEnterHandled(){return this.#b.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#o.undo(),this.#k({hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#K()}),this._editorUndoBar?.hide()}redo(){this.#o.redo(),this.#k({hasSomethingToUndo:!0,hasSomethingToRedo:this.#o.hasSomethingToRedo(),isEmpty:this.#K()})}addCommands(t){this.#o.add(t),this.#k({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#K()})}cleanUndoStack(t){this.#o.cleanType(t)}#K(){if(this.#n.size===0)return!0;if(this.#n.size===1)for(const t of this.#n.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#b],n=()=>{this._editorUndoBar?.show(s,e.length===1?e[0].editorType:e.length);for(const o of e)o.remove()},s=()=>{for(const o of e)this.#et(o)};this.addCommands({cmd:n,undo:s,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#nt(t){for(const e of this.#b)e.unselect();this.#b.clear();for(const e of t)e.isEmpty()||(this.#b.add(e),e.select());this.#k({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#b)t.commit();this.#nt(this.#n.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#T!==Vt.NONE))&&!this.#d?.commitOrRemove()&&this.hasSelection){for(const t of this.#b)t.unselect();this.#b.clear(),this.#k({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;this.#H[0]+=t,this.#H[1]+=e;const[s,o]=this.#H,l=[...this.#b],u=1e3;this.#P&&clearTimeout(this.#P),this.#P=setTimeout(()=>{this.#P=null,this.#H[0]=this.#H[1]=0,this.addCommands({cmd:()=>{for(const h of l)this.#n.has(h.id)&&(h.translateInPage(s,o),h.translationDone())},undo:()=>{for(const h of l)this.#n.has(h.id)&&(h.translateInPage(-s,-o),h.translationDone())},mustExec:!1})},u);for(const h of l)h.translateInPage(t,e),h.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#g=new Map;for(const t of this.#b)this.#g.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#g)return!1;this.disableUserSelect(!1);const t=this.#g;this.#g=null;let e=!1;for(const[{x:s,y:o,pageIndex:l},u]of t)u.newX=s,u.newY=o,u.newPageIndex=l,e||=s!==u.savedX||o!==u.savedY||l!==u.savedPageIndex;if(!e)return!1;const n=(s,o,l,u)=>{if(this.#n.has(s.id)){const h=this.#s.get(u);h?s._setParentAndPosition(h,o,l):(s.pageIndex=u,s.x=o,s.y=l)}};return this.addCommands({cmd:()=>{for(const[s,{newX:o,newY:l,newPageIndex:u}]of t)n(s,o,l,u)},undo:()=>{for(const[s,{savedX:o,savedY:l,savedPageIndex:u}]of t)n(s,o,l,u)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#g)for(const n of this.#g.keys())n.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#b.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#T}get imageManager(){return Gt(this,"imageManager",new Qv)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let f=0,m=e.rangeCount;f<m;f++)if(!t.contains(e.getRangeAt(f).commonAncestorContainer))return null;const{x:n,y:s,width:o,height:l}=t.getBoundingClientRect();let u;switch(t.getAttribute("data-main-rotation")){case"90":u=(f,m,v,b)=>({x:(m-s)/l,y:1-(f+v-n)/o,width:b/l,height:v/o});break;case"180":u=(f,m,v,b)=>({x:1-(f+v-n)/o,y:1-(m+b-s)/l,width:v/o,height:b/l});break;case"270":u=(f,m,v,b)=>({x:1-(m+b-s)/l,y:(f-n)/o,width:b/l,height:v/o});break;default:u=(f,m,v,b)=>({x:(f-n)/o,y:(m-s)/l,width:v/o,height:b/l});break}const h=[];for(let f=0,m=e.rangeCount;f<m;f++){const v=e.getRangeAt(f);if(!v.collapsed)for(const{x:b,y:A,width:S,height:E}of v.getClientRects())S===0||E===0||h.push(u(b,A,S,E))}return h.length===0?null:h}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#a||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#a?.delete(t)}renderAnnotationElement(t){const e=this.#a?.get(t.data.id);if(!e)return;const n=this.#i.getRawValue(e);n&&(this.#T===Vt.NONE&&!n.hasBeenModified||n.renderAnnotationElement(t))}setMissingCanvas(t,e,n){const s=this.#D?.get(t);s&&(s.setCanvas(e,n),this.#D.delete(t))}addMissingCanvas(t,e){(this.#D||=new Map).set(t,e)}}class Si{#t=null;#e=!1;#n=null;#s=null;#r=null;#i=null;#a=!1;#o=null;#u=null;#c=null;#d=null;#l=!1;static#p=null;static _l10n=null;constructor(t){this.#u=t,this.#l=t._uiManager.useNewAltTextFlow,Si.#p||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){Si._l10n??=t}async render(){const t=this.#n=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#s=document.createElement("span");t.append(e),this.#l?(t.classList.add("new"),t.setAttribute("data-l10n-id",Si.#p.missing),e.setAttribute("data-l10n-id",Si.#p["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=this.#u._uiManager._signal;t.addEventListener("contextmenu",js,{signal:n}),t.addEventListener("pointerdown",o=>o.stopPropagation(),{signal:n});const s=o=>{o.preventDefault(),this.#u._uiManager.editAltText(this.#u),this.#l&&this.#u._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#g}})};return t.addEventListener("click",s,{capture:!0,signal:n}),t.addEventListener("keydown",o=>{o.target===t&&o.key==="Enter"&&(this.#a=!0,s(o))},{signal:n}),await this.#f(),t}get#g(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#n&&(this.#n.focus({focusVisible:this.#a}),this.#a=!1)}isEmpty(){return this.#l?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#l?this.#t!==null||!!this.#c:this.isEmpty()}get guessedText(){return this.#c}async setGuessedText(t){this.#t===null&&(this.#c=t,this.#d=await Si._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#f())}toggleAltTextBadge(t=!1){if(!this.#l||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){const e=this.#o=document.createElement("div");e.className="noAltTextBadge",this.#u.div.append(e)}this.#o.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#c===e&&(e=this.#d),{altText:e,decorative:this.#e,guessedText:this.#c,textWithDisclaimer:this.#d}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:n,textWithDisclaimer:s,cancel:o=!1}){n&&(this.#c=n,this.#d=s),!(this.#t===t&&this.#e===e)&&(o||(this.#t=t,this.#e=e),this.#f())}toggle(t=!1){this.#n&&(!t&&this.#i&&(clearTimeout(this.#i),this.#i=null),this.#n.disabled=!t)}shown(){this.#u._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#g}})}destroy(){this.#n?.remove(),this.#n=null,this.#s=null,this.#r=null,this.#o?.remove(),this.#o=null}async#f(){const t=this.#n;if(!t)return;if(this.#l){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",Si.#p[this.#g]),this.#s?.setAttribute("data-l10n-id",Si.#p[`${this.#g}-label`]),!this.#t){this.#r?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#r?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#r;if(!e){this.#r=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#u.id}`;const s=100,o=this.#u._uiManager._signal;o.addEventListener("abort",()=>{clearTimeout(this.#i),this.#i=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#i=setTimeout(()=>{this.#i=null,this.#r.classList.add("show"),this.#u._reportTelemetry({action:"alt_text_tooltip"})},s)},{signal:o}),t.addEventListener("mouseleave",()=>{this.#i&&(clearTimeout(this.#i),this.#i=null),this.#r?.classList.remove("show")},{signal:o})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#u.getElementForAltText()?.setAttribute("aria-describedby",e.id)}}class Qd{#t=null;#e=!1;#n=null;#s=null;#r=null;#i=null;#a=!1;constructor(t){this.#n=t,this.toolbar=null}render(){if(!this.#n._uiManager.hasCommentManager())return null;const t=this.#t=document.createElement("button");t.className="comment",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button");const e=this.#n._uiManager._signal;t.addEventListener("contextmenu",js,{signal:e}),t.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:e});const n=s=>{s.preventDefault(),this.edit()};return t.addEventListener("click",n,{capture:!0,signal:e}),t.addEventListener("keydown",s=>{s.target===t&&s.key==="Enter"&&(this.#e=!0,n(s))},{signal:e}),t}edit(){const{bottom:t,left:e,right:n}=this.#n.getClientDimensions(),s={top:t};this.#n._uiManager.direction==="ltr"?s.right=n:s.left=e,this.#n._uiManager.editComment(this.#n,s)}finish(){this.#t&&(this.#t.focus({focusVisible:this.#e}),this.#e=!1)}isDeleted(){return this.#a||this.#r===""}hasBeenEdited(){return this.isDeleted()||this.#r!==this.#s}serialize(){return this.data}get data(){return{text:this.#r,date:this.#i,deleted:this.#a}}set data(t){if(t===null){this.#r="",this.#a=!0;return}this.#r=t,this.#i=new Date,this.#a=!1}setInitialText(t){this.#s=t,this.data=t}toggle(t=!1){this.#t&&(this.#t.disabled=!t)}shown(){}destroy(){this.#t?.remove(),this.#t=null,this.#r="",this.#i=null,this.#n=null,this.#e=!1,this.#a=!1}}class Ep{#t;#e=!1;#n=null;#s;#r;#i;#a;#o=null;#u;#c=null;#d;#l=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:n=null,onPinchStart:s=null,onPinching:o=null,onPinchEnd:l=null,signal:u}){this.#t=t,this.#n=n,this.#s=e,this.#r=s,this.#i=o,this.#a=l,this.#d=new AbortController,this.#u=AbortSignal.any([u,this.#d.signal]),t.addEventListener("touchstart",this.#p.bind(this),{passive:!1,signal:this.#u})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/ki.pixelRatio}#p(t){if(this.#s?.())return;if(t.touches.length===1){if(this.#o)return;const s=this.#o=new AbortController,o=AbortSignal.any([this.#u,s.signal]),l=this.#t,u={capture:!0,signal:o,passive:!1},h=f=>{f.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};l.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(Qe(f),h(f))},u),l.addEventListener("pointerup",h,u),l.addEventListener("pointercancel",h,u);return}if(!this.#l){this.#l=new AbortController;const s=AbortSignal.any([this.#u,this.#l.signal]),o=this.#t,l={signal:s,capture:!1,passive:!1};o.addEventListener("touchmove",this.#g.bind(this),l);const u=this.#f.bind(this);o.addEventListener("touchend",u,l),o.addEventListener("touchcancel",u,l),l.capture=!0,o.addEventListener("pointerdown",Qe,l),o.addEventListener("pointermove",Qe,l),o.addEventListener("pointercancel",Qe,l),o.addEventListener("pointerup",Qe,l),this.#r?.()}if(Qe(t),t.touches.length!==2||this.#n?.()){this.#c=null;return}let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]),this.#c={touch0X:e.screenX,touch0Y:e.screenY,touch1X:n.screenX,touch1Y:n.screenY}}#g(t){if(!this.#c||t.touches.length!==2)return;Qe(t);let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]);const{screenX:s,screenY:o}=e,{screenX:l,screenY:u}=n,h=this.#c,{touch0X:f,touch0Y:m,touch1X:v,touch1Y:b}=h,A=v-f,S=b-m,E=l-s,T=u-o,C=Math.hypot(E,T)||1,L=Math.hypot(A,S)||1;if(!this.#e&&Math.abs(L-C)<=Ep.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(h.touch0X=s,h.touch0Y=o,h.touch1X=l,h.touch1Y=u,!this.#e){this.#e=!0;return}const k=[(s+l)/2,(o+u)/2];this.#i?.(k,L,C)}#f(t){t.touches.length>=2||(this.#l&&(this.#l.abort(),this.#l=null,this.#a?.()),this.#c&&(Qe(t),this.#c=null,this.#e=!1))}destroy(){this.#d?.abort(),this.#d=null,this.#o?.abort(),this.#o=null}}class Rt{#t=null;#e=null;#n=null;#s=null;#r=!1;#i=null;#a="";#o=!1;#u=null;#c=null;#d=null;#l=null;#p="";#g=!1;#f=null;#h=!1;#m=!1;#_=!1;#y=null;#A=0;#w=0;#v=null;#S=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#I=!1;#E=Rt._zIndex++;static _borderLineWidth=-1;static _colorManager=new Jv;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=Rt.prototype._resizeWithKeyboard,e=ya.TRANSLATE_SMALL,n=ya.TRANSLATE_BIG;return Gt(this,"_resizerKeyboardManager",new gh([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,n]}],[["Escape","mac+Escape"],Rt.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null;const{rotation:e,rawDims:{pageWidth:n,pageHeight:s,pageX:o,pageY:l}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,s],this.pageTranslation=[o,l];const[u,h]=this.parentDimensions;this.x=t.x/u,this.y=t.y/h,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return Gt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new PO({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(Rt._l10n??=t,Rt._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),Rt._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);Rt._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){ye("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#I}set _isDraggable(t){this.#I=t,this.div?.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#E}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):this.#G(),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#g?this.#g=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,n,s){const[o,l]=this.parentDimensions;[n,s]=this.screenToPageTranslation(n,s),this.x=(t+n)/o,this.y=(e+s)/l,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[n,s]=this.parentDimensions;this.setAt(t*n,e*s,this.width*n,this.height*s),this._onTranslated()}#N([t,e],n,s){[n,s]=this.screenToPageTranslation(n,s),this.x+=n/t,this.y+=s/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#N(this.parentDimensions,t,e)}translateInPage(t,e){this.#f||=[this.x,this.y,this.width,this.height],this.#N(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#f||=[this.x,this.y,this.width,this.height];const{div:n,parentDimensions:[s,o]}=this;if(this.x+=t/s,this.y+=e/o,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:v,y:b}=this.div.getBoundingClientRect();this.parent.findNewParent(this,v,b)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:l,y:u}=this;const[h,f]=this.getBaseTranslation();l+=h,u+=f;const{style:m}=n;m.left=`${(100*l).toFixed(2)}%`,m.top=`${(100*u).toFixed(2)}%`,this._onTranslating(l,u),n.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#f&&(this.#f[0]!==this.x||this.#f[1]!==this.y)}get _hasBeenResized(){return!!this.#f&&(this.#f[2]!==this.width||this.#f[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:n}=Rt,s=n/t,o=n/e;switch(this.rotation){case 90:return[-s,o];case 180:return[s,o];case 270:return[s,-o];default:return[-s,-o]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[n,s]}=this;let{x:o,y:l,width:u,height:h}=this;if(u*=n,h*=s,o*=n,l*=s,this._mustFixPosition)switch(t){case 0:o=Bn(o,0,n-u),l=Bn(l,0,s-h);break;case 90:o=Bn(o,0,n-h),l=Bn(l,u,s);break;case 180:o=Bn(o,u,n),l=Bn(l,h,s);break;case 270:o=Bn(o,h,n),l=Bn(l,0,s-u);break}this.x=o/=n,this.y=l/=s;const[f,m]=this.getBaseTranslation();o+=f,l+=m,e.left=`${(100*o).toFixed(2)}%`,e.top=`${(100*l).toFixed(2)}%`,this.moveInDOM()}static#R(t,e,n){switch(n){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return Rt.#R(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return Rt.#R(t,e,360-this.parentRotation)}#C(t){switch(t){case 90:{const[e,n]=this.pageDimensions;return[0,-e/n,n/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,n]=this.pageDimensions;return[0,e/n,-n/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,n]}=this;return[e*t,n*t]}setDims(t,e){const[n,s]=this.parentDimensions,{style:o}=this.div;o.width=`${(100*t/n).toFixed(2)}%`,this.#o||(o.height=`${(100*e/s).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:n}=t,s=n.endsWith("%"),o=!this.#o&&e.endsWith("%");if(s&&o)return;const[l,u]=this.parentDimensions;s||(t.width=`${(100*parseFloat(n)/l).toFixed(2)}%`),!this.#o&&!o&&(t.height=`${(100*parseFloat(e)/u).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#x(){if(this.#u)return;this.#u=document.createElement("div"),this.#u.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const n of t){const s=document.createElement("div");this.#u.append(s),s.classList.add("resizer",n),s.setAttribute("data-resizer-name",n),s.addEventListener("pointerdown",this.#M.bind(this,n),{signal:e}),s.addEventListener("contextmenu",js,{signal:e}),s.tabIndex=-1}this.div.prepend(this.#u)}#M(t,e){e.preventDefault();const{isMac:n}=Tn.platform;if(e.button!==0||e.ctrlKey&&n)return;this.#n?.toggle(!1);const s=this._isDraggable;this._isDraggable=!1,this.#c=[e.screenX,e.screenY];const o=new AbortController,l=this._uiManager.combinedSignal(o);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#B.bind(this,t),{passive:!0,capture:!0,signal:l}),window.addEventListener("touchmove",Qe,{passive:!1,signal:l}),window.addEventListener("contextmenu",js,{signal:l}),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const u=this.parent.div.style.cursor,h=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const f=()=>{o.abort(),this.parent.togglePointerEvents(!0),this.#n?.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=u,this.div.style.cursor=h,this.#D()};window.addEventListener("pointerup",f,{signal:l}),window.addEventListener("blur",f,{signal:l})}#j(t,e,n,s){this.width=n,this.height=s,this.x=t,this.y=e;const[o,l]=this.parentDimensions;this.setDims(o*n,l*s),this.fixAndSetPosition(),this._onResized()}_onResized(){}#D(){if(!this.#d)return;const{savedX:t,savedY:e,savedWidth:n,savedHeight:s}=this.#d;this.#d=null;const o=this.x,l=this.y,u=this.width,h=this.height;o===t&&l===e&&u===n&&h===s||this.addCommands({cmd:this.#j.bind(this,o,l,u,h),undo:this.#j.bind(this,t,e,n,s),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#B(t,e){const[n,s]=this.parentDimensions,o=this.x,l=this.y,u=this.width,h=this.height,f=Rt.MIN_SIZE/n,m=Rt.MIN_SIZE/s,v=this.#C(this.rotation),b=($,Y)=>[v[0]*$+v[2]*Y,v[1]*$+v[3]*Y],A=this.#C(360-this.rotation),S=($,Y)=>[A[0]*$+A[2]*Y,A[1]*$+A[3]*Y];let E,T,C=!1,L=!1;switch(t){case"topLeft":C=!0,E=($,Y)=>[0,0],T=($,Y)=>[$,Y];break;case"topMiddle":E=($,Y)=>[$/2,0],T=($,Y)=>[$/2,Y];break;case"topRight":C=!0,E=($,Y)=>[$,0],T=($,Y)=>[0,Y];break;case"middleRight":L=!0,E=($,Y)=>[$,Y/2],T=($,Y)=>[0,Y/2];break;case"bottomRight":C=!0,E=($,Y)=>[$,Y],T=($,Y)=>[0,0];break;case"bottomMiddle":E=($,Y)=>[$/2,Y],T=($,Y)=>[$/2,0];break;case"bottomLeft":C=!0,E=($,Y)=>[0,Y],T=($,Y)=>[$,0];break;case"middleLeft":L=!0,E=($,Y)=>[0,Y/2],T=($,Y)=>[$,Y/2];break}const k=E(u,h),V=T(u,h);let P=b(...V);const G=Rt._round(o+P[0]),I=Rt._round(l+P[1]);let N=1,M=1,j,F;if(e.fromKeyboard)({deltaX:j,deltaY:F}=e);else{const{screenX:$,screenY:Y}=e,[ut,xt]=this.#c;[j,F]=this.screenToPageTranslation($-ut,Y-xt),this.#c[0]=$,this.#c[1]=Y}if([j,F]=S(j/n,F/s),C){const $=Math.hypot(u,h);N=M=Math.max(Math.min(Math.hypot(V[0]-k[0]-j,V[1]-k[1]-F)/$,1/u,1/h),f/u,m/h)}else L?N=Bn(Math.abs(V[0]-k[0]-j),f,1)/u:M=Bn(Math.abs(V[1]-k[1]-F),m,1)/h;const z=Rt._round(u*N),U=Rt._round(h*M);P=b(...T(z,U));const st=G-P[0],dt=I-P[1];this.#f||=[this.x,this.y,this.width,this.height],this.width=z,this.height=U,this.x=st,this.y=dt,this.setDims(n*z,s*U),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#n?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#m)return this._editToolbar;this._editToolbar=new Pu(this),this.div.append(this._editToolbar.render()),this._editToolbar.addButton("comment",this.addCommentButton());const{toolbarButtons:t}=this;if(t)for(const[e,n]of t)await this._editToolbar.addButton(e,n);return this._editToolbar.addButton("delete"),this._editToolbar}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#n?.destroy())}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#n||(Si.initialize(Rt._l10n),this.#n=new Si(this),this.#t&&(this.#n.data=this.#t,this.#t=null)),this.#n}get altTextData(){return this.#n?.data}set altTextData(t){this.#n&&(this.#n.data=t)}get guessedAltText(){return this.#n?.guessedText}async setGuessedAltText(t){await this.#n?.setGuessedText(t)}serializeAltText(t){return this.#n?.serialize(t)}hasAltText(){return!!this.#n&&!this.#n.isEmpty()}hasAltTextData(){return this.#n?.hasData()??!1}addCommentButton(){return this.#s?this.#s:this.#s=new Qd(this)}get commentColor(){return null}get comment(){const t=this.#s;return{text:t.data.text,date:t.data.date,deleted:t.isDeleted(),color:this.commentColor}}set comment(t){this.#s||(this.#s=new Qd(this)),this.#s.data=t}setCommentData(t){this.#s||(this.#s=new Qd(this)),this.#s.setInitialText(t)}get hasEditedComment(){return this.#s?.hasBeenEdited()}async editComment(){this.#s||(this.#s=new Qd(this)),this.#s.edit()}addComment(t){this.hasEditedComment&&(t.popup={contents:this.comment.text,deleted:this.comment.deleted})}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#r?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#q();const[e,n]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*n/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/n).toFixed(2)}%`);const[s,o]=this.getInitialTranslation();return this.translate(s,o),Bx(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#S||=new Ep({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#T.bind(this),onPinching:this.#b.bind(this),onPinchEnd:this.#V.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),t}#T(){this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#n?.toggle(!1),this.parent.togglePointerEvents(!1)}#b(t,e,n){let o=.7*(n/e)+1-.7;if(o===1)return;const l=this.#C(this.rotation),u=(G,I)=>[l[0]*G+l[2]*I,l[1]*G+l[3]*I],[h,f]=this.parentDimensions,m=this.x,v=this.y,b=this.width,A=this.height,S=Rt.MIN_SIZE/h,E=Rt.MIN_SIZE/f;o=Math.max(Math.min(o,1/b,1/A),S/b,E/A);const T=Rt._round(b*o),C=Rt._round(A*o);if(T===b&&C===A)return;this.#f||=[m,v,b,A];const L=u(b/2,A/2),k=Rt._round(m+L[0]),V=Rt._round(v+L[1]),P=u(T/2,C/2);this.x=k-P[0],this.y=V-P[1],this.width=T,this.height=C,this.setDims(h*T,f*C),this.fixAndSetPosition(),this._onResizing()}#V(){this.#n?.toggle(!0),this.parent.togglePointerEvents(!0),this.#D()}pointerdown(t){const{isMac:e}=Tn.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#g=!0,this._isDraggable){this.#z(t);return}this.#U(t)}#U(t){const{isMac:e}=Tn.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#z(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let n=!1;const s=new AbortController,o=this._uiManager.combinedSignal(s),l={capture:!0,passive:!1,signal:o},u=f=>{s.abort(),this.#i=null,this.#g=!1,this._uiManager.endDragSession()||this.#U(f),n&&this._onStopDragging()};e&&(this.#A=t.clientX,this.#w=t.clientY,this.#i=t.pointerId,this.#a=t.pointerType,window.addEventListener("pointermove",f=>{n||(n=!0,this._onStartDragging());const{clientX:m,clientY:v,pointerId:b}=f;if(b!==this.#i){Qe(f);return}const[A,S]=this.screenToPageTranslation(m-this.#A,v-this.#w);this.#A=m,this.#w=v,this._uiManager.dragSelectedEditors(A,S)},l),window.addEventListener("touchmove",Qe,l),window.addEventListener("pointerdown",f=>{f.pointerType===this.#a&&(this.#S||f.isPrimary)&&u(f),Qe(f)},l));const h=f=>{if(!this.#i||this.#i===f.pointerId){u(f);return}Qe(f)};window.addEventListener("pointerup",h,{signal:o}),window.addEventListener("blur",h,{signal:o})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.#y=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,n){t.changeParent(this),this.x=e,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,n=this.rotation){const s=this.parentScale,[o,l]=this.pageDimensions,[u,h]=this.pageTranslation,f=t/s,m=e/s,v=this.x*o,b=this.y*l,A=this.width*o,S=this.height*l;switch(n){case 0:return[v+f+u,l-b-m-S+h,v+f+A+u,l-b-m+h];case 90:return[v+m+u,l-b+f+h,v+m+S+u,l-b+f+A+h];case 180:return[v-f-A+u,l-b+m+h,v-f+u,l-b+m+S+h];case 270:return[v-m-S+u,l-b-f-A+h,v-m+u,l-b-f+h];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[n,s,o,l]=t,u=o-n,h=l-s;switch(this.rotation){case 0:return[n,e-l,u,h];case 90:return[n,e-s,h,u];case 180:return[o,e-s,u,h];case 270:return[o,e-l,h,u];default:throw new Error("Invalid rotation")}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#m=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#m=!1,!0):!1}isInEditMode(){return this.#m}shouldGetKeyboardEvents(){return this.#_}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:n,right:s}=this.getClientDimensions(),{innerHeight:o,innerWidth:l}=window;return e<l&&s>0&&t<o&&n>0}#q(){if(this.#l||!this.div)return;this.#l=new AbortController;const t=this._uiManager.combinedSignal(this.#l);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#q()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){ye("An editor must be serializable")}static async deserialize(t,e,n){const s=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:n,annotationElementId:t.annotationElementId});s.rotation=t.rotation,s.#t=t.accessibilityData,s._isCopy=t.isCopy||!1;const[o,l]=s.pageDimensions,[u,h,f,m]=s.getRectInCurrentCoords(t.rect,l);return s.x=u/o,s.y=h/l,s.width=f/o,s.height=m/l,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#l?.abort(),this.#l=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#y&&(clearTimeout(this.#y),this.#y=null),this.#G(),this.removeEditToolbar(),this.#v){for(const t of this.#v.values())clearTimeout(t);this.#v=null}this.parent=null,this.#S?.destroy(),this.#S=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#x(),this.#u.classList.remove("hidden"))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#u.children;if(!this.#e){this.#e=Array.from(e);const l=this.#$.bind(this),u=this.#H.bind(this),h=this._uiManager._signal;for(const f of this.#e){const m=f.getAttribute("data-resizer-name");f.setAttribute("role","spinbutton"),f.addEventListener("keydown",l,{signal:h}),f.addEventListener("blur",u,{signal:h}),f.addEventListener("focus",this.#P.bind(this,m),{signal:h}),f.setAttribute("data-l10n-id",Rt._l10nResizer[m])}}const n=this.#e[0];let s=0;for(const l of e){if(l===n)break;s++}const o=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(o!==s){if(o<s)for(let u=0;u<s-o;u++)this.#u.append(this.#u.firstChild);else if(o>s)for(let u=0;u<o-s;u++)this.#u.firstChild.before(this.#u.lastChild);let l=0;for(const u of e){const f=this.#e[l++].getAttribute("data-resizer-name");u.setAttribute("data-l10n-id",Rt._l10nResizer[f])}}this.#L(0),this.#_=!0,this.#u.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#$(t){Rt._resizerKeyboardManager.exec(this,t)}#H(t){this.#_&&t.relatedTarget?.parentNode!==this.#u&&this.#G()}#P(t){this.#p=this.#_?t:""}#L(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#_&&this.#B(this.#p,{deltaX:t,deltaY:e,fromKeyboard:!0})}#G(){this.#_=!1,this.#L(-1),this.#D()}_stopResizingWithKeyboard(){this.#G(),this.div.focus()}select(){if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#n?.toggleAltTextBadge(!1)}}unselect(){this.isSelected&&(this.isSelected=!1,this.#u?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#n?.toggleAltTextBadge(!0))}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#h}set isEditing(t){this.#h=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){this.#o=!0;const n=t/e,{style:s}=this.div;s.aspectRatio=n,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#v||=new Map;const{action:n}=t;let s=this.#v.get(n);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(t),this.#v.delete(n),this.#v.size===0&&(this.#v=null)},Rt._telemetryTimeout),this.#v.set(n,s);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#r=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#r=!0}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const n=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),n.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class PO extends Rt{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const w0=3285377520,Ms=4294901760,bi=65535;class zx{constructor(t){this.h1=t?t&4294967295:w0,this.h2=t?t&4294967295:w0}update(t){let e,n;if(typeof t=="string"){e=new Uint8Array(t.length*2),n=0;for(let E=0,T=t.length;E<T;E++){const C=t.charCodeAt(E);C<=255?e[n++]=C:(e[n++]=C>>>8,e[n++]=C&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),n=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=n>>2,o=n-s*4,l=new Uint32Array(e.buffer,0,s);let u=0,h=0,f=this.h1,m=this.h2;const v=3432918353,b=461845907,A=v&bi,S=b&bi;for(let E=0;E<s;E++)E&1?(u=l[E],u=u*v&Ms|u*A&bi,u=u<<15|u>>>17,u=u*b&Ms|u*S&bi,f^=u,f=f<<13|f>>>19,f=f*5+3864292196):(h=l[E],h=h*v&Ms|h*A&bi,h=h<<15|h>>>17,h=h*b&Ms|h*S&bi,m^=h,m=m<<13|m>>>19,m=m*5+3864292196);switch(u=0,o){case 3:u^=e[s*4+2]<<16;case 2:u^=e[s*4+1]<<8;case 1:u^=e[s*4],u=u*v&Ms|u*A&bi,u=u<<15|u>>>17,u=u*b&Ms|u*S&bi,s&1?f^=u:m^=u}this.h1=f,this.h2=m}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&Ms|t*36045&bi,e=e*4283543511&Ms|((e<<16|t>>>16)*2950163797&Ms)>>>16,t^=e>>>1,t=t*444984403&Ms|t*60499&bi,e=e*3301882366&Ms|((e<<16|t>>>16)*3120437893&Ms)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const jy=Object.freeze({map:null,hash:"",transfer:void 0});class Zv{#t=!1;#e=null;#n=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const n=this.#n.get(t);return n===void 0?e:Object.assign(e,n)}getRawValue(t){return this.#n.get(t)}remove(t){if(this.#n.delete(t),this.#n.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const e of this.#n.values())if(e instanceof Rt)return;this.onAnnotationEditor(null)}}setValue(t,e){const n=this.#n.get(t);let s=!1;if(n!==void 0)for(const[o,l]of Object.entries(e))n[o]!==l&&(s=!0,n[o]=l);else s=!0,this.#n.set(t,e);s&&this.#s(),e instanceof Rt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return this.#n.has(t)}get size(){return this.#n.size}#s(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Hx(this)}get serializable(){if(this.#n.size===0)return jy;const t=new Map,e=new zx,n=[],s=Object.create(null);let o=!1;for(const[l,u]of this.#n){const h=u instanceof Rt?u.serialize(!1,s):u;h&&(t.set(l,h),e.update(`${l}:${JSON.stringify(h)}`),o||=!!h.bitmap)}if(o)for(const l of t.values())l.bitmap&&n.push(l.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:n}:jy}get editorStats(){let t=null;const e=new Map;for(const n of this.#n.values()){if(!(n instanceof Rt))continue;const s=n.telemetryFinalData;if(!s)continue;const{type:o}=s;e.has(o)||e.set(o,Object.getPrototypeOf(n).constructor),t||=Object.create(null);const l=t[o]||=new Map;for(const[u,h]of Object.entries(s)){if(u==="type")continue;let f=l.get(u);f||(f=new Map,l.set(u,f));const m=f.get(h)??0;f.set(h,m+1)}}for(const[n,s]of e)t[n]=s.computeTelemetryFinalData(t[n]);return t}resetModifiedIds(){this.#e=null}get modifiedIds(){if(this.#e)return this.#e;const t=[];for(const e of this.#n.values())!(e instanceof Rt)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#n.entries()}}class Hx extends Zv{#t;constructor(t){super();const{map:e,hash:n,transfer:s}=t.serializable,o=structuredClone(e,s?{transfer:s}:null);this.#t={map:o,hash:n,transfer:s}}get print(){ye("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return Gt(this,"modifiedIds",{ids:new Set,hash:""})}}class LO{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:n}){if(!(!t||this.#t.has(t.loadedName))){if(Ze(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:o,style:l}=t,u=new FontFace(s,o,l);this.addNativeFontFace(u);try{await u.load(),this.#t.add(s),n?.(t)}catch{Ut(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(u)}return}ye("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const n=t.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(s){throw Ut(`Failed to load font '${n.family}': '${s}'.`),t.disableFontFace=!0,s}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const s=this._queueLoadingCallback(n);this._prepareFontLoadEvent(t,s)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return Gt(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return Gt(this,"isSyncFontLoadingSupported",Fn||Tn.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(Ze(!s.done,"completeRequest() cannot be called twice."),s.done=!0;n.length>0&&n[0].done;){const o=n.shift();setTimeout(o.callback,0)}}const{loadingRequests:n}=this,s={done:!1,complete:e,callback:t};return n.push(s),s}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Gt(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function n(V,P){return V.charCodeAt(P)<<24|V.charCodeAt(P+1)<<16|V.charCodeAt(P+2)<<8|V.charCodeAt(P+3)&255}function s(V,P,G,I){const N=V.substring(0,P),M=V.substring(P+G);return N+I+M}let o,l;const u=this._document.createElement("canvas");u.width=1,u.height=1;const h=u.getContext("2d");let f=0;function m(V,P){if(++f>30){Ut("Load test font never loaded."),P();return}if(h.font="30px "+V,h.fillText(".",0,20),h.getImageData(0,0,1,1).data[3]>0){P();return}setTimeout(m.bind(null,V,P))}const v=`lt${Date.now()}${this.loadTestFontId++}`;let b=this._loadTestFont;b=s(b,976,v.length,v);const S=16,E=1482184792;let T=n(b,S);for(o=0,l=v.length-3;o<l;o+=4)T=T-E+n(v,o)|0;o<v.length&&(T=T-E+n(v+"XXX",o)|0),b=s(b,S,4,_O(T));const C=`url(data:font/opentype;base64,${btoa(b)});`,L=`@font-face {font-family:"${v}";src:${C}}`;this.insertRule(L);const k=this._document.createElement("div");k.style.visibility="hidden",k.style.width=k.style.height="10px",k.style.position="absolute",k.style.top=k.style.left="0px";for(const V of[t.loadedName,v]){const P=this._document.createElement("span");P.textContent="Hi",P.style.fontFamily=V,k.append(P)}this._document.body.append(k),m(v,()=>{k.remove(),e.complete()})}}class OO{constructor(t,e=null){this.compiledGlyphs=Object.create(null);for(const n in t)this[n]=t[n];this._inspectFont=e}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${Fx(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const n=this.loadedName+"_path_"+e;let s;try{s=t.get(n)}catch(l){Ut(`getPathGenerator - ignoring character: "${l}".`)}const o=new Path2D(s||"");return this.fontExtraProperties||t.delete(n),this.compiledGlyphs[e]=o}}function jO(i){if(i instanceof URL)return i.href;if(typeof i=="string"){if(Fn)return i;const t=URL.parse(i,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function VO(i){if(Fn&&typeof Buffer<"u"&&i instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength)return i;if(typeof i=="string")return fh(i);if(i instanceof ArrayBuffer||ArrayBuffer.isView(i)||typeof i=="object"&&!isNaN(i?.length))return new Uint8Array(i);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Jd(i){if(typeof i!="string")return null;if(i.endsWith("/"))return i;throw new Error(`Invalid factory url: "${i}" must include trailing slash.`)}const Vy=i=>typeof i=="object"&&Number.isInteger(i?.num)&&i.num>=0&&Number.isInteger(i?.gen)&&i.gen>=0,UO=i=>typeof i=="object"&&typeof i?.name=="string",FO=SO.bind(null,Vy,UO);class BO{#t=new Map;#e=Promise.resolve();postMessage(t,e){const n={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[s]of this.#t)s.call(this,n)})}addEventListener(t,e,n=null){let s=null;if(n?.signal instanceof AbortSignal){const{signal:o}=n;if(o.aborted){Ut("LoopbackPort - cannot use an `aborted` signal.");return}const l=()=>this.removeEventListener(t,e);s=()=>o.removeEventListener("abort",l),o.addEventListener("abort",l)}this.#t.set(e,s)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}const Zd={DATA:1,ERROR:2},We={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function E0(){}function Yn(i){if(i instanceof ga||i instanceof Py||i instanceof _0||i instanceof Hf||i instanceof Qg)return i;switch(i instanceof Error||typeof i=="object"&&i!==null||ye('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),i.name){case"AbortException":return new ga(i.message);case"InvalidPDFException":return new Py(i.message);case"PasswordException":return new _0(i.message,i.code);case"ResponseException":return new Hf(i.message,i.status,i.missing);case"UnknownErrorException":return new Qg(i.message,i.details)}return new Qg(i.message,i.toString())}class Tu{#t=new AbortController;constructor(t,e,n){this.sourceName=t,this.targetName=e,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#s(t);return}if(t.callback){const n=t.callbackId,s=this.callbackCapabilities[n];if(!s)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],t.callback===Zd.DATA)s.resolve(t.data);else if(t.callback===Zd.ERROR)s.reject(Yn(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const n=this.sourceName,s=t.sourceName,o=this.comObj;Promise.try(e,t.data).then(function(l){o.postMessage({sourceName:n,targetName:s,callback:Zd.DATA,callbackId:t.callbackId,data:l})},function(l){o.postMessage({sourceName:n,targetName:s,callback:Zd.ERROR,callbackId:t.callbackId,reason:Yn(l)})});return}if(t.streamId){this.#n(t);return}e(t.data)}on(t,e){const n=this.actionHandler;if(n[t])throw new Error(`There is already an actionName called "${t}"`);n[t]=e}send(t,e,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},n)}sendWithPromise(t,e,n){const s=this.callbackId++,o=Promise.withResolvers();this.callbackCapabilities[s]=o;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:s,data:e},n)}catch(l){o.reject(l)}return o.promise}sendWithStream(t,e,n,s){const o=this.streamId++,l=this.sourceName,u=this.targetName,h=this.comObj;return new ReadableStream({start:f=>{const m=Promise.withResolvers();return this.streamControllers[o]={controller:f,startCall:m,pullCall:null,cancelCall:null,isClosed:!1},h.postMessage({sourceName:l,targetName:u,action:t,streamId:o,data:e,desiredSize:f.desiredSize},s),m.promise},pull:f=>{const m=Promise.withResolvers();return this.streamControllers[o].pullCall=m,h.postMessage({sourceName:l,targetName:u,stream:We.PULL,streamId:o,desiredSize:f.desiredSize}),m.promise},cancel:f=>{Ze(f instanceof Error,"cancel must have a valid reason");const m=Promise.withResolvers();return this.streamControllers[o].cancelCall=m,this.streamControllers[o].isClosed=!0,h.postMessage({sourceName:l,targetName:u,stream:We.CANCEL,streamId:o,reason:Yn(f)}),m.promise}},n)}#n(t){const e=t.streamId,n=this.sourceName,s=t.sourceName,o=this.comObj,l=this,u=this.actionHandler[t.action],h={enqueue(f,m=1,v){if(this.isCancelled)return;const b=this.desiredSize;this.desiredSize-=m,b>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),o.postMessage({sourceName:n,targetName:s,stream:We.ENQUEUE,streamId:e,chunk:f},v)},close(){this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:s,stream:We.CLOSE,streamId:e}),delete l.streamSinks[e])},error(f){Ze(f instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:s,stream:We.ERROR,streamId:e,reason:Yn(f)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};h.sinkCapability.resolve(),h.ready=h.sinkCapability.promise,this.streamSinks[e]=h,Promise.try(u,t.data,h).then(function(){o.postMessage({sourceName:n,targetName:s,stream:We.START_COMPLETE,streamId:e,success:!0})},function(f){o.postMessage({sourceName:n,targetName:s,stream:We.START_COMPLETE,streamId:e,reason:Yn(f)})})}#s(t){const e=t.streamId,n=this.sourceName,s=t.sourceName,o=this.comObj,l=this.streamControllers[e],u=this.streamSinks[e];switch(t.stream){case We.START_COMPLETE:t.success?l.startCall.resolve():l.startCall.reject(Yn(t.reason));break;case We.PULL_COMPLETE:t.success?l.pullCall.resolve():l.pullCall.reject(Yn(t.reason));break;case We.PULL:if(!u){o.postMessage({sourceName:n,targetName:s,stream:We.PULL_COMPLETE,streamId:e,success:!0});break}u.desiredSize<=0&&t.desiredSize>0&&u.sinkCapability.resolve(),u.desiredSize=t.desiredSize,Promise.try(u.onPull||E0).then(function(){o.postMessage({sourceName:n,targetName:s,stream:We.PULL_COMPLETE,streamId:e,success:!0})},function(f){o.postMessage({sourceName:n,targetName:s,stream:We.PULL_COMPLETE,streamId:e,reason:Yn(f)})});break;case We.ENQUEUE:if(Ze(l,"enqueue should have stream controller"),l.isClosed)break;l.controller.enqueue(t.chunk);break;case We.CLOSE:if(Ze(l,"close should have stream controller"),l.isClosed)break;l.isClosed=!0,l.controller.close(),this.#r(l,e);break;case We.ERROR:Ze(l,"error should have stream controller"),l.controller.error(Yn(t.reason)),this.#r(l,e);break;case We.CANCEL_COMPLETE:t.success?l.cancelCall.resolve():l.cancelCall.reject(Yn(t.reason)),this.#r(l,e);break;case We.CANCEL:if(!u)break;const h=Yn(t.reason);Promise.try(u.onCancel||E0,h).then(function(){o.postMessage({sourceName:n,targetName:s,stream:We.CANCEL_COMPLETE,streamId:e,success:!0})},function(f){o.postMessage({sourceName:n,targetName:s,stream:We.CANCEL_COMPLETE,streamId:e,reason:Yn(f)})}),u.sinkCapability.reject(h),u.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#r(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class Gx{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(t,e);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,n){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||n<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=n}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){ye("Abstract method `_createCanvas` called.")}}class zO extends Gx{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const n=this._document.createElement("canvas");return n.width=t,n.height=e,n}}class qx{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){ye("Abstract method `_fetch` called.")}}class S0 extends qx{async _fetch(t){const e=await ph(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):fh(e)}}class $x{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,n,s,o){return"none"}destroy(t=!1){}}class HO extends $x{#t;#e;#n;#s;#r;#i;#a=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#s=t,this.#r=e}get#o(){return this.#e||=new Map}get#u(){return this.#i||=new Map}get#c(){if(!this.#n){const t=this.#r.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const n=this.#r.createElementNS(rr,"svg");n.setAttribute("width",0),n.setAttribute("height",0),this.#n=this.#r.createElementNS(rr,"defs"),t.append(n),n.append(this.#n),this.#r.body.append(t)}return this.#n}#d(t){if(t.length===1){const h=t[0],f=new Array(256);for(let v=0;v<256;v++)f[v]=h[v]/255;const m=f.join(",");return[m,m,m]}const[e,n,s]=t,o=new Array(256),l=new Array(256),u=new Array(256);for(let h=0;h<256;h++)o[h]=e[h]/255,l[h]=n[h]/255,u[h]=s[h]/255;return[o.join(","),l.join(","),u.join(",")]}#l(t){if(this.#t===void 0){this.#t="";const e=this.#r.URL;e!==this.#r.baseURI&&(Ap(e)?Ut('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=jx(e,""))}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#o.get(t);if(e)return e;const[n,s,o]=this.#d(t),l=t.length===1?n:`${n}${s}${o}`;if(e=this.#o.get(l),e)return this.#o.set(t,e),e;const u=`g_${this.#s}_transfer_map_${this.#a++}`,h=this.#l(u);this.#o.set(t,h),this.#o.set(l,h);const f=this.#f(u);return this.#m(n,s,o,f),h}addHCMFilter(t,e){const n=`${t}-${e}`,s="base";let o=this.#u.get(s);if(o?.key===n||(o?(o.filter?.remove(),o.key=n,o.url="none",o.filter=null):(o={key:n,url:"none",filter:null},this.#u.set(s,o)),!t||!e))return o.url;const l=this.#y(t);t=Tt.makeHexColor(...l);const u=this.#y(e);if(e=Tt.makeHexColor(...u),this.#c.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return o.url;const h=new Array(256);for(let A=0;A<=255;A++){const S=A/255;h[A]=S<=.03928?S/12.92:((S+.055)/1.055)**2.4}const f=h.join(","),m=`g_${this.#s}_hcm_filter`,v=o.filter=this.#f(m);this.#m(f,f,f,v),this.#g(v);const b=(A,S)=>{const E=l[A]/255,T=u[A]/255,C=new Array(S+1);for(let L=0;L<=S;L++)C[L]=E+L/S*(T-E);return C.join(",")};return this.#m(b(0,5),b(1,5),b(2,5),v),o.url=this.#l(m),o.url}addAlphaFilter(t){let e=this.#o.get(t);if(e)return e;const[n]=this.#d([t]),s=`alpha_${n}`;if(e=this.#o.get(s),e)return this.#o.set(t,e),e;const o=`g_${this.#s}_alpha_map_${this.#a++}`,l=this.#l(o);this.#o.set(t,l),this.#o.set(s,l);const u=this.#f(o);return this.#_(n,u),l}addLuminosityFilter(t){let e=this.#o.get(t||"luminosity");if(e)return e;let n,s;if(t?([n]=this.#d([t]),s=`luminosity_${n}`):s="luminosity",e=this.#o.get(s),e)return this.#o.set(t,e),e;const o=`g_${this.#s}_luminosity_map_${this.#a++}`,l=this.#l(o);this.#o.set(t,l),this.#o.set(s,l);const u=this.#f(o);return this.#p(u),t&&this.#_(n,u),l}addHighlightHCMFilter(t,e,n,s,o){const l=`${e}-${n}-${s}-${o}`;let u=this.#u.get(t);if(u?.key===l||(u?(u.filter?.remove(),u.key=l,u.url="none",u.filter=null):(u={key:l,url:"none",filter:null},this.#u.set(t,u)),!e||!n))return u.url;const[h,f]=[e,n].map(this.#y.bind(this));let m=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),v=Math.round(.2126*f[0]+.7152*f[1]+.0722*f[2]),[b,A]=[s,o].map(this.#y.bind(this));v<m&&([m,v,b,A]=[v,m,A,b]),this.#c.style.color="";const S=(C,L,k)=>{const V=new Array(256),P=(v-m)/k,G=C/255,I=(L-C)/(255*k);let N=0;for(let M=0;M<=k;M++){const j=Math.round(m+M*P),F=G+M*I;for(let z=N;z<=j;z++)V[z]=F;N=j+1}for(let M=N;M<256;M++)V[M]=V[N-1];return V.join(",")},E=`g_${this.#s}_hcm_${t}_filter`,T=u.filter=this.#f(E);return this.#g(T),this.#m(S(b[0],A[0],5),S(b[1],A[1],5),S(b[2],A[2],5),T),u.url=this.#l(E),u.url}destroy(t=!1){t&&this.#i?.size||(this.#n?.parentNode.parentNode.remove(),this.#n=null,this.#e?.clear(),this.#e=null,this.#i?.clear(),this.#i=null,this.#a=0)}#p(t){const e=this.#r.createElementNS(rr,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#g(t){const e=this.#r.createElementNS(rr,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#f(t){const e=this.#r.createElementNS(rr,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#c.append(e),e}#h(t,e,n){const s=this.#r.createElementNS(rr,e);s.setAttribute("type","discrete"),s.setAttribute("tableValues",n),t.append(s)}#m(t,e,n,s){const o=this.#r.createElementNS(rr,"feComponentTransfer");s.append(o),this.#h(o,"feFuncR",t),this.#h(o,"feFuncG",e),this.#h(o,"feFuncB",n)}#_(t,e){const n=this.#r.createElementNS(rr,"feComponentTransfer");e.append(n),this.#h(n,"feFuncA",t)}#y(t){return this.#c.style.color=t,wp(getComputedStyle(this.#c).getPropertyValue("color"))}}class Kx{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(n=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){ye("Abstract method `_fetch` called.")}}class T0 extends Kx{async _fetch(t){const e=await ph(t,"arraybuffer");return new Uint8Array(e)}}class Wx{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(n=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){ye("Abstract method `_fetch` called.")}}class x0 extends Wx{async _fetch(t){const e=await ph(t,"arraybuffer");return new Uint8Array(e)}}Fn&&Ut("Please use the `legacy` build in Node.js environments.");async function t_(i){const e=await process.getBuiltinModule("fs").promises.readFile(i);return new Uint8Array(e)}class GO extends $x{}class qO extends Gx{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class $O extends qx{async _fetch(t){return t_(t)}}class KO extends Kx{async _fetch(t){return t_(t)}}class WO extends Wx{async _fetch(t){return t_(t)}}const Sn={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Uy(i,t){if(!t)return;const e=t[2]-t[0],n=t[3]-t[1],s=new Path2D;s.rect(t[0],t[1],e,n),i.clip(s)}class e_{isModifyingCurrentTransform(){return!1}getPattern(){ye("Abstract method `getPattern` called.")}}class YO extends e_{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)e.addColorStop(n[0],n[1]);return e}getPattern(t,e,n,s){let o;if(s===Sn.STROKE||s===Sn.FILL){const l=e.current.getClippedPathBoundingBox(s,Ie(t))||[0,0,0,0],u=Math.ceil(l[2]-l[0])||1,h=Math.ceil(l[3]-l[1])||1,f=e.cachedCanvases.getCanvas("pattern",u,h),m=f.context;m.clearRect(0,0,m.canvas.width,m.canvas.height),m.beginPath(),m.rect(0,0,m.canvas.width,m.canvas.height),m.translate(-l[0],-l[1]),n=Tt.transform(n,[1,0,0,1,l[0],l[1]]),m.transform(...e.baseTransform),this.matrix&&m.transform(...this.matrix),Uy(m,this._bbox),m.fillStyle=this._createGradient(m),m.fill(),o=t.createPattern(f.canvas,"no-repeat");const v=new DOMMatrix(n);o.setTransform(v)}else Uy(t,this._bbox),o=this._createGradient(t);return o}}function ty(i,t,e,n,s,o,l,u){const h=t.coords,f=t.colors,m=i.data,v=i.width*4;let b;h[e+1]>h[n+1]&&(b=e,e=n,n=b,b=o,o=l,l=b),h[n+1]>h[s+1]&&(b=n,n=s,s=b,b=l,l=u,u=b),h[e+1]>h[n+1]&&(b=e,e=n,n=b,b=o,o=l,l=b);const A=(h[e]+t.offsetX)*t.scaleX,S=(h[e+1]+t.offsetY)*t.scaleY,E=(h[n]+t.offsetX)*t.scaleX,T=(h[n+1]+t.offsetY)*t.scaleY,C=(h[s]+t.offsetX)*t.scaleX,L=(h[s+1]+t.offsetY)*t.scaleY;if(S>=L)return;const k=f[o],V=f[o+1],P=f[o+2],G=f[l],I=f[l+1],N=f[l+2],M=f[u],j=f[u+1],F=f[u+2],z=Math.round(S),U=Math.round(L);let st,dt,$,Y,ut,xt,q,it;for(let ht=z;ht<=U;ht++){if(ht<T){const Ot=ht<S?0:(S-ht)/(S-T);st=A-(A-E)*Ot,dt=k-(k-G)*Ot,$=V-(V-I)*Ot,Y=P-(P-N)*Ot}else{let Ot;ht>L?Ot=1:T===L?Ot=0:Ot=(T-ht)/(T-L),st=E-(E-C)*Ot,dt=G-(G-M)*Ot,$=I-(I-j)*Ot,Y=N-(N-F)*Ot}let W;ht<S?W=0:ht>L?W=1:W=(S-ht)/(S-L),ut=A-(A-C)*W,xt=k-(k-M)*W,q=V-(V-j)*W,it=P-(P-F)*W;const ft=Math.round(Math.min(st,ut)),Nt=Math.round(Math.max(st,ut));let wt=v*ht+ft*4;for(let Ot=ft;Ot<=Nt;Ot++)W=(st-Ot)/(st-ut),W<0?W=0:W>1&&(W=1),m[wt++]=dt-(dt-xt)*W|0,m[wt++]=$-($-q)*W|0,m[wt++]=Y-(Y-it)*W|0,m[wt++]=255}}function XO(i,t,e){const n=t.coords,s=t.colors;let o,l;switch(t.type){case"lattice":const u=t.verticesPerRow,h=Math.floor(n.length/u)-1,f=u-1;for(o=0;o<h;o++){let m=o*u;for(let v=0;v<f;v++,m++)ty(i,e,n[m],n[m+1],n[m+u],s[m],s[m+1],s[m+u]),ty(i,e,n[m+u+1],n[m+1],n[m+u],s[m+u+1],s[m+1],s[m+u])}break;case"triangles":for(o=0,l=n.length;o<l;o+=3)ty(i,e,n[o],n[o+1],n[o+2],s[o],s[o+1],s[o+2]);break;default:throw new Error("illegal figure")}}class QO extends e_{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,n){const u=Math.floor(this._bounds[0]),h=Math.floor(this._bounds[1]),f=Math.ceil(this._bounds[2])-u,m=Math.ceil(this._bounds[3])-h,v=Math.min(Math.ceil(Math.abs(f*t[0]*1.1)),3e3),b=Math.min(Math.ceil(Math.abs(m*t[1]*1.1)),3e3),A=f/v,S=m/b,E={coords:this._coords,colors:this._colors,offsetX:-u,offsetY:-h,scaleX:1/A,scaleY:1/S},T=v+4,C=b+4,L=n.getCanvas("mesh",T,C),k=L.context,V=k.createImageData(v,b);if(e){const G=V.data;for(let I=0,N=G.length;I<N;I+=4)G[I]=e[0],G[I+1]=e[1],G[I+2]=e[2],G[I+3]=255}for(const G of this._figures)XO(V,G,E);return k.putImageData(V,2,2),{canvas:L.canvas,offsetX:u-2*A,offsetY:h-2*S,scaleX:A,scaleY:S}}isModifyingCurrentTransform(){return!0}getPattern(t,e,n,s){Uy(t,this._bbox);const o=new Float32Array(2);if(s===Sn.SHADING)Tt.singularValueDecompose2dScale(Ie(t),o);else if(this.matrix){Tt.singularValueDecompose2dScale(this.matrix,o);const[u,h]=o;Tt.singularValueDecompose2dScale(e.baseTransform,o),o[0]*=u,o[1]*=h}else Tt.singularValueDecompose2dScale(e.baseTransform,o);const l=this._createMeshCanvas(o,s===Sn.SHADING?null:this._background,e.cachedCanvases);return s!==Sn.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(l.offsetX,l.offsetY),t.scale(l.scaleX,l.scaleY),t.createPattern(l.canvas,"no-repeat")}}class JO extends e_{getPattern(){return"hotpink"}}function ZO(i){switch(i[0]){case"RadialAxial":return new YO(i);case"Mesh":return new QO(i);case"Dummy":return new JO}throw new Error(`Unknown IR type: ${i[0]}`)}const C0={COLORED:1,UNCOLORED:2};class n_{static MAX_PATTERN_SIZE=3e3;constructor(t,e,n,s){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=n,this.baseTransform=s}createPatternCanvas(t){const{bbox:e,operatorList:n,paintType:s,tilingType:o,color:l,canvasGraphicsFactory:u}=this;let{xstep:h,ystep:f}=this;h=Math.abs(h),f=Math.abs(f),bp("TilingType: "+o);const m=e[0],v=e[1],b=e[2],A=e[3],S=b-m,E=A-v,T=new Float32Array(2);Tt.singularValueDecompose2dScale(this.matrix,T);const[C,L]=T;Tt.singularValueDecompose2dScale(this.baseTransform,T);const k=C*T[0],V=L*T[1];let P=S,G=E,I=!1,N=!1;const M=Math.ceil(h*k),j=Math.ceil(f*V),F=Math.ceil(S*k),z=Math.ceil(E*V);M>=F?P=h:I=!0,j>=z?G=f:N=!0;const U=this.getSizeAndScale(P,this.ctx.canvas.width,k),st=this.getSizeAndScale(G,this.ctx.canvas.height,V),dt=t.cachedCanvases.getCanvas("pattern",U.size,st.size),$=dt.context,Y=u.createCanvasGraphics($);if(Y.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(Y,s,l),$.translate(-U.scale*m,-st.scale*v),Y.transform(U.scale,0,0,st.scale,0,0),$.save(),this.clipBbox(Y,m,v,b,A),Y.baseTransform=Ie(Y.ctx),Y.executeOperatorList(n),Y.endDrawing(),$.restore(),I||N){const ut=dt.canvas;I&&(P=h),N&&(G=f);const xt=this.getSizeAndScale(P,this.ctx.canvas.width,k),q=this.getSizeAndScale(G,this.ctx.canvas.height,V),it=xt.size,ht=q.size,W=t.cachedCanvases.getCanvas("pattern-workaround",it,ht),ft=W.context,Nt=I?Math.floor(S/h):0,wt=N?Math.floor(E/f):0;for(let Ot=0;Ot<=Nt;Ot++)for(let Qt=0;Qt<=wt;Qt++)ft.drawImage(ut,it*Ot,ht*Qt,it,ht,0,0,it,ht);return{canvas:W.canvas,scaleX:xt.scale,scaleY:q.scale,offsetX:m,offsetY:v}}return{canvas:dt.canvas,scaleX:U.scale,scaleY:st.scale,offsetX:m,offsetY:v}}getSizeAndScale(t,e,n){const s=Math.max(n_.MAX_PATTERN_SIZE,e);let o=Math.ceil(t*n);return o>=s?o=s:n=o/t,{scale:n,size:o}}clipBbox(t,e,n,s,o){const l=s-e,u=o-n;t.ctx.rect(e,n,l,u),Tt.axialAlignedBoundingBox([e,n,s,o],Ie(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,n){const s=t.ctx,o=t.current;switch(e){case C0.COLORED:const{fillStyle:l,strokeStyle:u}=this.ctx;s.fillStyle=o.fillColor=l,s.strokeStyle=o.strokeColor=u;break;case C0.UNCOLORED:s.fillStyle=s.strokeStyle=n,o.fillColor=o.strokeColor=n;break;default:throw new vO(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,n,s){let o=n;s!==Sn.SHADING&&(o=Tt.transform(o,e.baseTransform),this.matrix&&(o=Tt.transform(o,this.matrix)));const l=this.createPatternCanvas(e);let u=new DOMMatrix(o);u=u.translate(l.offsetX,l.offsetY),u=u.scale(1/l.scaleX,1/l.scaleY);const h=t.createPattern(l.canvas,"repeat");return h.setTransform(u),h}}function tj({src:i,srcPos:t=0,dest:e,width:n,height:s,nonBlackColor:o=4294967295,inverseDecode:l=!1}){const u=Tn.isLittleEndian?4278190080:255,[h,f]=l?[o,u]:[u,o],m=n>>3,v=n&7,b=i.length;e=new Uint32Array(e.buffer);let A=0;for(let S=0;S<s;S++){for(const T=t+m;t<T;t++){const C=t<b?i[t]:255;e[A++]=C&128?f:h,e[A++]=C&64?f:h,e[A++]=C&32?f:h,e[A++]=C&16?f:h,e[A++]=C&8?f:h,e[A++]=C&4?f:h,e[A++]=C&2?f:h,e[A++]=C&1?f:h}if(v===0)continue;const E=t<b?i[t++]:255;for(let T=0;T<v;T++)e[A++]=E&1<<7-T?f:h}return{srcPos:t,destPos:A}}const R0=16,I0=100,ej=15,N0=10,Xn=16,ey=new DOMMatrix,fs=new Float32Array(2),Ml=new Float32Array([1/0,1/0,-1/0,-1/0]);function nj(i,t){if(i._removeMirroring)throw new Error("Context is already forwarding operations.");i.__originalSave=i.save,i.__originalRestore=i.restore,i.__originalRotate=i.rotate,i.__originalScale=i.scale,i.__originalTranslate=i.translate,i.__originalTransform=i.transform,i.__originalSetTransform=i.setTransform,i.__originalResetTransform=i.resetTransform,i.__originalClip=i.clip,i.__originalMoveTo=i.moveTo,i.__originalLineTo=i.lineTo,i.__originalBezierCurveTo=i.bezierCurveTo,i.__originalRect=i.rect,i.__originalClosePath=i.closePath,i.__originalBeginPath=i.beginPath,i._removeMirroring=()=>{i.save=i.__originalSave,i.restore=i.__originalRestore,i.rotate=i.__originalRotate,i.scale=i.__originalScale,i.translate=i.__originalTranslate,i.transform=i.__originalTransform,i.setTransform=i.__originalSetTransform,i.resetTransform=i.__originalResetTransform,i.clip=i.__originalClip,i.moveTo=i.__originalMoveTo,i.lineTo=i.__originalLineTo,i.bezierCurveTo=i.__originalBezierCurveTo,i.rect=i.__originalRect,i.closePath=i.__originalClosePath,i.beginPath=i.__originalBeginPath,delete i._removeMirroring},i.save=function(){t.save(),this.__originalSave()},i.restore=function(){t.restore(),this.__originalRestore()},i.translate=function(e,n){t.translate(e,n),this.__originalTranslate(e,n)},i.scale=function(e,n){t.scale(e,n),this.__originalScale(e,n)},i.transform=function(e,n,s,o,l,u){t.transform(e,n,s,o,l,u),this.__originalTransform(e,n,s,o,l,u)},i.setTransform=function(e,n,s,o,l,u){t.setTransform(e,n,s,o,l,u),this.__originalSetTransform(e,n,s,o,l,u)},i.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},i.rotate=function(e){t.rotate(e),this.__originalRotate(e)},i.clip=function(e){t.clip(e),this.__originalClip(e)},i.moveTo=function(e,n){t.moveTo(e,n),this.__originalMoveTo(e,n)},i.lineTo=function(e,n){t.lineTo(e,n),this.__originalLineTo(e,n)},i.bezierCurveTo=function(e,n,s,o,l,u){t.bezierCurveTo(e,n,s,o,l,u),this.__originalBezierCurveTo(e,n,s,o,l,u)},i.rect=function(e,n,s,o){t.rect(e,n,s,o),this.__originalRect(e,n,s,o)},i.closePath=function(){t.closePath(),this.__originalClosePath()},i.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class sj{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,n){let s;return this.cache[t]!==void 0?(s=this.cache[t],this.canvasFactory.reset(s,e,n)):(s=this.canvasFactory.create(e,n),this.cache[t]=s),s}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function tf(i,t,e,n,s,o,l,u,h,f){const[m,v,b,A,S,E]=Ie(i);if(v===0&&b===0){const L=l*m+S,k=Math.round(L),V=u*A+E,P=Math.round(V),G=(l+h)*m+S,I=Math.abs(Math.round(G)-k)||1,N=(u+f)*A+E,M=Math.abs(Math.round(N)-P)||1;return i.setTransform(Math.sign(m),0,0,Math.sign(A),k,P),i.drawImage(t,e,n,s,o,0,0,I,M),i.setTransform(m,v,b,A,S,E),[I,M]}if(m===0&&A===0){const L=u*b+S,k=Math.round(L),V=l*v+E,P=Math.round(V),G=(u+f)*b+S,I=Math.abs(Math.round(G)-k)||1,N=(l+h)*v+E,M=Math.abs(Math.round(N)-P)||1;return i.setTransform(0,Math.sign(v),Math.sign(b),0,k,P),i.drawImage(t,e,n,s,o,0,0,M,I),i.setTransform(m,v,b,A,S,E),[M,I]}i.drawImage(t,e,n,s,o,l,u,h,f);const T=Math.hypot(m,v),C=Math.hypot(b,A);return[T*h,C*f]}class k0{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=Dy;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=Nn.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e){this.clipBox=new Float32Array([0,0,t,e]),this.minMax=Ml.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=Sn.FILL,e=null){const n=this.minMax.slice();if(t===Sn.STROKE){e||ye("Stroke bounding box must include transform."),Tt.singularValueDecompose2dScale(e,fs);const s=fs[0]*this.lineWidth/2,o=fs[1]*this.lineWidth/2;n[0]-=s,n[1]-=o,n[2]+=s,n[3]+=o}return n}updateClipFromPath(){const t=Tt.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(Ml,0)}getClippedPathBoundingBox(t=Sn.FILL,e=null){return Tt.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function M0(i,t){if(t instanceof ImageData){i.putImageData(t,0,0);return}const e=t.height,n=t.width,s=e%Xn,o=(e-s)/Xn,l=s===0?o:o+1,u=i.createImageData(n,Xn);let h=0,f;const m=t.data,v=u.data;let b,A,S,E;if(t.kind===yf.GRAYSCALE_1BPP){const T=m.byteLength,C=new Uint32Array(v.buffer,0,v.byteLength>>2),L=C.length,k=n+7>>3,V=4294967295,P=Tn.isLittleEndian?4278190080:255;for(b=0;b<l;b++){for(S=b<o?Xn:s,f=0,A=0;A<S;A++){const G=T-h;let I=0;const N=G>k?n:G*8-7,M=N&-8;let j=0,F=0;for(;I<M;I+=8)F=m[h++],C[f++]=F&128?V:P,C[f++]=F&64?V:P,C[f++]=F&32?V:P,C[f++]=F&16?V:P,C[f++]=F&8?V:P,C[f++]=F&4?V:P,C[f++]=F&2?V:P,C[f++]=F&1?V:P;for(;I<N;I++)j===0&&(F=m[h++],j=128),C[f++]=F&j?V:P,j>>=1}for(;f<L;)C[f++]=0;i.putImageData(u,0,b*Xn)}}else if(t.kind===yf.RGBA_32BPP){for(A=0,E=n*Xn*4,b=0;b<o;b++)v.set(m.subarray(h,h+E)),h+=E,i.putImageData(u,0,A),A+=Xn;b<l&&(E=n*s*4,v.set(m.subarray(h,h+E)),i.putImageData(u,0,A))}else if(t.kind===yf.RGB_24BPP)for(S=Xn,E=n*S,b=0;b<l;b++){for(b>=o&&(S=s,E=n*S),f=0,A=E;A--;)v[f++]=m[h++],v[f++]=m[h++],v[f++]=m[h++],v[f++]=255;i.putImageData(u,0,b*Xn)}else throw new Error(`bad image kind: ${t.kind}`)}function D0(i,t){if(t.bitmap){i.drawImage(t.bitmap,0,0);return}const e=t.height,n=t.width,s=e%Xn,o=(e-s)/Xn,l=s===0?o:o+1,u=i.createImageData(n,Xn);let h=0;const f=t.data,m=u.data;for(let v=0;v<l;v++){const b=v<o?Xn:s;({srcPos:h}=tj({src:f,srcPos:h,dest:m,width:n,height:b,nonBlackColor:0})),i.putImageData(u,0,v*Xn)}}function pu(i,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of e)i[n]!==void 0&&(t[n]=i[n]);i.setLineDash!==void 0&&(t.setLineDash(i.getLineDash()),t.lineDashOffset=i.lineDashOffset)}function ef(i){i.strokeStyle=i.fillStyle="#000000",i.fillRule="nonzero",i.globalAlpha=1,i.lineWidth=1,i.lineCap="butt",i.lineJoin="miter",i.miterLimit=10,i.globalCompositeOperation="source-over",i.font="10px sans-serif",i.setLineDash!==void 0&&(i.setLineDash([]),i.lineDashOffset=0);const{filter:t}=i;t!=="none"&&t!==""&&(i.filter="none")}function P0(i,t){if(t)return!0;Tt.singularValueDecompose2dScale(i,fs);const e=Math.fround(ki.pixelRatio*Kl.PDF_TO_CSS_UNITS);return fs[0]<=e&&fs[1]<=e}const ij=["butt","round","square"],rj=["miter","round","bevel"],aj={},L0={};class Vl{constructor(t,e,n,s,o,{optionalContentConfig:l,markedContentStack:u=null},h,f){this.ctx=t,this.current=new k0(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=n,this.canvasFactory=s,this.filterFactory=o,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=u||[],this.optionalContentConfig=l,this.cachedCanvases=new sj(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=h,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=f,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing({transform:t,viewport:e,transparency:n=!1,background:s=null}){const o=this.ctx.canvas.width,l=this.ctx.canvas.height,u=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,o,l),this.ctx.fillStyle=u,n){const h=this.cachedCanvases.getCanvas("transparent",o,l);this.compositeCtx=this.ctx,this.transparentCanvas=h.canvas,this.ctx=h.context,this.ctx.save(),this.ctx.transform(...Ie(this.compositeCtx))}this.ctx.save(),ef(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=Ie(this.ctx)}executeOperatorList(t,e,n,s){const o=t.argsArray,l=t.fnArray;let u=e||0;const h=o.length;if(h===u)return u;const f=h-u>N0&&typeof n=="function",m=f?Date.now()+ej:0;let v=0;const b=this.commonObjs,A=this.objs;let S;for(;;){if(s!==void 0&&u===s.nextBreakPoint)return s.breakIt(u,n),u;if(S=l[u],S!==zf.dependency)this[S].apply(this,o[u]);else for(const E of o[u]){const T=E.startsWith("g_")?b:A;if(!T.has(E))return T.get(E,n),u}if(u++,u===h)return u;if(f&&++v>N0){if(Date.now()>m)return n(),u;v=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const n=t.width??t.displayWidth,s=t.height??t.displayHeight;let o=Math.max(Math.hypot(e[0],e[1]),1),l=Math.max(Math.hypot(e[2],e[3]),1),u=n,h=s,f="prescale1",m,v;for(;o>2&&u>1||l>2&&h>1;){let b=u,A=h;o>2&&u>1&&(b=u>=16384?Math.floor(u/2)-1||1:Math.ceil(u/2),o/=u/b),l>2&&h>1&&(A=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h)/2,l/=h/A),m=this.cachedCanvases.getCanvas(f,b,A),v=m.context,v.clearRect(0,0,b,A),v.drawImage(t,0,0,u,h,0,0,b,A),t=m.canvas,u=b,h=A,f=f==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:u,paintHeight:h}}_createMaskCanvas(t){const e=this.ctx,{width:n,height:s}=t,o=this.current.fillColor,l=this.current.patternFill,u=Ie(e);let h,f,m,v;if((t.bitmap||t.data)&&t.count>1){const M=t.bitmap||t.data.buffer;f=JSON.stringify(l?u:[u.slice(0,4),o]),h=this._cachedBitmapsMap.get(M),h||(h=new Map,this._cachedBitmapsMap.set(M,h));const j=h.get(f);if(j&&!l){const F=Math.round(Math.min(u[0],u[2])+u[4]),z=Math.round(Math.min(u[1],u[3])+u[5]);return{canvas:j,offsetX:F,offsetY:z}}m=j}m||(v=this.cachedCanvases.getCanvas("maskCanvas",n,s),D0(v.context,t));let b=Tt.transform(u,[1/n,0,0,-1/s,0,0]);b=Tt.transform(b,[1,0,0,1,0,-s]);const A=Ml.slice();Tt.axialAlignedBoundingBox([0,0,n,s],b,A);const[S,E,T,C]=A,L=Math.round(T-S)||1,k=Math.round(C-E)||1,V=this.cachedCanvases.getCanvas("fillCanvas",L,k),P=V.context,G=S,I=E;P.translate(-G,-I),P.transform(...b),m||(m=this._scaleImage(v.canvas,_i(P)),m=m.img,h&&l&&h.set(f,m)),P.imageSmoothingEnabled=P0(Ie(P),t.interpolate),tf(P,m,0,0,m.width,m.height,0,0,n,s),P.globalCompositeOperation="source-in";const N=Tt.transform(_i(P),[1,0,0,1,-G,-I]);return P.fillStyle=l?o.getPattern(e,this,N,Sn.FILL):o,P.fillRect(0,0,n,s),h&&!l&&(this.cachedCanvases.delete("fillCanvas"),h.set(f,V.canvas)),{canvas:V.canvas,offsetX:Math.round(G),offsetY:Math.round(I)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=ij[t]}setLineJoin(t){this.ctx.lineJoin=rj[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){const n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(t),n.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[e,n]of t)switch(e){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,e=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(n,t,e);this.suspendedCtx=this.ctx;const o=this.ctx=s.context;o.setTransform(this.suspendedCtx.getTransform()),pu(this.suspendedCtx,o),nj(o,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),pu(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,n,s){const o=s[0],l=s[1],u=s[2]-o,h=s[3]-l;u===0||h===0||(this.genericComposeSMask(e.context,n,u,h,e.subtype,e.backdrop,e.transferMap,o,l,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(n.canvas,0,0),t.restore())}genericComposeSMask(t,e,n,s,o,l,u,h,f,m,v){let b=t.canvas,A=h-m,S=f-v;if(l)if(A<0||S<0||A+n>b.width||S+s>b.height){const T=this.cachedCanvases.getCanvas("maskExtension",n,s),C=T.context;C.drawImage(b,-A,-S),C.globalCompositeOperation="destination-atop",C.fillStyle=l,C.fillRect(0,0,n,s),C.globalCompositeOperation="source-over",b=T.canvas,A=S=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const T=new Path2D;T.rect(A,S,n,s),t.clip(T),t.globalCompositeOperation="destination-atop",t.fillStyle=l,t.fillRect(A,S,n,s),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),o==="Alpha"&&u?e.filter=this.filterFactory.addAlphaFilter(u):o==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(u));const E=new Path2D;E.rect(h,f,n,s),e.clip(E),e.globalCompositeOperation="destination-in",e.drawImage(b,A,S,n,s,h,f,n,s),e.restore()}save(){this.inSMaskMode&&pu(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){if(this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&pu(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,n,s,o,l){this.ctx.transform(t,e,n,s,o,l),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,n){let[s]=e;if(!n){s||=e[0]=new Path2D,this[t](s);return}if(!(s instanceof Path2D)){const o=e[0]=new Path2D;for(let l=0,u=s.length;l<u;)switch(s[l++]){case Xd.moveTo:o.moveTo(s[l++],s[l++]);break;case Xd.lineTo:o.lineTo(s[l++],s[l++]);break;case Xd.curveTo:o.bezierCurveTo(s[l++],s[l++],s[l++],s[l++],s[l++],s[l++]);break;case Xd.closePath:o.closePath();break;default:Ut(`Unrecognized drawing path operator: ${s[l-1]}`);break}s=o}Tt.axialAlignedBoundingBox(n,Ie(this.ctx),this.current.minMax),this[t](s)}closePath(){this.ctx.closePath()}stroke(t,e=!0){const n=this.ctx,s=this.current.strokeColor;if(n.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof s=="object"&&s?.getPattern){const o=s.isModifyingCurrentTransform()?n.getTransform():null;if(n.save(),n.strokeStyle=s.getPattern(n,this,_i(n),Sn.STROKE),o){const l=new Path2D;l.addPath(t,n.getTransform().invertSelf().multiplySelf(o)),t=l}this.rescaleAndStroke(t,!1),n.restore()}else this.rescaleAndStroke(t,!0);e&&this.consumePath(t,this.current.getClippedPathBoundingBox(Sn.STROKE,Ie(this.ctx))),n.globalAlpha=this.current.fillAlpha}closeStroke(t){this.stroke(t)}fill(t,e=!0){const n=this.ctx,s=this.current.fillColor,o=this.current.patternFill;let l=!1;if(o){const h=s.isModifyingCurrentTransform()?n.getTransform():null;if(n.save(),n.fillStyle=s.getPattern(n,this,_i(n),Sn.FILL),h){const f=new Path2D;f.addPath(t,n.getTransform().invertSelf().multiplySelf(h)),t=f}l=!0}const u=this.current.getClippedPathBoundingBox();this.contentVisible&&u!==null&&(this.pendingEOFill?(n.fill(t,"evenodd"),this.pendingEOFill=!1):n.fill(t)),l&&n.restore(),e&&this.consumePath(t,u)}eoFill(t){this.pendingEOFill=!0,this.fill(t)}fillStroke(t){this.fill(t,!1),this.stroke(t,!1),this.consumePath(t)}eoFillStroke(t){this.pendingEOFill=!0,this.fillStroke(t)}closeFillStroke(t){this.fillStroke(t)}closeEOFillStroke(t){this.pendingEOFill=!0,this.fillStroke(t)}endPath(t){this.consumePath(t)}rawFillPath(t){this.ctx.fill(t)}clip(){this.pendingClip=aj}eoClip(){this.pendingClip=L0}beginText(){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const t=this.pendingTextPaths,e=this.ctx;if(t===void 0)return;const n=new Path2D,s=e.getTransform().invertSelf();for(const{transform:o,x:l,y:u,fontSize:h,path:f}of t)f&&n.addPath(f,new DOMMatrix(o).preMultiplySelf(s).translate(l,u).scale(h,-h));e.clip(n),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){const n=this.commonObjs.get(t),s=this.current;if(!n)throw new Error(`Can't find font for ${t}`);if(s.fontMatrix=n.fontMatrix||Dy,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&Ut("Invalid font matrix for font "+t),e<0?(e=-e,s.fontDirection=-1):s.fontDirection=1,this.current.font=n,this.current.fontSize=e,n.isType3Font)return;const o=n.loadedName||"sans-serif",l=n.systemFontInfo?.css||`"${o}", ${n.fallbackName}`;let u="normal";n.black?u="900":n.bold&&(u="bold");const h=n.italic?"italic":"normal";let f=e;e<R0?f=R0:e>I0&&(f=I0),this.current.fontSizeScale=e/f,this.ctx.font=`${h} ${u} ${f}px ${l}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t){const{current:e}=this;e.textMatrix=t,e.textMatrixScale=Math.hypot(t[0],t[1]),e.x=e.lineX=0,e.y=e.lineY=0}nextLine(){this.moveText(0,this.current.leading)}#n(t,e,n){const s=new Path2D;return s.addPath(t,new DOMMatrix(n).invertSelf().multiplySelf(e)),s}paintChar(t,e,n,s,o){const l=this.ctx,u=this.current,h=u.font,f=u.textRenderingMode,m=u.fontSize/u.fontSizeScale,v=f&Nn.FILL_STROKE_MASK,b=!!(f&Nn.ADD_TO_PATH_FLAG),A=u.patternFill&&!h.missingFile,S=u.patternStroke&&!h.missingFile;let E;if((h.disableFontFace||b||A||S)&&!h.missingFile&&(E=h.getPathGenerator(this.commonObjs,t)),E&&(h.disableFontFace||A||S)){l.save(),l.translate(e,n),l.scale(m,-m);let T;if((v===Nn.FILL||v===Nn.FILL_STROKE)&&(s?(T=l.getTransform(),l.setTransform(...s),l.fill(this.#n(E,T,s))):l.fill(E)),v===Nn.STROKE||v===Nn.FILL_STROKE)if(o){T||=l.getTransform(),l.setTransform(...o);const{a:C,b:L,c:k,d:V}=T,P=Tt.inverseTransform(o),G=Tt.transform([C,L,k,V,0,0],P);Tt.singularValueDecompose2dScale(G,fs),l.lineWidth*=Math.max(fs[0],fs[1])/m,l.stroke(this.#n(E,T,o))}else l.lineWidth/=m,l.stroke(E);l.restore()}else(v===Nn.FILL||v===Nn.FILL_STROKE)&&l.fillText(t,e,n),(v===Nn.STROKE||v===Nn.FILL_STROKE)&&l.strokeText(t,e,n);b&&(this.pendingTextPaths||=[]).push({transform:Ie(l),x:e,y:n,fontSize:m,path:E})}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let n=!1;for(let s=3;s<e.length;s+=4)if(e[s]>0&&e[s]<255){n=!0;break}return Gt(this,"isFontSubpixelAAEnabled",n)}showText(t){const e=this.current,n=e.font;if(n.isType3Font)return this.showType3Text(t);const s=e.fontSize;if(s===0)return;const o=this.ctx,l=e.fontSizeScale,u=e.charSpacing,h=e.wordSpacing,f=e.fontDirection,m=e.textHScale*f,v=t.length,b=n.vertical,A=b?1:-1,S=n.defaultVMetrics,E=s*e.fontMatrix[0],T=e.textRenderingMode===Nn.FILL&&!n.disableFontFace&&!e.patternFill;o.save(),e.textMatrix&&o.transform(...e.textMatrix),o.translate(e.x,e.y+e.textRise),f>0?o.scale(m,-1):o.scale(m,1);let C,L;if(e.patternFill){o.save();const I=e.fillColor.getPattern(o,this,_i(o),Sn.FILL);C=Ie(o),o.restore(),o.fillStyle=I}if(e.patternStroke){o.save();const I=e.strokeColor.getPattern(o,this,_i(o),Sn.STROKE);L=Ie(o),o.restore(),o.strokeStyle=I}let k=e.lineWidth;const V=e.textMatrixScale;if(V===0||k===0){const I=e.textRenderingMode&Nn.FILL_STROKE_MASK;(I===Nn.STROKE||I===Nn.FILL_STROKE)&&(k=this.getSinglePixelWidth())}else k/=V;if(l!==1&&(o.scale(l,l),k/=l),o.lineWidth=k,n.isInvalidPDFjsFont){const I=[];let N=0;for(const M of t)I.push(M.unicode),N+=M.width;o.fillText(I.join(""),0,0),e.x+=N*E*m,o.restore(),this.compose();return}let P=0,G;for(G=0;G<v;++G){const I=t[G];if(typeof I=="number"){P+=A*I*s/1e3;continue}let N=!1;const M=(I.isSpace?h:0)+u,j=I.fontChar,F=I.accent;let z,U,st=I.width;if(b){const $=I.vmetric||S,Y=-(I.vmetric?$[1]:st*.5)*E,ut=$[2]*E;st=$?-$[0]:st,z=Y/l,U=(P+ut)/l}else z=P/l,U=0;if(n.remeasure&&st>0){const $=o.measureText(j).width*1e3/s*l;if(st<$&&this.isFontSubpixelAAEnabled){const Y=st/$;N=!0,o.save(),o.scale(Y,1),z/=Y}else st!==$&&(z+=(st-$)/2e3*s/l)}if(this.contentVisible&&(I.isInFont||n.missingFile)){if(T&&!F)o.fillText(j,z,U);else if(this.paintChar(j,z,U,C,L),F){const $=z+s*F.offset.x/l,Y=U-s*F.offset.y/l;this.paintChar(F.fontChar,$,Y,C,L)}}const dt=b?st*E-M*f:st*E+M*f;P+=dt,N&&o.restore()}b?e.y-=P:e.x+=P*m,o.restore(),this.compose()}showType3Text(t){const e=this.ctx,n=this.current,s=n.font,o=n.fontSize,l=n.fontDirection,u=s.vertical?1:-1,h=n.charSpacing,f=n.wordSpacing,m=n.textHScale*l,v=n.fontMatrix||Dy,b=t.length,A=n.textRenderingMode===Nn.INVISIBLE;let S,E,T,C;if(!(A||o===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),n.textMatrix&&e.transform(...n.textMatrix),e.translate(n.x,n.y+n.textRise),e.scale(m,l),S=0;S<b;++S){if(E=t[S],typeof E=="number"){C=u*E*o/1e3,this.ctx.translate(C,0),n.x+=C*m;continue}const L=(E.isSpace?f:0)+h,k=s.charProcOperatorList[E.operatorListId];k?this.contentVisible&&(this.save(),e.scale(o,o),e.transform(...v),this.executeOperatorList(k),this.restore()):Ut(`Type3 character "${E.operatorListId}" is not available.`);const V=[E.width,0];Tt.applyTransform(V,v),T=V[0]*o+L,e.translate(T,0),n.x+=T*m}e.restore()}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,n,s,o,l){const u=new Path2D;u.rect(n,s,o-n,l-s),this.ctx.clip(u),this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){const n=this.baseTransform||Ie(this.ctx),s={createCanvasGraphics:o=>new Vl(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new n_(t,this.ctx,s,n)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t){this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t){this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let n;return this.cachedPatterns.has(t)?n=this.cachedPatterns.get(t):(n=ZO(this.getObject(t)),this.cachedPatterns.set(t,n)),e&&(n.matrix=e),n}shadingFill(t){if(!this.contentVisible)return;const e=this.ctx;this.save();const n=this._getPattern(t);e.fillStyle=n.getPattern(e,this,_i(e),Sn.SHADING);const s=_i(e);if(s){const{width:o,height:l}=e.canvas,u=Ml.slice();Tt.axialAlignedBoundingBox([0,0,o,l],s,u);const[h,f,m,v]=u;this.ctx.fillRect(h,f,m-h,v-f)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){ye("Should not call beginInlineImage")}beginImageData(){ye("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=Ie(this.ctx),e)){Tt.axialAlignedBoundingBox(e,this.baseTransform,this.current.minMax);const[n,s,o,l]=e,u=new Path2D;u.rect(n,s,o-n,l-s),this.ctx.clip(u),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const e=this.ctx;t.isolated||bp("TODO: Support non-isolated groups."),t.knockout&&Ut("Knockout groups not supported.");const n=Ie(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let s=Ml.slice();Tt.axialAlignedBoundingBox(t.bbox,Ie(e),s);const o=[0,0,e.canvas.width,e.canvas.height];s=Tt.intersect(s,o)||[0,0,0,0];const l=Math.floor(s[0]),u=Math.floor(s[1]),h=Math.max(Math.ceil(s[2])-l,1),f=Math.max(Math.ceil(s[3])-u,1);this.current.startNewPathAndClipBox([0,0,h,f]);let m="groupAt"+this.groupLevel;t.smask&&(m+="_smask_"+this.smaskCounter++%2);const v=this.cachedCanvases.getCanvas(m,h,f),b=v.context;b.translate(-l,-u),b.transform(...n);let A=new Path2D;const[S,E,T,C]=t.bbox;if(A.rect(S,E,T-S,C-E),t.matrix){const L=new Path2D;L.addPath(A,new DOMMatrix(t.matrix)),A=L}b.clip(A),t.smask?this.smaskStack.push({canvas:v.canvas,context:b,offsetX:l,offsetY:u,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(l,u),e.save()),pu(e,b),this.ctx=b,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;const e=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const s=Ie(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);const o=Ml.slice();Tt.axialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],s,o),this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(o)}}beginAnnotation(t,e,n,s,o){if(this.#t(),ef(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){const l=e[2]-e[0],u=e[3]-e[1];if(o&&this.annotationCanvasMap){n=n.slice(),n[4]-=e[0],n[5]-=e[1],e=e.slice(),e[0]=e[1]=0,e[2]=l,e[3]=u,Tt.singularValueDecompose2dScale(Ie(this.ctx),fs);const{viewportScale:h}=this,f=Math.ceil(l*this.outputScaleX*h),m=Math.ceil(u*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(f,m);const{canvas:v,context:b}=this.annotationCanvas;this.annotationCanvasMap.set(t,v),this.annotationCanvas.savedCtx=this.ctx,this.ctx=b,this.ctx.save(),this.ctx.setTransform(fs[0],0,0,-fs[1],0,u*fs[1]),ef(this.ctx)}else{ef(this.ctx),this.endPath();const h=new Path2D;h.rect(e[0],e[1],l,u),this.ctx.clip(h)}}this.current=new k0(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;const e=t.count;t=this.getObject(t.data,t),t.count=e;const n=this.ctx,s=this._createMaskCanvas(t),o=s.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(o,s.offsetX,s.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,n=0,s=0,o,l){if(!this.contentVisible)return;t=this.getObject(t.data,t);const u=this.ctx;u.save();const h=Ie(u);u.transform(e,n,s,o,0,0);const f=this._createMaskCanvas(t);u.setTransform(1,0,0,1,f.offsetX-h[4],f.offsetY-h[5]);for(let m=0,v=l.length;m<v;m+=2){const b=Tt.transform(h,[e,n,s,o,l[m],l[m+1]]);u.drawImage(f.canvas,b[4],b[5])}u.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;const e=this.ctx,n=this.current.fillColor,s=this.current.patternFill;for(const o of t){const{data:l,width:u,height:h,transform:f}=o,m=this.cachedCanvases.getCanvas("maskCanvas",u,h),v=m.context;v.save();const b=this.getObject(l,o);D0(v,b),v.globalCompositeOperation="source-in",v.fillStyle=s?n.getPattern(v,this,_i(e),Sn.FILL):n,v.fillRect(0,0,u,h),v.restore(),e.save(),e.transform(...f),e.scale(1,-1),tf(e,m.canvas,0,0,u,h,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;const e=this.getObject(t);if(!e){Ut("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,n,s){if(!this.contentVisible)return;const o=this.getObject(t);if(!o){Ut("Dependent image isn't ready yet");return}const l=o.width,u=o.height,h=[];for(let f=0,m=s.length;f<m;f+=2)h.push({transform:[e,0,0,n,s[f],s[f+1]],x:0,y:0,w:l,h:u});this.paintInlineImageXObjectGroup(o,h)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:n,height:s}=t,o=this.cachedCanvases.getCanvas("inlineImage",n,s),l=o.context;return l.filter=this.current.transferMaps,l.drawImage(e,0,0),l.filter="none",o.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;const e=t.width,n=t.height,s=this.ctx;this.save();const{filter:o}=s;o!=="none"&&o!==""&&(s.filter="none"),s.scale(1/e,-1/n);let l;if(t.bitmap)l=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)l=t;else{const f=this.cachedCanvases.getCanvas("inlineImage",e,n).context;M0(f,t),l=this.applyTransferMapsToCanvas(f)}const u=this._scaleImage(l,_i(s));s.imageSmoothingEnabled=P0(Ie(s),t.interpolate),tf(s,u.img,0,0,u.paintWidth,u.paintHeight,0,-n,e,n),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;const n=this.ctx;let s;if(t.bitmap)s=t.bitmap;else{const o=t.width,l=t.height,h=this.cachedCanvases.getCanvas("inlineImage",o,l).context;M0(h,t),s=this.applyTransferMapsToCanvas(h)}for(const o of e)n.save(),n.transform(...o.transform),n.scale(1,-1),tf(n,s,o.x,o.y,o.w,o.h,0,-1,1,1),n.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t,e){const n=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const s=this.ctx;this.pendingClip&&(n||(this.pendingClip===L0?s.clip(t,"evenodd"):s.clip(t)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=Ie(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),n=Math.hypot(t[0],t[2]),s=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(n,s)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:n,c:s,d:o}=this.ctx.getTransform();let l,u;if(n===0&&s===0){const h=Math.abs(e),f=Math.abs(o);if(h===f)if(t===0)l=u=1/h;else{const m=h*t;l=u=m<1?1/m:1}else if(t===0)l=1/h,u=1/f;else{const m=h*t,v=f*t;l=m<1?1/m:1,u=v<1?1/v:1}}else{const h=Math.abs(e*o-n*s),f=Math.hypot(e,n),m=Math.hypot(s,o);if(t===0)l=m/h,u=f/h;else{const v=t*h;l=m>v?m/v:1,u=f>v?f/v:1}}this._cachedScaleForStroking[0]=l,this._cachedScaleForStroking[1]=u}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:n,current:{lineWidth:s}}=this,[o,l]=this.getScaleForStroking();if(o===l){n.lineWidth=(s||1)*o,n.stroke(t);return}const u=n.getLineDash();e&&n.save(),n.scale(o,l),ey.a=1/o,ey.d=1/l;const h=new Path2D;if(h.addPath(t,ey),u.length>0){const f=Math.max(o,l);n.setLineDash(u.map(m=>m/f)),n.lineDashOffset/=f}n.lineWidth=s||1,n.stroke(h),e&&n.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const i in zf)Vl.prototype[i]!==void 0&&(Vl.prototype[zf[i]]=Vl.prototype[i]);class Ul{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class oj{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}[Symbol.iterator](){return this.#t.entries()}}const Rl=Symbol("INTERNAL");class lj{#t=!1;#e=!1;#n=!1;#s=!0;constructor(t,{name:e,intent:n,usage:s,rbGroups:o}){this.#t=!!(t&ds.DISPLAY),this.#e=!!(t&ds.PRINT),this.name=e,this.intent=n,this.usage=s,this.rbGroups=o}get visible(){if(this.#n)return this.#s;if(!this.#s)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,n=!1){t!==Rl&&ye("Internal method `_setVisible` called."),this.#n=n,this.#s=e}}class cj{#t=null;#e=new Map;#n=null;#s=null;constructor(t,e=ds.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#s=t.order;for(const n of t.groups)this.#e.set(n.id,new lj(e,n));if(t.baseState==="OFF")for(const n of this.#e.values())n._setVisible(Rl,!1);for(const n of t.on)this.#e.get(n)._setVisible(Rl,!0);for(const n of t.off)this.#e.get(n)._setVisible(Rl,!1);this.#n=this.getHash()}}#r(t){const e=t.length;if(e<2)return!0;const n=t[0];for(let s=1;s<e;s++){const o=t[s];let l;if(Array.isArray(o))l=this.#r(o);else if(this.#e.has(o))l=this.#e.get(o).visible;else return Ut(`Optional content group not found: ${o}`),!0;switch(n){case"And":if(!l)return!1;break;case"Or":if(l)return!0;break;case"Not":return!l;default:return!0}}return n==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return bp("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(Ut(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#r(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return Ut(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return Ut(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return Ut(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return Ut(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return Ut(`Unknown optional content policy ${t.policy}.`),!0}return Ut(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,n=!0){const s=this.#e.get(t);if(!s){Ut(`Optional content group not found: ${t}`);return}if(n&&e&&s.rbGroups.length)for(const o of s.rbGroups)for(const l of o)l!==t&&this.#e.get(l)?._setVisible(Rl,!1,!0);s._setVisible(Rl,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let n;for(const s of t){switch(s){case"ON":case"OFF":case"Toggle":n=s;continue}const o=this.#e.get(s);if(o)switch(n){case"ON":this.setVisibility(s,!0,e);break;case"OFF":this.setVisibility(s,!1,e);break;case"Toggle":this.setVisibility(s,!o.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#n===null||this.getHash()===this.#n}getOrder(){return this.#e.size?this.#s?this.#s.slice():[...this.#e.keys()]:null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new zx;for(const[e,n]of this.#e)t.update(`${e}:${n.visible}`);return this.#t=t.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class uj{constructor(t,{disableRange:e=!1,disableStream:n=!1}){Ze(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:o,progressiveDone:l,contentDispositionFilename:u}=t;if(this._queuedChunks=[],this._progressiveDone=l,this._contentDispositionFilename=u,o?.length>0){const h=o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer;this._queuedChunks.push(h)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!n,this._isRangeSupported=!e,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((h,f)=>{this._onReceiveData({begin:h,chunk:f})}),t.addProgressListener((h,f)=>{this._onProgress({loaded:h,total:f})}),t.addProgressiveReadListener(h=>{this._onReceiveData({chunk:h})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const n=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const s=this._rangeReaders.some(function(o){return o._begin!==t?!1:(o._enqueue(n),!0)});Ze(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){Ze(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new hj(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new dj(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class hj{constructor(t,e,n=!1,s=null){this._stream=t,this._done=n||!1,this._filename=Xv(s)?s:null,this._queuedChunks=e||[],this._loaded=0;for(const o of this._queuedChunks)this._loaded+=o.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class dj{constructor(t,e,n){this._stream=t,this._begin=e,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function fj(i){let t=!0,e=n("filename\\*","i").exec(i);if(e){e=e[1];let m=u(e);return m=unescape(m),m=h(m),m=f(m),o(m)}if(e=l(i),e){const m=f(e);return o(m)}if(e=n("filename","i").exec(i),e){e=e[1];let m=u(e);return m=f(m),o(m)}function n(m,v){return new RegExp("(?:^|;)\\s*"+m+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',v)}function s(m,v){if(m){if(!/^[\x00-\xFF]+$/.test(v))return v;try{const b=new TextDecoder(m,{fatal:!0}),A=fh(v);v=b.decode(A),t=!1}catch{}}return v}function o(m){return t&&/[\x80-\xff]/.test(m)&&(m=s("utf-8",m),t&&(m=s("iso-8859-1",m))),m}function l(m){const v=[];let b;const A=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(b=A.exec(m))!==null;){let[,E,T,C]=b;if(E=parseInt(E,10),E in v){if(E===0)break;continue}v[E]=[T,C]}const S=[];for(let E=0;E<v.length&&E in v;++E){let[T,C]=v[E];C=u(C),T&&(C=unescape(C),E===0&&(C=h(C))),S.push(C)}return S.join("")}function u(m){if(m.startsWith('"')){const v=m.slice(1).split('\\"');for(let b=0;b<v.length;++b){const A=v[b].indexOf('"');A!==-1&&(v[b]=v[b].slice(0,A),v.length=b+1),v[b]=v[b].replaceAll(/\\(.)/g,"$1")}m=v.join('"')}return m}function h(m){const v=m.indexOf("'");if(v===-1)return m;const b=m.slice(0,v),S=m.slice(v+1).replace(/^[^']*'/,"");return s(b,S)}function f(m){return!m.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(m)?m:m.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(v,b,A,S){if(A==="q"||A==="Q")return S=S.replaceAll("_"," "),S=S.replaceAll(/=([0-9a-fA-F]{2})/g,function(E,T){return String.fromCharCode(parseInt(T,16))}),s(b,S);try{S=atob(S)}catch{}return s(b,S)})}return""}function Yx(i,t){const e=new Headers;if(!i||!t||typeof t!="object")return e;for(const n in t){const s=t[n];s!==void 0&&e.append(n,s)}return e}function Sp(i){return URL.parse(i)?.origin??null}function Xx({responseHeaders:i,isHttp:t,rangeChunkSize:e,disableRange:n}){const s={allowRangeRequests:!1,suggestedLength:void 0},o=parseInt(i.get("Content-Length"),10);return!Number.isInteger(o)||(s.suggestedLength=o,o<=2*e)||n||!t||i.get("Accept-Ranges")!=="bytes"||(i.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function Qx(i){const t=i.get("Content-Disposition");if(t){let e=fj(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Xv(e))return e}return null}function yh(i,t){return new Hf(`Unexpected server response (${i}) while retrieving PDF "${t}".`,i,i===404||i===0&&t.startsWith("file:"))}function Jx(i){return i===200||i===206}function Zx(i,t,e){return{method:"GET",headers:i,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function t1(i){return i instanceof Uint8Array?i.buffer:i instanceof ArrayBuffer?i:(Ut(`getArrayBuffer - unexpected data format: ${i}`),new Uint8Array(i).buffer)}class pj{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=Yx(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Ze(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new mj(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new gj(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class mj{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const n=new Headers(t.headers),s=e.url;fetch(s,Zx(n,this._withCredentials,this._abortController)).then(o=>{if(t._responseOrigin=Sp(o.url),!Jx(o.status))throw yh(o.status,s);this._reader=o.body.getReader(),this._headersCapability.resolve();const l=o.headers,{allowRangeRequests:u,suggestedLength:h}=Xx({responseHeaders:l,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=u,this._contentLength=h||this._contentLength,this._filename=Qx(l),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new ga("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:t1(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class gj{constructor(t,e,n){this._stream=t,this._reader=null,this._loaded=0;const s=t.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const o=new Headers(t.headers);o.append("Range",`bytes=${e}-${n-1}`);const l=s.url;fetch(l,Zx(o,this._withCredentials,this._abortController)).then(u=>{const h=Sp(u.url);if(h!==t._responseOrigin)throw new Error(`Expected range response-origin "${h}" to match "${t._responseOrigin}".`);if(!Jx(u.status))throw yh(u.status,l);this._readCapability.resolve(),this._reader=u.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:t1(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const ny=200,sy=206;function yj(i){const t=i.response;return typeof t!="string"?t:fh(t).buffer}class vj{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:n}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=Yx(this.isHttp,e),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,n=this.currXhrId++,s=this.pendingRequests[n]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[o,l]of this.headers)e.setRequestHeader(o,l);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),s.expectedStatus=sy):s.expectedStatus=ny,e.responseType="arraybuffer",Ze(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,n),e.onprogress=this.onProgress.bind(this,n),s.onHeadersReceived=t.onHeadersReceived,s.onDone=t.onDone,s.onError=t.onError,s.onProgress=t.onProgress,e.send(null),n}onProgress(t,e){const n=this.pendingRequests[t];n&&n.onProgress?.(e)}onStateChange(t,e){const n=this.pendingRequests[t];if(!n)return;const s=n.xhr;if(s.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),s.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],s.status===0&&this.isHttp){n.onError(s.status);return}const o=s.status||ny;if(!(o===ny&&n.expectedStatus===sy)&&o!==n.expectedStatus){n.onError(s.status);return}const u=yj(s);if(o===sy){const h=s.getResponseHeader("Content-Range"),f=/bytes (\d+)-(\d+)\/(\d+)/.exec(h);f?n.onDone({begin:parseInt(f[1],10),chunk:u}):(Ut('Missing or invalid "Content-Range" header.'),n.onError(0))}else u?n.onDone({begin:0,chunk:u}):n.onError(s.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class _j{constructor(t){this._source=t,this._manager=new vj(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return Ze(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new bj(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const n=new Aj(this._manager,t,e);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class bj{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=Sp(e.responseURL);const n=e.getAllResponseHeaders(),s=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(u=>{const[h,...f]=u.split(": ");return[h,f.join(": ")]}):[]),{allowRangeRequests:o,suggestedLength:l}=Xx({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});o&&(this._isRangeSupported=!0),this._contentLength=l||this._contentLength,this._filename=Qx(s),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=yh(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Aj{constructor(t,e,n){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=Sp(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=yh(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const wj=/^[a-z][a-z0-9\-+.]+:/i;function Ej(i){if(wj.test(i))return new URL(i);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(i))}class Sj{constructor(t){this.source=t,this.url=Ej(t.url),Ze(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Ze(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Tj(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const n=new xj(this,t,e);return this._rangeRequestReaders.push(n),n}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Tj{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=yh(0,this._url.href)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new ga("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class xj{constructor(t,e,n){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const s=t.source;this._isStreamingSupported=!s.disableStream;const o=process.getBuiltinModule("fs");this._setReadableStream(o.createReadStream(this._url,{start:e,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const mu=Symbol("INITIAL_DATA");class e1{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:mu}}get(t,e=null){if(e){const s=this.#e(t);return s.promise.then(()=>e(s.data)),null}const n=this.#t[t];if(!n||n.data===mu)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return n.data}has(t){const e=this.#t[t];return!!e&&e.data!==mu}delete(t){const e=this.#t[t];return!e||e.data===mu?!1:(delete this.#t[t],!0)}resolve(t,e=null){const n=this.#e(t);n.data=e,n.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==mu&&(yield[t,e])}}}const Cj=1e5,O0=30;class Un{#t=Promise.withResolvers();#e=null;#n=!1;#s=!!globalThis.FontInspector?.enabled;#r=null;#i=null;#a=0;#o=0;#u=null;#c=null;#d=0;#l=0;#p=Object.create(null);#g=[];#f=null;#h=[];#m=new WeakMap;#_=null;static#y=new Map;static#A=new Map;static#w=new WeakMap;static#v=null;static#S=new Set;constructor({textContentSource:t,container:e,viewport:n}){if(t instanceof ReadableStream)this.#f=t;else if(typeof t=="object")this.#f=new ReadableStream({start(h){h.enqueue(t),h.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#c=e,this.#l=n.scale*ki.pixelRatio,this.#d=n.rotation,this.#i={div:null,properties:null,ctx:null};const{pageWidth:s,pageHeight:o,pageX:l,pageY:u}=n.rawDims;this.#_=[1,0,0,-1,-l,u+o],this.#o=s,this.#a=o,Un.#x(),Ao(e,n),this.#t.promise.finally(()=>{Un.#S.delete(this),this.#i=null,this.#p=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=Tn.platform;return Gt(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#u.read().then(({value:e,done:n})=>{if(n){this.#t.resolve();return}this.#r??=e.lang,Object.assign(this.#p,e.styles),this.#I(e.items),t()},this.#t.reject)};return this.#u=this.#f.getReader(),Un.#S.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const n=t.scale*ki.pixelRatio,s=t.rotation;if(s!==this.#d&&(e?.(),this.#d=s,Ao(this.#c,{rotation:s})),n!==this.#l){e?.(),this.#l=n;const o={div:null,properties:null,ctx:Un.#R(this.#r)};for(const l of this.#h)o.properties=this.#m.get(l),o.div=l,this.#N(o)}}cancel(){const t=new ga("TextLayer task cancelled.");this.#u?.cancel(t).catch(()=>{}),this.#u=null,this.#t.reject(t)}get textDivs(){return this.#h}get textContentItemsStr(){return this.#g}#I(t){if(this.#n)return;this.#i.ctx??=Un.#R(this.#r);const e=this.#h,n=this.#g;for(const s of t){if(e.length>Cj){Ut("Ignoring additional textDivs for performance reasons."),this.#n=!0;return}if(s.str===void 0){if(s.type==="beginMarkedContentProps"||s.type==="beginMarkedContent"){const o=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),s.id&&this.#e.setAttribute("id",`${s.id}`),o.append(this.#e)}else s.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}n.push(s.str),this.#E(s)}}#E(t){const e=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#h.push(e);const s=Tt.transform(this.#_,t.transform);let o=Math.atan2(s[1],s[0]);const l=this.#p[t.fontName];l.vertical&&(o+=Math.PI/2);let u=this.#s&&l.fontSubstitution||l.fontFamily;u=Un.fontFamilyMap.get(u)||u;const h=Math.hypot(s[2],s[3]),f=h*Un.#M(u,l,this.#r);let m,v;o===0?(m=s[4],v=s[5]-f):(m=s[4]+f*Math.sin(o),v=s[5]-f*Math.cos(o));const b="calc(var(--total-scale-factor) *",A=e.style;this.#e===this.#c?(A.left=`${(100*m/this.#o).toFixed(2)}%`,A.top=`${(100*v/this.#a).toFixed(2)}%`):(A.left=`${b}${m.toFixed(2)}px)`,A.top=`${b}${v.toFixed(2)}px)`),A.fontSize=`${b}${(Un.#v*h).toFixed(2)}px)`,A.fontFamily=u,n.fontSize=h,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#s&&(e.dataset.fontName=l.fontSubstitutionLoadedName||t.fontName),o!==0&&(n.angle=o*(180/Math.PI));let S=!1;if(t.str.length>1)S=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const E=Math.abs(t.transform[0]),T=Math.abs(t.transform[3]);E!==T&&Math.max(E,T)/Math.min(E,T)>1.5&&(S=!0)}if(S&&(n.canvasWidth=l.vertical?t.height:t.width),this.#m.set(e,n),this.#i.div=e,this.#i.properties=n,this.#N(this.#i),n.hasText&&this.#e.append(e),n.hasEOL){const E=document.createElement("br");E.setAttribute("role","presentation"),this.#e.append(E)}}#N(t){const{div:e,properties:n,ctx:s}=t,{style:o}=e;let l="";if(Un.#v>1&&(l=`scale(${1/Un.#v})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:u}=o,{canvasWidth:h,fontSize:f}=n;Un.#C(s,f*this.#l,u);const{width:m}=s.measureText(e.textContent);m>0&&(l=`scaleX(${h*this.#l/m}) ${l}`)}n.angle!==0&&(l=`rotate(${n.angle}deg) ${l}`),l.length>0&&(o.transform=l)}static cleanup(){if(!(this.#S.size>0)){this.#y.clear();for(const{canvas:t}of this.#A.values())t.remove();this.#A.clear()}}static#R(t=null){let e=this.#A.get(t||="");if(!e){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=t,document.body.append(n),e=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#A.set(t,e),this.#w.set(e,{size:0,family:""})}return e}static#C(t,e,n){const s=this.#w.get(t);e===s.size&&n===s.family||(t.font=`${e}px ${n}`,s.size=e,s.family=n)}static#x(){if(this.#v!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#v=t.getBoundingClientRect().height,t.remove()}static#M(t,e,n){const s=this.#y.get(t);if(s)return s;const o=this.#R(n);o.canvas.width=o.canvas.height=O0,this.#C(o,O0,t);const l=o.measureText(""),u=l.fontBoundingBoxAscent,h=Math.abs(l.fontBoundingBoxDescent);o.canvas.width=o.canvas.height=0;let f=.8;return u?f=u/(u+h):(Tn.platform.isFirefox&&Ut("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?f=e.ascent:e.descent&&(f=1+e.descent)),this.#y.set(t,f),f}}class $u{static textContent(t){const e=[],n={items:e,styles:Object.create(null)};function s(o){if(!o)return;let l=null;const u=o.name;if(u==="#text")l=o.value;else if($u.shouldBuildText(u))o?.attributes?.textContent?l=o.attributes.textContent:o.value&&(l=o.value);else return;if(l!==null&&e.push({str:l}),!!o.children)for(const h of o.children)s(h)}return s(t),n}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const Rj=100;function n1(i={}){typeof i=="string"||i instanceof URL?i={url:i}:(i instanceof ArrayBuffer||ArrayBuffer.isView(i))&&(i={data:i});const t=new s_,{docId:e}=t,n=i.url?jO(i.url):null,s=i.data?VO(i.data):null,o=i.httpHeaders||null,l=i.withCredentials===!0,u=i.password??null,h=i.range instanceof s1?i.range:null,f=Number.isInteger(i.rangeChunkSize)&&i.rangeChunkSize>0?i.rangeChunkSize:2**16;let m=i.worker instanceof Ku?i.worker:null;const v=i.verbosity,b=typeof i.docBaseUrl=="string"&&!Ap(i.docBaseUrl)?i.docBaseUrl:null,A=Jd(i.cMapUrl),S=i.cMapPacked!==!1,E=i.CMapReaderFactory||(Fn?$O:S0),T=Jd(i.iccUrl),C=Jd(i.standardFontDataUrl),L=i.StandardFontDataFactory||(Fn?KO:T0),k=Jd(i.wasmUrl),V=i.WasmFactory||(Fn?WO:x0),P=i.stopAtErrors!==!0,G=Number.isInteger(i.maxImageSize)&&i.maxImageSize>-1?i.maxImageSize:-1,I=i.isEvalSupported!==!1,N=typeof i.isOffscreenCanvasSupported=="boolean"?i.isOffscreenCanvasSupported:!Fn,M=typeof i.isImageDecoderSupported=="boolean"?i.isImageDecoderSupported:!Fn&&(Tn.platform.isFirefox||!globalThis.chrome),j=Number.isInteger(i.canvasMaxAreaInBytes)?i.canvasMaxAreaInBytes:-1,F=typeof i.disableFontFace=="boolean"?i.disableFontFace:Fn,z=i.fontExtraProperties===!0,U=i.enableXfa===!0,st=i.ownerDocument||globalThis.document,dt=i.disableRange===!0,$=i.disableStream===!0,Y=i.disableAutoFetch===!0,ut=i.pdfBug===!0,xt=i.CanvasFactory||(Fn?qO:zO),q=i.FilterFactory||(Fn?GO:HO),it=i.enableHWA===!0,ht=i.useWasm!==!1,W=h?h.length:i.length??NaN,ft=typeof i.useSystemFonts=="boolean"?i.useSystemFonts:!Fn&&!F,Nt=typeof i.useWorkerFetch=="boolean"?i.useWorkerFetch:!!(E===S0&&L===T0&&V===x0&&A&&C&&k&&Su(A,document.baseURI)&&Su(C,document.baseURI)&&Su(k,document.baseURI)),wt=null;mO(v);const Ot={canvasFactory:new xt({ownerDocument:st,enableHWA:it}),filterFactory:new q({docId:e,ownerDocument:st}),cMapReaderFactory:Nt?null:new E({baseUrl:A,isCompressed:S}),standardFontDataFactory:Nt?null:new L({baseUrl:C}),wasmFactory:Nt?null:new V({baseUrl:k})};m||(m=Ku.create({verbosity:v,port:Ul.workerPort}),t._worker=m);const Qt={docId:e,apiVersion:"5.4.54",data:s,password:u,disableAutoFetch:Y,rangeChunkSize:f,length:W,docBaseUrl:b,enableXfa:U,evaluatorOptions:{maxImageSize:G,disableFontFace:F,ignoreErrors:P,isEvalSupported:I,isOffscreenCanvasSupported:N,isImageDecoderSupported:M,canvasMaxAreaInBytes:j,fontExtraProperties:z,useSystemFonts:ft,useWasm:ht,useWorkerFetch:Nt,cMapUrl:A,iccUrl:T,standardFontDataUrl:C,wasmUrl:k}},Gn={ownerDocument:st,pdfBug:ut,styleElement:wt,loadingParams:{disableAutoFetch:Y,enableXfa:U}};return m.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(m.destroyed)throw new Error("Worker was destroyed");const ys=m.messageHandler.sendWithPromise("GetDocRequest",Qt,s?[s.buffer]:null);let Pn;if(h)Pn=new uj(h,{disableRange:dt,disableStream:$});else if(!s){if(!n)throw new Error("getDocument - no `url` parameter provided.");const es=Su(n)?pj:Fn?Sj:_j;Pn=new es({url:n,length:W,httpHeaders:o,withCredentials:l,rangeChunkSize:f,disableRange:dt,disableStream:$})}return ys.then(es=>{if(t.destroyed)throw new Error("Loading aborted");if(m.destroyed)throw new Error("Worker was destroyed");const vs=new Tu(e,es,m.port),Vs=new kj(vs,t,Pn,Gn,Ot,it);t._transport=Vs,vs.send("Ready",null)})}).catch(t._capability.reject),t}class s_{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${s_.#t++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class s1{#t=Promise.withResolvers();#e=[];#n=[];#s=[];#r=[];constructor(t,e,n=!1,s=null){this.length=t,this.initialData=e,this.progressiveDone=n,this.contentDispositionFilename=s}addRangeListener(t){this.#r.push(t)}addProgressListener(t){this.#s.push(t)}addProgressiveReadListener(t){this.#n.push(t)}addProgressiveDoneListener(t){this.#e.push(t)}onDataRange(t,e){for(const n of this.#r)n(t,e)}onDataProgress(t,e){this.#t.promise.then(()=>{for(const n of this.#s)n(t,e)})}onDataProgressiveRead(t){this.#t.promise.then(()=>{for(const e of this.#n)e(t)})}onDataProgressiveDone(){this.#t.promise.then(()=>{for(const t of this.#e)t()})}transportReady(){this.#t.resolve()}requestDataRange(t,e){ye("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class Ij{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Gt(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class Nj{#t=!1;constructor(t,e,n,s=!1){this._pageIndex=t,this._pageInfo=e,this._transport=n,this._stats=s?new A0:null,this._pdfBug=s,this.commonObjs=n.commonObjs,this.objs=new e1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:n=0,offsetY:s=0,dontFlip:o=!1}={}){return new mh({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:n,offsetY:s,dontFlip:o})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Gt(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:n,intent:s="display",annotationMode:o=na.ENABLE,transform:l=null,background:u=null,optionalContentConfigPromise:h=null,annotationCanvasMap:f=null,pageColors:m=null,printAnnotationStorage:v=null,isEditing:b=!1}){this._stats?.time("Overall");const A=this._transport.getRenderingIntent(s,o,v,b),{renderingIntent:S,cacheKey:E}=A;this.#t=!1,h||=this._transport.getOptionalContentConfig(S);let T=this._intentStates.get(E);T||(T=Object.create(null),this._intentStates.set(E,T)),T.streamReaderCancelTimeout&&(clearTimeout(T.streamReaderCancelTimeout),T.streamReaderCancelTimeout=null);const C=!!(S&ds.PRINT);T.displayReadyCapability||(T.displayReadyCapability=Promise.withResolvers(),T.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(A));const L=P=>{T.renderTasks.delete(k),C&&(this.#t=!0),this.#e(),P?(k.capability.reject(P),this._abortOperatorList({intentState:T,reason:P instanceof Error?P:new Error(P)})):k.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},k=new Dl({callback:L,params:{canvas:e,canvasContext:t,viewport:n,transform:l,background:u},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:f,operatorList:T.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!C,pdfBug:this._pdfBug,pageColors:m,enableHWA:this._transport.enableHWA});(T.renderTasks||=new Set).add(k);const V=k.task;return Promise.all([T.displayReadyCapability.promise,h]).then(([P,G])=>{if(this.destroyed){L();return}if(this._stats?.time("Rendering"),!(G.renderingIntent&S))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");k.initializeGraphics({transparency:P,optionalContentConfig:G}),k.operatorListChanged()}).catch(L),V}getOperatorList({intent:t="display",annotationMode:e=na.ENABLE,printAnnotationStorage:n=null,isEditing:s=!1}={}){function o(){u.operatorList.lastChunk&&(u.opListReadCapability.resolve(u.operatorList),u.renderTasks.delete(h))}const l=this._transport.getRenderingIntent(t,e,n,s,!0);let u=this._intentStates.get(l.cacheKey);u||(u=Object.create(null),this._intentStates.set(l.cacheKey,u));let h;return u.opListReadCapability||(h=Object.create(null),h.operatorListChanged=o,u.opListReadCapability=Promise.withResolvers(),(u.renderTasks||=new Set).add(h),u.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(l)),u.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>$u.textContent(n));const e=this.streamTextContent(t);return new Promise(function(n,s){function o(){l.read().then(function({value:h,done:f}){if(f){n(u);return}u.lang??=h.lang,Object.assign(u.styles,h.styles),u.items.push(...h.items),o()},s)}const l=e.getReader(),u={items:[],styles:Object.create(null),lang:null};o()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const n of e.renderTasks)t.push(n.completed),n.cancel();return this.objs.clear(),this.#t=!1,Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#e();return t&&e&&(this._stats&&=new A0),e}#e(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(t,e){const n=this._intentStates.get(e);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let n=0,s=t.length;n<s;n++)e.operatorList.fnArray.push(t.fnArray[n]),e.operatorList.argsArray.push(t.argsArray[n]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const n of e.renderTasks)n.operatorListChanged();t.lastChunk&&this.#e()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:n,modifiedIds:s}){const{map:o,transfer:l}=n,h=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:o,modifiedIds:s},l).getReader(),f=this._intentStates.get(e);f.streamReader=h;const m=()=>{h.read().then(({value:v,done:b})=>{if(b){f.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(v,f),m())},v=>{if(f.streamReader=null,!this._transport.destroyed){if(f.operatorList){f.operatorList.lastChunk=!0;for(const b of f.renderTasks)b.operatorListChanged();this.#e()}if(f.displayReadyCapability)f.displayReadyCapability.reject(v);else if(f.opListReadCapability)f.opListReadCapability.reject(v);else throw v}})};m()}_abortOperatorList({intentState:t,reason:e,force:n=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!n){if(t.renderTasks.size>0)return;if(e instanceof Yv){let s=Rj;e.extraDelay>0&&e.extraDelay<1e3&&(s+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},s);return}}if(t.streamReader.cancel(new ga(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[s,o]of this._intentStates)if(o===t){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}var sa,$s,or,co,qf,uo,ho,zn,vf,i1,r1,xu,Fl,_f;const xe=class xe{constructor({name:t=null,port:e=null,verbosity:n=gO()}={}){yi(this,zn);yi(this,sa,Promise.withResolvers());yi(this,$s,null);yi(this,or,null);yi(this,co,null);if(this.name=t,this.destroyed=!1,this.verbosity=n,e){if(Te(xe,ho).has(e))throw new Error("Cannot use more than one PDFWorker per port.");Te(xe,ho).set(e,this),vi(this,zn,i1).call(this,e)}else vi(this,zn,r1).call(this)}get promise(){return Te(this,sa).promise}get port(){return Te(this,or)}get messageHandler(){return Te(this,$s)}destroy(){this.destroyed=!0,Te(this,co)?.terminate(),Wn(this,co,null),Te(xe,ho).delete(Te(this,or)),Wn(this,or,null),Te(this,$s)?.destroy(),Wn(this,$s,null)}static create(t){const e=Te(this,ho).get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new xe(t)}static get workerSrc(){if(Ul.workerSrc)return Ul.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Gt(this,"_setupFakeWorkerGlobal",(async()=>Te(this,Fl,_f)?Te(this,Fl,_f):(await import(this.workerSrc)).WorkerMessageHandler)())}};sa=new WeakMap,$s=new WeakMap,or=new WeakMap,co=new WeakMap,qf=new WeakMap,uo=new WeakMap,ho=new WeakMap,zn=new WeakSet,vf=function(){Te(this,sa).resolve(),Te(this,$s).send("configure",{verbosity:this.verbosity})},i1=function(t){Wn(this,or,t),Wn(this,$s,new Tu("main","worker",t)),Te(this,$s).on("ready",()=>{}),vi(this,zn,vf).call(this)},r1=function(){if(Te(xe,uo)||Te(xe,Fl,_f)){vi(this,zn,xu).call(this);return}let{workerSrc:t}=xe;try{xe._isSameOrigin(window.location,t)||(t=xe._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),n=new Tu("main","worker",e),s=()=>{o.abort(),n.destroy(),e.terminate(),this.destroyed?Te(this,sa).reject(new Error("Worker was destroyed")):vi(this,zn,xu).call(this)},o=new AbortController;e.addEventListener("error",()=>{Te(this,co)||s()},{signal:o.signal}),n.on("test",u=>{if(o.abort(),this.destroyed||!u){s();return}Wn(this,$s,n),Wn(this,or,e),Wn(this,co,e),vi(this,zn,vf).call(this)}),n.on("ready",u=>{if(o.abort(),this.destroyed){s();return}try{l()}catch{vi(this,zn,xu).call(this)}});const l=()=>{const u=new Uint8Array;n.send("test",u,[u.buffer])};l();return}catch{bp("The worker has been disabled.")}vi(this,zn,xu).call(this)},xu=function(){Te(xe,uo)||(Ut("Setting up fake worker."),Wn(xe,uo,!0)),xe._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){Te(this,sa).reject(new Error("Worker was destroyed"));return}const e=new BO;Wn(this,or,e);const n=`fake${Aw(xe,qf)._++}`,s=new Tu(n+"_worker",n,e);t.setup(s,e),Wn(this,$s,new Tu(n,n+"_worker",e)),vi(this,zn,vf).call(this)}).catch(t=>{Te(this,sa).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},Fl=new WeakSet,_f=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},yi(xe,Fl),yi(xe,qf,0),yi(xe,uo,!1),yi(xe,ho,new WeakMap),Fn&&(Wn(xe,uo,!0),Ul.workerSrc||="./pdf.worker.mjs"),xe._isSameOrigin=(t,e)=>{const n=URL.parse(t);if(!n?.origin||n.origin==="null")return!1;const s=new URL(e,n);return n.origin===s.origin},xe._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},xe.fromPort=t=>{if(RO("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return xe.create(t)};let Ku=xe;class kj{#t=new Map;#e=new Map;#n=new Map;#s=new Map;#r=null;constructor(t,e,n,s,o,l){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new e1,this.fontLoader=new LO({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=o.canvasFactory,this.filterFactory=o.filterFactory,this.cMapReaderFactory=o.cMapReaderFactory,this.standardFontDataFactory=o.standardFontDataFactory,this.wasmFactory=o.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=l,this.setupMessageHandler()}#i(t,e=null){const n=this.#t.get(t);if(n)return n;const s=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,s),s}get annotationStorage(){return Gt(this,"annotationStorage",new Zv)}getRenderingIntent(t,e=na.ENABLE,n=null,s=!1,o=!1){let l=ds.DISPLAY,u=jy;switch(t){case"any":l=ds.ANY;break;case"display":break;case"print":l=ds.PRINT;break;default:Ut(`getRenderingIntent - invalid intent: ${t}`)}const h=l&ds.PRINT&&n instanceof Hx?n:this.annotationStorage;switch(e){case na.DISABLE:l+=ds.ANNOTATIONS_DISABLE;break;case na.ENABLE:break;case na.ENABLE_FORMS:l+=ds.ANNOTATIONS_FORMS;break;case na.ENABLE_STORAGE:l+=ds.ANNOTATIONS_STORAGE,u=h.serializable;break;default:Ut(`getRenderingIntent - invalid annotationMode: ${e}`)}s&&(l+=ds.IS_EDITING),o&&(l+=ds.OPLIST);const{ids:f,hash:m}=h.modifiedIds,v=[l,u.hash,m];return{renderingIntent:l,cacheKey:v.join("_"),annotationStorageSerializable:u,modifiedIds:f}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const n of this.#e.values())t.push(n._destroy());this.#e.clear(),this.#n.clear(),this.#s.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),Un.cleanup(),this._networkStream?.cancelAllRequests(new ga("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(n,s)=>{Ze(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=o=>{this._lastProgress={loaded:o.loaded,total:o.total}},s.onPull=()=>{this._fullReader.read().then(function({value:o,done:l}){if(l){s.close();return}Ze(o instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{s.error(o)})},s.onCancel=o=>{this._fullReader.cancel(o),s.ready.catch(l=>{if(!this.destroyed)throw l})}}),t.on("ReaderHeadersReady",async n=>{await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:o,contentLength:l}=this._fullReader;return(!s||!o)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=u=>{e.onProgress?.({loaded:u.loaded,total:u.total})}),{isStreamingSupported:s,isRangeSupported:o,contentLength:l}}),t.on("GetRangeReader",(n,s)=>{Ze(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const o=this._networkStream.getRangeReader(n.begin,n.end);if(!o){s.close();return}s.onPull=()=>{o.read().then(function({value:l,done:u}){if(u){s.close();return}Ze(l instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(l),1,[l])}).catch(l=>{s.error(l)})},s.onCancel=l=>{o.cancel(l),s.ready.catch(u=>{if(!this.destroyed)throw u})}}),t.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,e._capability.resolve(new Ij(n,this))}),t.on("DocException",n=>{e._capability.reject(Yn(n))}),t.on("PasswordRequest",n=>{this.#r=Promise.withResolvers();try{if(!e.onPassword)throw Yn(n);const s=o=>{o instanceof Error?this.#r.reject(o):this.#r.resolve({password:o})};e.onPassword(s,n.code)}catch(s){this.#r.reject(s)}return this.#r.promise}),t.on("DataLoaded",n=>{e.onProgress?.({loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),t.on("StartRenderPage",n=>{if(this.destroyed)return;this.#e.get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),t.on("commonobj",([n,s,o])=>{if(this.destroyed||this.commonObjs.has(n))return null;switch(s){case"Font":if("error"in o){const f=o.error;Ut(`Error during font loading: ${f}`),this.commonObjs.resolve(n,f);break}const l=this._params.pdfBug&&globalThis.FontInspector?.enabled?(f,m)=>globalThis.FontInspector.fontAdded(f,m):null,u=new OO(o,l);this.fontLoader.bind(u).catch(()=>t.sendWithPromise("FontFallback",{id:n})).finally(()=>{!u.fontExtraProperties&&u.data&&(u.data=null),this.commonObjs.resolve(n,u)});break;case"CopyLocalImage":const{imageRef:h}=o;Ze(h,"The imageRef must be defined.");for(const f of this.#e.values())for(const[,m]of f.objs)if(m?.ref===h)return m.dataLen?(this.commonObjs.resolve(n,structuredClone(m)),m.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,o);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),t.on("obj",([n,s,o,l])=>{if(this.destroyed)return;const u=this.#e.get(s);if(!u.objs.has(n)){if(u._intentStates.size===0){l?.bitmap?.close();return}switch(o){case"Image":case"Pattern":u.objs.resolve(n,l);break;default:throw new Error(`Got unknown object type ${o}`)}}}),t.on("DocProgress",n=>{this.destroyed||e.onProgress?.({loaded:n.loaded,total:n.total})}),t.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const s=this[n.type];if(!s)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return s.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&Ut("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,n=this.#n.get(e);if(n)return n;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(o=>{if(this.destroyed)throw new Error("Transport destroyed");o.refStr&&this.#s.set(o.refStr,t);const l=new Nj(e,o,this,this._params.pdfBug);return this.#e.set(e,l),l});return this.#n.set(e,s),s}getPageIndex(t){return Vy(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#i("GetFieldObjects")}hasJSActions(){return this.#i("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#i("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#i("GetOptionalContentConfig").then(e=>new cj(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#t.get(t);if(e)return e;const n=this.messageHandler.sendWithPromise(t,null).then(s=>({info:s[0],metadata:s[1]?new oj(s[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(t,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),Un.cleanup()}}cachedPageNumber(t){if(!Vy(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#s.get(e)??null}}class Mj{#t=null;onContinue=null;onError=null;constructor(t){this.#t=t}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}}class Dl{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:n,commonObjs:s,annotationCanvasMap:o,operatorList:l,pageIndex:u,canvasFactory:h,filterFactory:f,useRequestAnimationFrame:m=!1,pdfBug:v=!1,pageColors:b=null,enableHWA:A=!1}){this.callback=t,this.params=e,this.objs=n,this.commonObjs=s,this.annotationCanvasMap=o,this.operatorListIdx=null,this.operatorList=l,this._pageIndex=u,this.canvasFactory=h,this.filterFactory=f,this._pdfBug=v,this.pageColors=b,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=m===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Mj(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=A}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(Dl.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Dl.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:n,transform:s,background:o}=this.params,l=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Vl(l,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:s,viewport:n,transparency:t,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),Dl.#e.delete(this._canvas),t||=new Yv(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Dl.#e.delete(this._canvas),this.callback())))}}const Dj="5.4.54",Pj="295fb3ec4";class Ps{#t=null;#e=null;#n;#s=null;#r=!1;#i=!1;#a=null;#o;#u=null;#c=null;static#d=null;static get _keyboardManager(){return Gt(this,"_keyboardManager",new gh([[["Escape","mac+Escape"],Ps.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Ps.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Ps.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Ps.prototype._moveToPrevious],[["Home","mac+Home"],Ps.prototype._moveToBeginning],[["End","mac+End"],Ps.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#i=!1,this.#a=t):this.#i=!0,this.#c=t?._uiManager||e,this.#o=this.#c._eventBus,this.#n=t?.color?.toUpperCase()||this.#c?.highlightColors.values().next().value||"#FFFF98",Ps.#d||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#a&&(t.ariaControls=`${this.#a.id}_colorpicker_dropdown`);const e=this.#c._signal;t.addEventListener("click",this.#f.bind(this),{signal:e}),t.addEventListener("keydown",this.#g.bind(this),{signal:e});const n=this.#e=document.createElement("span");return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=this.#n,t.append(n),t}renderMainDropdown(){const t=this.#s=this.#l();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#l(){const t=document.createElement("div"),e=this.#c._signal;t.addEventListener("contextmenu",js,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#a&&(t.id=`${this.#a.id}_colorpicker_dropdown`);for(const[n,s]of this.#c.highlightColors){const o=document.createElement("button");o.tabIndex="0",o.role="option",o.setAttribute("data-color",s),o.title=n,o.setAttribute("data-l10n-id",Ps.#d[n]);const l=document.createElement("span");o.append(l),l.className="swatch",l.style.backgroundColor=s,o.ariaSelected=s===this.#n,o.addEventListener("click",this.#p.bind(this,s),{signal:e}),t.append(o)}return t.addEventListener("keydown",this.#g.bind(this),{signal:e}),t}#p(t,e){e.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:Xt.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#f(t);return}const e=t.target.getAttribute("data-color");e&&this.#p(e,t)}_moveToNext(t){if(!this.#m){this.#f(t);return}if(t.target===this.#t){this.#s.firstChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#s?.firstChild||t.target===this.#t){this.#m&&this._hideDropdownFromKeyboard();return}this.#m||this.#f(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#m){this.#f(t);return}this.#s.firstChild?.focus()}_moveToEnd(t){if(!this.#m){this.#f(t);return}this.#s.lastChild?.focus()}#g(t){Ps._keyboardManager.exec(this,t)}#f(t){if(this.#m){this.hideDropdown();return}if(this.#r=t.detail===0,this.#u||(this.#u=new AbortController,window.addEventListener("pointerdown",this.#h.bind(this),{signal:this.#c.combinedSignal(this.#u)})),this.#t.ariaExpanded="true",this.#s){this.#s.classList.remove("hidden");return}const e=this.#s=this.#l();this.#t.append(e)}#h(t){this.#s?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#s?.classList.add("hidden"),this.#t.ariaExpanded="false",this.#u?.abort(),this.#u=null}get#m(){return this.#s&&!this.#s.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#i){if(!this.#m){this.#a?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#r})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#s)return;const e=this.#c.highlightColors.values();for(const n of this.#s.children)n.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#s?.remove(),this.#s=null}}class Wu{#t=null;#e=null;#n=null;static#s=null;constructor(t){this.#e=t,this.#n=t._uiManager,Wu.#s||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#t)return this.#t;const{editorType:t,colorType:e,colorValue:n}=this.#e,s=this.#t=document.createElement("input");return s.type="color",s.value=n||"#000000",s.className="basicColorPicker",s.tabIndex=0,s.setAttribute("data-l10n-id",Wu.#s[t]),s.addEventListener("input",()=>{this.#n.updateParams(e,s.value)},{signal:this.#n._signal}),s}update(t){this.#t&&(this.#t.value=t)}destroy(){this.#t?.remove(),this.#t=null}hideDropdown(){}}function j0(i){return Math.floor(Math.max(0,Math.min(1,i))*255).toString(16).padStart(2,"0")}function gu(i){return Math.max(0,Math.min(255,255*i))}class V0{static CMYK_G([t,e,n,s]){return["G",1-Math.min(1,.3*t+.59*n+.11*e+s)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=gu(t),[t,t,t]}static G_HTML([t]){const e=j0(t);return`#${e}${e}${e}`}static RGB_G([t,e,n]){return["G",.3*t+.59*e+.11*n]}static RGB_rgb(t){return t.map(gu)}static RGB_HTML(t){return`#${t.map(j0).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,n,s]){return["RGB",1-Math.min(1,t+s),1-Math.min(1,n+s),1-Math.min(1,e+s)]}static CMYK_rgb([t,e,n,s]){return[gu(1-Math.min(1,t+s)),gu(1-Math.min(1,n+s)),gu(1-Math.min(1,e+s))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,n]){const s=1-t,o=1-e,l=1-n,u=Math.min(s,o,l);return["CMYK",s,o,l,u]}}class Lj{create(t,e,n=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),n||(s.setAttribute("width",`${t}px`),s.setAttribute("height",`${e}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${t} ${e}`),s}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){ye("Abstract method `_createSVG` called.")}}class Gf extends Lj{_createSVG(t){return document.createElementNS(rr,t)}}class a1{static setupStorage(t,e,n,s,o){const l=s.getValue(e,{value:null});switch(n.name){case"textarea":if(l.value!==null&&(t.textContent=l.value),o==="print")break;t.addEventListener("input",u=>{s.setValue(e,{value:u.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(l.value===n.attributes.xfaOn?t.setAttribute("checked",!0):l.value===n.attributes.xfaOff&&t.removeAttribute("checked"),o==="print")break;t.addEventListener("change",u=>{s.setValue(e,{value:u.target.checked?u.target.getAttribute("xfaOn"):u.target.getAttribute("xfaOff")})})}else{if(l.value!==null&&t.setAttribute("value",l.value),o==="print")break;t.addEventListener("input",u=>{s.setValue(e,{value:u.target.value})})}break;case"select":if(l.value!==null){t.setAttribute("value",l.value);for(const u of n.children)u.attributes.value===l.value?u.attributes.selected=!0:u.attributes.hasOwnProperty("selected")&&delete u.attributes.selected}t.addEventListener("input",u=>{const h=u.target.options,f=h.selectedIndex===-1?"":h[h.selectedIndex].value;s.setValue(e,{value:f})});break}}static setAttributes({html:t,element:e,storage:n=null,intent:s,linkService:o}){const{attributes:l}=e,u=t instanceof HTMLAnchorElement;l.type==="radio"&&(l.name=`${l.name}-${s}`);for(const[h,f]of Object.entries(l))if(f!=null)switch(h){case"class":f.length&&t.setAttribute(h,f.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",f);break;case"style":Object.assign(t.style,f);break;case"textContent":t.textContent=f;break;default:(!u||h!=="href"&&h!=="newWindow")&&t.setAttribute(h,f)}u&&o.addLinkAttributes(t,l.href,l.newWindow),n&&l.dataId&&this.setupStorage(t,l.dataId,e,n)}static render(t){const e=t.annotationStorage,n=t.linkService,s=t.xfaHtml,o=t.intent||"display",l=document.createElement(s.name);s.attributes&&this.setAttributes({html:l,element:s,intent:o,linkService:n});const u=o!=="richText",h=t.div;if(h.append(l),t.viewport){const v=`matrix(${t.viewport.transform.join(",")})`;h.style.transform=v}u&&h.setAttribute("class","xfaLayer xfaFont");const f=[];if(s.children.length===0){if(s.value){const v=document.createTextNode(s.value);l.append(v),u&&$u.shouldBuildText(s.name)&&f.push(v)}return{textDivs:f}}const m=[[s,-1,l]];for(;m.length>0;){const[v,b,A]=m.at(-1);if(b+1===v.children.length){m.pop();continue}const S=v.children[++m.at(-1)[1]];if(S===null)continue;const{name:E}=S;if(E==="#text"){const C=document.createTextNode(S.value);f.push(C),A.append(C);continue}const T=S?.attributes?.xmlns?document.createElementNS(S.attributes.xmlns,E):document.createElement(E);if(A.append(T),S.attributes&&this.setAttributes({html:T,element:S,storage:e,intent:o,linkService:n}),S.children?.length>0)m.push([S,-1,T]);else if(S.value){const C=document.createTextNode(S.value);u&&$u.shouldBuildText(E)&&f.push(C),T.append(C)}}for(const v of h.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))v.setAttribute("readOnly",!0);return{textDivs:f}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const Oj=9,wo=new WeakSet,jj=new Date().getTimezoneOffset()*60*1e3;class U0{static create(t){switch(t.data.annotationType){case Ye.LINK:return new i_(t);case Ye.TEXT:return new Vj(t);case Ye.WIDGET:switch(t.data.fieldType){case"Tx":return new Uj(t);case"Btn":return t.data.radioButton?new o1(t):t.data.checkBox?new Bj(t):new zj(t);case"Ch":return new Hj(t);case"Sig":return new Fj(t)}return new Io(t);case Ye.POPUP:return new Fy(t);case Ye.FREETEXT:return new l1(t);case Ye.LINE:return new qj(t);case Ye.SQUARE:return new $j(t);case Ye.CIRCLE:return new Kj(t);case Ye.POLYLINE:return new c1(t);case Ye.CARET:return new Yj(t);case Ye.INK:return new r_(t);case Ye.POLYGON:return new Wj(t);case Ye.HIGHLIGHT:return new u1(t);case Ye.UNDERLINE:return new Xj(t);case Ye.SQUIGGLY:return new Qj(t);case Ye.STRIKEOUT:return new Jj(t);case Ye.STAMP:return new h1(t);case Ye.FILEATTACHMENT:return new Zj(t);default:return new He(t)}}}class He{#t=null;#e=!1;#n=null;constructor(t,{isRenderable:e=!1,ignoreBorder:n=!1,createQuadrilaterals:s=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(n)),s&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return He._hasPopupData(this.data)}updateEdited(t){if(!this.container)return;t.rect&&(this.#t||={rect:this.data.rect.slice(0)});const{rect:e,popup:n}=t;e&&this.#s(e);let s=this.#n?.popup||this.popup;!s&&n?.text&&(this._createPopup(n),s=this.#n.popup),s&&(s.updateEdited(t),n?.deleted&&(s.remove(),this.#n=null,this.popup=null))}resetEdited(){this.#t&&(this.#s(this.#t.rect),this.#n?.popup.resetEdited(),this.#t=null)}#s(t){const{container:{style:e},data:{rect:n,rotation:s},parent:{viewport:{rawDims:{pageWidth:o,pageHeight:l,pageX:u,pageY:h}}}}=this;n?.splice(0,4,...t),e.left=`${100*(t[0]-u)/o}%`,e.top=`${100*(l-t[3]+h)/l}%`,s===0?(e.width=`${100*(t[2]-t[0])/o}%`,e.height=`${100*(t[3]-t[1])/l}%`):this.setRotation(s)}_createContainer(t){const{data:e,parent:{page:n,viewport:s}}=this,o=document.createElement("section");o.setAttribute("data-annotation-id",e.id),!(this instanceof Io)&&!(this instanceof i_)&&(o.tabIndex=0);const{style:l}=o;if(l.zIndex=this.parent.zIndex++,e.alternativeText&&(o.title=e.alternativeText),e.noRotate&&o.classList.add("norotate"),!e.rect||this instanceof Fy){const{rotation:E}=e;return!e.hasOwnCanvas&&E!==0&&this.setRotation(E,o),o}const{width:u,height:h}=this;if(!t&&e.borderStyle.width>0){l.borderWidth=`${e.borderStyle.width}px`;const E=e.borderStyle.horizontalCornerRadius,T=e.borderStyle.verticalCornerRadius;if(E>0||T>0){const L=`calc(${E}px * var(--total-scale-factor)) / calc(${T}px * var(--total-scale-factor))`;l.borderRadius=L}else if(this instanceof o1){const L=`calc(${u}px * var(--total-scale-factor)) / calc(${h}px * var(--total-scale-factor))`;l.borderRadius=L}switch(e.borderStyle.style){case Cl.SOLID:l.borderStyle="solid";break;case Cl.DASHED:l.borderStyle="dashed";break;case Cl.BEVELED:Ut("Unimplemented border style: beveled");break;case Cl.INSET:Ut("Unimplemented border style: inset");break;case Cl.UNDERLINE:l.borderBottomStyle="solid";break}const C=e.borderColor||null;C?(this.#e=!0,l.borderColor=Tt.makeHexColor(C[0]|0,C[1]|0,C[2]|0)):l.borderWidth=0}const f=Tt.normalizeRect([e.rect[0],n.view[3]-e.rect[1]+n.view[1],e.rect[2],n.view[3]-e.rect[3]+n.view[1]]),{pageWidth:m,pageHeight:v,pageX:b,pageY:A}=s.rawDims;l.left=`${100*(f[0]-b)/m}%`,l.top=`${100*(f[1]-A)/v}%`;const{rotation:S}=e;return e.hasOwnCanvas||S===0?(l.width=`${100*u/m}%`,l.height=`${100*h/v}%`):this.setRotation(S,o),o}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:s}=this.parent.viewport.rawDims;let{width:o,height:l}=this;t%180!==0&&([o,l]=[l,o]),e.style.width=`${100*o/n}%`,e.style.height=`${100*l/s}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,n,s)=>{const o=s.detail[e],l=o[0],u=o.slice(1);s.target.style[n]=V0[`${l}_HTML`](u),this.annotationStorage.setValue(this.data.id,{[n]:V0[`${l}_rgb`](u)})};return Gt(this,"_commonActions",{display:e=>{const{display:n}=e.detail,s=n%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:n===1||n===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:n}=e.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const n=e.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(t,e){const n=this._commonActions;for(const s of Object.keys(e.detail))(t[s]||n[s])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const n=this._commonActions;for(const[s,o]of Object.entries(e)){const l=n[s];if(l){const u={detail:{[s]:o},target:t};l(u),delete e[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,n,s,o]=this.data.rect.map(E=>Math.fround(E));if(t.length===8){const[E,T,C,L]=t.subarray(2,6);if(s===E&&o===T&&e===C&&n===L)return}const{style:l}=this.container;let u;if(this.#e){const{borderColor:E,borderWidth:T}=l;l.borderWidth=0,u=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${E}" stroke-width="${T}">`],this.container.classList.add("hasBorder")}const h=s-e,f=o-n,{svgFactory:m}=this,v=m.createElement("svg");v.classList.add("quadrilateralsContainer"),v.setAttribute("width",0),v.setAttribute("height",0),v.role="none";const b=m.createElement("defs");v.append(b);const A=m.createElement("clipPath"),S=`clippath_${this.data.id}`;A.setAttribute("id",S),A.setAttribute("clipPathUnits","objectBoundingBox"),b.append(A);for(let E=2,T=t.length;E<T;E+=8){const C=t[E],L=t[E+1],k=t[E+2],V=t[E+3],P=m.createElement("rect"),G=(k-e)/h,I=(o-L)/f,N=(C-k)/h,M=(L-V)/f;P.setAttribute("x",G),P.setAttribute("y",I),P.setAttribute("width",N),P.setAttribute("height",M),A.append(P),u?.push(`<rect vector-effect="non-scaling-stroke" x="${G}" y="${I}" width="${N}" height="${M}"/>`)}this.#e&&(u.push("</g></svg>')"),l.backgroundImage=u.join("")),this.container.append(v),this.container.style.clipPath=`url(#${S})`}_createPopup(t=null){const{data:e}=this;let n,s;t?(n={str:t.text},s=t.date):(n=e.contentsObj,s=e.modificationDate);const o=this.#n=new Fy({data:{color:e.color,titleObj:e.titleObj,modificationDate:s,contentsObj:n,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent.div.append(o.render())}get hasPopupElement(){return!!(this.#n||this.popup||this.data.popupRef)}render(){ye("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const n=[];if(this._fieldObjects){const s=this._fieldObjects[t];if(s)for(const{page:o,id:l,exportValues:u}of s){if(o===-1||l===e)continue;const h=typeof u=="string"?u:null,f=document.querySelector(`[data-element-id="${l}"]`);if(f&&!wo.has(f)){Ut(`_getElementsByName - element not allowed: ${l}`);continue}n.push({id:l,exportValue:h,domElement:f})}return n}for(const s of document.getElementsByName(t)){const{exportValue:o}=s,l=s.getAttribute("data-element-id");l!==e&&wo.has(s)&&n.push({id:l,exportValue:o,domElement:s})}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class i_ extends He{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,n=document.createElement("a");n.setAttribute("data-element-id",t.id);let s=!1;return t.url?(e.addLinkAttributes(n,t.url,t.newWindow),s=!0):t.action?(this._bindNamedAction(n,t.action,t.overlaidText),s=!0):t.attachment?(this.#e(n,t.attachment,t.overlaidText,t.attachmentDest),s=!0):t.setOCGState?(this.#n(n,t.setOCGState,t.overlaidText),s=!0):t.dest?(this._bindLink(n,t.dest,t.overlaidText),s=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,t),s=!0),t.resetForm?(this._bindResetFormAction(n,t.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(n,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(n),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,n=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t(),n&&(t.title=n)}_bindNamedAction(t,e,n=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),n&&(t.title=n),this.#t()}#e(t,e,n="",s=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:n&&(t.title=n),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,s),!1),this.#t()}#n(t,e,n=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),n&&(t.title=n),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const s of Object.keys(e.actions)){const o=n.get(s);o&&(t[o]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:s}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const n=t.onclick;if(n||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){Ut('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),n||(t.onclick=()=>!1);return}t.onclick=()=>{n?.();const{fields:s,refs:o,include:l}=e,u=[];if(s.length!==0||o.length!==0){const m=new Set(o);for(const v of s){const b=this._fieldObjects[v]||[];for(const{id:A}of b)m.add(A)}for(const v of Object.values(this._fieldObjects))for(const b of v)m.has(b.id)===l&&u.push(b)}else for(const m of Object.values(this._fieldObjects))u.push(...m);const h=this.annotationStorage,f=[];for(const m of u){const{id:v}=m;switch(f.push(v),m.type){case"text":{const A=m.defaultValue||"";h.setValue(v,{value:A});break}case"checkbox":case"radiobutton":{const A=m.defaultValue===m.exportValues;h.setValue(v,{value:A});break}case"combobox":case"listbox":{const A=m.defaultValue||"";h.setValue(v,{value:A});break}default:continue}const b=document.querySelector(`[data-element-id="${v}"]`);if(b){if(!wo.has(b)){Ut(`_bindResetFormAction - element not allowed: ${v}`);continue}}else continue;b.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:f,name:"ResetForm"}}),!1}}}class Vj extends He{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class Io extends He{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return Tn.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,n,s,o){n.includes("mouse")?t.addEventListener(n,l=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:o(l),shift:l.shiftKey,modifier:this._getKeyModifier(l)}})}):t.addEventListener(n,l=>{if(n==="blur"){if(!e.focused||!l.relatedTarget)return;e.focused=!1}else if(n==="focus"){if(e.focused)return;e.focused=!0}o&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:o(l)}})})}_setEventListeners(t,e,n,s){for(const[o,l]of n)(l==="Action"||this.data.actions?.[l])&&((l==="Focus"||l==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,o,l,s),l==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):l==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":Tt.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||Oj,o=t.style;let l;const u=2,h=f=>Math.round(10*f)/10;if(this.data.multiLine){const f=Math.abs(this.data.rect[3]-this.data.rect[1]-u),m=Math.round(f/(Xg*s))||1,v=f/m;l=Math.min(s,h(v/Xg))}else{const f=Math.abs(this.data.rect[3]-this.data.rect[1]-u);l=Math.min(s,h(f/Xg))}o.fontSize=`calc(${l}px * var(--total-scale-factor))`,o.color=Tt.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(o.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class Uj extends Io{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,n,s){const o=this.annotationStorage;for(const l of this._getElementsByName(t.name,t.id))l.domElement&&(l.domElement[e]=n),o.setValue(l.id,{[s]:n})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const s=t.getValue(e,{value:this.data.fieldValue});let o=s.value||"";const l=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let u=s.formattedValue||this.data.textContent?.join(`
`)||null;u&&this.data.comb&&(u=u.replaceAll(/\s+/g,""));const h={userValue:o,formattedValue:u,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=u??o,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",u??o),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),wo.add(n),n.setAttribute("data-element-id",e),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:f,datetimeType:m,timeStep:v}=this.data,b=!!m&&this.enableScripting;f&&(n.title=f),this._setRequired(n,this.data.required),l&&(n.maxLength=l),n.addEventListener("input",S=>{t.setValue(e,{value:S.target.value}),this.setPropertyOnSiblings(n,"value",S.target.value,"value"),h.formattedValue=null}),n.addEventListener("resetform",S=>{const E=this.data.defaultFieldValue??"";n.value=h.userValue=E,h.formattedValue=null});let A=S=>{const{formattedValue:E}=h;E!=null&&(S.target.value=E),S.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",E=>{if(h.focused)return;const{target:T}=E;if(b&&(T.type=m,v&&(T.step=v)),h.userValue){const C=h.userValue;if(b)if(m==="time"){const L=new Date(C),k=[L.getHours(),L.getMinutes(),L.getSeconds()];T.value=k.map(V=>V.toString().padStart(2,"0")).join(":")}else T.value=new Date(C-jj).toISOString().split(m==="date"?"T":".",1)[0];else T.value=C}h.lastCommittedValue=T.value,h.commitKey=1,this.data.actions?.Focus||(h.focused=!0)}),n.addEventListener("updatefromsandbox",E=>{this.showElementAndHideCanvas(E.target);const T={value(C){h.userValue=C.detail.value??"",b||t.setValue(e,{value:h.userValue.toString()}),C.target.value=h.userValue},formattedValue(C){const{formattedValue:L}=C.detail;h.formattedValue=L,L!=null&&C.target!==document.activeElement&&(C.target.value=L);const k={formattedValue:L};b&&(k.value=L),t.setValue(e,k)},selRange(C){C.target.setSelectionRange(...C.detail.selRange)},charLimit:C=>{const{charLimit:L}=C.detail,{target:k}=C;if(L===0){k.removeAttribute("maxLength");return}k.setAttribute("maxLength",L);let V=h.userValue;!V||V.length<=L||(V=V.slice(0,L),k.value=h.userValue=V,t.setValue(e,{value:V}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:V,willCommit:!0,commitKey:1,selStart:k.selectionStart,selEnd:k.selectionEnd}}))}};this._dispatchEventFromSandbox(T,E)}),n.addEventListener("keydown",E=>{h.commitKey=1;let T=-1;if(E.key==="Escape"?T=0:E.key==="Enter"&&!this.data.multiLine?T=2:E.key==="Tab"&&(h.commitKey=3),T===-1)return;const{value:C}=E.target;h.lastCommittedValue!==C&&(h.lastCommittedValue=C,h.userValue=C,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:C,willCommit:!0,commitKey:T,selStart:E.target.selectionStart,selEnd:E.target.selectionEnd}}))});const S=A;A=null,n.addEventListener("blur",E=>{if(!h.focused||!E.relatedTarget)return;this.data.actions?.Blur||(h.focused=!1);const{target:T}=E;let{value:C}=T;if(b){if(C&&m==="time"){const L=C.split(":").map(k=>parseInt(k,10));C=new Date(2e3,0,1,L[0],L[1],L[2]||0).valueOf(),T.step=""}else C=new Date(C).valueOf();T.type="text"}h.userValue=C,h.lastCommittedValue!==C&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:C,willCommit:!0,commitKey:h.commitKey,selStart:E.target.selectionStart,selEnd:E.target.selectionEnd}}),S(E)}),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",E=>{h.lastCommittedValue=null;const{data:T,target:C}=E,{value:L,selectionStart:k,selectionEnd:V}=C;let P=k,G=V;switch(E.inputType){case"deleteWordBackward":{const I=L.substring(0,k).match(/\w*[^\w]*$/);I&&(P-=I[0].length);break}case"deleteWordForward":{const I=L.substring(k).match(/^[^\w]*\w*/);I&&(G+=I[0].length);break}case"deleteContentBackward":k===V&&(P-=1);break;case"deleteContentForward":k===V&&(G+=1);break}E.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:L,change:T||"",willCommit:!1,selStart:P,selEnd:G}})}),this._setEventListeners(n,h,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],E=>E.target.value)}if(A&&n.addEventListener("blur",A),this.data.comb){const E=(this.data.rect[2]-this.data.rect[0])/l;n.classList.add("comb"),n.style.letterSpacing=`calc(${E}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Fj extends Io{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class Bj extends Io{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,n=e.id;let s=t.getValue(n,{value:e.exportValue===e.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",t.setValue(n,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const o=document.createElement("input");return wo.add(o),o.setAttribute("data-element-id",n),o.disabled=e.readOnly,this._setRequired(o,this.data.required),o.type="checkbox",o.name=e.fieldName,s&&o.setAttribute("checked",!0),o.setAttribute("exportValue",e.exportValue),o.tabIndex=0,o.addEventListener("change",l=>{const{name:u,checked:h}=l.target;for(const f of this._getElementsByName(u,n)){const m=h&&f.exportValue===e.exportValue;f.domElement&&(f.domElement.checked=m),t.setValue(f.id,{value:m})}t.setValue(n,{value:h})}),o.addEventListener("resetform",l=>{const u=e.defaultFieldValue||"Off";l.target.checked=u===e.exportValue}),this.enableScripting&&this.hasJSActions&&(o.addEventListener("updatefromsandbox",l=>{const u={value(h){h.target.checked=h.detail.value!=="Off",t.setValue(n,{value:h.target.checked})}};this._dispatchEventFromSandbox(u,l)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],l=>l.target.checked)),this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}}class o1 extends Io{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,n=e.id;let s=t.getValue(n,{value:e.fieldValue===e.buttonValue}).value;if(typeof s=="string"&&(s=s!==e.buttonValue,t.setValue(n,{value:s})),s)for(const l of this._getElementsByName(e.fieldName,n))t.setValue(l.id,{value:!1});const o=document.createElement("input");if(wo.add(o),o.setAttribute("data-element-id",n),o.disabled=e.readOnly,this._setRequired(o,this.data.required),o.type="radio",o.name=e.fieldName,s&&o.setAttribute("checked",!0),o.tabIndex=0,o.addEventListener("change",l=>{const{name:u,checked:h}=l.target;for(const f of this._getElementsByName(u,n))t.setValue(f.id,{value:!1});t.setValue(n,{value:h})}),o.addEventListener("resetform",l=>{const u=e.defaultFieldValue;l.target.checked=u!=null&&u===e.buttonValue}),this.enableScripting&&this.hasJSActions){const l=e.buttonValue;o.addEventListener("updatefromsandbox",u=>{const h={value:f=>{const m=l===f.detail.value;for(const v of this._getElementsByName(f.target.name)){const b=m&&v.id===n;v.domElement&&(v.domElement.checked=b),t.setValue(v.id,{value:b})}}};this._dispatchEventFromSandbox(h,u)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],u=>u.target.checked)}return this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}}class zj extends i_{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),t}}class Hj extends Io{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,n=t.getValue(e,{value:this.data.fieldValue}),s=document.createElement("select");wo.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=0;let o=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",m=>{const v=this.data.defaultFieldValue;for(const b of s.options)b.selected=b.value===v});for(const m of this.data.options){const v=document.createElement("option");v.textContent=m.displayValue,v.value=m.exportValue,n.value.includes(m.exportValue)&&(v.setAttribute("selected",!0),o=!1),s.append(v)}let l=null;if(o){const m=document.createElement("option");m.value=" ",m.setAttribute("hidden",!0),m.setAttribute("selected",!0),s.prepend(m),l=()=>{m.remove(),s.removeEventListener("input",l),l=null},s.addEventListener("input",l)}const u=m=>{const v=m?"value":"textContent",{options:b,multiple:A}=s;return A?Array.prototype.filter.call(b,S=>S.selected).map(S=>S[v]):b.selectedIndex===-1?null:b[b.selectedIndex][v]};let h=u(!1);const f=m=>{const v=m.target.options;return Array.prototype.map.call(v,b=>({displayValue:b.textContent,exportValue:b.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",m=>{const v={value(b){l?.();const A=b.detail.value,S=new Set(Array.isArray(A)?A:[A]);for(const E of s.options)E.selected=S.has(E.value);t.setValue(e,{value:u(!0)}),h=u(!1)},multipleSelection(b){s.multiple=!0},remove(b){const A=s.options,S=b.detail.remove;A[S].selected=!1,s.remove(S),A.length>0&&Array.prototype.findIndex.call(A,T=>T.selected)===-1&&(A[0].selected=!0),t.setValue(e,{value:u(!0),items:f(b)}),h=u(!1)},clear(b){for(;s.length!==0;)s.remove(0);t.setValue(e,{value:null,items:[]}),h=u(!1)},insert(b){const{index:A,displayValue:S,exportValue:E}=b.detail.insert,T=s.children[A],C=document.createElement("option");C.textContent=S,C.value=E,T?T.before(C):s.append(C),t.setValue(e,{value:u(!0),items:f(b)}),h=u(!1)},items(b){const{items:A}=b.detail;for(;s.length!==0;)s.remove(0);for(const S of A){const{displayValue:E,exportValue:T}=S,C=document.createElement("option");C.textContent=E,C.value=T,s.append(C)}s.options.length>0&&(s.options[0].selected=!0),t.setValue(e,{value:u(!0),items:f(b)}),h=u(!1)},indices(b){const A=new Set(b.detail.indices);for(const S of b.target.options)S.selected=A.has(S.index);t.setValue(e,{value:u(!0)}),h=u(!1)},editable(b){b.target.disabled=!b.detail.editable}};this._dispatchEventFromSandbox(v,m)}),s.addEventListener("input",m=>{const v=u(!0),b=u(!1);t.setValue(e,{value:v}),m.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:h,change:b,changeEx:v,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],m=>m.target.value)):s.addEventListener("input",function(m){t.setValue(e,{value:u(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Fy extends He{constructor(t){const{data:e,elements:n}=t;super(t,{isRenderable:He._hasPopupData(e)}),this.elements=n,this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=new Gj({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),n=[];for(const s of this.elements)s.popup=e,s.container.ariaHasPopup="dialog",n.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",n.map(s=>`${Wv}${s}`).join(",")),this.container}}class Gj{#t=this.#N.bind(this);#e=this.#M.bind(this);#n=this.#x.bind(this);#s=this.#C.bind(this);#r=null;#i=null;#a=null;#o=null;#u=null;#c=null;#d=null;#l=!1;#p=null;#g=null;#f=null;#h=null;#m=null;#_=null;#y=null;#A=!1;constructor({container:t,color:e,elements:n,titleObj:s,modificationDate:o,contentsObj:l,richText:u,parent:h,rect:f,parentRect:m,open:v}){this.#i=t,this.#_=s,this.#a=l,this.#m=u,this.#c=h,this.#r=e,this.#h=f,this.#d=m,this.#u=n,this.#o=Ly.toDateObject(o),this.trigger=n.flatMap(b=>b.getElementsToTriggerPopup()),this.#w(),this.#i.hidden=!0,v&&this.#C()}#w(){if(this.#g)return;this.#g=new AbortController;const{signal:t}=this.#g;for(const e of this.trigger)e.addEventListener("click",this.#s,{signal:t}),e.addEventListener("mouseenter",this.#n,{signal:t}),e.addEventListener("mouseleave",this.#e,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#u)e.container?.addEventListener("keydown",this.#t,{signal:t})}render(){if(this.#p)return;const t=this.#p=document.createElement("div");if(t.className="popup",this.#r){const s=t.style.outlineColor=Tt.makeHexColor(...this.#r);t.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#_?.str){const s=document.createElement("span");s.className="title",e.append(s),{dir:s.dir,str:s.textContent}=this.#_}if(t.append(e),this.#o){const s=document.createElement("time");s.className="popupDate",s.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),s.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#o.valueOf()})),s.dateTime=this.#o.toISOString(),e.append(s)}const n=this.#v;if(n)a1.render({xfaHtml:n,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const s=this._formatContents(this.#a);t.append(s)}this.#i.append(t)}get#v(){const t=this.#m,e=this.#a;return t?.str&&(!e?.str||e.str===t.str)&&this.#m.html||null}get#S(){return this.#v?.attributes?.style?.fontSize||0}get#I(){return this.#v?.attributes?.style?.color||null}#E(t){const e=[],n={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},s={style:{color:this.#I,fontSize:this.#S?`calc(${this.#S}px * var(--total-scale-factor))`:""}};for(const o of t.split(`
`))e.push({name:"span",value:o,attributes:s});return n}_formatContents({str:t,dir:e}){const n=document.createElement("p");n.classList.add("popupContent"),n.dir=e;const s=t.split(/(?:\r\n?|\n)/);for(let o=0,l=s.length;o<l;++o){const u=s[o];n.append(document.createTextNode(u)),o<l-1&&n.append(document.createElement("br"))}return n}#N(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#l)&&this.#C()}updateEdited({rect:t,popup:e,deleted:n}){if(n||e?.deleted){this.remove();return}this.#w(),this.#y||={contentsObj:this.#a,richText:this.#m},t&&(this.#f=null),e&&(this.#m=this.#E(e.text),this.#o=Ly.toDateObject(e.date),this.#a=null),this.#p?.remove(),this.#p=null}resetEdited(){this.#y&&({contentsObj:this.#a,richText:this.#m}=this.#y,this.#y=null,this.#p?.remove(),this.#p=null,this.#f=null)}remove(){this.#g?.abort(),this.#g=null,this.#p?.remove(),this.#p=null,this.#A=!1,this.#l=!1;for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#R(){if(this.#f!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:n,pageX:s,pageY:o}}}=this.#c;let l=!!this.#d,u=l?this.#d:this.#h;for(const S of this.#u)if(!u||Tt.intersect(S.data.rect,u)!==null){u=S.data.rect,l=!0;break}const h=Tt.normalizeRect([u[0],t[3]-u[1]+t[1],u[2],t[3]-u[3]+t[1]]),m=l?u[2]-u[0]+5:0,v=h[0]+m,b=h[1];this.#f=[100*(v-s)/e,100*(b-o)/n];const{style:A}=this.#i;A.left=`${this.#f[0]}%`,A.top=`${this.#f[1]}%`}#C(){this.#l=!this.#l,this.#l?(this.#x(),this.#i.addEventListener("click",this.#s),this.#i.addEventListener("keydown",this.#t)):(this.#M(),this.#i.removeEventListener("click",this.#s),this.#i.removeEventListener("keydown",this.#t))}#x(){this.#p||this.render(),this.isVisible?this.#l&&this.#i.classList.add("focused"):(this.#R(),this.#i.hidden=!1,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)+1e3)}#M(){this.#i.classList.remove("focused"),!(this.#l||!this.isVisible)&&(this.#i.hidden=!0,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)-1e3)}forceHide(){this.#A=this.isVisible,this.#A&&(this.#i.hidden=!0)}maybeShow(){this.#w(),this.#A&&(this.#p||this.#x(),this.#A=!1,this.#i.hidden=!1)}get isVisible(){return this.#i.hidden===!1}}class l1 extends He{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=Vt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const n=document.createElement("span");n.textContent=e,t.append(n)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class qj extends He{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:n}=this,s=this.svgFactory.create(e,n,!0),o=this.#t=this.svgFactory.createElement("svg:line");return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),s.append(o),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class $j extends He{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:n}=this,s=this.svgFactory.create(e,n,!0),o=t.borderStyle.width,l=this.#t=this.svgFactory.createElement("svg:rect");return l.setAttribute("x",o/2),l.setAttribute("y",o/2),l.setAttribute("width",e-o),l.setAttribute("height",n-o),l.setAttribute("stroke-width",o||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),s.append(l),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Kj extends He{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:n}=this,s=this.svgFactory.create(e,n,!0),o=t.borderStyle.width,l=this.#t=this.svgFactory.createElement("svg:ellipse");return l.setAttribute("cx",e/2),l.setAttribute("cy",n/2),l.setAttribute("rx",e/2-o/2),l.setAttribute("ry",n/2-o/2),l.setAttribute("stroke-width",o||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),s.append(l),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class c1 extends He{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:n,popupRef:s},width:o,height:l}=this;if(!e)return this.container;const u=this.svgFactory.create(o,l,!0);let h=[];for(let m=0,v=e.length;m<v;m+=2){const b=e[m]-t[0],A=t[3]-e[m+1];h.push(`${b},${A}`)}h=h.join(" ");const f=this.#t=this.svgFactory.createElement(this.svgElementName);return f.setAttribute("points",h),f.setAttribute("stroke-width",n.width||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),u.append(f),this.container.append(u),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Wj extends c1{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Yj extends He{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class r_ extends He{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Vt.HIGHLIGHT:Vt.INK}#n(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:n,borderStyle:s,popupRef:o}}=this,{transform:l,width:u,height:h}=this.#n(e,t),f=this.svgFactory.create(u,h,!0),m=this.#t=this.svgFactory.createElement("svg:g");f.append(m),m.setAttribute("stroke-width",s.width||1),m.setAttribute("stroke-linecap","round"),m.setAttribute("stroke-linejoin","round"),m.setAttribute("stroke-miterlimit",10),m.setAttribute("stroke","transparent"),m.setAttribute("fill","transparent"),m.setAttribute("transform",l);for(let v=0,b=n.length;v<b;v++){const A=this.svgFactory.createElement(this.svgElementName);this.#e.push(A),A.setAttribute("points",n[v].join(",")),m.append(A)}return!o&&this.hasPopupData&&this._createPopup(),this.container.append(f),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:n,rect:s}=t,o=this.#t;if(e>=0&&o.setAttribute("stroke-width",e||1),n)for(let l=0,u=this.#e.length;l<u;l++)this.#e[l].setAttribute("points",n[l].join(","));if(s){const{transform:l,width:u,height:h}=this.#n(this.data.rotation,s);o.parentElement.setAttribute("viewBox",`0 0 ${u} ${h}`),o.setAttribute("transform",l)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class u1 extends He{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Vt.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class Xj extends He{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),t){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class Qj extends He{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),t){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class Jj extends He{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),t){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=t,this.container.append(n)}return this.container}}class h1 extends He{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Vt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class Zj extends He{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let n;e.hasAppearance||e.fillAlpha===0?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),n.addEventListener("dblclick",this.#e.bind(this)),this.#t=n;const{isMac:s}=Tn.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(s?o.metaKey:o.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?this._createPopup():n.classList.add("popupTriggerArea"),t.append(n),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class a_{#t=null;#e=null;#n=new Map;#s=null;constructor({div:t,accessibilityManager:e,annotationCanvasMap:n,annotationEditorUIManager:s,page:o,viewport:l,structTreeLayer:u}){this.div=t,this.#t=e,this.#e=n,this.#s=u||null,this.page=o,this.viewport=l,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return this.#n.size>0}async#r(t,e,n){const s=t.firstChild||t,o=s.id=`${Wv}${e}`,l=await this.#s?.getAriaAttributes(o);if(l)for(const[u,h]of l)s.setAttribute(u,h);n?n.at(-1).container.after(t):(this.div.append(t),this.#t?.moveElementInDOM(this.div,t,s,!1))}async render(t){const{annotations:e}=t,n=this.div;Ao(n,this.viewport);const s=new Map,o={data:null,layer:n,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new Gf,annotationStorage:t.annotationStorage||new Zv,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const l of e){if(l.noHTML)continue;const u=l.annotationType===Ye.POPUP;if(u){const m=s.get(l.id);if(!m)continue;o.elements=m}else if(l.rect[2]===l.rect[0]||l.rect[3]===l.rect[1])continue;o.data=l;const h=U0.create(o);if(!h.isRenderable)continue;if(!u&&l.popupRef){const m=s.get(l.popupRef);m?m.push(h):s.set(l.popupRef,[h])}const f=h.render();l.hidden&&(f.style.visibility="hidden"),await this.#r(f,l.id,o.elements),h._isEditable&&(this.#n.set(h.data.id,h),this._annotationEditorUIManager?.renderAnnotationElement(h))}this.#i()}async addLinkAnnotations(t,e){const n={data:null,layer:this.div,linkService:e,svgFactory:new Gf,parent:this};for(const s of t){s.borderStyle||=a_._defaultBorderStyle,n.data=s;const o=U0.create(n);if(!o.isRenderable)continue;const l=o.render();await this.#r(l,s.id,null)}}update({viewport:t}){const e=this.div;this.viewport=t,Ao(e,{rotation:t.rotation}),this.#i(),e.hidden=!1}#i(){if(!this.#e)return;const t=this.div;for(const[e,n]of this.#e){const s=t.querySelector(`[data-annotation-id="${e}"]`);if(!s)continue;n.className="annotationContent";const{firstChild:o}=s;o?o.nodeName==="CANVAS"?o.replaceWith(n):o.classList.contains("annotationContent")?o.after(n):o.before(n):s.append(n);const l=this.#n.get(e);l&&(l._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,s.id,n),l._hasNoCanvas=!1):l.canvas=n)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#n.values())}getEditableAnnotation(t){return this.#n.get(t)}static get _defaultBorderStyle(){return Gt(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Cl.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const nf=/\r\n?|\n/g;class on extends Rt{#t;#e="";#n=`${this.id}-editor`;#s=null;#r;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=on.prototype,e=o=>o.isEmpty(),n=ya.TRANSLATE_SMALL,s=ya.TRANSLATE_BIG;return Gt(this,"_keyboardManager",new gh([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[n,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,n],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}]]))}static _type="freetext";static _editorType=Vt.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.#t=t.color||on._defaultColor||Rt._defaultLineColor,this.#r=t.fontSize||on._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(t,e){Rt.initialize(t,e);const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case Xt.FREETEXT_SIZE:on._defaultFontSize=e;break;case Xt.FREETEXT_COLOR:on._defaultColor=e;break}}updateParams(t,e){switch(t){case Xt.FREETEXT_SIZE:this.#i(e);break;case Xt.FREETEXT_COLOR:this.#a(e);break}}static get defaultPropertiesToUpdate(){return[[Xt.FREETEXT_SIZE,on._defaultFontSize],[Xt.FREETEXT_COLOR,on._defaultColor||Rt._defaultLineColor]]}get propertiesToUpdate(){return[[Xt.FREETEXT_SIZE,this.#r],[Xt.FREETEXT_COLOR,this.#t]]}get toolbarButtons(){return this._colorPicker||=new Wu(this),[["colorPicker",this._colorPicker]]}get colorType(){return Xt.FREETEXT_COLOR}get colorValue(){return this.#t}#i(t){const e=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--total-scale-factor))`,this.translate(0,-(s-this.#r)*this.parentScale),this.#r=s,this.#u()},n=this.#r;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Xt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#a(t){const e=s=>{this.#t=this.editorDiv.style.color=s,this._colorPicker?.update(s)},n=this.#t;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Xt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-on._internalPadding*t,-(on._internalPadding+this.#r)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#s=new AbortController;const t=this._uiManager.combinedSignal(this.#s);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#n),this._isDraggable=!0,this.#s?.abort(),this.#s=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){const t=[];this.editorDiv.normalize();let e=null;for(const n of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&n.nodeName==="BR"||(t.push(on.#c(n)),e=n);return t.join(`
`)}#u(){const[t,e]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:s,div:o}=this,l=o.style.display,u=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",s.div.append(this.div),n=o.getBoundingClientRect(),o.remove(),o.style.display=l,o.classList.toggle("hidden",u)}this.rotation%180===this.parentRotation%180?(this.width=n.width/t,this.height=n.height/e):(this.width=n.height/t,this.height=n.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#e,e=this.#e=this.#o().trimEnd();if(t===e)return;const n=s=>{if(this.#e=s,!s){this.remove();return}this.#d(),this._uiManager.rebuild(this),this.#u()};this.addCommands({cmd:()=>{n(e)},undo:()=>{n(t)},mustExec:!1}),this.#u()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){on._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#n),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${this.#r}px * var(--total-scale-factor))`,n.color=this.#t,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[s,o]=this.parentDimensions;if(this.annotationElementId){const{position:l}=this._initialData;let[u,h]=this.getInitialTranslation();[u,h]=this.pageTranslationToScreen(u,h);const[f,m]=this.pageDimensions,[v,b]=this.pageTranslation;let A,S;switch(this.rotation){case 0:A=t+(l[0]-v)/f,S=e+this.height-(l[1]-b)/m;break;case 90:A=t+(l[0]-v)/f,S=e-(l[1]-b)/m,[u,h]=[h,-u];break;case 180:A=t-this.width+(l[0]-v)/f,S=e-(l[1]-b)/m,[u,h]=[-u,-h];break;case 270:A=t+(l[0]-v-this.height*m)/f,S=e+(l[1]-b-this.width*f)/m,[u,h]=[-h,u];break}this.setAt(A*s,S*o,u,h)}else this._moveAfterPaste(t,e);this.#d(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(nf,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:n}=e;if(n.length===1&&n[0]==="text/plain")return;t.preventDefault();const s=on.#p(e.getData("text")||"").replaceAll(nf,`
`);if(!s)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const l=o.getRangeAt(0);if(!s.includes(`
`)){l.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:u,startOffset:h}=l,f=[],m=[];if(u.nodeType===Node.TEXT_NODE){const A=u.parentElement;if(m.push(u.nodeValue.slice(h).replaceAll(nf,"")),A!==this.editorDiv){let S=f;for(const E of this.editorDiv.childNodes){if(E===A){S=m;continue}S.push(on.#c(E))}}f.push(u.nodeValue.slice(0,h).replaceAll(nf,""))}else if(u===this.editorDiv){let A=f,S=0;for(const E of this.editorDiv.childNodes)S++===h&&(A=m),A.push(on.#c(E))}this.#e=`${f.join(`
`)}${s}${m.join(`
`)}`,this.#d();const v=new Range;let b=Math.sumPrecise(f.map(A=>A.length));for(const{firstChild:A}of this.editorDiv.childNodes)if(A.nodeType===Node.TEXT_NODE){const S=A.nodeValue.length;if(b<=S){v.setStart(A,b),v.setEnd(A,b);break}b-=S}o.removeAllRanges(),o.addRange(v)}#d(){if(this.editorDiv.replaceChildren(),!!this.#e)for(const t of this.#e.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#l(){return this.#e.replaceAll(""," ")}static#p(t){return t.replaceAll(" ","")}get contentDiv(){return this.editorDiv}static async deserialize(t,e,n){let s=null;if(t instanceof l1){const{data:{defaultAppearanceData:{fontSize:l,fontColor:u},rect:h,rotation:f,id:m,popupRef:v,contentsObj:b},textContent:A,textPosition:S,parent:{page:{pageNumber:E}}}=t;if(!A||A.length===0)return null;s=t={annotationType:Vt.FREETEXT,color:Array.from(u),fontSize:l,value:A.join(`
`),position:S,pageIndex:E-1,rect:h.slice(0),rotation:f,annotationElementId:m,id:m,deleted:!1,popupRef:v,comment:b?.str||null}}const o=await super.deserialize(t,e,n);return o.#r=t.fontSize,o.#t=Tt.makeHexColor(...t.color),o.#e=on.#p(t.value),o._initialData=s,t.comment&&o.setCommentData(t.comment),o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=on._internalPadding*this.parentScale,n=this.getRect(e,e),s=Rt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#t),o={annotationType:Vt.FREETEXT,color:s,fontSize:this.#r,value:this.#l(),pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(o),t?(o.isCopy=!0,o):this.annotationElementId&&!this.#g(o)?null:(o.id=this.annotationElementId,o)}#g(t){const{value:e,fontSize:n,color:s,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==n||t.color.some((l,u)=>l!==s[u])||t.pageIndex!==o}renderAnnotationElement(t){const e=super.renderAnnotationElement(t),{style:n}=e;n.fontSize=`calc(${this.#r}px * var(--total-scale-factor))`,n.color=this.#t,e.replaceChildren();for(const l of this.#e.split(`
`)){const u=document.createElement("div");u.append(l?document.createTextNode(l):document.createElement("br")),e.append(u)}const s=on._internalPadding*this.parentScale,o={rect:this.getRect(s,s)};return o.popup=this.hasEditedComment?this.comment:{text:this.#e},t.updateEdited(o),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class _t{static PRECISION=1e-4;toSVGPath(){ye("Abstract method `toSVGPath` must be implemented.")}get box(){ye("Abstract getter `box` must be implemented.")}serialize(t,e){ye("Abstract method `serialize` must be implemented.")}static _rescale(t,e,n,s,o,l){l||=new Float32Array(t.length);for(let u=0,h=t.length;u<h;u+=2)l[u]=e+t[u]*s,l[u+1]=n+t[u+1]*o;return l}static _rescaleAndSwap(t,e,n,s,o,l){l||=new Float32Array(t.length);for(let u=0,h=t.length;u<h;u+=2)l[u]=e+t[u+1]*s,l[u+1]=n+t[u]*o;return l}static _translate(t,e,n,s){s||=new Float32Array(t.length);for(let o=0,l=t.length;o<l;o+=2)s[o]=e+t[o],s[o+1]=n+t[o+1];return s}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,n,s,o){switch(o){case 90:return[1-e/n,t/s];case 180:return[1-t/n,1-e/s];case 270:return[e/n,1-t/s];default:return[t/n,e/s]}}static _normalizePagePoint(t,e,n){switch(n){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,n,s,o,l){return[(t+5*n)/6,(e+5*s)/6,(5*n+o)/6,(5*s+l)/6,(n+o)/2,(s+l)/2]}}class lo{#t;#e=[];#n;#s;#r=[];#i=new Float32Array(18);#a;#o;#u;#c;#d;#l;#p=[];static#g=8;static#f=2;static#h=lo.#g+lo.#f;constructor({x:t,y:e},n,s,o,l,u=0){this.#t=n,this.#l=o*s,this.#s=l,this.#i.set([NaN,NaN,NaN,NaN,t,e],6),this.#n=u,this.#c=lo.#g*s,this.#u=lo.#h*s,this.#d=s,this.#p.push(t,e)}isEmpty(){return isNaN(this.#i[8])}#m(){const t=this.#i.subarray(4,6),e=this.#i.subarray(16,18),[n,s,o,l]=this.#t;return[(this.#a+(t[0]-e[0])/2-n)/o,(this.#o+(t[1]-e[1])/2-s)/l,(this.#a+(e[0]-t[0])/2-n)/o,(this.#o+(e[1]-t[1])/2-s)/l]}add({x:t,y:e}){this.#a=t,this.#o=e;const[n,s,o,l]=this.#t;let[u,h,f,m]=this.#i.subarray(8,12);const v=t-f,b=e-m,A=Math.hypot(v,b);if(A<this.#u)return!1;const S=A-this.#c,E=S/A,T=E*v,C=E*b;let L=u,k=h;u=f,h=m,f+=T,m+=C,this.#p?.push(t,e);const V=-C/S,P=T/S,G=V*this.#l,I=P*this.#l;return this.#i.set(this.#i.subarray(2,8),0),this.#i.set([f+G,m+I],4),this.#i.set(this.#i.subarray(14,18),12),this.#i.set([f-G,m-I],16),isNaN(this.#i[6])?(this.#r.length===0&&(this.#i.set([u+G,h+I],2),this.#r.push(NaN,NaN,NaN,NaN,(u+G-n)/o,(h+I-s)/l),this.#i.set([u-G,h-I],14),this.#e.push(NaN,NaN,NaN,NaN,(u-G-n)/o,(h-I-s)/l)),this.#i.set([L,k,u,h,f,m],6),!this.isEmpty()):(this.#i.set([L,k,u,h,f,m],6),Math.abs(Math.atan2(k-h,L-u)-Math.atan2(C,T))<Math.PI/2?([u,h,f,m]=this.#i.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((u+f)/2-n)/o,((h+m)/2-s)/l),[u,h,L,k]=this.#i.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((L+u)/2-n)/o,((k+h)/2-s)/l),!0):([L,k,u,h,f,m]=this.#i.subarray(0,6),this.#r.push(((L+5*u)/6-n)/o,((k+5*h)/6-s)/l,((5*u+f)/6-n)/o,((5*h+m)/6-s)/l,((u+f)/2-n)/o,((h+m)/2-s)/l),[f,m,u,h,L,k]=this.#i.subarray(12,18),this.#e.push(((L+5*u)/6-n)/o,((k+5*h)/6-s)/l,((5*u+f)/6-n)/o,((5*h+m)/6-s)/l,((u+f)/2-n)/o,((h+m)/2-s)/l),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#r,e=this.#e;if(isNaN(this.#i[6])&&!this.isEmpty())return this.#_();const n=[];n.push(`M${t[4]} ${t[5]}`);for(let s=6;s<t.length;s+=6)isNaN(t[s])?n.push(`L${t[s+4]} ${t[s+5]}`):n.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);this.#A(n);for(let s=e.length-6;s>=6;s-=6)isNaN(e[s])?n.push(`L${e[s+4]} ${e[s+5]}`):n.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);return this.#y(n),n.join(" ")}#_(){const[t,e,n,s]=this.#t,[o,l,u,h]=this.#m();return`M${(this.#i[2]-t)/n} ${(this.#i[3]-e)/s} L${(this.#i[4]-t)/n} ${(this.#i[5]-e)/s} L${o} ${l} L${u} ${h} L${(this.#i[16]-t)/n} ${(this.#i[17]-e)/s} L${(this.#i[14]-t)/n} ${(this.#i[15]-e)/s} Z`}#y(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#A(t){const[e,n,s,o]=this.#t,l=this.#i.subarray(4,6),u=this.#i.subarray(16,18),[h,f,m,v]=this.#m();t.push(`L${(l[0]-e)/s} ${(l[1]-n)/o} L${h} ${f} L${m} ${v} L${(u[0]-e)/s} ${(u[1]-n)/o}`)}newFreeDrawOutline(t,e,n,s,o,l){return new d1(t,e,n,s,o,l)}getOutlines(){const t=this.#r,e=this.#e,n=this.#i,[s,o,l,u]=this.#t,h=new Float32Array((this.#p?.length??0)+2);for(let v=0,b=h.length-2;v<b;v+=2)h[v]=(this.#p[v]-s)/l,h[v+1]=(this.#p[v+1]-o)/u;if(h[h.length-2]=(this.#a-s)/l,h[h.length-1]=(this.#o-o)/u,isNaN(n[6])&&!this.isEmpty())return this.#w(h);const f=new Float32Array(this.#r.length+24+this.#e.length);let m=t.length;for(let v=0;v<m;v+=2){if(isNaN(t[v])){f[v]=f[v+1]=NaN;continue}f[v]=t[v],f[v+1]=t[v+1]}m=this.#S(f,m);for(let v=e.length-6;v>=6;v-=6)for(let b=0;b<6;b+=2){if(isNaN(e[v+b])){f[m]=f[m+1]=NaN,m+=2;continue}f[m]=e[v+b],f[m+1]=e[v+b+1],m+=2}return this.#v(f,m),this.newFreeDrawOutline(f,h,this.#t,this.#d,this.#n,this.#s)}#w(t){const e=this.#i,[n,s,o,l]=this.#t,[u,h,f,m]=this.#m(),v=new Float32Array(36);return v.set([NaN,NaN,NaN,NaN,(e[2]-n)/o,(e[3]-s)/l,NaN,NaN,NaN,NaN,(e[4]-n)/o,(e[5]-s)/l,NaN,NaN,NaN,NaN,u,h,NaN,NaN,NaN,NaN,f,m,NaN,NaN,NaN,NaN,(e[16]-n)/o,(e[17]-s)/l,NaN,NaN,NaN,NaN,(e[14]-n)/o,(e[15]-s)/l],0),this.newFreeDrawOutline(v,t,this.#t,this.#d,this.#n,this.#s)}#v(t,e){const n=this.#e;return t.set([NaN,NaN,NaN,NaN,n[4],n[5]],e),e+=6}#S(t,e){const n=this.#i.subarray(4,6),s=this.#i.subarray(16,18),[o,l,u,h]=this.#t,[f,m,v,b]=this.#m();return t.set([NaN,NaN,NaN,NaN,(n[0]-o)/u,(n[1]-l)/h,NaN,NaN,NaN,NaN,f,m,NaN,NaN,NaN,NaN,v,b,NaN,NaN,NaN,NaN,(s[0]-o)/u,(s[1]-l)/h],e),e+=24}}class d1 extends _t{#t;#e=new Float32Array(4);#n;#s;#r;#i;#a;constructor(t,e,n,s,o,l){super(),this.#a=t,this.#r=e,this.#t=n,this.#i=s,this.#n=o,this.#s=l,this.lastPoint=[NaN,NaN],this.#o(l);const[u,h,f,m]=this.#e;for(let v=0,b=t.length;v<b;v+=2)t[v]=(t[v]-u)/f,t[v+1]=(t[v+1]-h)/m;for(let v=0,b=e.length;v<b;v+=2)e[v]=(e[v]-u)/f,e[v+1]=(e[v+1]-h)/m}toSVGPath(){const t=[`M${this.#a[4]} ${this.#a[5]}`];for(let e=6,n=this.#a.length;e<n;e+=6){if(isNaN(this.#a[e])){t.push(`L${this.#a[e+4]} ${this.#a[e+5]}`);continue}t.push(`C${this.#a[e]} ${this.#a[e+1]} ${this.#a[e+2]} ${this.#a[e+3]} ${this.#a[e+4]} ${this.#a[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,n,s],o){const l=n-t,u=s-e;let h,f;switch(o){case 0:h=_t._rescale(this.#a,t,s,l,-u),f=_t._rescale(this.#r,t,s,l,-u);break;case 90:h=_t._rescaleAndSwap(this.#a,t,e,l,u),f=_t._rescaleAndSwap(this.#r,t,e,l,u);break;case 180:h=_t._rescale(this.#a,n,e,-l,u),f=_t._rescale(this.#r,n,e,-l,u);break;case 270:h=_t._rescaleAndSwap(this.#a,n,s,-l,-u),f=_t._rescaleAndSwap(this.#r,n,s,-l,-u);break}return{outline:Array.from(h),points:[Array.from(f)]}}#o(t){const e=this.#a;let n=e[4],s=e[5];const o=[n,s,n,s];let l=n,u=s;const h=t?Math.max:Math.min;for(let m=6,v=e.length;m<v;m+=6){const b=e[m+4],A=e[m+5];if(isNaN(e[m]))Tt.pointBoundingBox(b,A,o),u<A?(l=b,u=A):u===A&&(l=h(l,b));else{const S=[1/0,1/0,-1/0,-1/0];Tt.bezierBoundingBox(n,s,...e.slice(m,m+6),S),Tt.rectBoundingBox(...S,o),u<S[3]?(l=S[2],u=S[3]):u===S[3]&&(l=h(l,S[2]))}n=b,s=A}const f=this.#e;f[0]=o[0]-this.#n,f[1]=o[1]-this.#n,f[2]=o[2]-o[0]+2*this.#n,f[3]=o[3]-o[1]+2*this.#n,this.lastPoint=[l,u]}get box(){return this.#e}newOutliner(t,e,n,s,o,l=0){return new lo(t,e,n,s,o,l)}getNewOutline(t,e){const[n,s,o,l]=this.#e,[u,h,f,m]=this.#t,v=o*f,b=l*m,A=n*f+u,S=s*m+h,E=this.newOutliner({x:this.#r[0]*v+A,y:this.#r[1]*b+S},this.#t,this.#i,t,this.#s,e??this.#n);for(let T=2;T<this.#r.length;T+=2)E.add({x:this.#r[T]*v+A,y:this.#r[T+1]*b+S});return E.getOutlines()}}class By{#t;#e;#n=[];#s=[];constructor(t,e=0,n=0,s=!0){const o=[1/0,1/0,-1/0,-1/0],l=10**-4;for(const{x:A,y:S,width:E,height:T}of t){const C=Math.floor((A-e)/l)*l,L=Math.ceil((A+E+e)/l)*l,k=Math.floor((S-e)/l)*l,V=Math.ceil((S+T+e)/l)*l,P=[C,k,V,!0],G=[L,k,V,!1];this.#n.push(P,G),Tt.rectBoundingBox(C,k,L,V,o)}const u=o[2]-o[0]+2*n,h=o[3]-o[1]+2*n,f=o[0]-n,m=o[1]-n,v=this.#n.at(s?-1:-2),b=[v[0],v[2]];for(const A of this.#n){const[S,E,T]=A;A[0]=(S-f)/u,A[1]=(E-m)/h,A[2]=(T-m)/h}this.#t=new Float32Array([f,m,u,h]),this.#e=b}getOutlines(){this.#n.sort((e,n)=>e[0]-n[0]||e[1]-n[1]||e[2]-n[2]);const t=[];for(const e of this.#n)e[3]?(t.push(...this.#u(e)),this.#a(e)):(this.#o(e),t.push(...this.#u(e)));return this.#r(t)}#r(t){const e=[],n=new Set;for(const l of t){const[u,h,f]=l;e.push([u,h,l],[u,f,l])}e.sort((l,u)=>l[1]-u[1]||l[0]-u[0]);for(let l=0,u=e.length;l<u;l+=2){const h=e[l][2],f=e[l+1][2];h.push(f),f.push(h),n.add(h),n.add(f)}const s=[];let o;for(;n.size>0;){const l=n.values().next().value;let[u,h,f,m,v]=l;n.delete(l);let b=u,A=h;for(o=[u,f],s.push(o);;){let S;if(n.has(m))S=m;else if(n.has(v))S=v;else break;n.delete(S),[u,h,f,m,v]=S,b!==u&&(o.push(b,A,u,A===h?h:f),b=u),A=A===h?f:h}o.push(b,A)}return new tV(s,this.#t,this.#e)}#i(t){const e=this.#s;let n=0,s=e.length-1;for(;n<=s;){const o=n+s>>1,l=e[o][0];if(l===t)return o;l<t?n=o+1:s=o-1}return s+1}#a([,t,e]){const n=this.#i(t);this.#s.splice(n,0,[t,e])}#o([,t,e]){const n=this.#i(t);for(let s=n;s<this.#s.length;s++){const[o,l]=this.#s[s];if(o!==t)break;if(o===t&&l===e){this.#s.splice(s,1);return}}for(let s=n-1;s>=0;s--){const[o,l]=this.#s[s];if(o!==t)break;if(o===t&&l===e){this.#s.splice(s,1);return}}}#u(t){const[e,n,s]=t,o=[[e,n,s]],l=this.#i(s);for(let u=0;u<l;u++){const[h,f]=this.#s[u];for(let m=0,v=o.length;m<v;m++){const[,b,A]=o[m];if(!(f<=b||A<=h)){if(b>=h){if(A>f)o[m][1]=f;else{if(v===1)return[];o.splice(m,1),m--,v--}continue}o[m][2]=h,A>f&&o.push([e,f,A])}}}return o}}class tV extends _t{#t;#e;constructor(t,e,n){super(),this.#e=t,this.#t=e,this.lastPoint=n}toSVGPath(){const t=[];for(const e of this.#e){let[n,s]=e;t.push(`M${n} ${s}`);for(let o=2;o<e.length;o+=2){const l=e[o],u=e[o+1];l===n?(t.push(`V${u}`),s=u):u===s&&(t.push(`H${l}`),n=l)}t.push("Z")}return t.join(" ")}serialize([t,e,n,s],o){const l=[],u=n-t,h=s-e;for(const f of this.#e){const m=new Array(f.length);for(let v=0;v<f.length;v+=2)m[v]=t+f[v]*u,m[v+1]=s-f[v+1]*h;l.push(m)}return l}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class zy extends lo{newFreeDrawOutline(t,e,n,s,o,l){return new eV(t,e,n,s,o,l)}}class eV extends d1{newOutliner(t,e,n,s,o,l=0){return new zy(t,e,n,s,o,l)}}class Fe extends Rt{#t=null;#e=0;#n;#s=null;#r=null;#i=null;#a=null;#o=0;#u=null;#c=null;#d=null;#l=!1;#p=null;#g;#f=null;#h="";#m;#_="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=Vt.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=Fe.prototype;return Gt(this,"_keyboardManager",new gh([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||Fe._defaultColor,this.#m=t.thickness||Fe._defaultThickness,this.#g=t.opacity||Fe._defaultOpacity,this.#n=t.boxes||null,this.#_=t.methodOfCreation||"",this.#h=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#l=!0,this.#A(t),this.#E()):this.#n&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#a=t.focusNode,this.#o=t.focusOffset,this.#y(),this.#E(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#l?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#m,methodOfCreation:this.#_}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}get commentColor(){return this.color}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#y(){const t=new By(this.#n,.001);this.#c=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#c.box;const e=new By(this.#n,.0025,.001,this._uiManager.direction==="ltr");this.#i=e.getOutlines();const{lastPoint:n}=this.#i;this.#p=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height]}#A({highlightOutlines:t,highlightId:e,clipPathId:n}){this.#c=t;const s=1.5;if(this.#i=t.getNewOutline(this.#m/2+s,.0025),e>=0)this.#d=e,this.#s=n,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#f=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#i.box,path:{d:this.#i.toSVGPath()}},!0);else if(this.parent){const m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#d,{bbox:Fe.#N(this.#c.box,(m-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#f,{bbox:Fe.#N(this.#i.box,m),path:{d:this.#i.toSVGPath()}})}const[o,l,u,h]=t.box;switch(this.rotation){case 0:this.x=o,this.y=l,this.width=u,this.height=h;break;case 90:{const[m,v]=this.parentDimensions;this.x=l,this.y=1-o,this.width=u*v/m,this.height=h*m/v;break}case 180:this.x=1-o,this.y=1-l,this.width=u,this.height=h;break;case 270:{const[m,v]=this.parentDimensions;this.x=1-l,this.y=o,this.width=u*v/m,this.height=h*m/v;break}}const{lastPoint:f}=this.#i;this.#p=[(f[0]-o)/u,(f[1]-l)/h]}static initialize(t,e){Rt.initialize(t,e),Fe._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case Xt.HIGHLIGHT_COLOR:Fe._defaultColor=e;break;case Xt.HIGHLIGHT_THICKNESS:Fe._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#p}updateParams(t,e){switch(t){case Xt.HIGHLIGHT_COLOR:this.#w(e);break;case Xt.HIGHLIGHT_THICKNESS:this.#v(e);break}}static get defaultPropertiesToUpdate(){return[[Xt.HIGHLIGHT_COLOR,Fe._defaultColor],[Xt.HIGHLIGHT_THICKNESS,Fe._defaultThickness]]}get propertiesToUpdate(){return[[Xt.HIGHLIGHT_COLOR,this.color||Fe._defaultColor],[Xt.HIGHLIGHT_THICKNESS,this.#m||Fe._defaultThickness],[Xt.HIGHLIGHT_FREE,this.#l]]}#w(t){const e=(o,l)=>{this.color=o,this.#g=l,this.parent?.drawLayer.updateProperties(this.#d,{root:{fill:o,"fill-opacity":l}}),this.#r?.updateColor(o)},n=this.color,s=this.#g;this.addCommands({cmd:e.bind(this,t,Fe._defaultOpacity),undo:e.bind(this,n,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Xt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#v(t){const e=this.#m,n=s=>{this.#m=s,this.#S(s)};this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Xt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#r=new Ps({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#x())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#x())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#I(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#E(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#I():t&&(this.#E(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#S(t){if(!this.#l)return;this.#A({highlightOutlines:this.#c.getNewOutline(t/2)}),this.fixAndSetPosition();const[e,n]=this.parentDimensions;this.setDims(this.width*e,this.height*n)}#I(){this.#d===null||!this.parent||(this.parent.drawLayer.remove(this.#d),this.#d=null,this.parent.drawLayer.remove(this.#f),this.#f=null)}#E(t=this.parent){this.#d===null&&({id:this.#d,clipPathId:this.#s}=t.drawLayer.draw({bbox:this.#c.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#g},rootClass:{highlight:!0,free:this.#l},path:{d:this.#c.toSVGPath()}},!1,!0),this.#f=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#l},bbox:this.#i.box,path:{d:this.#i.toSVGPath()}},this.#l),this.#u&&(this.#u.style.clipPath=this.#s))}static#N([t,e,n,s],o){switch(o){case 90:return[1-e-s,t,s,n];case 180:return[1-t-n,1-e-s,n,s];case 270:return[e,1-t-n,s,n]}return[t,e,n,s]}rotate(t){const{drawLayer:e}=this.parent;let n;this.#l?(t=(t-this.rotation+360)%360,n=Fe.#N(this.#c.box,t)):n=Fe.#N([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#d,{bbox:n,root:{"data-main-rotation":t}}),e.updateProperties(this.#f,{bbox:Fe.#N(this.#i.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#h&&(t.setAttribute("aria-label",this.#h),t.setAttribute("role","mark")),this.#l?t.classList.add("free"):this.div.addEventListener("keydown",this.#R.bind(this),{signal:this._uiManager._signal});const e=this.#u=document.createElement("div");t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#s;const[n,s]=this.parentDimensions;return this.setDims(this.width*n,this.height*s),Bx(this,this.#u,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{hovered:!1}})}#R(t){Fe._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#C(!0);break;case 1:case 3:this.#C(!1);break}}#C(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#a,this.#o)}select(){super.select(),this.#f&&this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#f&&(this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{selected:!1}}),this.#l||this.#C(!1))}get _mustFixPosition(){return!this.#l}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#d,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#f,{rootClass:{hidden:!t}}))}#x(){return this.#l?this.rotation:0}#M(){if(this.#l)return null;const[t,e]=this.pageDimensions,[n,s]=this.pageTranslation,o=this.#n,l=new Float32Array(o.length*8);let u=0;for(const{x:h,y:f,width:m,height:v}of o){const b=h*t+n,A=(1-f)*e+s;l[u]=l[u+4]=b,l[u+1]=l[u+3]=A,l[u+2]=l[u+6]=b+m*t,l[u+5]=l[u+7]=A-v*e,u+=8}return l}#j(t){return this.#c.serialize(t,this.#x())}static startHighlighting(t,e,{target:n,x:s,y:o}){const{x:l,y:u,width:h,height:f}=n.getBoundingClientRect(),m=new AbortController,v=t.combinedSignal(m),b=A=>{m.abort(),this.#B(t,A)};window.addEventListener("blur",b,{signal:v}),window.addEventListener("pointerup",b,{signal:v}),window.addEventListener("pointerdown",Qe,{capture:!0,passive:!1,signal:v}),window.addEventListener("contextmenu",js,{signal:v}),n.addEventListener("pointermove",this.#D.bind(this,t),{signal:v}),this._freeHighlight=new zy({x:s,y:o},[l,u,h,f],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#D(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#B(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,n){let s=null;if(t instanceof u1){const{data:{quadPoints:S,rect:E,rotation:T,id:C,color:L,opacity:k,popupRef:V,contentsObj:P},parent:{page:{pageNumber:G}}}=t;s=t={annotationType:Vt.HIGHLIGHT,color:Array.from(L),opacity:k,quadPoints:S,boxes:null,pageIndex:G-1,rect:E.slice(0),rotation:T,annotationElementId:C,id:C,deleted:!1,popupRef:V,comment:P?.str||null}}else if(t instanceof r_){const{data:{inkLists:S,rect:E,rotation:T,id:C,color:L,borderStyle:{rawWidth:k},popupRef:V,contentsObj:P},parent:{page:{pageNumber:G}}}=t;s=t={annotationType:Vt.HIGHLIGHT,color:Array.from(L),thickness:k,inkLists:S,boxes:null,pageIndex:G-1,rect:E.slice(0),rotation:T,annotationElementId:C,id:C,deleted:!1,popupRef:V,comment:P?.str||null}}const{color:o,quadPoints:l,inkLists:u,opacity:h}=t,f=await super.deserialize(t,e,n);f.color=Tt.makeHexColor(...o),f.#g=h||1,u&&(f.#m=t.thickness),f._initialData=s,t.comment&&f.setCommentData(t.comment);const[m,v]=f.pageDimensions,[b,A]=f.pageTranslation;if(l){const S=f.#n=[];for(let E=0;E<l.length;E+=8)S.push({x:(l[E]-b)/m,y:1-(l[E+1]-A)/v,width:(l[E+2]-l[E])/m,height:(l[E+1]-l[E+5])/v});f.#y(),f.#E(),f.rotate(f.rotation)}else if(u){f.#l=!0;const S=u[0],E={x:S[0]-b,y:v-(S[1]-A)},T=new zy(E,[0,0,m,v],1,f.#m/2,!0,.001);for(let k=0,V=S.length;k<V;k+=2)E.x=S[k]-b,E.y=v-(S[k+1]-A),T.add(E);const{id:C,clipPathId:L}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:f.color,"fill-opacity":f._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:T.toSVGPath()}},!0,!0);f.#A({highlightOutlines:T.getOutlines(),highlightId:C,clipPathId:L}),f.#E(),f.rotate(f.parentRotation)}return f}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=this.getRect(0,0),n=Rt._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),s={annotationType:Vt.HIGHLIGHT,color:n,opacity:this.#g,thickness:this.#m,quadPoints:this.#M(),outlines:this.#j(e),pageIndex:this.pageIndex,rect:e,rotation:this.#x(),structTreeParentId:this._structTreeParentId};return this.addComment(s),this.annotationElementId&&!this.#T(s)?null:(s.id=this.annotationElementId,s)}#T(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((n,s)=>n!==e[s])}renderAnnotationElement(t){const e={rect:this.getRect(0,0)};return this.hasEditedComment&&(e.popup=this.comment),t.updateEdited(e),null}static canCreateNewEmptyEditor(){return!1}}class f1{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,n]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,n)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){ye("Not implemented")}}class Mt extends Rt{#t=null;#e;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#n=null;static#s=null;static#r=null;static#i=NaN;static#a=null;static#o=null;static#u=NaN;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}_addOutlines(t){t.drawOutlines&&(this.#c(t),this.#p())}#c({drawOutlines:t,drawId:e,drawingOptions:n}){this.#t=t,this._drawingOptions||=n,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#d(t,this.parent),this.#h(t.box)}#d(t,e){const{id:n}=e.drawLayer.draw(Mt._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return n}static _mergeSVGProperties(t,e){const n=new Set(Object.keys(t));for(const[s,o]of Object.entries(e))n.has(s)?Object.assign(t[s],o):t[s]=o;return t}static getDefaultDrawingOptions(t){ye("Not implemented")}static get typesMap(){ye("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const n=this.typesMap.get(t);n&&this._defaultDrawingOptions.updateProperty(n,e),this._currentParent&&(Mt.#n.updateProperty(n,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const n=this.constructor.typesMap.get(t);n&&this._updateProperty(t,n,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[n,s]of this.typesMap)t.push([n,e[s]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[n,s]of this.constructor.typesMap)t.push([n,e[s]]);return t}_updateProperty(t,e,n){const s=this._drawingOptions,o=s[e],l=u=>{s.updateProperty(e,u);const h=this.#t.updateProperty(e,u);h&&this.#h(h),this.parent?.drawLayer.updateProperties(this._drawId,s.toSVGProperties()),t===this.colorType&&this._colorPicker?.update(u)};this.addCommands({cmd:l.bind(this,n),undo:l.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,Mt._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#f()),{bbox:this.#m()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,Mt._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#f()),{bbox:this.#m()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#m()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,Mt._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#f(),this.parentDimensions),{bbox:this.#m()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#l(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#p(),this.#h(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#l()):t&&(this._uiManager.addShouldRescale(this),this.#p(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#l(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#p(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#d(this.#t,t)}}#g([t,e,n,s]){const{parentDimensions:[o,l],rotation:u}=this;switch(u){case 90:return[e,1-t,n*(l/o),s*(o/l)];case 180:return[1-t,1-e,n,s];case 270:return[1-e,t,n*(l/o),s*(o/l)];default:return[t,e,n,s]}}#f(){const{x:t,y:e,width:n,height:s,parentDimensions:[o,l],rotation:u}=this;switch(u){case 90:return[1-e,t,n*(o/l),s*(l/o)];case 180:return[1-t,1-e,n,s];case 270:return[e,1-t,n*(o/l),s*(l/o)];default:return[t,e,n,s]}}#h(t){if([this.x,this.y,this.width,this.height]=this.#g(t),this.div){this.fixAndSetPosition();const[e,n]=this.parentDimensions;this.setDims(this.width*e,this.height*n)}this._onResized()}#m(){const{x:t,y:e,width:n,height:s,rotation:o,parentRotation:l,parentDimensions:[u,h]}=this;switch((o*4+l)/90){case 1:return[1-e-s,t,s,n];case 2:return[1-t-n,1-e-s,n,s];case 3:return[e,1-t-n,s,n];case 4:return[t,e-n*(u/h),s*(h/u),n*(u/h)];case 5:return[1-e,t,n*(u/h),s*(h/u)];case 6:return[1-t-s*(h/u),1-e,s*(h/u),n*(u/h)];case 7:return[e-n*(u/h),1-t-s*(h/u),n*(u/h),s*(h/u)];case 8:return[t-n,e-s,n,s];case 9:return[1-e,t-n,s,n];case 10:return[1-t,1-e,n,s];case 11:return[e-s,1-t,s,n];case 12:return[t-s*(h/u),e,s*(h/u),n*(u/h)];case 13:return[1-e-n*(u/h),t-s*(h/u),n*(u/h),s*(h/u)];case 14:return[1-t,1-e-n*(u/h),s*(h/u),n*(u/h)];case 15:return[e,1-t,n*(u/h),s*(h/u)];default:return[t,e,n,s]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Mt._mergeSVGProperties({bbox:this.#m()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#h(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const n=super.render();n.classList.add("draw");const s=document.createElement("div");n.append(s),s.setAttribute("aria-hidden","true"),s.className="internal";const[o,l]=this.parentDimensions;return this.setDims(this.width*o,this.height*l),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),n}static createDrawerInstance(t,e,n,s,o){ye("Not implemented")}static startDrawing(t,e,n,s){const{target:o,offsetX:l,offsetY:u,pointerId:h,pointerType:f}=s;if(Mt.#a&&Mt.#a!==f)return;const{viewport:{rotation:m}}=t,{width:v,height:b}=o.getBoundingClientRect(),A=Mt.#s=new AbortController,S=t.combinedSignal(A);if(Mt.#i||=h,Mt.#a??=f,window.addEventListener("pointerup",E=>{Mt.#i===E.pointerId?this._endDraw(E):Mt.#o?.delete(E.pointerId)},{signal:S}),window.addEventListener("pointercancel",E=>{Mt.#i===E.pointerId?this._currentParent.endDrawingSession():Mt.#o?.delete(E.pointerId)},{signal:S}),window.addEventListener("pointerdown",E=>{Mt.#a===E.pointerType&&((Mt.#o||=new Set).add(E.pointerId),Mt.#n.isCancellable()&&(Mt.#n.removeLastElement(),Mt.#n.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:S}),window.addEventListener("contextmenu",js,{signal:S}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:S}),o.addEventListener("touchmove",E=>{E.timeStamp===Mt.#u&&Qe(E)},{signal:S}),t.toggleDrawing(),e._editorUndoBar?.hide(),Mt.#n){t.drawLayer.updateProperties(this._currentDrawId,Mt.#n.startNew(l,u,v,b,m));return}e.updateUIForDefaultProperties(this),Mt.#n=this.createDrawerInstance(l,u,v,b,m),Mt.#r=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(Mt.#r.toSVGProperties(),Mt.#n.defaultSVGProperties),!0,!1)}static _drawMove(t){if(Mt.#u=-1,!Mt.#n)return;const{offsetX:e,offsetY:n,pointerId:s}=t;if(Mt.#i===s){if(Mt.#o?.size>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,Mt.#n.add(e,n)),Mt.#u=t.timeStamp,Qe(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,Mt.#n=null,Mt.#r=null,Mt.#a=null,Mt.#u=NaN),Mt.#s&&(Mt.#s.abort(),Mt.#s=null,Mt.#i=NaN,Mt.#o=null)}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,Mt.#n.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const n=Mt.#n,s=this._currentDrawId,o=n.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(s,n.setLastElement(o))},undo:()=>{e.drawLayer.updateProperties(s,n.removeLastElement())},mustExec:!1,type:Xt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(Xt.DRAW_STEP),!Mt.#n.isEmpty()){const{pageDimensions:[n,s],scale:o}=e,l=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:Mt.#n.getOutlines(n*o,s*o,o,this._INNER_MARGIN),drawingOptions:Mt.#r,mustBeCommitted:!t});return this._cleanup(!0),l}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,n,s,o,l){ye("Not implemented")}static async deserialize(t,e,n){const{rawDims:{pageWidth:s,pageHeight:o,pageX:l,pageY:u}}=e.viewport,h=this.deserializeDraw(l,u,s,o,this._INNER_MARGIN,t),f=await super.deserialize(t,e,n);return f.createDrawingOptions(t),f.#c({drawOutlines:h}),f.#p(),f.onScaleChanging(),f.rotate(),f}serializeDraw(t){const[e,n]=this.pageTranslation,[s,o]=this.pageDimensions;return this.#t.serialize([e,n,s,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}class nV{#t=new Float64Array(6);#e;#n;#s;#r;#i;#a="";#o=0;#u=new vh;#c;#d;constructor(t,e,n,s,o,l){this.#c=n,this.#d=s,this.#s=o,this.#r=l,[t,e]=this.#l(t,e);const u=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#i=[t,e],this.#n=[{line:u,points:this.#i}],this.#t.set(u,0)}updateProperty(t,e){t==="stroke-width"&&(this.#r=e)}#l(t,e){return _t._normalizePoint(t,e,this.#c,this.#d,this.#s)}isEmpty(){return!this.#n||this.#n.length===0}isCancellable(){return this.#i.length<=10}add(t,e){[t,e]=this.#l(t,e);const[n,s,o,l]=this.#t.subarray(2,6),u=t-o,h=e-l;return Math.hypot(this.#c*u,this.#d*h)<=2?null:(this.#i.push(t,e),isNaN(n)?(this.#t.set([o,l,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([n,s,o,l,t,e],0),this.#e.push(..._t.createBezierPoints(n,s,o,l,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const n=this.add(t,e);return n||(this.#i.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,n,s,o){this.#c=n,this.#d=s,this.#s=o,[t,e]=this.#l(t,e);const l=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#i=[t,e];const u=this.#n.at(-1);return u&&(u.line=new Float32Array(u.line),u.points=new Float32Array(u.points)),this.#n.push({line:l,points:this.#i}),this.#t.set(l,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#n.at(-1)}setLastElement(t){return this.#n?(this.#n.push(t),this.#e=t.line,this.#i=t.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#u.setLastElement(t)}removeLastElement(){if(!this.#n)return this.#u.removeLastElement();this.#n.pop(),this.#a="";for(let t=0,e=this.#n.length;t<e;t++){const{line:n,points:s}=this.#n[t];this.#e=n,this.#i=s,this.#o=0,this.toSVGPath()}return{path:{d:this.#a}}}toSVGPath(){const t=_t.svgRound(this.#e[4]),e=_t.svgRound(this.#e[5]);if(this.#i.length===2)return this.#a=`${this.#a} M ${t} ${e} Z`,this.#a;if(this.#i.length<=6){const s=this.#a.lastIndexOf("M");this.#a=`${this.#a.slice(0,s)} M ${t} ${e}`,this.#o=6}if(this.#i.length===4){const s=_t.svgRound(this.#e[10]),o=_t.svgRound(this.#e[11]);return this.#a=`${this.#a} L ${s} ${o}`,this.#o=12,this.#a}const n=[];this.#o===0&&(n.push(`M ${t} ${e}`),this.#o=6);for(let s=this.#o,o=this.#e.length;s<o;s+=6){const[l,u,h,f,m,v]=this.#e.slice(s,s+6).map(_t.svgRound);n.push(`C${l} ${u} ${h} ${f} ${m} ${v}`)}return this.#a+=n.join(" "),this.#o=this.#e.length,this.#a}getOutlines(t,e,n,s){const o=this.#n.at(-1);return o.line=new Float32Array(o.line),o.points=new Float32Array(o.points),this.#u.build(this.#n,t,e,n,this.#s,this.#r,s),this.#t=null,this.#e=null,this.#n=null,this.#a=null,this.#u}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class vh extends _t{#t;#e=0;#n;#s;#r;#i;#a;#o;#u;build(t,e,n,s,o,l,u){this.#r=e,this.#i=n,this.#a=s,this.#o=o,this.#u=l,this.#n=u??0,this.#s=t,this.#l()}get thickness(){return this.#u}setLastElement(t){return this.#s.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#s.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#s){if(t.push(`M${_t.svgRound(e[4])} ${_t.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${_t.svgRound(e[10])} ${_t.svgRound(e[11])}`);continue}for(let n=6,s=e.length;n<s;n+=6){const[o,l,u,h,f,m]=e.subarray(n,n+6).map(_t.svgRound);t.push(`C${o} ${l} ${u} ${h} ${f} ${m}`)}}return t.join("")}serialize([t,e,n,s],o){const l=[],u=[],[h,f,m,v]=this.#d();let b,A,S,E,T,C,L,k,V;switch(this.#o){case 0:V=_t._rescale,b=t,A=e+s,S=n,E=-s,T=t+h*n,C=e+(1-f-v)*s,L=t+(h+m)*n,k=e+(1-f)*s;break;case 90:V=_t._rescaleAndSwap,b=t,A=e,S=n,E=s,T=t+f*n,C=e+h*s,L=t+(f+v)*n,k=e+(h+m)*s;break;case 180:V=_t._rescale,b=t+n,A=e,S=-n,E=s,T=t+(1-h-m)*n,C=e+f*s,L=t+(1-h)*n,k=e+(f+v)*s;break;case 270:V=_t._rescaleAndSwap,b=t+n,A=e+s,S=-n,E=-s,T=t+(1-f-v)*n,C=e+(1-h-m)*s,L=t+(1-f)*n,k=e+(1-h)*s;break}for(const{line:P,points:G}of this.#s)l.push(V(P,b,A,S,E,o?new Array(P.length):null)),u.push(V(G,b,A,S,E,o?new Array(G.length):null));return{lines:l,points:u,rect:[T,C,L,k]}}static deserialize(t,e,n,s,o,{paths:{lines:l,points:u},rotation:h,thickness:f}){const m=[];let v,b,A,S,E;switch(h){case 0:E=_t._rescale,v=-t/n,b=e/s+1,A=1/n,S=-1/s;break;case 90:E=_t._rescaleAndSwap,v=-e/s,b=-t/n,A=1/s,S=1/n;break;case 180:E=_t._rescale,v=t/n+1,b=-e/s,A=-1/n,S=1/s;break;case 270:E=_t._rescaleAndSwap,v=e/s+1,b=t/n+1,A=-1/s,S=-1/n;break}if(!l){l=[];for(const C of u){const L=C.length;if(L===2){l.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1]]));continue}if(L===4){l.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1],NaN,NaN,NaN,NaN,C[2],C[3]]));continue}const k=new Float32Array(3*(L-2));l.push(k);let[V,P,G,I]=C.subarray(0,4);k.set([NaN,NaN,NaN,NaN,V,P],0);for(let N=4;N<L;N+=2){const M=C[N],j=C[N+1];k.set(_t.createBezierPoints(V,P,G,I,M,j),(N-2)*3),[V,P,G,I]=[G,I,M,j]}}}for(let C=0,L=l.length;C<L;C++)m.push({line:E(l[C].map(k=>k??NaN),v,b,A,S),points:E(u[C].map(k=>k??NaN),v,b,A,S)});const T=new this.prototype.constructor;return T.build(m,n,s,1,h,f,o),T}#c(t=this.#u){const e=this.#n+t/2*this.#a;return this.#o%180===0?[e/this.#r,e/this.#i]:[e/this.#i,e/this.#r]}#d(){const[t,e,n,s]=this.#t,[o,l]=this.#c(0);return[t+o,e+l,n-2*o,s-2*l]}#l(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:s}of this.#s){if(s.length<=12){for(let u=4,h=s.length;u<h;u+=6)Tt.pointBoundingBox(s[u],s[u+1],t);continue}let o=s[4],l=s[5];for(let u=6,h=s.length;u<h;u+=6){const[f,m,v,b,A,S]=s.subarray(u,u+6);Tt.bezierBoundingBox(o,l,f,m,v,b,A,S,t),o=A,l=S}}const[e,n]=this.#c();t[0]=Bn(t[0]-e,0,1),t[1]=Bn(t[1]-n,0,1),t[2]=Bn(t[2]+e,0,1),t[3]=Bn(t[3]+n,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#p(e):null}#p(t){const[e,n]=this.#c();this.#u=t;const[s,o]=this.#c(),[l,u]=[s-e,o-n],h=this.#t;return h[0]-=l,h[1]-=u,h[2]+=2*l,h[3]+=2*u,h}updateParentDimensions([t,e],n){const[s,o]=this.#c();this.#r=t,this.#i=e,this.#a=n;const[l,u]=this.#c(),h=l-s,f=u-o,m=this.#t;return m[0]-=h,m[1]-=f,m[2]+=2*h,m[3]+=2*f,m}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(_t.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${_t.svgRound(t)} ${_t.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let n=0,s=0,o=0,l=0,u=0,h=0;switch(this.#e){case 90:s=e/t,o=-t/e,u=t;break;case 180:n=-1,l=-1,u=t,h=e;break;case 270:s=-e/t,o=t/e,h=e;break;default:return""}return`matrix(${n} ${s} ${o} ${l} ${_t.svgRound(u)} ${_t.svgRound(h)})`}getPathResizingSVGProperties([t,e,n,s]){const[o,l]=this.#c(),[u,h,f,m]=this.#t;if(Math.abs(f-o)<=_t.PRECISION||Math.abs(m-l)<=_t.PRECISION){const E=t+n/2-(u+f/2),T=e+s/2-(h+m/2);return{path:{"transform-origin":`${_t.svgRound(t)} ${_t.svgRound(e)}`,transform:`${this.rotationTransform} translate(${E} ${T})`}}}const v=(n-2*o)/(f-2*o),b=(s-2*l)/(m-2*l),A=f/n,S=m/s;return{path:{"transform-origin":`${_t.svgRound(u)} ${_t.svgRound(h)}`,transform:`${this.rotationTransform} scale(${A} ${S}) translate(${_t.svgRound(o)} ${_t.svgRound(l)}) scale(${v} ${b}) translate(${_t.svgRound(-o)} ${_t.svgRound(-l)})`}}}getPathResizedSVGProperties([t,e,n,s]){const[o,l]=this.#c(),u=this.#t,[h,f,m,v]=u;if(u[0]=t,u[1]=e,u[2]=n,u[3]=s,Math.abs(m-o)<=_t.PRECISION||Math.abs(v-l)<=_t.PRECISION){const T=t+n/2-(h+m/2),C=e+s/2-(f+v/2);for(const{line:L,points:k}of this.#s)_t._translate(L,T,C,L),_t._translate(k,T,C,k);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${_t.svgRound(t)} ${_t.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const b=(n-2*o)/(m-2*o),A=(s-2*l)/(v-2*l),S=-b*(h+o)+t+o,E=-A*(f+l)+e+l;if(b!==1||A!==1||S!==0||E!==0)for(const{line:T,points:C}of this.#s)_t._rescale(T,S,E,b,A,T),_t._rescale(C,S,E,b,A,C);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${_t.svgRound(t)} ${_t.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],n){const[s,o]=n,l=this.#t,u=t-l[0],h=e-l[1];if(this.#r===s&&this.#i===o)for(const{line:f,points:m}of this.#s)_t._translate(f,u,h,f),_t._translate(m,u,h,m);else{const f=this.#r/s,m=this.#i/o;this.#r=s,this.#i=o;for(const{line:v,points:b}of this.#s)_t._rescale(v,u,h,f,m,v),_t._rescale(b,u,h,f,m,b);l[2]*=f,l[3]*=m}return l[0]=t,l[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${_t.svgRound(t)} ${_t.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${_t.svgRound(t[0])} ${_t.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class Tp extends f1{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:Rt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new Tp(this._viewParameters);return t.updateAll(this),t}}class o_ extends Mt{static _type="ink";static _editorType=Vt.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){Rt.initialize(t,e),this._defaultDrawingOptions=new Tp(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return Gt(this,"typesMap",new Map([[Xt.INK_THICKNESS,"stroke-width"],[Xt.INK_COLOR,"stroke"],[Xt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,n,s,o){return new nV(t,e,n,s,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,n,s,o,l){return vh.deserialize(t,e,n,s,o,l)}static async deserialize(t,e,n){let s=null;if(t instanceof r_){const{data:{inkLists:l,rect:u,rotation:h,id:f,color:m,opacity:v,borderStyle:{rawWidth:b},popupRef:A,contentsObj:S},parent:{page:{pageNumber:E}}}=t;s=t={annotationType:Vt.INK,color:Array.from(m),thickness:b,opacity:v,paths:{points:l},boxes:null,pageIndex:E-1,rect:u.slice(0),rotation:h,annotationElementId:f,id:f,deleted:!1,popupRef:A,comment:S?.str||null}}const o=await super.deserialize(t,e,n);return o._initialData=s,t.comment&&o.setCommentData(t.comment),o}get toolbarButtons(){return this._colorPicker||=new Wu(this),[["colorPicker",this._colorPicker]]}get colorType(){return Xt.INK_COLOR}get colorValue(){return this._drawingOptions.stroke}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:n}=this;e.updateSVGProperty("stroke-width"),n.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:n}){this._drawingOptions=o_.getDefaultDrawingOptions({stroke:Tt.makeHexColor(...t),"stroke-width":e,"stroke-opacity":n})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:n,rect:s}=this.serializeDraw(t),{_drawingOptions:{stroke:o,"stroke-opacity":l,"stroke-width":u}}=this,h={annotationType:Vt.INK,color:Rt._colorManager.convert(o),opacity:l,thickness:u,paths:{lines:e,points:n},pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(h),t?(h.isCopy=!0,h):this.annotationElementId&&!this.#t(h)?null:(h.id=this.annotationElementId,h)}#t(t){const{color:e,thickness:n,opacity:s,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((l,u)=>l!==e[u])||t.thickness!==n||t.opacity!==s||t.pageIndex!==o}renderAnnotationElement(t){const{points:e,rect:n}=this.serializeDraw(!1),s={rect:n,thickness:this._drawingOptions["stroke-width"],points:e};return this.hasEditedComment&&(s.popup=this.comment),t.updateEdited(s),null}}class Hy extends vh{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const sf=8,yu=3;class Il{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(t,e,n,s){return n-=t,s-=e,n===0?s>0?0:4:n===1?s+6:2-s}static#n=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#s(t,e,n,s,o,l,u){const h=this.#e(n,s,o,l);for(let f=0;f<8;f++){const m=(-f+h-u+16)%8,v=this.#n[2*m],b=this.#n[2*m+1];if(t[(n+v)*e+(s+b)]!==0)return m}return-1}static#r(t,e,n,s,o,l,u){const h=this.#e(n,s,o,l);for(let f=0;f<8;f++){const m=(f+h+u+16)%8,v=this.#n[2*m],b=this.#n[2*m+1];if(t[(n+v)*e+(s+b)]!==0)return m}return-1}static#i(t,e,n,s){const o=t.length,l=new Int32Array(o);for(let m=0;m<o;m++)l[m]=t[m]<=s?1:0;for(let m=1;m<n-1;m++)l[m*e]=l[m*e+e-1]=0;for(let m=0;m<e;m++)l[m]=l[e*n-1-m]=0;let u=1,h;const f=[];for(let m=1;m<n-1;m++){h=1;for(let v=1;v<e-1;v++){const b=m*e+v,A=l[b];if(A===0)continue;let S=m,E=v;if(A===1&&l[b-1]===0)u+=1,E-=1;else if(A>=1&&l[b+1]===0)u+=1,E+=1,A>1&&(h=A);else{A!==1&&(h=Math.abs(A));continue}const T=[v,m],C=E===v+1,L={isHole:C,points:T,id:u,parent:0};f.push(L);let k;for(const F of f)if(F.id===h){k=F;break}k?k.isHole?L.parent=C?k.parent:h:L.parent=C?h:k.parent:L.parent=C?h:0;const V=this.#s(l,e,m,v,S,E,0);if(V===-1){l[b]=-u,l[b]!==1&&(h=Math.abs(l[b]));continue}let P=this.#n[2*V],G=this.#n[2*V+1];const I=m+P,N=v+G;S=I,E=N;let M=m,j=v;for(;;){const F=this.#r(l,e,M,j,S,E,1);P=this.#n[2*F],G=this.#n[2*F+1];const z=M+P,U=j+G;T.push(U,z);const st=M*e+j;if(l[st+1]===0?l[st]=-u:l[st]===1&&(l[st]=u),z===m&&U===v&&M===I&&j===N){l[b]!==1&&(h=Math.abs(l[b]));break}else S=M,E=j,M=z,j=U}}}return f}static#a(t,e,n,s){if(n-e<=4){for(let I=e;I<n-2;I+=2)s.push(t[I],t[I+1]);return}const o=t[e],l=t[e+1],u=t[n-4]-o,h=t[n-3]-l,f=Math.hypot(u,h),m=u/f,v=h/f,b=m*l-v*o,A=h/u,S=1/f,E=Math.atan(A),T=Math.cos(E),C=Math.sin(E),L=S*(Math.abs(T)+Math.abs(C)),k=S*(1-L+L**2),V=Math.max(Math.atan(Math.abs(C+T)*k),Math.atan(Math.abs(C-T)*k));let P=0,G=e;for(let I=e+2;I<n-2;I+=2){const N=Math.abs(b-m*t[I+1]+v*t[I]);N>P&&(G=I,P=N)}P>(f*V)**2?(this.#a(t,e,G+2,s),this.#a(t,G,n,s)):s.push(o,l)}static#o(t){const e=[],n=t.length;return this.#a(t,0,n,e),e.push(t[n-2],t[n-1]),e.length<=4?null:e}static#u(t,e,n,s,o,l){const u=new Float32Array(l**2),h=-2*s**2,f=l>>1;for(let E=0;E<l;E++){const T=(E-f)**2;for(let C=0;C<l;C++)u[E*l+C]=Math.exp((T+(C-f)**2)/h)}const m=new Float32Array(256),v=-2*o**2;for(let E=0;E<256;E++)m[E]=Math.exp(E**2/v);const b=t.length,A=new Uint8Array(b),S=new Uint32Array(256);for(let E=0;E<n;E++)for(let T=0;T<e;T++){const C=E*e+T,L=t[C];let k=0,V=0;for(let G=0;G<l;G++){const I=E+G-f;if(!(I<0||I>=n))for(let N=0;N<l;N++){const M=T+N-f;if(M<0||M>=e)continue;const j=t[I*e+M],F=u[G*l+N]*m[Math.abs(j-L)];k+=j*F,V+=F}}const P=A[C]=Math.round(k/V);S[P]++}return[A,S]}static#c(t){const e=new Uint32Array(256);for(const n of t)e[n]++;return e}static#d(t){const e=t.length,n=new Uint8ClampedArray(e>>2);let s=-1/0,o=1/0;for(let u=0,h=n.length;u<h;u++){const f=n[u]=t[u<<2];s=Math.max(s,f),o=Math.min(o,f)}const l=255/(s-o);for(let u=0,h=n.length;u<h;u++)n[u]=(n[u]-o)*l;return n}static#l(t){let e,n=-1/0,s=-1/0;const o=t.findIndex(h=>h!==0);let l=o,u=o;for(e=o;e<256;e++){const h=t[e];h>n&&(e-l>s&&(s=e-l,u=e-1),n=h,l=e)}for(e=u-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#p(t){const e=t,{width:n,height:s}=t,{maxDim:o}=this.#t;let l=n,u=s;if(n>o||s>o){let b=n,A=s,S=Math.log2(Math.max(n,s)/o);const E=Math.floor(S);S=S===E?E-1:E;for(let C=0;C<S;C++){l=Math.ceil(b/2),u=Math.ceil(A/2);const L=new OffscreenCanvas(l,u);L.getContext("2d").drawImage(t,0,0,b,A,0,0,l,u),b=l,A=u,t!==e&&t.close(),t=L.transferToImageBitmap()}const T=Math.min(o/l,o/u);l=Math.round(l*T),u=Math.round(u*T)}const f=new OffscreenCanvas(l,u).getContext("2d",{willReadFrequently:!0});f.fillStyle="white",f.fillRect(0,0,l,u),f.filter="grayscale(1)",f.drawImage(t,0,0,t.width,t.height,0,0,l,u);const m=f.getImageData(0,0,l,u).data;return[this.#d(m),l,u]}static extractContoursFromText(t,{fontFamily:e,fontStyle:n,fontWeight:s},o,l,u,h){let f=new OffscreenCanvas(1,1),m=f.getContext("2d",{alpha:!1});const v=200,b=m.font=`${n} ${s} ${v}px ${e}`,{actualBoundingBoxLeft:A,actualBoundingBoxRight:S,actualBoundingBoxAscent:E,actualBoundingBoxDescent:T,fontBoundingBoxAscent:C,fontBoundingBoxDescent:L,width:k}=m.measureText(t),V=1.5,P=Math.ceil(Math.max(Math.abs(A)+Math.abs(S)||0,k)*V),G=Math.ceil(Math.max(Math.abs(E)+Math.abs(T)||v,Math.abs(C)+Math.abs(L)||v)*V);f=new OffscreenCanvas(P,G),m=f.getContext("2d",{alpha:!0,willReadFrequently:!0}),m.font=b,m.filter="grayscale(1)",m.fillStyle="white",m.fillRect(0,0,P,G),m.fillStyle="black",m.fillText(t,P*(V-1)/2,G*(3-V)/2);const I=this.#d(m.getImageData(0,0,P,G).data),N=this.#c(I),M=this.#l(N),j=this.#i(I,P,G,M);return this.processDrawnLines({lines:{curves:j,width:P,height:G},pageWidth:o,pageHeight:l,rotation:u,innerMargin:h,mustSmooth:!0,areContours:!0})}static process(t,e,n,s,o){const[l,u,h]=this.#p(t),[f,m]=this.#u(l,u,h,Math.hypot(u,h)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),v=this.#l(m),b=this.#i(f,u,h,v);return this.processDrawnLines({lines:{curves:b,width:u,height:h},pageWidth:e,pageHeight:n,rotation:s,innerMargin:o,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:n,rotation:s,innerMargin:o,mustSmooth:l,areContours:u}){s%180!==0&&([e,n]=[n,e]);const{curves:h,width:f,height:m}=t,v=t.thickness??0,b=[],A=Math.min(e/f,n/m),S=A/e,E=A/n,T=[];for(const{points:L}of h){const k=l?this.#o(L):L;if(!k)continue;T.push(k);const V=k.length,P=new Float32Array(V),G=new Float32Array(3*(V===2?2:V-2));if(b.push({line:G,points:P}),V===2){P[0]=k[0]*S,P[1]=k[1]*E,G.set([NaN,NaN,NaN,NaN,P[0],P[1]],0);continue}let[I,N,M,j]=k;I*=S,N*=E,M*=S,j*=E,P.set([I,N,M,j],0),G.set([NaN,NaN,NaN,NaN,I,N],0);for(let F=4;F<V;F+=2){const z=P[F]=k[F]*S,U=P[F+1]=k[F+1]*E;G.set(_t.createBezierPoints(I,N,M,j,z,U),(F-2)*3),[I,N,M,j]=[M,j,z,U]}}if(b.length===0)return null;const C=u?new Hy:new vh;return C.build(b,e,n,1,s,u?0:v,o),{outline:C,newCurves:T,areContours:u,thickness:v,width:f,height:m}}static async compressSignature({outlines:t,areContours:e,thickness:n,width:s,height:o}){let l=1/0,u=-1/0,h=0;for(const k of t){h+=k.length;for(let V=2,P=k.length;V<P;V++){const G=k[V]-k[V-2];l=Math.min(l,G),u=Math.max(u,G)}}let f;l>=-128&&u<=127?f=Int8Array:l>=-32768&&u<=32767?f=Int16Array:f=Int32Array;const m=t.length,v=sf+yu*m,b=new Uint32Array(v);let A=0;b[A++]=v*Uint32Array.BYTES_PER_ELEMENT+(h-2*m)*f.BYTES_PER_ELEMENT,b[A++]=0,b[A++]=s,b[A++]=o,b[A++]=e?0:1,b[A++]=Math.max(0,Math.floor(n??0)),b[A++]=m,b[A++]=f.BYTES_PER_ELEMENT;for(const k of t)b[A++]=k.length-2,b[A++]=k[0],b[A++]=k[1];const S=new CompressionStream("deflate-raw"),E=S.writable.getWriter();await E.ready,E.write(b);const T=f.prototype.constructor;for(const k of t){const V=new T(k.length-2);for(let P=2,G=k.length;P<G;P++)V[P-2]=k[P]-k[P-2];E.write(V)}E.close();const C=await new Response(S.readable).arrayBuffer(),L=new Uint8Array(C);return Fx(L)}static async decompressSignature(t){try{const e=TO(t),{readable:n,writable:s}=new DecompressionStream("deflate-raw"),o=s.getWriter();await o.ready,o.write(e).then(async()=>{await o.ready,await o.close()}).catch(()=>{});let l=null,u=0;for await(const k of n)l||=new Uint8Array(new Uint32Array(k.buffer,0,4)[0]),l.set(k,u),u+=k.length;const h=new Uint32Array(l.buffer,0,l.length>>2),f=h[1];if(f!==0)throw new Error(`Invalid version: ${f}`);const m=h[2],v=h[3],b=h[4]===0,A=h[5],S=h[6],E=h[7],T=[],C=(sf+yu*S)*Uint32Array.BYTES_PER_ELEMENT;let L;switch(E){case Int8Array.BYTES_PER_ELEMENT:L=new Int8Array(l.buffer,C);break;case Int16Array.BYTES_PER_ELEMENT:L=new Int16Array(l.buffer,C);break;case Int32Array.BYTES_PER_ELEMENT:L=new Int32Array(l.buffer,C);break}u=0;for(let k=0;k<S;k++){const V=h[yu*k+sf],P=new Float32Array(V+2);T.push(P);for(let G=0;G<yu-1;G++)P[G]=h[yu*k+sf+G+1];for(let G=0;G<V;G++)P[G+2]=P[G]+L[u++]}return{areContours:b,thickness:A,outlines:T,width:m,height:v}}catch(e){return Ut(`decompressSignature: ${e}`),null}}}class l_ extends f1{constructor(){super(),super.updateProperties({fill:Rt._defaultLineColor,"stroke-width":0})}clone(){const t=new l_;return t.updateAll(this),t}}class c_ extends Tp{constructor(t){super(t),super.updateProperties({stroke:Rt._defaultLineColor,"stroke-width":1})}clone(){const t=new c_(this._viewParameters);return t.updateAll(this),t}}class wi extends Mt{#t=!1;#e=null;#n=null;#s=null;static _type="signature";static _editorType=Vt.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#n=t.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){Rt.initialize(t,e),this._defaultDrawingOptions=new l_,this._defaultDrawnSignatureOptions=new c_(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return Gt(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:n}=this;if(n&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(this.#n){const{lines:s,mustSmooth:o,areContours:l,description:u,uuid:h,heightInPage:f}=this.#n,{rawDims:{pageWidth:m,pageHeight:v},rotation:b}=this.parent.viewport,A=Il.processDrawnLines({lines:s,pageWidth:m,pageHeight:v,rotation:b,innerMargin:wi._INNER_MARGIN,mustSmooth:o,areContours:l});this.addSignature(A,f,u,h)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#e||""}));return n&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#s=t,this.addEditToolbar()}getUuid(){return this.#s}get description(){return this.#e}set description(t){this.#e=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:n,width:s,height:o}=this.#n,l=Math.max(s,o),u=Il.processDrawnLines({lines:{curves:t.map(h=>({points:h})),thickness:n,width:s,height:o},pageWidth:l,pageHeight:l,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:u.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,n,s){const{x:o,y:l}=this,{outline:u}=this.#n=t;this.#t=u instanceof Hy,this.description=n;let h;this.#t?h=wi.getDefaultDrawingOptions():(h=wi._defaultDrawnSignatureOptions.clone(),h.updateProperties({"stroke-width":u.thickness})),this._addOutlines({drawOutlines:u,drawingOptions:h});const[f,m]=this.parentDimensions,[,v]=this.pageDimensions;let b=e/v;b=b>=1?.5:b,this.width*=b/this.height,this.width>=1&&(b*=.9/this.width,this.width=.9),this.height=b,this.setDims(f*this.width,m*this.height),this.x=o,this.y=l,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(s),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!s,hasDescription:!!n}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:n},rotation:s}=this.parent.viewport;return Il.process(t,e,n,s,wi._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:n,pageHeight:s},rotation:o}=this.parent.viewport;return Il.extractContoursFromText(t,e,n,s,o,wi._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:n},rotation:s}=this.parent.viewport;return Il.processDrawnLines({lines:t,pageWidth:e,pageHeight:n,rotation:s,innerMargin:wi._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=wi.getDefaultDrawingOptions():(this._drawingOptions=wi._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:n,rect:s}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":o}}=this,l={annotationType:Vt.SIGNATURE,isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:o,pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(l),t?(l.paths={lines:e,points:n},l.uuid=this.#s,l.isCopy=!0):l.lines=e,this.#e&&(l.accessibilityData={type:"Figure",alt:this.#e}),l}static deserializeDraw(t,e,n,s,o,l){return l.areContours?Hy.deserialize(t,e,n,s,o,l):vh.deserialize(t,e,n,s,o,l)}static async deserialize(t,e,n){const s=await super.deserialize(t,e,n);return s.#t=t.areContours,s.description=t.accessibilityData?.alt||"",s.#s=t.uuid,s}}class sV extends Rt{#t=null;#e=null;#n=null;#s=null;#r=null;#i="";#a=null;#o=!1;#u=null;#c=!1;#d=!1;static _type="stamp";static _editorType=Vt.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#s=t.bitmapUrl,this.#r=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){Rt.initialize(t,e)}static isHandlingMimeForPasting(t){return Oy.includes(t)}static paste(t,e){e.pasteEditor({mode:Vt.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#l(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#c=t.isSvg),t.file&&(this.#i=t.file.name),this.#f()}#p(){if(this.#n=null,this._uiManager.enableWaiting(!1),!!this.#a){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:n}=this._uiManager;if(!n)throw new Error("No ML.");if(!await n.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:s,width:o,height:l}=t||this.copyCanvas(null,null,!0).imageData,u=await n.guess({name:"altText",request:{data:s,width:o,height:l,channels:s.length/(o*l)}});if(!u)throw new Error("No response from the AI service.");if(u.error)throw new Error("Error from the AI service.");if(u.cancel)return null;if(!u.output)throw new Error("No valid response from the AI service.");const h=u.output;return await this.setGuessedAltText(h),e&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}#g(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(n=>this.#l(n,!0)).finally(()=>this.#p());return}if(this.#s){const n=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromUrl(n).then(s=>this.#l(s)).finally(()=>this.#p());return}if(this.#r){const n=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromFile(n).then(s=>this.#l(s)).finally(()=>this.#p());return}const t=document.createElement("input");t.type="file",t.accept=Oy.join(",");const e=this._uiManager._signal;this.#n=new Promise(n=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#l(s)}n()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),n()},{signal:e})}).finally(()=>this.#p()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#a?.remove(),this.#a=null,this.#u&&(clearTimeout(this.#u),this.#u=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#g();return}super.rebuild(),this.div!==null&&(this.#e&&this.#a===null&&this.#g(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#n||this.#t||this.#s||this.#r||this.#e||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#t?this.#f():this.#g()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:n,bitmap:s}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),n&&this._uiManager.imageManager.isValidId(n)&&(this.#e=n,s&&(this.#t=s),this.#o=!1,this.#f())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#u!==null&&clearTimeout(this.#u);const t=200;this.#u=setTimeout(()=>{this.#u=null,this.#m()},t)}#f(){const{div:t}=this;let{width:e,height:n}=this.#t;const[s,o]=this.pageDimensions,l=.75;if(this.width)e=this.width*s,n=this.height*o;else if(e>l*s||n>l*o){const m=Math.min(l*s/e,l*o/n);e*=m,n*=m}const[u,h]=this.parentDimensions;this.setDims(e*u/s,n*h/o),this._uiManager.enableWaiting(!1);const f=this.#a=document.createElement("canvas");f.setAttribute("role","img"),this.addContainer(f),this.width=e/s,this.height=n/o,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#m(),this.#d||(this.parent.addUndoableEditor(this),this.#d=!0),this._reportTelemetry({action:"inserted_image"}),this.#i&&this.div.setAttribute("aria-description",this.#i),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,n=!1){t||(t=224);const{width:s,height:o}=this.#t,l=new ki;let u=this.#t,h=s,f=o,m=null;if(e){if(s>e||o>e){const G=Math.min(e/s,e/o);h=Math.floor(s*G),f=Math.floor(o*G)}m=document.createElement("canvas");const b=m.width=Math.ceil(h*l.sx),A=m.height=Math.ceil(f*l.sy);this.#c||(u=this.#h(b,A));const S=m.getContext("2d");S.filter=this._uiManager.hcmFilter;let E="white",T="#cfcfd8";this._uiManager.hcmFilter!=="none"?T="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(E="#8f8f9d",T="#42414d");const C=15,L=C*l.sx,k=C*l.sy,V=new OffscreenCanvas(L*2,k*2),P=V.getContext("2d");P.fillStyle=E,P.fillRect(0,0,L*2,k*2),P.fillStyle=T,P.fillRect(0,0,L,k),P.fillRect(L,k,L,k),S.fillStyle=S.createPattern(V,"repeat"),S.fillRect(0,0,b,A),S.drawImage(u,0,0,u.width,u.height,0,0,b,A)}let v=null;if(n){let b,A;if(l.symmetric&&u.width<t&&u.height<t)b=u.width,A=u.height;else if(u=this.#t,s>t||o>t){const T=Math.min(t/s,t/o);b=Math.floor(s*T),A=Math.floor(o*T),this.#c||(u=this.#h(b,A))}const E=new OffscreenCanvas(b,A).getContext("2d",{willReadFrequently:!0});E.drawImage(u,0,0,u.width,u.height,0,0,b,A),v={width:b,height:A,data:E.getImageData(0,0,b,A).data}}return{canvas:m,width:h,height:f,imageData:v}}#h(t,e){const{width:n,height:s}=this.#t;let o=n,l=s,u=this.#t;for(;o>2*t||l>2*e;){const h=o,f=l;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),l>2*e&&(l=l>=16384?Math.floor(l/2)-1:Math.ceil(l/2));const m=new OffscreenCanvas(o,l);m.getContext("2d").drawImage(u,0,0,h,f,0,0,o,l),u=m.transferToImageBitmap()}return u}#m(){const[t,e]=this.parentDimensions,{width:n,height:s}=this,o=new ki,l=Math.ceil(n*t*o.sx),u=Math.ceil(s*e*o.sy),h=this.#a;if(!h||h.width===l&&h.height===u)return;h.width=l,h.height=u;const f=this.#c?this.#t:this.#h(l,u),m=h.getContext("2d");m.filter=this._uiManager.hcmFilter,m.drawImage(f,0,0,f.width,f.height,0,0,l,u)}#_(t){if(t){if(this.#c){const s=this._uiManager.imageManager.getSvgUrl(this.#e);if(s)return s}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#c){const[e,n]=this.pageDimensions,s=Math.round(this.width*e*Kl.PDF_TO_CSS_UNITS),o=Math.round(this.height*n*Kl.PDF_TO_CSS_UNITS),l=new OffscreenCanvas(s,o);return l.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,s,o),l.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,n){let s=null,o=!1;if(t instanceof h1){const{data:{rect:E,rotation:T,id:C,structParent:L,popupRef:k,contentsObj:V},container:P,parent:{page:{pageNumber:G}},canvas:I}=t;let N,M;I?(delete t.canvas,{id:N,bitmap:M}=n.imageManager.getFromCanvas(P.id,I),I.remove()):(o=!0,t._hasNoCanvas=!0);const j=(await e._structTree.getAriaAttributes(`${Wv}${C}`))?.get("aria-label")||"";s=t={annotationType:Vt.STAMP,bitmapId:N,bitmap:M,pageIndex:G-1,rect:E.slice(0),rotation:T,annotationElementId:C,id:C,deleted:!1,accessibilityData:{decorative:!1,altText:j},isSvg:!1,structParent:L,popupRef:k,comment:V?.str||null}}const l=await super.deserialize(t,e,n),{rect:u,bitmap:h,bitmapUrl:f,bitmapId:m,isSvg:v,accessibilityData:b}=t;o?(n.addMissingCanvas(t.id,l),l.#o=!0):m&&n.imageManager.isValidId(m)?(l.#e=m,h&&(l.#t=h)):l.#s=f,l.#c=v;const[A,S]=l.pageDimensions;return l.width=(u[2]-u[0])/A,l.height=(u[3]-u[1])/S,b&&(l.altTextData=b),l._initialData=s,t.comment&&l.setCommentData(t.comment),l.#d=!!s,l}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n={annotationType:Vt.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#c,structTreeParentId:this._structTreeParentId};if(this.addComment(n),t)return n.bitmapUrl=this.#_(!0),n.accessibilityData=this.serializeAltText(!0),n.isCopy=!0,n;const{decorative:s,altText:o}=this.serializeAltText(!1);if(!s&&o&&(n.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const u=this.#y(n);if(u.isSame)return null;u.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=this._initialData.structParent??-1}if(n.id=this.annotationElementId,e===null)return n;e.stamps||=new Map;const l=this.#c?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:l,serialized:n}),n.bitmap=this.#_(!1);else if(this.#c){const u=e.stamps.get(this.#e);l>u.area&&(u.area=l,u.serialized.bitmap.close(),u.serialized.bitmap=this.#_(!1))}return n}#y(t){const{pageIndex:e,accessibilityData:{altText:n}}=this._initialData,s=t.pageIndex===e,o=(t.accessibilityData?.alt||"")===n;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&s&&o,isSameAltText:o}}renderAnnotationElement(t){const e={rect:this.getRect(0,0)};return this.hasEditedComment&&(e.popup=this.comment),t.updateEdited(e),null}}class ar{#t;#e=!1;#n=null;#s=null;#r=null;#i=new Map;#a=!1;#o=!1;#u=!1;#c=null;#d=null;#l=null;#p=null;#g=null;#f=-1;#h;static _initialized=!1;static#m=new Map([on,o_,sV,Fe,wi].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:n,structTreeLayer:s,accessibilityManager:o,annotationLayer:l,drawLayer:u,textLayer:h,viewport:f,l10n:m}){const v=[...ar.#m.values()];if(!ar._initialized){ar._initialized=!0;for(const b of v)b.initialize(m,t)}t.registerEditorTypes(v),this.#h=t,this.pageIndex=e,this.div=n,this.#t=o,this.#n=l,this.viewport=f,this.#l=h,this.drawLayer=u,this._structTree=s,this.#h.addLayer(this)}get isEmpty(){return this.#i.size===0}get isInvisible(){return this.isEmpty&&this.#h.getMode()===Vt.NONE}updateToolbar(t){this.#h.updateToolbar(t)}updateMode(t=this.#h.getMode()){switch(this.#v(),t){case Vt.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Vt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Vt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const n of ar.#m.values())e.toggle(`${n._type}Editing`,t===n._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#l?.div}setEditingState(t){this.#h.setEditingState(t)}addCommands(t){this.#h.addCommands(t)}cleanUndoStack(t){this.#h.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#n?.div.classList.toggle("disabled",!t)}async enable(){this.#u=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.#g?.abort(),this.#g=null;const t=new Set;for(const n of this.#i.values())n.enableEditing(),n.show(!0),n.annotationElementId&&(this.#h.removeChangedExistingAnnotation(n),t.add(n.annotationElementId));if(!this.#n){this.#u=!1;return}const e=this.#n.getEditableAnnotations();for(const n of e){if(n.hide(),this.#h.isDeletedAnnotationElement(n.data.id)||t.has(n.data.id))continue;const s=await this.deserialize(n);s&&(this.addOrRebuild(s),s.enableEditing())}this.#u=!1}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.#l&&!this.#g){this.#g=new AbortController;const s=this.#h.combinedSignal(this.#g);this.#l.div.addEventListener("pointerdown",o=>{const{clientX:u,clientY:h,timeStamp:f}=o,m=this.#f;if(f-m>500){this.#f=f;return}this.#f=-1;const{classList:v}=this.div;v.toggle("getElements",!0);const b=document.elementsFromPoint(u,h);if(v.toggle("getElements",!1),!this.div.contains(b[0]))return;let A;const S=new RegExp(`^${Lx}[0-9]+$`);for(const T of b)if(S.test(T.id)){A=T.id;break}if(!A)return;const E=this.#i.get(A);E?.annotationElementId===null&&(o.stopPropagation(),o.preventDefault(),E.dblclick())},{signal:s,capture:!0})}const t=new Map,e=new Map;for(const s of this.#i.values())if(s.disableEditing(),!!s.annotationElementId){if(s.serialize()!==null){t.set(s.annotationElementId,s);continue}else e.set(s.annotationElementId,s);this.getEditableAnnotation(s.annotationElementId)?.show(),s.remove()}if(this.#n){const s=this.#n.getEditableAnnotations();for(const o of s){const{id:l}=o.data;if(this.#h.isDeletedAnnotationElement(l)){o.updateEdited({deleted:!0});continue}let u=e.get(l);if(u){u.resetAnnotationElement(o),u.show(!1),o.show();continue}u=t.get(l),u&&(this.#h.addChangedExistingAnnotation(u),u.renderAnnotationElement(o)&&u.show(!1)),o.show()}}this.#v(),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const s of ar.#m.values())n.remove(`${s._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o=!1}getEditableAnnotation(t){return this.#n?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#h.getActive()!==t&&this.#h.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#l?.div&&!this.#p){this.#p=new AbortController;const t=this.#h.combinedSignal(this.#p);this.#l.div.addEventListener("pointerdown",this.#_.bind(this),{signal:t}),this.#l.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#l?.div&&this.#p&&(this.#p.abort(),this.#p=null,this.#l.div.classList.remove("highlighting"))}#_(t){this.#h.unselectAll();const{target:e}=t;if(e===this.#l.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#l.div.contains(e)){const{isMac:n}=Tn.platform;if(t.button!==0||t.ctrlKey&&n)return;this.#h.showAllEditors("highlight",!0,!0),this.#l.div.classList.add("free"),this.toggleDrawing(),Fe.startHighlighting(this,this.#h.direction==="ltr",{target:this.#l.div,x:t.x,y:t.y}),this.#l.div.addEventListener("pointerup",()=>{this.#l.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#h._signal}),t.preventDefault()}}enableClick(){if(this.#s)return;this.#s=new AbortController;const t=this.#h.combinedSignal(this.#s);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#s?.abort(),this.#s=null}attach(t){this.#i.set(t.id,t);const{annotationElementId:e}=t;e&&this.#h.isDeletedAnnotationElement(e)&&this.#h.removeDeletedAnnotationElement(t)}detach(t){this.#i.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#o&&t.annotationElementId&&this.#h.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#h.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#h.addDeletedAnnotationElement(t.annotationElementId),Rt.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#h.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#u),this.#h.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#r&&(t._focusEventsAllowed=!1,this.#r=setTimeout(()=>{this.#r=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#h._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),n=()=>{t.remove()};this.addCommands({cmd:e,undo:n,mustExec:!1})}getNextId(){return this.#h.getId()}get#y(){return ar.#m.get(this.#h.getMode())}combinedSignal(t){return this.#h.combinedSignal(t)}#A(t){const e=this.#y;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#y?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#h.updateMode(t.mode);const{offsetX:n,offsetY:s}=this.#w(),o=this.getNextId(),l=this.#A({parent:this,id:o,x:n,y:s,uiManager:this.#h,isCentered:!0,...e});l&&this.add(l)}async deserialize(t){return await ar.#m.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#h)||null}createAndAddNewEditor(t,e,n={}){const s=this.getNextId(),o=this.#A({parent:this,id:s,x:t.offsetX,y:t.offsetY,uiManager:this.#h,isCentered:e,...n});return o&&this.add(o),o}#w(){const{x:t,y:e,width:n,height:s}=this.div.getBoundingClientRect(),o=Math.max(0,t),l=Math.max(0,e),u=Math.min(window.innerWidth,t+n),h=Math.min(window.innerHeight,e+s),f=(o+u)/2-t,m=(l+h)/2-e,[v,b]=this.viewport.rotation%180===0?[f,m]:[m,f];return{offsetX:v,offsetY:b}}addNewEditor(t={}){this.createAndAddNewEditor(this.#w(),!0,t)}setSelected(t){this.#h.setSelected(t)}toggleSelected(t){this.#h.toggleSelected(t)}unselect(t){this.#h.unselect(t)}pointerup(t){const{isMac:e}=Tn.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!this.#a||(this.#a=!1,this.#y?.isDrawer&&this.#y.supportMultipleDrawings))return;if(!this.#e){this.#e=!0;return}const n=this.#h.getMode();if(n===Vt.STAMP||n===Vt.SIGNATURE){this.#h.unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){if(this.#h.getMode()===Vt.HIGHLIGHT&&this.enableTextSelection(),this.#a){this.#a=!1;return}const{isMac:e}=Tn.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#a=!0,this.#y?.isDrawer){this.startDrawingSession(t);return}const n=this.#h.getActive();this.#e=!n||n.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#c){this.#y.startDrawing(this,this.#h,!1,t);return}this.#h.setCurrentDrawingSession(this),this.#c=new AbortController;const e=this.#h.combinedSignal(this.#c);this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(this.#d=null,this.commitOrRemove())},{signal:e}),this.#y.startDrawing(this,this.#h,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#d=e);return}this.#d&&setTimeout(()=>{this.#d?.focus(),this.#d=null},0)}endDrawingSession(t=!1){return this.#c?(this.#h.setCurrentDrawingSession(null),this.#c.abort(),this.#c=null,this.#d=null,this.#y.endDrawing(t)):null}findNewParent(t,e,n){const s=this.#h.findParent(e,n);return s===null||s===this?!1:(s.changeParent(t),!0)}commitOrRemove(){return this.#c?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#c&&this.#y.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#h.getActive()?.parent===this&&(this.#h.commitOrRemove(),this.#h.setActiveEditor(null)),this.#r&&(clearTimeout(this.#r),this.#r=null);for(const t of this.#i.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#i.clear(),this.#h.removeLayer(this)}#v(){for(const t of this.#i.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,Ao(this.div,t);for(const e of this.#h.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#h.commitOrRemove(),this.#v();const e=this.viewport.rotation,n=t.rotation;if(this.viewport=t,Ao(this.div,{rotation:n}),e!==n)for(const s of this.#i.values())s.rotate(n)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#h.viewParameters.realScale}}class wn{#t=null;#e=new Map;#n=new Map;static#s=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#e.size>0)for(const e of this.#e.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return Gt(this,"_svgFactory",new Gf)}static#r(t,[e,n,s,o]){const{style:l}=t;l.top=`${100*n}%`,l.left=`${100*e}%`,l.width=`${100*s}%`,l.height=`${100*o}%`}#i(){const t=wn._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#a(t,e){const n=wn._svgFactory.createElement("clipPath");t.append(n);const s=`clip_${e}`;n.setAttribute("id",s),n.setAttribute("clipPathUnits","objectBoundingBox");const o=wn._svgFactory.createElement("use");return n.append(o),o.setAttribute("href",`#${e}`),o.classList.add("clip"),s}#o(t,e){for(const[n,s]of Object.entries(e))s===null?t.removeAttribute(n):t.setAttribute(n,s)}draw(t,e=!1,n=!1){const s=wn.#s++,o=this.#i(),l=wn._svgFactory.createElement("defs");o.append(l);const u=wn._svgFactory.createElement("path");l.append(u);const h=`path_p${this.pageIndex}_${s}`;u.setAttribute("id",h),u.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#n.set(s,u);const f=n?this.#a(l,h):null,m=wn._svgFactory.createElement("use");return o.append(m),m.setAttribute("href",`#${h}`),this.updateProperties(o,t),this.#e.set(s,o),{id:s,clipPathId:`url(#${f})`}}drawOutline(t,e){const n=wn.#s++,s=this.#i(),o=wn._svgFactory.createElement("defs");s.append(o);const l=wn._svgFactory.createElement("path");o.append(l);const u=`path_p${this.pageIndex}_${n}`;l.setAttribute("id",u),l.setAttribute("vector-effect","non-scaling-stroke");let h;if(e){const v=wn._svgFactory.createElement("mask");o.append(v),h=`mask_p${this.pageIndex}_${n}`,v.setAttribute("id",h),v.setAttribute("maskUnits","objectBoundingBox");const b=wn._svgFactory.createElement("rect");v.append(b),b.setAttribute("width","1"),b.setAttribute("height","1"),b.setAttribute("fill","white");const A=wn._svgFactory.createElement("use");v.append(A),A.setAttribute("href",`#${u}`),A.setAttribute("stroke","none"),A.setAttribute("fill","black"),A.setAttribute("fill-rule","nonzero"),A.classList.add("mask")}const f=wn._svgFactory.createElement("use");s.append(f),f.setAttribute("href",`#${u}`),h&&f.setAttribute("mask",`url(#${h})`);const m=f.cloneNode();return s.append(m),f.classList.add("mainOutline"),m.classList.add("secondaryOutline"),this.updateProperties(s,t),this.#e.set(n,s),n}finalizeDraw(t,e){this.#n.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:n,bbox:s,rootClass:o,path:l}=e,u=typeof t=="number"?this.#e.get(t):t;if(u){if(n&&this.#o(u,n),s&&wn.#r(u,s),o){const{classList:h}=u;for(const[f,m]of Object.entries(o))h.toggle(f,m)}if(l){const f=u.firstChild.firstChild;this.#o(f,l)}}}updateParent(t,e){if(e===this)return;const n=this.#e.get(t);n&&(e.#t.append(n),this.#e.delete(t),e.#e.set(t,n))}remove(t){this.#n.delete(t),this.#t!==null&&(this.#e.get(t).remove(),this.#e.delete(t))}destroy(){this.#t=null;for(const t of this.#e.values())t.remove();this.#e.clear(),this.#n.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:By};globalThis.pdfjsLib={AbortException:ga,AnnotationEditorLayer:ar,AnnotationEditorParamsType:Xt,AnnotationEditorType:Vt,AnnotationEditorUIManager:ya,AnnotationLayer:a_,AnnotationMode:na,AnnotationType:Ye,build:Pj,ColorPicker:Ps,createValidAbsoluteUrl:Ox,DOMSVGFactory:Gf,DrawLayer:wn,FeatureTest:Tn,fetchData:ph,getDocument:n1,getFilenameFromUrl:xO,getPdfFilenameFromUrl:CO,getRGB:wp,getUuid:Ux,getXfaPageViewport:IO,GlobalWorkerOptions:Ul,ImageKind:yf,InvalidPDFException:Py,isDataScheme:Ap,isPdfFile:Xv,isValidExplicitDest:FO,MathClamp:Bn,noContextMenu:js,normalizeUnicode:EO,OPS:zf,OutputScale:ki,PasswordResponses:pO,PDFDataRangeTransport:s1,PDFDateString:Ly,PDFWorker:Ku,PermissionFlag:fO,PixelsPerInch:Kl,RenderingCancelledException:Yv,ResponseException:Hf,setLayerDimensions:Ao,shadow:Gt,SignatureExtractor:Il,stopEvent:Qe,SupportedImageMimeTypes:Oy,TextLayer:Un,TouchManager:Ep,updateUrlHash:jx,Util:Tt,VerbosityLevel:vp,version:Dj,XfaLayer:a1};Ul.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.6.82/pdf.worker.min.js";const iV=({url:i,height:t=600})=>{const e=B.useRef(null),[n,s]=B.useState(null),[o,l]=B.useState(1),[u,h]=B.useState(1),[f,m]=B.useState(!0),[v,b]=B.useState(null);return B.useEffect(()=>{let A=!0;return m(!0),b(null),s(null),l(1),n1({url:i,withCredentials:!1}).promise.then(S=>{A&&(s(S),h(S.numPages))}).catch(()=>{A&&b("Gagal memuat PDF")}).finally(()=>A&&m(!1)),()=>{A=!1}},[i]),B.useEffect(()=>{(async()=>{if(!n||!e.current)return;const S=await n.getPage(o),E=S.getViewport({scale:1.5}),T=e.current,C=T.getContext("2d");C&&(T.width=E.width,T.height=E.height,await S.render({canvasContext:C,canvas:T,viewport:E}).promise)})()},[n,o]),f?g.jsxs("div",{className:"loading-state",children:[g.jsx("div",{className:"loading-spinner"}),g.jsx("p",{children:"Memuat PDF..."})]}):v?g.jsx("div",{className:"error-message",children:v}):g.jsxs("div",{style:{userSelect:"none"},onContextMenu:A=>A.preventDefault(),children:[g.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[g.jsxs("div",{style:{color:"#64748b"},children:["Halaman ",o," dari ",u]}),g.jsxs("div",{style:{display:"flex",gap:8},children:[g.jsx("button",{className:"btn-secondary",onClick:()=>l(A=>Math.max(1,A-1)),disabled:o<=1,children:""}),g.jsx("button",{className:"btn-secondary",onClick:()=>l(A=>Math.min(u,A+1)),disabled:o>=u,children:""})]})]}),g.jsx("div",{style:{border:"1px solid #e5e7eb",borderRadius:8,overflow:"hidden",maxHeight:t},children:g.jsx("canvas",{ref:e,style:{width:"100%",height:t}})})]})},rV=()=>{const{moduleId:i,lessonId:t}=Yy(),e=Wy(),{user:n,userDoc:s}=Ar(),[o,l]=B.useState(!0),[u,h]=B.useState(null),[f,m]=B.useState(null),v=B.useRef(!1);B.useEffect(()=>{(async()=>{if(i){l(!0),h(null);try{const P=await gt.getModuleWithLessons(i);m(P)}catch(P){h(P?.message||"Gagal memuat materi")}finally{l(!1)}}})()},[i]);const b=B.useRef(!1);B.useEffect(()=>{if(!n||!i||!t)return;b.current=!1;const V=window.setTimeout(async()=>{if(!b.current)try{await gt.markLessonRead(n.uid,i,t),b.current=!0}catch{}},1e4);return()=>{window.clearTimeout(V)}},[n,i,t]),B.useEffect(()=>{const V=()=>{v.current||(v.current=!0,e("/belajar",{replace:!0}))},P=()=>{document.visibilityState==="hidden"&&V()},G=()=>{V()};return document.addEventListener("visibilitychange",P),window.addEventListener("blur",G),()=>{document.removeEventListener("visibilitychange",P),window.removeEventListener("blur",G)}},[e]);const A=B.useMemo(()=>{if(!f||!t)return null;const V=f.lessons.findIndex(N=>N.id===t);if(V===-1)return null;const P=f.lessons[V],G=V>0?f.lessons[V-1]:null,I=V<f.lessons.length-1?f.lessons[V+1]:null;return{idx:V,current:P,prev:G,next:I}},[f,t]),S=A?.current?.assets&&A.current.assets[0]||"",E=B.useMemo(()=>{if(!S)return"";const V=S.trim();if(/drive\.google\.com/.test(V)){const P=V.match(/drive\.google\.com\/file\/d\/([^/]+)/);if(P&&P[1])return`https://drive.google.com/file/d/${P[1]}/preview`;const G=V.match(/[?&]id=([^&]+)/);if(G&&G[1])return`https://drive.google.com/file/d/${decodeURIComponent(G[1])}/preview`;const I=V.match(/uc\?id=([^&]+)/);return I&&I[1]?`https://drive.google.com/file/d/${decodeURIComponent(I[1])}/preview`:V.replace("/view","/preview")}return V},[S]);if(o)return g.jsx("div",{className:"dashboard-main",children:g.jsx("div",{className:"container",children:g.jsxs("div",{className:"loading-state",children:[g.jsx("div",{className:"loading-spinner"}),g.jsx("p",{children:"Memuat materi..."})]})})});if(u||!f||!A)return g.jsx("div",{className:"dashboard-main",children:g.jsxs("div",{className:"container",children:[u?g.jsx("div",{className:"error-message",children:u}):g.jsx("div",{className:"card",children:g.jsx("p",{children:"Materi tidak ditemukan."})}),g.jsx(ts,{className:"btn-secondary",to:"/belajar",style:{display:"inline-block",marginTop:12},children:"Kembali ke Belajar"})]})});const{current:T,prev:C,next:L}=A,k=s?.role==="teacher";return T.visible===!1&&!k?g.jsx("div",{className:"dashboard-main",children:g.jsx("div",{className:"container",children:g.jsx("div",{className:"card",style:{maxWidth:720,margin:"0 auto"},children:g.jsxs("div",{className:"card-content",children:[g.jsx("h3",{style:{marginTop:0},children:"Materi Tertutup"}),g.jsx("p",{children:"Materi ini belum ditampilkan untuk siswa. Silakan hubungi guru Anda."}),g.jsx("div",{className:"form-actions",children:g.jsx(ts,{className:"btn-secondary",to:"/belajar",children:"Kembali ke Belajar"})})]})})})}):g.jsx("div",{className:"dashboard-main",children:g.jsx("div",{className:"container",children:g.jsxs("div",{className:"card",style:{maxWidth:900,margin:"0 auto"},children:[g.jsx("div",{style:{marginBottom:8},children:g.jsx(ts,{to:"/belajar",className:"btn-secondary",style:{display:"inline-block"},children:" Kembali ke Bab"})}),g.jsx("h3",{style:{marginBottom:8},children:f?.title||"Bab"}),g.jsx("h1",{style:{marginTop:0},children:T.title}),g.jsx("div",{style:{marginTop:12,lineHeight:1.7,color:"#334155",whiteSpace:"pre-wrap"},children:T.content||"Belum ada konten."}),E?g.jsxs("div",{style:{marginTop:16},onContextMenu:V=>V.preventDefault(),children:[g.jsx("h4",{style:{margin:"12px 0"},children:"Lampiran"}),/drive\.google\.com/.test(E)?g.jsx("div",{style:{border:"1px solid #e5e7eb",borderRadius:8,overflow:"hidden"},children:g.jsx("iframe",{src:E,style:{width:"100%",height:600,border:"none"},title:"Lampiran PDF"})}):g.jsx(iV,{url:E,height:600})]}):g.jsx("div",{style:{marginTop:12,color:"#64748b"},children:"Tidak ada lampiran."}),g.jsxs("div",{className:"form-actions",style:{justifyContent:"space-between",marginTop:24},children:[g.jsx("button",{className:"btn-secondary",disabled:!C,onClick:()=>C&&e(`/belajar/m/${f.id}/lesson/${C.id}`),children:" Sebelumnya"}),g.jsx("button",{className:"btn-primary",disabled:!L,onClick:()=>L&&e(`/belajar/m/${f.id}/lesson/${L.id}`),children:"Lanjutkan "})]})]})})})},aV=()=>{const{quizId:i}=Yy(),{user:t}=Ar(),[e,n]=B.useState(!0),[s,o]=B.useState(null),[l,u]=B.useState(null),[h,f]=B.useState([]),[m,v]=B.useState({}),[b,A]=B.useState(!1),S=B.useRef(!1),[E,T]=B.useState(!1),[C,L]=B.useState(0);B.useEffect(()=>{(async()=>{if(i){n(!0),o(null);try{const M=(await gt.getQuizzes()).find(j=>j.id===i)||null;if(u(M),M){const j=await gt.getQuestions(M.id);if(f(j),t){(await gt.getAnswersByUser(t.uid,M.id)).length>0&&T(!0);const z=await gt.getRetakeGrant(t.uid,M.id);L(z?.allowed??0)}}}catch(N){o(N?.message||"Gagal memuat kuis")}finally{n(!1)}}})()},[i,t]);const k=B.useMemo(()=>h.length>0,[h]),V=B.useCallback(()=>h.map(I=>{let N=-1,M;I.type==="multiple_choice"||I.type==="dropdown"?N=typeof m[I.id]=="number"?m[I.id]:-1:I.type==="checkboxes"?N=(Array.isArray(m[I.id])?m[I.id]:[]).length?-2:-1:(N=-1,M=typeof m[I.id]=="string"?m[I.id]:"");const j=typeof I.correctIndex=="number"&&N===I.correctIndex;return{questionId:I.id,selectedIndex:N,isCorrect:j,textAnswer:M}}),[h,m]),P=B.useCallback(async()=>{if(!(!t||!l)&&!S.current){S.current=!0;try{A(!0);try{(await gt.getAnswersByUser(t.uid,l.id)).length>0&&await gt.consumeRetake(t.uid,l.id)}catch{}const I=V();await gt.replaceAnswers(t.uid,l.id,I),alert("Kuis selesai. Jawaban telah disimpan."),window.location.hash="#/dashboard"}catch(I){console.error(I),alert("Gagal menyimpan jawaban.")}finally{A(!1)}}},[t,l,V]);if(B.useEffect(()=>{const I=()=>{document.visibilityState==="hidden"&&P()},N=()=>{P()},M=()=>{P()};return document.addEventListener("visibilitychange",I),window.addEventListener("blur",N),window.addEventListener("pagehide",M),()=>{document.removeEventListener("visibilitychange",I),window.removeEventListener("blur",N),window.removeEventListener("pagehide",M)}},[P]),!t)return null;if(e)return g.jsx("div",{className:"dashboard-main",children:g.jsx("div",{className:"container",children:g.jsxs("div",{className:"loading-state",children:[g.jsx("div",{className:"loading-spinner"}),g.jsx("p",{children:"Memuat kuis..."})]})})});if(s||!l)return g.jsx("div",{className:"dashboard-main",children:g.jsxs("div",{className:"container",children:[s?g.jsx("div",{className:"error-message",children:s}):g.jsx("div",{className:"card",children:g.jsx("p",{children:"Kuis tidak ditemukan."})}),g.jsx(ts,{className:"btn-secondary",to:"/belajar",style:{display:"inline-block",marginTop:12},children:"Kembali ke Belajar"})]})});if(E&&C<=0)return g.jsx("div",{className:"dashboard-main",children:g.jsx("div",{className:"container",children:g.jsx("div",{className:"card",style:{maxWidth:720,margin:"0 auto"},children:g.jsxs("div",{className:"card-content",children:[g.jsx("h3",{style:{marginTop:0},children:"Kuis Sudah Diselesaikan"}),g.jsx("p",{children:"Anda telah menyelesaikan kuis ini. Silakan kembali ke halaman Belajar atau Dashboard."}),g.jsxs("div",{className:"form-actions",children:[g.jsx(ts,{className:"btn-secondary",to:"/belajar",children:"Kembali ke Belajar"}),g.jsx(ts,{className:"btn-primary",to:"/dashboard",children:"Ke Dashboard"})]})]})})})});const G=E&&C>0;return g.jsx("div",{className:"dashboard-main take-quiz",children:g.jsx("div",{className:"container",children:g.jsxs("div",{className:"card",style:{maxWidth:900,margin:"0 auto"},children:[g.jsx("div",{style:{marginBottom:8},children:g.jsx(ts,{to:"/belajar",className:"btn-secondary",style:{display:"inline-block"},children:" Kembali ke Belajar"})}),g.jsx("h1",{style:{marginTop:0},children:l.title}),l.timeLimitSec&&g.jsxs("p",{style:{color:"#64748b"},children:["Batas waktu: ",Math.round(l.timeLimitSec/60)," menit"]}),G&&g.jsx("div",{className:"card",style:{background:"#f8fafc",border:"1px dashed #94a3b8",padding:12,marginBottom:12},children:g.jsxs("p",{style:{margin:0},children:["Guru telah memberikan akses ulang untuk kuis ini. Sisa kesempatan: ",g.jsx("strong",{children:C}),"."]})}),h.length===0?g.jsx("div",{className:"empty-state",children:"Belum ada pertanyaan."}):g.jsxs("form",{className:"form-grid",onSubmit:I=>{I.preventDefault(),P()},children:[h.map((I,N)=>g.jsx("div",{className:"content-card",children:g.jsxs("div",{className:"card-content",children:[g.jsxs("h4",{style:{marginTop:0},children:["Pertanyaan ",N+1]}),I.imageUrl&&g.jsx("div",{style:{marginBottom:10},children:g.jsx("img",{src:oV(I.imageUrl),alt:I.imageAlt||"Ilustrasi pertanyaan",style:{maxWidth:"100%",height:"auto",borderRadius:8,display:"block"},loading:"lazy"})}),g.jsx("p",{style:{whiteSpace:"pre-wrap"},children:I.text}),I.type==="multiple_choice"&&I.options&&g.jsx("div",{className:"quiz-options",children:I.options.map((M,j)=>g.jsxs("label",{style:{display:"block",marginBottom:6},children:[g.jsx("input",{type:"radio",name:`q_${I.id}`,value:j,onChange:()=>v(F=>({...F,[I.id]:j})),checked:m[I.id]===j})," ",M]},j))}),I.type==="checkboxes"&&I.options&&g.jsx("div",{className:"quiz-options",children:I.options.map((M,j)=>g.jsxs("label",{style:{display:"block",marginBottom:6},children:[g.jsx("input",{type:"checkbox",value:j,onChange:F=>{v(z=>{const U=Array.isArray(z[I.id])?z[I.id]:[],st=new Set(U);return F.target.checked?st.add(j):st.delete(j),{...z,[I.id]:Array.from(st).sort()}})},checked:Array.isArray(m[I.id])&&m[I.id].includes(j)})," ",M]},j))}),I.type==="dropdown"&&I.options&&g.jsxs("select",{value:m[I.id]??"",onChange:M=>v(j=>({...j,[I.id]:Number(M.target.value)})),children:[g.jsx("option",{value:"",disabled:!0,children:"Pilih jawaban"}),I.options.map((M,j)=>g.jsx("option",{value:j,children:M},j))]}),I.type==="short_answer"&&g.jsx("div",{className:"form-group",children:g.jsx("input",{type:"text",className:"w-full p-4 text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Jawaban singkat",value:m[I.id]??"",onChange:M=>v(j=>({...j,[I.id]:M.target.value}))})}),I.type==="paragraph"&&g.jsx("div",{className:"form-group",children:g.jsx("textarea",{className:"w-full p-4 text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 min-h-[140px] md:min-h-[180px] resize-y",placeholder:"Jawaban panjang",rows:6,value:m[I.id]??"",onChange:M=>v(j=>({...j,[I.id]:M.target.value}))})})]})},I.id)),g.jsx("div",{className:"form-actions",style:{justifyContent:"flex-end"},children:g.jsx("button",{type:"submit",className:"btn-primary",disabled:!k||b,children:b?"Menyimpan...":"Kumpulkan"})})]})]})})})};function oV(i){return i?/^https?:\/\//i.test(i)?i:("/kelazgraphicdesigner"+(i.startsWith("~/")?i.slice(1):i).replace(/^\//,"")).replace(/\/+/g,"/"):""}const lV="dgkh8fleg",cV="kelazgraphicdesigner";function uV(i){return i.replace("/upload/","/upload/f_auto,q_auto,w_1600,c_limit/")}async function hV(i){const t=new FormData;t.append("file",i),t.append("upload_preset",cV);const e=await fetch(`https://api.cloudinary.com/v1_1/${lV}/image/upload`,{method:"POST",body:t});if(!e.ok)throw new Error("Upload gagal");return e.json()}const dV=()=>{const{quizId:i}=Yy(),[t,e]=B.useState(!0),[n,s]=B.useState([]),[o,l]=B.useState([]),[u,h]=B.useState(null),[f,m]=B.useState([]),[v,b]=B.useState({moduleId:"",lessonId:"",title:"",timeLimitMin:10});B.useEffect(()=>{(async()=>{if(i){e(!0);try{const[C,L]=await Promise.all([gt.getModules(),gt.getQuiz(i)]);if(s(C),!L){h(null);return}if(h(L),b({moduleId:L.moduleId||"",lessonId:L.lessonId||"",title:L.title,timeLimitMin:Math.max(1,Math.round((L.timeLimitSec??600)/60))}),L.moduleId){const V=await gt.getLessons(L.moduleId);l(V)}const k=await gt.getQuestions(L.id);m(k)}finally{e(!1)}}})()},[i]),B.useEffect(()=>{(async()=>{if(!v.moduleId){l([]),b(L=>({...L,lessonId:""}));return}const C=await gt.getLessons(v.moduleId);l(C),C.find(L=>L.id===v.lessonId)||b(L=>({...L,lessonId:""}))})()},[v.moduleId]);const A=async()=>{u&&(await gt.updateQuiz(u.id,{moduleId:v.moduleId,lessonId:v.lessonId,title:v.title.trim(),timeLimitSec:Math.max(60,v.timeLimitMin*60)}),alert("Info kuis disimpan"))},S=async(T,C)=>{u&&(await gt.updateQuestion(u.id,T,C),m(L=>L.map(k=>k.id===T?{...k,...C}:k)))},E=async T=>{u&&confirm("Hapus pertanyaan ini?")&&(await gt.deleteQuestion(u.id,T),m(C=>C.filter(L=>L.id!==T)))};return t?g.jsx("div",{className:"dashboard-main",children:g.jsx("div",{className:"container",children:g.jsxs("div",{className:"loading-state",children:[g.jsx("div",{className:"loading-spinner"}),g.jsx("p",{children:"Memuat..."})]})})}):u?g.jsx("div",{className:"dashboard-main",children:g.jsxs("div",{className:"container",children:[g.jsx("div",{style:{marginBottom:8},children:g.jsx(ts,{to:"/dashboard",className:"btn-secondary",children:" Kembali ke Dashboard"})}),g.jsx("div",{className:"card",style:{maxWidth:1e3,margin:"0 auto"},children:g.jsxs("div",{className:"card-content",children:[g.jsx("h1",{style:{marginTop:0},children:"Edit Kuis"}),g.jsxs("div",{className:"form-card",children:[g.jsx("h4",{children:"Informasi Kuis"}),g.jsxs("div",{className:"form-row",children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Bab"}),g.jsxs("select",{value:v.moduleId,onChange:T=>b(C=>({...C,moduleId:T.target.value})),children:[g.jsx("option",{value:"",children:"-- Pilih Bab --"}),n.map(T=>g.jsx("option",{value:T.id,children:T.title},T.id))]})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Materi"}),g.jsxs("select",{value:v.lessonId,onChange:T=>b(C=>({...C,lessonId:T.target.value})),disabled:!v.moduleId,children:[g.jsx("option",{value:"",children:"-- Pilih Materi --"}),o.map(T=>g.jsx("option",{value:T.id,children:T.title},T.id))]})]})]}),g.jsxs("div",{className:"form-row",children:[g.jsxs("div",{className:"form-group",style:{flex:2},children:[g.jsx("label",{children:"Judul"}),g.jsx("input",{value:v.title,onChange:T=>b(C=>({...C,title:T.target.value}))})]}),g.jsxs("div",{className:"form-group",style:{maxWidth:220},children:[g.jsx("label",{children:"Batas Waktu (menit)"}),g.jsx("input",{type:"number",min:1,value:v.timeLimitMin,onChange:T=>b(C=>({...C,timeLimitMin:Math.max(1,parseInt(T.target.value||"1",10))}))})]})]}),g.jsx("div",{className:"form-actions",children:g.jsx("button",{className:"btn-primary",onClick:A,children:"Simpan Info"})})]}),g.jsxs("div",{className:"form-card",children:[g.jsxs("h4",{children:["Pertanyaan (",f.length,")"]}),f.length===0?g.jsx("div",{className:"empty-state",children:"Belum ada pertanyaan"}):g.jsx("div",{className:"content-grid",style:{gridTemplateColumns:"1fr"},children:f.map((T,C)=>g.jsxs("div",{className:"content-card",children:[g.jsxs("div",{className:"card-header",children:[g.jsxs("div",{className:"lesson-order",children:["P",C+1]}),g.jsx("div",{className:"card-actions",children:g.jsx("button",{className:"btn-action delete",onClick:()=>E(T.id),children:"Hapus"})})]}),g.jsxs("div",{className:"card-content",children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Tipe"}),g.jsxs("select",{value:T.type,onChange:L=>S(T.id,{type:L.target.value}),children:[g.jsx("option",{value:"multiple_choice",children:"Multiple Choice"}),g.jsx("option",{value:"checkboxes",children:"Checkboxes"}),g.jsx("option",{value:"dropdown",children:"Dropdown"}),g.jsx("option",{value:"short_answer",children:"Short Answer"}),g.jsx("option",{value:"paragraph",children:"Paragraph"})]})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Pertanyaan"}),g.jsx("textarea",{value:T.text,rows:3,onChange:L=>S(T.id,{text:L.target.value})})]}),g.jsxs("div",{className:"form-row",children:[g.jsxs("div",{className:"form-group",style:{flex:2},children:[g.jsx("label",{children:"Gambar (opsional)"}),g.jsx("input",{value:T.imageUrl||"",onChange:L=>S(T.id,{imageUrl:L.target.value})}),g.jsx("div",{style:{display:"flex",gap:8,marginTop:8,alignItems:"center"},children:g.jsx("input",{type:"file",accept:"image/*",onChange:async L=>{const k=L.target.files?.[0];if(!k)return;const V=await hV(k),P=uV(V.secure_url);S(T.id,{imageUrl:P})}})})]}),g.jsxs("div",{className:"form-group",style:{flex:1},children:[g.jsx("label",{children:"Alt text"}),g.jsx("input",{value:T.imageAlt||"",onChange:L=>S(T.id,{imageAlt:L.target.value})})]})]}),["multiple_choice","checkboxes","dropdown"].includes(T.type)&&g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Pilihan"}),(T.options||[]).map((L,k)=>g.jsxs("div",{className:"option-row",children:[T.type==="checkboxes"?g.jsx("input",{type:"checkbox",checked:(T.correctIndexes||[]).includes(k),onChange:V=>{const P=new Set(T.correctIndexes||[]);V.target.checked?P.add(k):P.delete(k);const G=Array.from(P).sort((I,N)=>I-N);S(T.id,{correctIndexes:G})}}):g.jsx("input",{type:"radio",name:`correct_${T.id}`,checked:(T.correctIndex??0)===k,onChange:()=>S(T.id,{correctIndex:k})}),g.jsx("input",{type:"text",className:"option-input",value:L,onChange:V=>{const P=[...T.options||[]];P[k]=V.target.value,S(T.id,{options:P})}}),g.jsx("button",{type:"button",className:"btn-delete",onClick:()=>{const V=(T.options||[]).filter((G,I)=>I!==k),P={options:V};T.type!=="checkboxes"?(T.correctIndex??0)>=V.length&&(P.correctIndex=0):P.correctIndexes=(T.correctIndexes||[]).filter(G=>G!==k).map(G=>G>k?G-1:G),S(T.id,P)},children:"Hapus"})]},k)),g.jsx("div",{className:"form-actions",style:{marginTop:8},children:g.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>S(T.id,{options:[...T.options||[],""]}),children:"+ Tambah Pilihan"})})]})]})]},T.id))})]})]})})]})}):g.jsx("div",{className:"dashboard-main",children:g.jsx("div",{className:"container",children:g.jsx("div",{className:"card",children:g.jsxs("div",{className:"card-content",children:[g.jsx("p",{children:"Kuis tidak ditemukan."}),g.jsx(ts,{to:"/dashboard",className:"btn-secondary",children:"Kembali"})]})})})})};function Al({children:i}){const{isAuthenticated:t,loading:e,userDoc:n}=Ar();return e?g.jsxs("div",{className:"app-loading",children:[g.jsx("div",{className:"loading-spinner"}),g.jsx("p",{children:"Loading..."})]}):t?n?.role==="student"&&(n?.status??"approved")!=="approved"?g.jsx("div",{className:"dashboard-main",children:g.jsx("div",{className:"container",children:g.jsx("div",{className:"card",style:{maxWidth:720,margin:"0 auto"},children:g.jsxs("div",{className:"card-content",children:[g.jsx("h3",{style:{marginTop:0},children:"Menunggu Persetujuan Guru"}),g.jsx("p",{children:"Akun Anda telah terdaftar sebagai siswa, namun akses belajar masih menunggu persetujuan dari guru."}),g.jsx("p",{children:"Silakan tunggu. Setelah disetujui, Anda dapat mulai belajar."}),g.jsx("div",{className:"form-actions",style:{justifyContent:"flex-end"},children:g.jsx("button",{className:"btn-secondary",onClick:()=>window.location.reload(),children:"Cek Lagi"})})]})})})}):!n||n?.status==="rejected"?g.jsx(Nl,{to:"/?msg=rejected",replace:!0}):i:g.jsx(Nl,{to:"/auth",replace:!0})}function fV(){const{isAuthenticated:i,loading:t,userDoc:e}=Ar();return t?g.jsxs("div",{className:"app-loading",children:[g.jsx("div",{className:"loading-spinner"}),g.jsx("p",{children:"Loading..."})]}):g.jsx(lI,{children:g.jsxs(UR,{children:[g.jsx(Ai,{path:"/",element:i&&(!e||e.status==="rejected")?g.jsx(y0,{onLoginClick:()=>{window.location.hash="#/auth"}}):i?g.jsx(Nl,{to:"/dashboard",replace:!0}):g.jsx(y0,{onLoginClick:()=>{window.location.hash="#/auth"}})}),g.jsx(Ai,{path:"/auth",element:i?!e||e.status==="rejected"?g.jsx(Nl,{to:"/?msg=rejected",replace:!0}):g.jsx(Nl,{to:"/dashboard",replace:!0}):g.jsx(tO,{})}),g.jsx(Ai,{path:"/dashboard",element:g.jsx(Al,{children:g.jsx(uO,{})})}),g.jsx(Ai,{path:"/belajar",element:g.jsx(Al,{children:g.jsx(hO,{})})}),g.jsx(Ai,{path:"/belajar/m/:moduleId/lesson/:lessonId",element:g.jsx(Al,{children:g.jsx(rV,{})})}),g.jsx(Ai,{path:"/kuis",element:g.jsx(Al,{children:g.jsx(dO,{})})}),g.jsx(Ai,{path:"/kuis/:quizId",element:g.jsx(Al,{children:g.jsx(aV,{})})}),g.jsx(Ai,{path:"/dashboard/edit-quiz/:quizId",element:g.jsx(Al,{children:g.jsx(dV,{})})}),g.jsx(Ai,{path:"*",element:g.jsx(Nl,{to:"/",replace:!0})})]})})}YC.createRoot(document.getElementById("root")).render(g.jsx(B.StrictMode,{children:g.jsx(fV,{})}));
